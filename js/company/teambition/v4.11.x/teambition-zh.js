/**
 * 功能描述：
 * 使用方法:
 * 注意事件：
 * 引入来源：  作用：
 *
 * Created by LiuYuTao on 2015/3/9.
 */
!function() {
    define("util", ["require", "exports", "module", "jquery", "underscore", "essage", "markdown", "moment"], function(a) {
        var b, c, d, e, f, g, h, i, j, k;
        return b = a("jquery"), j = a("underscore"), k = a("essage"), f = a("markdown"), g = a("moment"), c = b(document), e = {NO: "不重复",DAILY: "每天重复",WEEKLY: "每周重复",WEEKLY2: "每2周重复",MONTHLY: "每月重复"}, d = /^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/, h = /^\+?(?:[0-9] ?\-?){6,14}[0-9]$/, i = {formatDate: function(a) {
            var b, c;
            return b = g(a), b.isValid() ? (c = g(), a = {dateString: b.calendar(),dateClass: "normal"}, c.startOf("day").isAfter(b) ? a.dateClass = "overdue" : c.endOf("day").isAfter(b) ? a.dateClass = "today" : c.add(7, "days").endOf("day").isAfter(b) && (a.dateClass = "upcoming"), a) : {dateString: "未知日期"}
        },getPriorityDisplay: function(a) {
            var b;
            return b = {0: "普通",1: "紧急",2: "非常紧急"}, b[a || 0]
        },removeItem: function(a, b) {
            var c, d, e, f;
            if (d = 0, j.isArray(a))
                for (c = f = a.length - 1; f >= 0; c = f += -1)
                    e = a[c], e === b && (a.splice(c, 1), d += 1);
            else
                j.each(a, function(c, e) {
                    return c === b ? (delete a[e], d += 1) : void 0
                });
            return d
        },formatFileSize: function(a) {
            var b;
            if ("string" == typeof a && (-1 !== a.indexOf("K") || -1 !== a.indexOf("M")))
                return a;
            for (b = -1, a /= 1024, b++; a > 99; )
                a /= 1024, b++;
            return Math.max(a, .1).toFixed(1) + ["kB", "MB", "GB", "TB", "PB", "EB"][b]
        },isEmail: function(a) {
            return d.test(a)
        },isPhoneNum: function(a) {
            return h.test(a)
        },isId: function(a) {
            return isString(a) && /^[a-zA-Z0-9]{24}$/.test(a) ? !0 : !1
        },lengthOf: function(a) {
            var b, c;
            return b = 0, "string" == typeof a && (c = a.replace(/[\u4e00-\u9fa5]/g, function() {
                return b += 2, ""
            }), b += c.length), b
        },escape: function(a) {
            return a = null != a ? "" + a : "", /\<|\>|\"|\'/.test(a) && (a = j.escape(a)), a
        },cutString: function(a, b, c) {
            var d, e, f, g;
            if ("string" != typeof a)
                return "";
            if (this.lengthOf(a) <= b)
                return a;
            for (f = 0, e = 0, g = ""; b > e; )
                d = a.charAt(f), /[\u4e00-\u9fa5]/.test(d) ? e += 2 : e++, g += d, f++;
            return g += c
        },loadImage: function(a, b) {
            var c;
            return c = new Image, c.onload = function() {
                return c.onload = null, b(null, c.naturalWidth || c.width, c.naturalHeight || c.height, a)
            }, c.onerror = function(a) {
                return b(a)
            }, c.abort = function() {
                return c.onload = null, c.onerror = null
            }, c.src = a, c
        },loadVideo: function(a, c) {
            var d;
            return d = document.createElement("video"), d.controls = "controls", d.preload = !0, b(d).on("loadedmetadata", function() {
                return c(null, d.videoWidth, d.videoHeight, a)
            }).on("error", function(a) {
                return c(a)
            }).on("abort", function() {
                return b(d).off()
            }).html("<source src='" + a + "'></source>您的浏览器不支持该视频播放"), d
        },loadAudio: function(a, c) {
            var d;
            return d = document.createElement("audio"), d.controls = "controls", d.preload = !0, b(d).on("loadedmetadata", function() {
                return b(d).off(), c(null, a)
            }).on("error", function(a) {
                return c(a)
            }).on("abort", function() {
                return b(d).off()
            }).html("<source src='" + a + "'></source>您的浏览器不支持该音频播放"), d
        },parseJSON: function(a) {
            var b;
            try {
                return JSON.parse(a)
            } catch (c) {
                b = c, "undefined" != typeof console && null !== console && console.error(b)
            }
            return null
        },parsePost: function(a) {
            var c, d;
            return j.isObject(a) ? (a.html && "html" === a.postMode && (a.content = a.html), delete a.html, a.description = a.title, a.description || (d = j.unescape(a.content), "html" !== a.postMode && (d = f(d)), c = b("<div>" + d + "</div>"), d = c.text().trim(), d || (c = c.find("img:first"), d = c.attr("alt") || c.attr("title") || c.attr("src")), a.description = this.cutString(d, 60, "...") || "无标题"), a) : {}
        },mousewheel: function() {
            return function(a, c) {
                var d, e;
                return a.stopPropagation(), d = b(a.currentTarget), e = d.scrollTop(), c > 0 && 2 > e ? !1 : 0 > c && d[0].scrollHeight - d.innerHeight() - e < 2 ? !1 : void 0
            }
        }(this),label2Freq: function(a) {
            var b;
            switch (b = null, a) {
                case "DAILY":
                    b = {freq: RRule.DAILY,interval: 1};
                    break;
                case "WEEKLY":
                    b = {freq: RRule.WEEKLY,interval: 1};
                    break;
                case "WEEKLY2":
                    b = {freq: RRule.WEEKLY,interval: 2};
                    break;
                case "MONTHLY":
                    b = {freq: RRule.MONTHLY,interval: 1}
            }
            return b
        },freq2Label: function(a) {
            var b;
            switch (b = "NO", null != a ? a.options.freq : void 0) {
                case 1:
                    b = "MONTHLY";
                    break;
                case 2:
                    b = 2 === a.options.interval ? "WEEKLY2" : "WEEKLY";
                    break;
                case 3:
                    b = "DAILY"
            }
            return {label: b,string: e[b]}
        },message: function(a) {
            var b;
            if (a)
                return j.isString(a) && (a = {message: a}), b = "<span class='essage-tips'>" + a.tips + "</span><a class='essage-url url-handler' href='" + a.url + "'>" + a.title + "</a>", Essage.show({message: a.message || b,status: a.status || "success"}, a.time || 5e3)
        },matchString: function(a, b, c) {
            var d, e;
            return null == a && (a = ""), null == b && (b = ""), null == c && (c = 0), a.indexOf(b) >= 0 ? !0 : /[\u4e00-\u9fa5]/.test(b) ? (d = a.length - b.length, e = this.distanceString(a, b), 0 > d || e && e === Math.max(a.length, b.length) ? !1 : d + c >= e) : !1
        },distanceString: function(a, b) {
            var c, d, e, f, g, h, i, j, k, l;
            for (c = a.length + 1, d = b.length + 1, g = [], h = 0, e = i = 0; c >= 0 ? c >= i : i >= c; e = c >= 0 ? ++i : --i)
                g[e] = [e];
            for (e = j = 0; d >= 0 ? d >= j : j >= d; e = d >= 0 ? ++j : --j)
                g[0][e] = e;
            for (e = k = 1; c >= 1 ? c >= k : k >= c; e = c >= 1 ? ++k : --k)
                for (f = l = 1; d >= 1 ? d >= l : l >= d; f = d >= 1 ? ++l : --l)
                    h = a[e - 1] === b[f - 1] ? 0 : 1, g[e][f] = Math.min(g[e - 1][f] + 1, g[e][f - 1] + 1, g[e - 1][f - 1] + h);
            return g[e - 1][f - 1]
        }}
    }), define("teambition", ["require", "exports", "module"], function() {
        var a;
        return a = document.getElementById("teambition-global"), a.parentNode.removeChild(a), {NAME: "teambition",host: a.getAttribute("data-host"),apiHost: a.getAttribute("data-apihost"),pushHost: a.getAttribute("data-pushhost"),accountHost: a.getAttribute("data-accounthost"),uploadUrl: a.getAttribute("data-uploadurl"),spiderHost: a.getAttribute("data-spiderhost"),loadingStart: a.getAttribute("data-loadingstart")}
    }), define("lib/http", ["require", "exports", "module", "jquery", "underscore", "essage", "teambition", "backbone", "expireCache", "warehouse"], function(a) {
        var b, c, d, e, f, g, h, i, j, k, l;
        return b = a("jquery"), k = a("underscore"), l = a("essage"), j = a("teambition"), c = a("backbone"), e = a("expireCache"), f = a("warehouse"), d = 1e3 * k.random(5, 10), g = d, h = !0, i = !1, k.extend({}, c.Events, {initialize: function() {
            return b(window).on("offline", function() {
                return Essage.show({message: "网络有异常，请检查网络后再试",status: "error"})
            }).on("online", function() {
                return Essage.hide()
            }), this.on("reconnected", function() {
                return function() {
                    return h || Essage.show({message: "网络已连上，欢迎回来",status: "success"}, 2e3), g = d, h = !0
                }
            }(this)), this.on("disconnect", function() {
                return function() {
                    return h && Essage.show({message: "网络有异常，请检查网络后再试",status: "error"}), g = d, h = !1
                }
            }(this)), this.on("checkConnect", function(a) {
                return function() {
                    return i ? void 0 : (i = !0, k.delay(function() {
                        return a._reconnecting()
                    }, g))
                }
            }(this))
        },_reconnecting: function() {
            return i ? c.ajax({url: "" + j.apiHost + "/",success: function(a) {
                return function() {
                    return i = !1, a.trigger("reconnected")
                }
            }(this),error: function(a) {
                return function() {
                    return a.trigger("disconnect"), g *= 1.5, g > 6e4 ? i = !1 : k.delay(function() {
                        return a._reconnecting()
                    }, g)
                }
            }(this)}) : void 0
        },wrapSuccess: function(a) {
            return function(b) {
                return function(c) {
                    return h || b.trigger("reconnected"), "function" == typeof a ? a(c) : void 0
                }
            }(this)
        },wrapError: function(a, b) {
            return function(c) {
                return function(d) {
                    var e;
                    return e = {message: "",code: ""}, d.responseJSON ? e = k.extend(e, d.responseJSON) : k.isObject(d) ? (e.message = d.message || d.statusText || e.message || "", e.code = d.code || d.status || 1, e.stack = e.stack) : e.message = d, console.error(e), 404 === e.code ? c.trigger("checkConnect") : b || Essage.show({message: e.message || "对不起，出错啦！",status: "error"}, 2e3), "function" == typeof a ? a(e) : void 0
                }
            }(this)
        },wrapForExpireCache: function(a) {
            var b, c, d, f;
            if (c = a.expireCache)
                return b = a.beforeSend || function() {
                }, f = a.success || function() {
                }, d = function() {
                }, a.beforeSend = function(a, g) {
                    var h, i, j;
                    return b(a, g), "GET" === g.type ? (h = g.url.replace(/_=\d+/, "_="), j = e, c.namespace && (j = j.namespace(c.namespace, c.expire)), i = j(h), i ? (f(i), !1) : d = function(a) {
                        return j(h, a)
                    }) : void 0
                }, a.success = function(a) {
                    return d(a), f(a)
                }
        },ajax: function(a, b) {
            var d, e;
            return k.isString(a) ? b.url || (b.url = "" + j.apiHost + "/" + a) : b = a, e = k.extend({type: "GET"}, b), e.url.indexOf("" + j.apiHost + "/") >= 0 && (e.xhrFields = {withCredentials: !0}), e.success = this.wrapSuccess(b.success), e.error = this.wrapError(b.error), "GET" === e.type && this.wrapForExpireCache(e), d = e.success || function() {
            }, e.success = function(a) {
                return a.code ? e.error(a) : d(a)
            }, c.ajax(e)
        }})
    }), define("lib/socket", ["require", "exports", "module", "jquery", "teambition", "backbone", "sockjs"], function(a) {
        var b, c, d, e, f, g, h, i, j;
        return b = a("jquery"), j = a("teambition"), c = a("backbone"), e = a("sockjs"), d = 1e3 * (Math.ceil(10 * Math.random()) + 5), f = d, h = [], g = function(a) {
            var b;
            if (a) {
                for (b = []; h.length; )
                    b.push(h.shift()());
                return b
            }
        }, i = {connect: function(a) {
            var c;
            return this.socket = c = new SockJS(a, ["websocket", "xhr-streaming", "xhr-polling"]), c.onopen = function() {
                return function() {
                    return f = d
                }
            }(this), c.onclose = function(b) {
                return function() {
                    return f > 6e5 ? void 0 : _.delay(function() {
                        return f *= 2, b.connect(a)
                    }, f)
                }
            }(this), c.onmessage = function(a) {
                return function(c) {
                    var d, e;
                    try {
                        d = JSON.parse(c.data)
                    } catch (f) {
                        return e = f, !1
                    }
                    return d.socketId ? (a.socketId = d.socketId, b.ajaxSetup({beforeSend: function(a, b) {
                        return -1 !== b.url.indexOf("" + j.apiHost + "/") ? a.setRequestHeader("X-Socket-Id", d.socketId) : void 0
                    }}), b.ajax({url: "" + j.apiHost + "/handshake",method: "POST",xhrFields: {withCredentials: !0},success: function() {
                        return g(a.socketId)
                    }})) : d.a ? a.trigger(d.a, d.d) : void 0
                }
            }(this)
        },send: function(a) {
            return this.socket.send(a)
        },join: function(a, c) {
            return h.push(function() {
                return b.ajax({url: "" + j.apiHost + "/" + a + "/" + c + "/subscribe",method: "POST",xhrFields: {withCredentials: !0}})
            }), g(this.socketId)
        }}, _.extend({}, c.Events, i)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collection", ["require", "exports", "module", "teambition", "backbone", "lib/http", "lib/socket", "warehouse"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("backbone"), e = a("lib/http"), f = a("lib/socket"), g = a("warehouse"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.synced = !1, c.prototype.listened = !1, c.prototype.orderBy = "latest-created", c.prototype.initialize = function(a, b) {
                return this.pageIndex = 0, this._boundToObjectId = (null != b ? b._boundToObjectId : void 0) || 0, null != (null != b ? b.boundToObjectType : void 0) && (this.boundToObjectType = b.boundToObjectType), "activities" === this.name ? this.listen() : void 0
            }, c.prototype.add = function(a, b) {
                return b || (b = {}), b.merge = !0, c.__super__.add.apply(this, arguments)
            }, c.prototype.set = function(a, b) {
                return b || (b = {}), b.parse = !0, b.merge = !0, c.__super__.set.apply(this, arguments)
            }, c.prototype.sync = function(a, b, d) {
                var f, g, i, j;
                switch (d.url || (d.url = this.name), d.xhrFields = {withCredentials: !0}, d.success = e.wrapSuccess(d.success), d.error = e.wrapError(d.error, d.silentError), g = d.success || function() {
                }, a) {
                    case "read":
                        f = d.attrs || ("function" == typeof this.getParams ? this.getParams(a, d) : void 0) || {}, this.pageNum && !f.all && (f.count = this.pageNum, f.page = ++this.pageIndex), this.boundToObjectType && (f[i = "_" + this.boundToObjectType + "Id"] || (f[i] = f._boundToObjectId || this._boundToObjectId)), h.user.get("isGhost") && (f = _.extend(f, h._global)), d.data = f, j = function(a) {
                            return function(b) {
                                return a.synced = !0, a.pageNum && (a.hasMore = a.checkHasMore(b)), g(b), a.listen()
                            }
                        }(this);
                        break;
                    case "one":
                        d.type = "GET", d.processData = !0, d.url = "" + this.name + "/" + d._modelId, j = function(a) {
                            return function(b) {
                                return a.update(b), g(a.get(b._id))
                            }
                        }(this)
                }
                return d.url = "" + h.apiHost + "/" + d.url, null == d.cache && (d.cache = !1), d.success = function() {
                    return function(a) {
                        return a.code ? d.error(a) : (j || g)(a)
                    }
                }(this), c.__super__.sync.apply(this, arguments)
            }, c.prototype.listen = function() {
                var a;
                if (!this.listened)
                    return this.listened = !0, a = this.name, this._boundToObjectId && (a += "/" + this._boundToObjectId), "projects" !== this.name && this.on("change:isArchived", function(a) {
                        return function(b, c) {
                            return c ? a.remove(b) : void 0
                        }
                    }(this)), f.on(":new:" + a, function(a) {
                        return function(b) {
                            return a.add(b)
                        }
                    }(this)), f.on(":change:" + a, function(a) {
                        return function(b) {
                            return a.set(b)
                        }
                    }(this)), f.on(":remove:" + a, function(a) {
                        return function(b) {
                            return a.remove(b)
                        }
                    }(this)), f.on(":remove:" + this.name, function(a) {
                        return function(b) {
                            return a.remove(b)
                        }
                    }(this)), this
            }, c.prototype.last = function() {
                return 0 === this.length ? {} : this.at(this.length - 1)
            }, c.prototype.comparator = function(a) {
                return "latest-created" === this.orderBy ? -new Date(a.get("created") || 0).getTime() : "earliest-created" === this.orderBy ? new Date(a.get("created") || 0).getTime() : "latest-updated" === this.orderBy ? -new Date(a.get("updated") || 0).getTime() : "earliest-updated" === this.orderBy ? new Date(a.get("updated") || 0).getTime() : this.orderBy ? a.get(this.orderBy) : void 0
            }, c.prototype.updateSort = function(a, b) {
                var c;
                return a && a.length ? (c = function(c) {
                    return a.indexOf(c) + 1 || (b ? 0 : 9999)
                }, this.models.sort(function(a, b) {
                    return c(a.id) - c(b.id)
                }), this) : this
            }, c.prototype.update = function(a, b) {
                return b || (b = {}), b.remove = !1, this.set(a, b)
            }, c.prototype.checkHasMore = function(a) {
                return a.length >= this.pageNum
            }, c.prototype.loadMore = function(a) {
                var b;
                if (this.hasMore)
                    return a || (a = {}), a.remove = !1, b = a.error || function() {
                    }, a.error = function(a) {
                        return function() {
                            return b.apply(a, arguments)
                        }
                    }(this), this.fetch(a)
            }, c.prototype.fetchOne = function(a, b) {
                return b || (b = {}), b._modelId = a, this.sync("one", this, b)
            }, c.prototype.resetSoft = function() {
                return this.pageIndex = 0, this.synced = !1, this.hasMore = !1
            }, c.prototype.reset = function() {
                return this.resetSoft(), c.__super__.reset.apply(this, arguments)
            }, c
        }(c.Collection), g.bindToCollection(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("model", ["require", "exports", "module", "teambition", "backbone", "lib/http", "lib/socket", "warehouse"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("backbone"), e = a("lib/http"), f = a("lib/socket"), g = a("warehouse"), d = function(a) {
            function c(a, b) {
                null == b && (b = {}), b.parse = !0, c.__super__.constructor.call(this, a, b)
            }
            return b(c, a), c.prototype.idAttribute = "_id", c.prototype.listened = !1, c.prototype.initialize = function(a, b) {
                return this.listen(), "_id" === this.idAttribute && (null != b ? b.bindByMatrix : void 0) !== !1 && g.bindByMatrix(this), this
            }, c.prototype.sync = function(a, b, d) {
                var f;
                switch (d.url || (d.url = this.url()), d.url = "" + h.apiHost + "/" + d.url, d.xhrFields = {withCredentials: !0}, d.success = e.wrapSuccess(d.success), d.error = e.wrapError(d.error, d.silentError), d.expireCache && e.wrapForExpireCache(d), f = d.success || function() {
                }, null == d.cache && (d.cache = !1), d.success = function(a) {
                    return function(b) {
                        return b.code ? d.error(b) : (f(b), a.listen())
                    }
                }(this), a) {
                    case "read":
                        d.attrs && (d.data = d.attrs), h.user.get("isGhost") && (d.data = _.extend(d.data || {}, h._global))
                }
                return c.__super__.sync.apply(this, arguments)
            }, c.prototype.saveAttr = function(a, b, c) {
                var d;
                return c || (c = {}), c.url = "" + this.url() + "/" + a, c.attrs || (c.attrs = {}), null != b && (c.attrs[a] = b), d = c.success || function() {
                }, c.success = function(a) {
                    return function(b) {
                        return a.set(b), d(a)
                    }
                }(this), c.wait || this.set(c.attrs), this.sync("update", this, c)
            }, c.prototype.clone = function() {
                return new this.constructor(this.attributes, {bindByMatrix: !1})
            }, c.prototype.listen = function() {
                return !this.listened && this.id ? (this.listened = !0, f.on(":change:" + this.name + "/" + this.id, function(a) {
                    return function(b) {
                        return a.set(a.parse(b))
                    }
                }(this)), this) : void 0
            }, c.prototype.archive = function(a) {
                var b;
                return a || (a = {}), a.url = "" + this.url() + "/archive", a.attrs = {}, b = a.success || function() {
                }, a.success = function(a) {
                    return function(c) {
                        var d;
                        return null != (d = a.collection) && d.remove(a), a.set(c), b(a)
                    }
                }(this), this.sync("create", this, a), this
            }, c.prototype.unarchive = function(a) {
                var b;
                return a || (a = {}), a.url = "" + this.url() + "/archive", a.attrs = {}, b = a.success || function() {
                }, a.success = function(a) {
                    return function(c) {
                        return a.set(c), b(a)
                    }
                }(this), this.sync("delete", this, a), this
            }, c.prototype.getLike = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/like", a.attrs || (a.attrs = {}), this.sync("read", this, a), this
            }, c.prototype.doLike = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/like", a.attrs = {}, this.sync("create", this, a), this
            }, c.prototype.unLike = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/like", a.attrs = {}, this.sync("delete", this, a), this
            }, c
        }(c.Model), g.bindToModel(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/organization", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return c = a("model"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "organization", c.prototype.urlRoot = "organizations", c.prototype.defaults = {objectType: "organization",teamsCount: 0,membersCount: 0,projectsCount: 0,plan: {days: 999},hasRight: -2,dividers: [],projectIds: []}, c.prototype.sync = function(a, b, d) {
                var e;
                switch (e = d.success, a) {
                    case "create":
                        d.success = function() {
                            return function(a) {
                                return a.isNew = !0, "function" == typeof e ? e(a) : void 0
                            }
                        }(this)
                }
                return c.__super__.sync.apply(this, arguments)
            }, c.prototype.getRecommendMembers = function(a) {
                return a.url = "" + this.url() + "/recommendMembers", a.expireCache = {namespace: "organization_" + this.id + "_recommend_members",expire: 300}, this.sync("read", this, a), this
            }, c.prototype.getStatistic = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/statistic", a.expireCache = {namespace: "organization_members",expire: 300}, this.sync("read", this, a), this
            }, c.prototype.getTeamsStatistic = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/statistic", a.expireCache = {namespace: "organization_teams",expire: 300}, a.attrs || (a.attrs = {}), a.attrs.base = "team", this.sync("read", this, a), this
            }, c.prototype.getProjectsStatistic = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/statistic", a.expireCache = {namespace: "organization_projects",expire: 300}, a.attrs || (a.attrs = {}), a.attrs.base = "project", this.sync("read", this, a), this
            }, c.prototype.isOverdue = function() {
                return !(this.get("plan").days > 0)
            }, c.prototype.isExpiring = function() {
                var a;
                return a = this.get("plan").days, a > 0 && 10 >= a
            }, c.prototype.quit = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/quit", this.sync("update", this, a), this
            }, c.prototype.saveSection = function(a, b, c) {
                return c || (c = {}), c.url = "" + this.url() + "/" + a, c.attrs = {}, c.attrs[a] = b, this.sync("update", this, c), this
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/organizations", ["require", "exports", "module", "collection", "models/organization"], function(a) {
        var c, d, e;
        return c = a("collection"), e = a("models/organization"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "organizations", c.prototype.model = e, c.prototype.comparator = function(a) {
                return a.get("name")
            }, c.prototype.getOrganizationsByRight = function(a) {
                return this.where({hasRight: a})
            }, c.prototype.getOrganizationsByIds = function(a) {
                var b;
                return b = [], _.each(a, function(a) {
                    return function(c) {
                        var d;
                        return d = a.find(function(a) {
                            return a.id === c
                        }), d ? b.push(d.toJSON()) : void 0
                    }
                }(this)), b
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/project", ["require", "exports", "module", "teambition", "model", "moment", "lib/socket"], function(a) {
        var c, d, e, f, g;
        return g = a("teambition"), c = a("model"), d = a("moment"), f = a("lib/socket"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "project", c.prototype.urlRoot = "projects", c.prototype.defaults = {_organizationId: null,objectType: "project",category: "media",description: "在这里尝试teambition各项功能",recent: [0, 0, 0, 0, 0],task: {total: 0,done: 0,today: 0},navigation: {home: 0,tasks: 1,posts: 2,files: 3,events: 4,review: 5,tag: 6,bookkeeping: -1}}, c.prototype.initialize = function() {
                return this.id && f.on(":change:statistic/" + this.id, function(a) {
                    return function(b) {
                        var c, d, e, f, g;
                        if (b.task) {
                            e = _.clone(a.get("task")), g = b.task;
                            for (c in g)
                                f = g[c], e[c] += f;
                            return a.set("task", e), b.task.done > 0 ? (d = _.clone(a.get("recent")), d[4] += b.task.done, a.set("recent", d)) : void 0
                        }
                    }
                }(this)), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.sync = function(a, b, d) {
                var e;
                switch (e = d.success, a) {
                    case "create":
                        d.success = function() {
                            return function(a) {
                                return a.isNew = !0, "function" == typeof e ? e(a) : void 0
                            }
                        }(this)
                }
                return c.__super__.sync.apply(this, arguments)
            }, c.prototype.getRecommendMembers = function(a) {
                return a.url = "" + this.url() + "/recommendMembers", a.expireCache = {namespace: "project_" + this.id + "_recommend_members",expire: 60}, this.sync("read", this, a), this
            }, c.prototype.getStatistic = function(a) {
                return a.url = "" + this.url() + "/statistic", a.attrs = {today: d().endOf("day").toISOString()}, this.sync("read", this, a), this
            }, c.prototype.getFirstApp = function() {
                var a, b, c, d;
                d = this.get("navigation");
                for (b in d)
                    c = d[b], 0 === c && (a = b);
                return a
            }, c.prototype.transfer = function(a, b) {
                var d, e, f;
                return b || (b = {}), b.url = "" + this.url() + "/transfer", b.attrs = {_id: this.id}, a !== g.user.id && (b.attrs._organizationId = a), e = b.success || function() {
                }, f = this.get("_organizationId"), d = c.Collection, b.success = function(a) {
                    return function(b) {
                        var c, g, h, i;
                        return c = d.get(0), f && (h = d.get(f, {boundToObjectType: "organization"})), i = d.get(b._organizationId, {boundToObjectType: "organization"}), g = (null != h ? h.get(a.id) : void 0) || c.get(a.id), null != h && h.remove(g), g.set(b), null != i && i.add(g.toJSON(), {merge: !0}), g.get("hasRight") > -2 && c.add(g.toJSON(), {merge: !0}), e(b)
                    }
                }(this), "function" == typeof b.beforeSend && b.beforeSend(), this.sync("update", this, b), this
            }, c.prototype.quit = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/quit", this.sync("update", this, a), this
            }, c.prototype.resetInvite = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/invitelink", a.attrs = {}, this.sync("update", this, a), this
            }, c.prototype.setNavigation = function(a, b) {
                return b.url = "" + this.url() + "/navigation", b.attrs = {navigation: a}, this.sync("update", this, b), this
            }, c.prototype.copy = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/copy", this.sync("create", this, a), this
            }, c.prototype.toggleStar = function(a) {
                var b;
                return a.url = "" + this.url() + "/star", b = this.get("isStar") ? "delete" : "update", this.sync(b, this, a), this
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/projects", ["require", "exports", "module", "teambition", "collection", "models/project", "lib/socket"], function(a) {
        var c, d, e, f, g;
        return g = a("teambition"), c = a("collection"), e = a("models/project"), f = a("lib/socket"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "projects", c.prototype.model = e, c.prototype.initialize = function() {
                return _.delay(function(a) {
                    return function() {
                        var b;
                        return b = a._boundToObjectId || g.user.id, f.on(":new:projects/" + b, function(b) {
                            return a.add(b)
                        }), a.on("add", function(a) {
                            var b, d;
                            if (b = a.get("_organizationId") && !a.get("isArchived"))
                                return null != (d = c.find(b)) ? d.add(a.toJSON()) : void 0
                        })
                    }
                }(this)), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.getSelfProjectCount = function() {
                return this.where({_organizationId: null}).length
            }, c.prototype.getSelfOwnProjectCount = function() {
                return this.where({_organizationId: null,_creatorId: g.user.id}).length
            }, c.prototype.getStarProjects = function() {
                return this.filter(function() {
                    return function(a) {
                        return a.get("isStar")
                    }
                }(this))
            }, c.prototype.groupByOrganization = function(a) {
                var b, c, d, e;
                return d = this.groupBy(function() {
                    return function(a) {
                        return a.get("_organizationId")
                    }
                }(this)), e = this.getStarProjects(), b = [], e.length && (b.push({type: "groupBy",groupName: "星标项目"}), _.each(e, function() {
                    return function(a) {
                        return b.push(a.toJSON())
                    }
                }(this))), c = _.keys(d), c = _.map(c, function() {
                    return function(b) {
                        var c, d;
                        return c = (null != (d = a.get(b)) ? d.toJSON() : void 0) || {name: ""}, {_id: b,name: c.name,pinyin: c.pinyin || c.name}
                    }
                }(this)), c = _.sortBy(c, function() {
                    return function(a) {
                        return a.pinyin
                    }
                }(this)), _.each(c, function() {
                    return function(a) {
                        return b.push({type: "groupBy",groupName: a.name || "个人项目"}), _.each(d[a._id], function(a) {
                            return b.push(a.toJSON())
                        })
                    }
                }(this)), b
            }, c.prototype.comparator = function(a) {
                return a.get("pinyin") || a.get("name")
            }, c
        }(c), e.Collection = d, d
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("router", ["require", "exports", "module", "teambition", "backbone", "collections/organizations", "collections/projects"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("backbone"), e = a("collections/organizations"), f = a("collections/projects"), d = {wall: "posts",board: "tasks",library: "files"}, g = function(a) {
            function g() {
                return g.__super__.constructor.apply(this, arguments)
            }
            return b(g, a), g.prototype.routes = {"projects(/*paramString)": "enterPortal","project/:_projectId": "enterProjectApp","project/:_projectId/:appName(/*paramString)": "enterProjectApp","organization/:_organizationId(/*paramString)": "enterOrganization","*paramString": "home"}, g.prototype.home = function() {
                return this.navigate("projects", {trigger: !0})
            }, g.prototype.gotoTeambition = function() {
                return window.location = h.host, this
            }, g.prototype.gotoLogin = function() {
                var a;
                return a = encodeURIComponent(window.location.href), window.location = "" + h.accountHost + "/login?next_url=" + a, this
            }, g.prototype.gotoRegister = function() {
                var a;
                return a = encodeURIComponent(window.location.href), window.location = "" + h.accountHost + "/signup?next_url=" + a, this
            }, g.prototype.enterPortal = function(a) {
                var b, c, d;
                return h._global = {}, d = h.user.toJSON(), d.isGhost && this.gotoLogin(), c = this.splitParamString(a), this.paramString = c.paramString, b = {params: this._analyzeParams(c.paramString),attrs: this._analyzeParams(c.paramString),routeString: c.routeString}, h.gta.pageview({page: "/projects",title: "portal"}), h.APP.enter("portal", b), this
            }, g.prototype.enterOrganization = function(a, b) {
                var c;
                return h._global = {_organizationId: a}, c = this.splitParamString(b), this.paramString = c.paramString, e.fetchOne(0, a, {success: function(b) {
                    return function(d) {
                        var e;
                        return e = {organizationModel: d,_organizationId: a,params: b._analyzeParams(c.paramString),attrs: b._analyzeParams(c.paramString),routeString: c.routeString}, h.gta.pageview({page: "organization/" + a,title: "organization"}), h.APP.enter("organization", e)
                    }
                }(this)}), this
            }, g.prototype.enterProjectApp = function(a, b, c) {
                return h._global = {_projectId: a}, f.fetchOne(0, a, {success: function(e) {
                    return function(f) {
                        var g, i, j, k, l;
                        return k = e.splitParamString(c), e.paramString = k.paramString, j = {_projectId: a,projectModel: f,routeString: k.routeString,params: e._analyzeParams(k.paramString),attrs: e._analyzeParams(k.paramString)}, i = b, d[b] && (b = d[b]), g = f.get("navigation"), b && g[b] >= 0 || (b = f.getFirstApp()), i !== b && (l = h.router.getUrl().replace("/" + i, ""), l += "/" + b, h.router.navigate(l, {trigger: !1})), h.gta.pageview({page: "project/" + a + "/" + b,title: b}), h.APP.enter(b, j)
                    }
                }(this),error: function(a) {
                    return function() {
                        return a.home()
                    }
                }(this)})
            }, g.prototype.splitParamString = function(a) {
                var b, c;
                return b = {routeString: "",paramString: ""}, a ? (~a.indexOf("?") ? (c = a.split("?"), b.routeString = c[0], b.paramString = c[1]) : ~a.indexOf("=") ? (b.routeString = "", b.paramString = a) : (b.routeString = a, b.paramString = ""), b) : b
            }, g.prototype.setupLinkEvents = function() {
                return $(document).on("click", ".url", function(a) {
                    return function(b) {
                        return a.navigate($(b.currentTarget).data("url"), {trigger: !0}), !1
                    }
                }(this))
            }, g.prototype._analyzeParams = function(a) {
                var b, c, d, e, f, g, h;
                if (!a)
                    return {};
                if (d = {}, b = {}, c = a.split(","), c.length)
                    for (g = 0, h = c.length; h > g; g++)
                        f = c[g], ~f.indexOf("=") && (e = f.split("="), d[e[0]] = e[1], b[e[0]] = e[1]);
                return d
            }, g.prototype.start = function() {
                return this.setupLinkEvents(), c.history.start({pushState: !0}), this
            }, g.prototype.routeToHandler = function(a) {
                var b, c, d, e, f;
                b = function(a, b, c, d) {
                    return function(e) {
                        var f;
                        return f = d._extractParameters(c, e), b[a].apply(b, f)
                    }
                }, e = a.routes, a.handlers = [], f = [];
                for (d in e)
                    c = e[d], d = this._routeToRegExp(d), f.push(a.handlers.push({route: d,callback: b(c, a, d, this)}));
                return f
            }, g.prototype.checkRoute = function(a, b) {
                var c, d, e, f, g;
                for (null != (f = h.APP) && f.dynamicTitle(), this.routeToHandler(b), g = b.handlers, d = 0, e = g.length; e > d; d++)
                    if (c = g[d], c.route.test(a))
                        return c.callback(a)
            }, g.prototype.getUrl = function() {
                return c.history.getFragment()
            }, g.prototype.getPrefix = function() {
                var a, b, c;
                switch (b = "", c = this.getUrl(), a = c.split("/"), a[0]) {
                    case "organizations":
                        b = "organizations";
                        break;
                    case "projects":
                        b = "projects";
                        break;
                    case "organization":
                        b = a.slice(0, 2).join("/");
                        break;
                    case "project":
                        b = a.slice(0, 2).join("/")
                }
                return b
            }, g
        }(c.Router)
    }), define("lib/hint/index", ["require", "exports", "module", "jquery"], function(a) {
        var b, c, d, e, f;
        return f = a("jquery"), c = $(document), b = $("body"), d = function(a) {
            return "<div class='arrow'></div>\n<p class='message'>" + a + "</p>"
        }, e = function() {
            var a;
            return this.$el = $('<div class="hint"></div>'), a = function(a) {
                return function(e) {
                    var f, g, h, i;
                    f = $(e.currentTarget), g = function() {
                        var g, h, i, j, k, l, m, n, o, p, q, r;
                        if (f.off(".hint"), q = f.width(), m = f.parent().width(), q > m && (q = m), p = {$el: f,message: f.data("title"),offset: {top: f.offset().top,left: f.offset().left},size: {height: f.height(),width: q}}, f.hasClass("hint-content")) {
                            if (!(f.get(0).scrollWidth > f.width()))
                                return;
                            p.message || (p.message = f.text())
                        }
                        if (!f.hasClass("auto-hint") || f.width() > f.parent().width()) {
                            if (a.$el.html(d(p.message)), b.append(a.$el), l = {height: a.$el.outerHeight(),width: a.$el.outerWidth()}, r = {width: window.innerWidth,height: window.innerHeight}, o = document.documentElement.scrollTop || window.pageYOffset, j = function() {
                                return l.top = p.offset.top + p.size.height + 10, l.left = p.offset.left + .5 * p.size.width - .5 * l.width, l.arrowPosition = "top"
                            }, g = function() {
                                return l.top = p.offset.top - l.height - 10, l.left = p.offset.left + .5 * p.size.width - .5 * l.width, l.arrowPosition = "bottom"
                            }, h = function() {
                                return l.top = p.offset.top + .5 * p.size.height - .5 * l.height, l.left = p.offset.left + p.size.width + 10, l.arrowPosition = "left"
                            }, i = function() {
                                return l.top = p.offset.top + .5 * p.size.height - .5 * l.height, l.left = p.offset.left - l.width - 10, l.arrowPosition = "right"
                            }, k = $(e.currentTarget).data("direction"), !k || "left" !== k && "right" !== k && "bottom" !== k && "top" !== k)
                                g(), l.left + l.width > r.width && p.offset.left - l.width - 10 > 0 ? i() : l.top < 0 ? p.offset.left + p.size.width + l.width + 10 < r.width ? h() : j() : l.left < 0 && h();
                            else
                                switch (k) {
                                    case "left":
                                        h();
                                        break;
                                    case "right":
                                        i();
                                        break;
                                    case "top":
                                        j();
                                        break;
                                    case "bottom":
                                        g()
                                }
                            a.$el.css({top: "" + l.top + "px",left: "" + l.left + "px"}), a.$el.children(".arrow").prop("class", "arrow " + l.arrowPosition), a.$el.addClass("on"), n = function() {
                                return a.$el.css({top: "50%",left: "50%"}).removeClass("on").remove(), p.$el.off(".hint")
                            }, p.$el.one("mouseleave click", n).on("mousedown.hint", function() {
                                return c.one("mousemove.hint", n)
                            }).on("mouseup.hint", function() {
                                return c.off("mousemove.hint")
                            }).on("remove.hint", n)
                        }
                    }, h = setTimeout(g, 370), i = function() {
                        return clearTimeout(h), f.off(".hint")
                    }, f.one("mouseleave click", i).on("mousedown.hint", function() {
                        return c.one("mousemove.hint", i)
                    }).on("mouseup.hint", function() {
                        return c.off("mousemove.hint")
                    }).on("remove.hint", i)
                }
            }(this), c.on("mouseenter", ".hinted", a)
        }, {initialize: e}
    });
    var c = [].slice;
    define("hotkey", ["require", "exports", "module", "underscore", "mousetrap"], function(a) {
        var b, d, e, f, g, h, i;
        return i = a("underscore"), d = a("mousetrap"), b = $("body").data("hotkeys", {}), g = {}, h = function() {
        }, d.stopCallback = function(a, b, c) {
            return "esc" === c ? !1 : "INPUT" === b.tagName || "SELECT" === b.tagName || "TEXTAREA" === b.tagName || b.contentEditable && "true" === b.contentEditable
        }, e = function(a, c) {
            var e, f;
            for (e = g[c][0]; !e.data("hotkeys"); )
                g[c].shift(), e = g[c][0];
            return f = e.data("hotkeys")[c], f ? f(a, c) : e === b ? d.unbind(c) : void 0
        }, f = {add: function(a) {
            var c, f;
            return a || a.hotkeys ? (f = i.clone(a.hotkeys), c = a.$el || b, i.each(a.preventHotkeys, function(a) {
                return f[a] = h
            }), i.each(f, function(h, j) {
                var k, l;
                if (null != (k = a.currentView) && null != (l = k.hotkeys) ? !l[j] : !0)
                    return i.isFunction(h) || (h = a[h]), h && i.isFunction(h) ? (h = i.bind(h, a), j = j.split("|"), i.each(j, function(a) {
                        return f[a] = h, d.bind(a, e), g[a] || (g[a] = [b]), c !== b ? (g[a] = i.without(g[a], c), g[a].unshift(c)) : void 0
                    })) : delete f[j]
            }), c === b ? i.extend(b.data("hotkeys"), f) : c.data("hotkeys", f), this) : this
        },remove: function() {
            var a, d, e, f, h;
            return d = arguments[0], f = 2 <= arguments.length ? c.call(arguments, 1) : [], d ? (h = !f.length, a = d.$el || b, e = a.data("hotkeys"), h && (f = i.keys(d.hotkeys || {})), e && i.each(f, function(c) {
                return delete e[c], h && !a === b ? g[c] = i.without(g[c], a) : void 0
            }), this) : this
        },reset: function() {
            return d.reset(), b.data("hotkeys", {}), g = {}, this
        }}
    }), define("lib/notification/templates/basic", [], function() {
        return function() {
            var a = '<div class="notification-modal modal"> <div class="modal-dialog card"> <a class="close-modal-btn pull-right" data-dismiss="modal"> <span class="icon icon-remove"></span> </a> <div class="card-header"> <p class="card-title">桌面通知</p> </div> <div class="card-content"> <p class="description">「桌面通知」可以让您更方便地使用通知中心, 提高协作效率</p> <hr> <button class="request-permission-btn btn btn-primary btn-block">启用桌面通知</button> <button class="cancel-setup-btn btn btn-block">关闭桌面通知</button> </div> </div></div><div class="notification-modal-backdrop modal-backdrop"></div>';
            return a
        }
    }), define("lib/notification/index", ["require", "exports", "module", "./templates/basic", "store"], function(a) {
        var b, c, d, e, f, g, h, i, j;
        return b = a("./templates/basic"), d = a("store"), g = d.namespace("desktopNotification"), h = "disableDesktopNotification", e = [], c = window.Notification || window.webkitNotifications, j = function() {
            return !!c
        }, f = function() {
            return c.permission ? "granted" === c.permission : 0 === c.checkPermission()
        }, i = function(a) {
            return c.requestPermission(a)
        }, {support: function() {
            return j()
        },hasPermission: function() {
            return j() ? g(h) ? !1 : f() : void 0
        },setup: function(a) {
            var c;
            if (j() && (a && e.push(a), null != (c = this.$modal) ? !c.closest("body").length : !0))
                return this.$modal = $(b()).appendTo("body"), this.$modal.find(".request-permission-btn").one("click", function(a) {
                    return function() {
                        return g(h, !1), a.$modal.remove(), i(function() {
                            var a;
                            for (a = []; e.length; )
                                a.push(e.shift()());
                            return a
                        })
                    }
                }(this)), this.$modal.find(".cancel-setup-btn").one("click", function(a) {
                    return function() {
                        return a.$modal.remove(), e.length = 0, g(h, !0)
                    }
                }(this)), this.$modal.find(".close-modal-btn").one("click", function(a) {
                    return function() {
                        return a.$modal.remove()
                    }
                }(this))
        },show: function(a, b) {
            return j() ? this.hasPermission() ? _.delay(function() {
                var d;
                if (!a.notificationId || !g(a.notificationId))
                    return d = c.createNotification ? c.createNotification(a.icon, a.title, a.content) : new c(a.title, {tag: a.notificationId,body: a.content,icon: a.icon}), d.onclick = function() {
                        return "function" == typeof d.cancel && d.cancel(), "function" == typeof d.close && d.close(), "function" == typeof b ? b() : void 0
                    }, "function" == typeof d.show && d.show(), a.notificationId && g(a.notificationId, !0, 2)
            }, 3e3 * Math.random()) : g(h) ? void 0 : this.setup(function(c) {
                return function() {
                    return c.show(a, b)
                }
            }(this)) : void 0
        }}
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, c = [].slice;
    define("view", ["require", "exports", "module", "teambition", "backbone", "hotkey", "util"], function(a) {
        var d, e, f, g, h, i, j;
        return j = a("teambition"), d = a("backbone"), g = a("hotkey"), i = a("util"), h = function() {
            return '<div class="loading-indicator">\n  <span class="loader-dot"></span>\n  <span class="loader-dot"></span>\n  <span class="loader-dot"></span>\n</div>'
        }, f = function() {
            return '<div class="end-point-wrapper">\n  <span class="end-point"></span>\n</div>'
        }, e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.hotkeys = {}, e.prototype.routes = {}, e.prototype.setupHotKey = function() {
                return g.add(this), this
            }, e.prototype.removeHotKey = function() {
                return g.remove(this), this
            }, e.prototype.reset = function() {
                return this.dataModels = _.toArray(arguments)
            }, e.prototype.requestSubView = function(a, b) {
                var c, d;
                return b || (b = {}), c = a.Constructor || a, d = new c(b), d.parentView = this, "function" == typeof d.setupHotKey && d.setupHotKey(), this.subViews || (this.subViews = []), this.subViews.push(d), d
            }, e.prototype.removeSubViews = function() {
                var a, b, d;
                if (a = 1 <= arguments.length ? c.call(arguments, 0) : [], this.subViews) {
                    for (_.each(a, function(a) {
                        return function(b) {
                            return i.removeItem(a.subViews, b)
                        }
                    }(this)); (null != (d = this.subViews) ? d.length : void 0) > 0; )
                        null != (b = this.subViews.pop()) && b.remove();
                    this.subViews = a
                }
                return this
            }, e.prototype.remove = function(a) {
                var b, c;
                return "function" == typeof this.removeSubViews && this.removeSubViews(), a || (a = {}), this._guidePointActive && this.$(".guide-point").off("click"), this.toolEvents && (this.undelegateEventsOnElement(this.$toolset), delete this.$toolset), this.removeHotKey(), this.deregisterAsResponsive(), a.keepListen || this.stopListening(), null != (b = this.$el) && b.remove(), (null != (c = this.parentView) ? c.subViews : void 0) && i.removeItem(this.parentView.subViews, this), _.each(this, function(a) {
                    return function(b, c) {
                        return a[c] = null
                    }
                }(this)), this
            }, e.prototype.registerAsResponsive = function() {
                return j.APP.responsiveViews[this.cid] = this, this
            }, e.prototype.deregisterAsResponsive = function() {
                return delete j.APP.responsiveViews[this.cid], this
            }, e.prototype.detached = function() {
                var a;
                return a = this.$el.get(0), a.id ? !document.getElementById(a.id) : !$.contains(document, a)
            }, e.prototype.delegateEventsOnElement = function(a, b) {
                var c;
                return b && (this.$el = b), c = d.View.prototype.delegateEvents.apply(this, arguments), b && (this.$el = $(this.el)), c
            }, e.prototype.undelegateEventsOnElement = function(a) {
                var b;
                return a && (this.$el = a), b = d.View.prototype.undelegateEvents.apply(this, arguments), a && (this.$el = $(this.el)), b
            }, e.prototype.setupPlaceholder = function(a, b) {
                var c;
                return c = function(c) {
                    return function() {
                        return a.length ? c.$placeholder ? c.hidePlaceholder(b) : void 0 : c.showPlaceholder(b)
                    }
                }(this), this.listenTo(a, "add remove", c), _.delay(function() {
                    return function() {
                        return c()
                    }
                }(this))
            }, e.prototype.showPlaceholder = function(a) {
                var b;
                return this.$el.addClass("empty"), null != (b = this.$placeholder) && b.remove(), this.$placeholder = $("<div class='no-" + a + "-placeholder placeholder'></div>").appendTo(this.$el)
            }, e.prototype.hidePlaceholder = function() {
                var a;
                return this.$el.removeClass("empty"), null != (a = this.$placeholder) && a.remove(), delete this.$placeholder
            }, e.prototype.showLoadingIndicator = function(a, b) {
                var c;
                return null == a && (a = this.$el), c = (null != b ? b.isPrepend : void 0) ? "prependTo" : "appendTo", this.hasOwnProperty("$loadingIcons") || (this.$loadingIcons = []), this.$loadingIcons.push($(h())[c](a)), this
            }, e.prototype.hideLoadingIndicator = function(a) {
                return this.hasOwnProperty("$loadingIcons") ? ((null != a ? a.animated : void 0) ? _.each(this.$loadingIcons, function(a) {
                    return a.animate({opacity: 0,height: 0}, function() {
                        return function() {
                            return null != a ? a.remove() : void 0
                        }
                    }(this))
                }) : _.each(this.$loadingIcons, function(a) {
                    return a.remove()
                }), this) : void 0
            }, e.prototype.showEndPoint = function(a) {
                var b;
                return null == a && (a = this.$el), null != (b = this.$endPoint) && b.remove(), this.$endPoint = $(f()).appendTo(a), this
            }, e
        }(d.View)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/member", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return d = a("model"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "member", c.prototype.urlRoot = "members", c.prototype.defaults = {objectType: "member",name: "",title: "",avatar: "",isOnline: !0,isQuited: !1}, c.prototype.initialize = function(a, b) {
                return b || (b = {}), b.bindByMatrix = !1, c.__super__.initialize.apply(this, arguments)
            }, c.prototype.url = function() {
                var a;
                return a = this.get("boundToObjectType"), "organization_project" === a && (a = "project"), "" + a + "s/" + this.get("_boundToObjectId") + "/members/" + this.id
            }, c.prototype.parse = function(a) {
                var b;
                return a = _.extend(this.toJSON(), a), a._userId || (a._userId = a._id), (null != a ? a.website : void 0) ? (b = a.website, "string" == typeof b && "" !== b.replace(/\s/g, "") ? /^[http:|https:|ftp:]/.test(b) || (b = "http://" + b) : b = null, a.website = b, a) : a
            }, c.prototype.getBirthdayString = function() {
                var a, b, c;
                return (b = this.get("birthday")) ? (a = new Date(b), c = "" + a.getFullYear() + ".\n" + (a.getMonth() + 1) + ".\n" + a.getDate()) : void 0
            }, c.prototype.getMemberRight = function() {
                var a;
                return a = this.get("hasOrgRight"), Math.max(this.get("hasRight"), a >= -2 ? a : -2)
            }, c.prototype.getRole = function() {
                var a, b;
                return a = this.get("hasOrgRight"), b = function() {
                    switch (this.getMemberRight()) {
                        case 2:
                            return "拥有者";
                        case 1:
                            return "管理员";
                        case 0:
                            return "成员";
                        default:
                            return "访客"
                    }
                }.call(this)
            }, c
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/members", ["require", "exports", "module", "teambition", "collection", "models/member", "lib/socket", "util"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("collection"), e = a("models/member"), f = a("lib/socket"), g = a("util"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "members", c.prototype.model = e, c.prototype.boundToObjectType = "project", c.prototype.initialize = function() {
                return _.delay(function(a) {
                    return function() {
                        return f.on(":new:members/" + a.boundToObjectType + "/" + a._boundToObjectId, function(b) {
                            return a.add(b, {merge: !0})
                        }), f.on(":remove:members/" + a.boundToObjectType + "/" + a._boundToObjectId, function(b) {
                            return a.remove(b)
                        }), f.on(":remove:members", function(b) {
                            var c;
                            if (c = a.find(function(a) {
                                return a.get("_memberId") === b
                            }))
                                return a.remove(c)
                        })
                    }
                }(this)), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.sync = function(a, b, d) {
                var e;
                switch (d || (d = {}), d.url || (d.url = "" + this.boundToObjectType + "s/" + this._boundToObjectId + "/members"), e = d.success || function() {
                }, a) {
                    case "search":
                        d.url = "users", d.type = "GET", d.processData = !0;
                        break;
                    case "create":
                        d.success = function(a) {
                            return function(b) {
                                return a.update(b, d), e(b)
                            }
                        }(this)
                }
                return c.__super__.sync.apply(this, arguments)
            }, c.prototype.comparator = function(a, b) {
                var c;
                return c = b.getMemberRight() - a.getMemberRight(), c || (a.get("pinyin") > b.get("pinyin") ? c = 1 : a.get("pinyin") < b.get("pinyin") && (c = -1)), c
            }, c.prototype.getParams = function(a, b) {
                var c;
                return "read" === a ? c = {boundToObjectType: b.boundToObjectType || this.boundToObjectType,_boundToObjectId: this._boundToObjectId} : void 0
            }, c.prototype.search = function(a, b) {
                return b || (b = {}), b.data = {email: a}, this.sync("search", this, b)
            }, c.prototype.getMemberIds = function() {
                return this.pluck("_id")
            }, c.prototype.addMember = function(a, b) {
                return b || (b = {}), b.attrs = a, this.sync("create", this, b), this
            }, c.prototype.removeMember = function(a, b) {
                var c;
                return b || (b = {}), b.wait = !0, c = this.get(a), null != c && c.destroy(b), this
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/message", ["require", "exports", "module", "teambition", "md5", "model", "thenjs", "util"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("md5"), e = a("model"), f = a("thenjs"), g = a("util"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.name = "message", d.prototype.urlRoot = "messages", d.prototype.parse = function(a) {
                return a = _.extend(this.toJSON(), a), "system" !== a.type || a.isRead || (a.unreadActivitiesCount = 1), g.parsePost(a)
            }, d.prototype.archive = function() {
                return this.set({isArchived: !0,isRead: !0,unreadActivitiesCount: 0}), this.destroy()
            }, d.prototype.markRead = function() {
                var a;
                if (!this.get("isRead") || this.get("unreadActivitiesCount"))
                    return a = {isRead: !0,unreadActivitiesCount: 0}, this.save(a, {attrs: a})
            }, d.prototype.genNotification = function() {
                var a, b, d, e, f, g, i;
                return e = this.toJSON(), d = e.creator, d || (d = {name: "",avatarUrl: ""}), g = this.parseString(e.content || e.note || e.title), b = e.subtitle || g, a = "", (null != (i = e.mentions) ? i[h.user.id] : void 0) && (a = "[@我] "), f = {title: "" + d.name + " " + a + g,content: b,icon: d.avatarUrl,creator: d}, f.notificationId = c(e._id + f.content + f.title + f.icon), f
            }, d.prototype.genMessage = function() {
                var a;
                return a = this.toJSON(), a.title = this.parseString(a.content || a.note || a.title), a.boundToObjectType = a.boundToObjectType || a.objectType, a.creator || (a.creator = {name: "",avatarUrl: ""}), a
            }, d.prototype.parseString = function(a) {
                return a = $("<div>" + a + "</div>").text(), a = g.cutString(a, 100, "..."), a = _.unescape(a)
            }, d
        }(e)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/messages", ["require", "exports", "module", "collection", "models/message"], function(a) {
        var c, d, e;
        return c = a("collection"), e = a("models/message"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "messages", c.prototype.model = e, c.prototype.pageNum = 20, c.prototype.fetch = function(a) {
                return a.url = "v2/" + this.name, c.__super__.fetch.apply(this, arguments)
            }, c.prototype.sync = function(a, b, d) {
                switch (d || (d = {}), a) {
                    case "delete":
                        d.success = function(a) {
                            return function() {
                                return a.remove(a.getReaded())
                            }
                        }(this)
                }
                return c.__super__.sync.apply(this, arguments)
            }, c.prototype.readAll = function() {
                return this.getUnread().length ? this.sync("update", this, {url: "messages/markallread",attrs: {},success: function(a) {
                    return function() {
                        return a.each(function(a) {
                            return a.set({isRead: !0,unreadActivitiesCount: 0})
                        })
                    }
                }(this)}) : void 0
            }, c.prototype.getUnreadCount = function() {
                return this.reduce(function() {
                    return function(a, b) {
                        return a + b.get("unreadActivitiesCount")
                    }
                }(this), 0)
            }, c.prototype.getUnarchivedCount = function() {
                return this.where({isArchived: !1}).length
            }, c.prototype.getUnarchived = function() {
                return this.where({isArchived: !1})
            }, c.prototype.getUnread = function() {
                return this.where({isRead: !1})
            }, c.prototype.getReaded = function() {
                return this.where({isRead: !0})
            }, c.prototype.archiveRead = function(a) {
                return this.sync("delete", this, a), this
            }, c.prototype.comparator = function(a, b) {
                var c;
                return c = a.get("isRead") - b.get("isRead"), c || (c = new Date(b.get("updated")) - new Date(a.get("updated"))), c
            }, c.prototype.remove = function(a) {
                return "all" === a ? this.remove(this.getReaded()) : c.__super__.remove.apply(this, arguments)
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/tag", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return c = a("model"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "tag", c.prototype.urlRoot = "tags", c.prototype.defaults = {name: "",color: "gray",postsCount: 0,tasksCount: 0,eventsCount: 0,worksCount: 0,entriesCount: 0}, c.prototype.fetchRelation = function(a, b) {
                return b || (b = {}), b.url = "" + this.url() + "/" + a, b.expireCache = {namespace: "tag_" + a,expire: 30}, this.sync("read", this, b), this
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/tags", ["require", "exports", "module", "collection", "models/tag"], function(a) {
        var c, d, e;
        return c = a("collection"), d = a("models/tag"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "tags", c.prototype.model = d, c.prototype.boundToObjectType = "project", c.prototype.orderBy = "latest-updated", c.prototype.getTagsbyIds = function(a) {
                var b;
                return b = [], _.each(a, function(a) {
                    return function(c) {
                        var d, e;
                        return d = null != (e = a.get(c)) ? e.toJSON() : void 0, d ? b.push(d) : void 0
                    }
                }(this)), b
            }, c
        }(c)
    }), define("lib/guide-point/templates/backdrop", [], function() {
        return function() {
            var a = '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <defs> <mask id="guide-bdcp"> <g> <rect x="0" y="0" width="100%" height="100%" fill="#ffffff"></rect> <rect class="guide-bdcp" x="200" y="200" width="300" height="300" rx="2" ry="2"></rect> </g> </mask> </defs> <rect height="100%" width="100%" style="mask:url(#guide-bdcp)" /></svg>';
            return a
        }
    }), define("lib/guide-point/templates/card", [], function() {
        return function(a) {
            var b = "<div class='card-arrow'></div><a class=\"card-close icon icon-remove\" title=\"关闭引导\"></a><h4 class='card-title'>" + a.title + "</h4><p class='card-note'>" + a.note + "</p>";
            return b
        }
    }), define("lib/guide-point/templates/point", [], function() {
        return function() {
            var a = '<div class="point-outer"></div><div class="point-inner"></div>';
            return a
        }
    }), define("lib/guide-point/index", ["require", "exports", "module", "./templates/backdrop", "./templates/card", "./templates/point", "teambition"], function(a) {
        var b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w;
        return j = a("./templates/backdrop"), l = a("./templates/card"), m = a("./templates/point"), t = a("teambition"), c = $(window), b = $("body"), d = $('<div class="guide-backdrop"></div>'), e = $('<div class="card guide-card hack-render-bug"></div>'), f = $('<div class="guide-point"></div>'), k = {navMy: {title: "与你相关的任务、日程",note: "你可以在这里，快速查看与你相关的所有信息"},navInbox: {title: "与你有关的动态",note: "「收件箱」会实时接收项目动态的消息，当你参与的任务、分享、日程、文件等有了新的动态，你就会立即收到通知"},navThree: {title: "应用导航",note: "我们给每个项目都准备了几个应用，你可以一个一个了解并快速上手",target: ".app-switcher .nav",direction: "top"},memberAdd: {title: "添加、管理项目成员",note: "在这里添加、移除成员，设置管理员",target: ".modal-dialog",direction: "left"},homeToday: {title: "项目动态",note: "在这能看到项目中所有人都做了些什么。如 Eric 完成了某个任务，Jerry 创建了某个会议日程",target: ".reviews-card-view"},tasksGroup: {title: "创建、切换任务分组",note: "任务分组可以帮助你整理一个项目下的不同类型的工作。例如，研发部可以按照迭代版本分组，行政部可以按照事务类型分组",target: ".tasklist-bar"},tasksStage: {title: "修改、添加任务阶段",note: "你可以通过编辑任务阶段名称、拖动调整阶段顺序、增减阶段数量来设计自己的流程",target: ".popover"},postsMore: {title: "置顶、归档、删除分享",note: "置顶：可将重要内容排到最顶部<br/>归档：将历史分享隐藏起来",target: ".popover"},eventAcano: {title: "Acano 视频会议",note: "提供多人语音、视频、桌面共享会议功能，只需采用 chrome、firefox 浏览器即可参与",target: ".icon-video"},orgImport: {title: "迁入项目",note: "将你的个人项目迁入企业，让工作得到更好的延续",target: ".modal-dialog",direction: "top"},orgGroup: {title: "添加项目分组",note: "点击这里添加分组，之后可以拖动项目到对应分组"},orgRight: {title: "权限设定",note: "拥有者：最高权限，可以根据项目组织进行任意操作。<br/>管理员：仅可调整对应项目内容。",target: ".popover"},orgBar: {title: "任务进度条",note: "实时显示该成员的任务进展情况，并可以横向对比所有成员的进展"},orgTeamCreate: {title: "新建团队",note: "团队让组织结构更加清晰，方便批量操作成员",target: ".modal-dialog"},orgTeamSet: {title: "团队设置",note: "团队重命名、删除、退出等操作",target: ".popover"},orgTeamProject: {title: "参与项目",note: "搜索已有项目，快速将团队成员加入该项目"}}, n = function(a) {
            return a._guidePointActive = !0, q(a.$el, w())
        }, i = function() {
            var a, b;
            return b = t.user.get("isNew"), a = t.PREFERENCE.structureGuide({}, b), b && (t.user.set("isNew", !1), t.PREFERENCE.updateGuide(a, b)), a
        }, v = function(a) {
            var b;
            return b = {}, b[a] = !1, t.PREFERENCE.updateGuide(b)
        }, w = function() {
            var a;
            return a = [], _.each(i(), function(b, c) {
                return b === !0 ? a.push(c) : void 0
            }), a
        }, q = function(a, b) {
            return a.find(".guide-handler:not(.guide-active)").each(function() {
                var a;
                return a = $(this), -1 !== _.indexOf(b, a.data("guide")) ? (h(a), a.addClass("guide-active").one("click", function(a) {
                    return o(a)
                })) : void 0
            })
        }, h = function(a) {
            var b;
            return b = f.html(m()).clone(), _.delay(function() {
                return b.css({marginLeft: .5 * c.width() - a.offset().left - parseInt(a.css("paddingLeft")) - .5 * b.width(),marginTop: .5 * c.height() - a.offset().top - parseInt(a.css("paddingTop")) - .5 * b.height(),opacity: .3}).appendTo(a).transition({marginLeft: b.css("marginLeft"),marginTop: b.css("marginTop"),delay: 200,complete: function() {
                    return b.removeAttr("style")
                }}, function() {
                    return $(this).css({opacity: 1})
                })
            }, 200)
        }, p = function(a) {
            return a.removeClass("guide-active"), _.delay(function() {
                return a.children(".guide-point").remove()
            }, 300)
        }, o = function(a) {
            var c, f, h, i, m;
            return c = $(a.currentTarget), i = c.data("guide"), f = k[i], h = [".modal-dialog", ".tasklist-bar"], v(i), p(c), f ? (e.hasClass("guide-active") && d.trigger("click", [!0]), b.append(e.html(l(f))).append(d.html(j())), m = -1 !== _.indexOf(h, f.target) ? 500 : 0, _.delay(function() {
                var a;
                return a = f.target ? $(f.target) : c, s(a, f.direction), r(a), a.addClass("guide-target"), e.addClass("card-active"), $(".modal-backdrop").length || d.addClass("in"), g(a)
            }, m)) : void 0
        }, g = function(a) {
            return e.on("click.guide", function(a) {
                return a.stopPropagation()
            }), a.on("click", function() {
                return d.trigger("click")
            }), e.find(".card-close").on("click", function(a) {
                return a.stopPropagation(), d.trigger("click")
            }), c.on("resize.guide scroll.guide", _.throttle(function() {
                return s(a), r(a)
            }, 10)), b.on("keydown.guide", function(a) {
                return 27 === a.which ? (a.stopPropagation(), d.trigger("click")) : void 0
            }), d.one("click", function(b, c) {
                return b.stopPropagation(), c ? (e.addClass("card-move"), _.delay(function() {
                    return e.removeClass("card-move")
                }, 200)) : (a.removeClass("guide-target"), e.removeClass("card-active"), d.removeClass("in"), _.delay(function() {
                    return e.not(".card-active").removeAttr("style").remove(), d.remove()
                }, 200)), u()
            })
        }, u = function() {
            return c.off("resize.guide scroll.guide"), b.off("keydown.guide"), e.off("click.guide"), e.find(".card-close").off("click")
        }, s = function(a, b) {
            var d, f, g, h, i, j, k, l, m, n;
            if (n = a.outerWidth(), j = a.parent().outerWidth(), n > j && (n = j), k = document.documentElement.scrollTop || window.pageYOffset, l = {top: a.offset().top,left: a.offset().left}, m = {height: a.outerHeight(),width: n}, i = {height: e.outerHeight(),width: e.outerWidth()}, h = function() {
                return i.top = l.top + m.height + 20, i.left = l.left + .5 * m.width - .5 * i.width, i.arrowPosition = "top"
            }, d = function() {
                return i.top = l.top - i.height - 20, i.left = l.left + .5 * m.width - .5 * i.width, i.arrowPosition = "bottom"
            }, f = function() {
                return i.top = l.top + .5 * m.height - .5 * i.height, i.left = l.left + m.width + 20, i.arrowPosition = "left"
            }, g = function() {
                return i.top = l.top + .5 * m.height - .5 * i.height, i.left = l.left - i.width - 20, i.arrowPosition = "right"
            }, !b || "left" !== b && "right" !== b && "bottom" !== b && "top" !== b)
                d(), i.left + i.width > c.width() && l.left - i.width - 10 > 0 ? g() : i.top < 0 && i.height + m.height + l.top < c.height() ? h() : i.left < 0 && f();
            else
                switch (b) {
                    case "left":
                        f();
                        break;
                    case "right":
                        g();
                        break;
                    case "top":
                        h();
                        break;
                    case "bottom":
                        d()
                }
            return e.css({top: "" + i.top + "px",left: "" + i.left + "px"}).children(".card-arrow").prop("class", "card-arrow " + i.arrowPosition)
        }, r = function(a) {
            return d.find(".guide-bdcp").attr({x: a.offset().left - b.scrollLeft(),y: a.offset().top - b.scrollTop(),width: a.outerWidth(),height: a.outerHeight()})
        }, {initialize: n,validList: w}
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/app", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return d = a("model"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "app", c.prototype.urlRoot = "apps", c.prototype.idAttribute = "name", c.prototype.getUrl = function() {
                return "app:" + this.get("name")
            }, c.prototype.getIcon = function() {
                var a;
                switch (this.get("name")) {
                    case "tasks":
                        a = "icon-board";
                        break;
                    case "posts":
                        a = "icon-wall";
                        break;
                    case "files":
                        a = "icon-library";
                        break;
                    case "events":
                        a = "icon-calendar";
                        break;
                    case "tags":
                        a = "icon-tag";
                        break;
                    default:
                        a = "icon-" + this.get("name")
                }
                return a
            }, c
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/apps", ["require", "exports", "module", "models/app", "collection"], function(a) {
        var c, d, e, f;
        return d = a("models/app"), e = a("collection"), f = [{name: "home",title: "主页"}, {name: "tasks",title: "任务板"}, {name: "posts",title: "分享墙"}, {name: "files",title: "文件库"}, {name: "events",title: "日程表"}, {name: "review",title: "回顾"}, {name: "tags",title: "标签"}, {name: "bookkeeping",title: "记账"}], c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "apps", c.prototype.model = d, c.prototype.sync = function(a, b, c) {
                switch (a) {
                    case "read":
                        return c.success(f), this.synced = !0
                }
            }, c
        }(e)
    }), define("views/organization/organization-expiring/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="modal-dialog modal-padding"> <div class="modal-content"> <header class="modal-header"> <a class="modal-close modal-close pull-right icon icon-remove"></a> <h4 class="modal-title">到期提示</h4> </header> <div class="modal-body"> <p class="description">' + b(a._organizaitonName) + '的企业版即将到期，请及时续费</p> <div class="organization-expiring-handler-set clearfix"> <a href="https://pay.teambition.com/confirm_order?_organizationId=' + a._organizaitonId + '" target="_blank" class="btn btn-primary btn-block">前往支付中心</a> <!--<a href="" target="_blank" class="btn btn-link btn-block">怎么更好地使用企业版</a>--> </div> </div> </div></div>';
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/organization-expiring/index", ["require", "exports", "module", "./templates/basic", "moment", "collections/organizations", "store", "view"], function(a) {
        var c, d, e, f, g, h, i;
        return c = a("./templates/basic"), d = a("moment"), f = a("collections/organizations"), g = a("store"), h = a("view"), i = g.namespace("temp").namespace("organization_expiring"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "OrganizationExpiringView", e.prototype.className = "organization-expiring modal fade in", e.prototype.events = {"click .modal-close": "hide","click .btn": "hide"}, e.prototype.hotkeys = {esc: function(a) {
                return a.preventDefault(), this.hide()
            }}, e.prototype.initialize = function(a) {
                var b, c;
                if (a._organizationId && (this.options = a, this.organizationsCollection = f.get(0), this.organizationModel = this.organizationsCollection.get(a._organizationId), this.organizationModel.hasRight() > 1))
                    return this.localCacheId = "" + a._organizationId, c = i(this.localCacheId), b = d(), c && b.isSame(c, "day") || (i(this.localCacheId, b), this.render().show()), this
            }, e.prototype.render = function() {
                return this.$el.html(c({_organizaitonId: this.organizationModel.id,_organizaitonName: this.organizationModel.get("name")})), this
            }, e.prototype.show = function() {
                return this.$el.appendTo("body"), this.$backdrop = $("<div></div>").addClass("organization-expiring-modal-backdrop fade in").insertAfter(this.$el)
            }, e.prototype.hide = function() {
                return this.$el ? (this.$el.removeClass("in"), _.delay(function(a) {
                    return function() {
                        return a.$backdrop.remove(), a.remove()
                    }
                }(this), 350)) : void 0
            }, e.prototype.remove = function() {
                var a;
                return null != (a = this.$backdrop) && a.remove(), e.__super__.remove.apply(this, arguments)
            }, e
        }(h)
    }), define("views/organization/organization-overdue/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="modal-content"> <div class="organization-overdue-icon"></div> <div class="organization-overdue"> <h3>组织已到期</h3> <p class="organization-overdue-message">' + a.message + "</p> ";
            return 2 == a.hasRight && (b += ' <div class="organization-overdue-set"> <a class="btn btn-primary" href="http://pay.teambition.com/confirm_order?_organizationId=' + a._organizaitonId + '" target="_blank">立即付款</a> ', a.projectsCount > 0 && (b += ' <a class="btn btn-default export-projects">迁出项目</a> '), b += " </div> "), b += " </div></div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/core/selector/index", ["require", "exports", "module", "view"], function(a) {
        var c, d;
        return d = a("view"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "SelectorView", c.prototype.className = "selector", c.prototype.events = {"click .selector-item": "select","input input": "checkCreateCondition","click .create-handler": "create"}, c.prototype.initialize = function(a) {
                return this.options = a, this.reset(a).render().bindEvents(), this.$el.appendTo(this.options.$container), _.delay(function(a) {
                    return function() {
                        return a.options ? a.position() : void 0
                    }
                }(this), 200), this
            }, c.prototype.reset = function(a) {
                return this.collection = a.collection, this
            }, c.prototype.render = function() {
                return this.$el.html(this.options.template({selected: this.options.selected,collection: this.options.collection})), this.$input = this.$("input"), this.$createHandler = this.$(".create-handler"), this
            }, c.prototype.position = function() {
                var a, b, c, d, e;
                return a = this.options.$container || $("body"), b = this.options.$opener, c = this.options.collection.length, c > 6 && (c = 6), e = b.offset().top - a.offset().top - 25 * c - 10, d = {position: "absolute",top: e,left: 90,right: 10}, null != this.options.position && (d = _.extend(d, this.options.position)), this.$el.css(d), this
            }, c.prototype.bindEvents = function() {
                return this.options.$opener.click(function(a) {
                    return function() {
                        return a.show()
                    }
                }(this))
            }, c.prototype.bindBlueHandler = function() {
                return $(document).one("click", function(a) {
                    return function(b) {
                        return a.$el ? 0 === $(b.target).closest(".selector").length || $(b.target).closest(".selector-item").length ? a.hide() : a.bindBlueHandler() : void 0
                    }
                }(this))
            }, c.prototype.select = function(a) {
                return this.$(".active").removeClass("active"), $(a.currentTarget).addClass("active"), this.options.select(a)
            }, c.prototype.show = function() {
                return this.position(), this.$el.show(), _.delay(function(a) {
                    return function() {
                        return a.bindBlueHandler()
                    }
                }(this)), this
            }, c.prototype.hide = function() {
                return this.$el.hide(), this
            }, c.prototype.checkCreateCondition = function() {
                return this.$createHandler.prop("disabled", !this.$input.val())
            }, c.prototype.create = function() {
                return this.options.create(this.$input.val()) ? (this.$input.val(""), this.hide()) : this.$input.focusAtEnd()
            }, c
        }(d)
    }), define("views/organization/projects-transfer/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<header class="modal-header"> <h4 class="modal-title">迁入项目</h4></header><div class="modal-body clearfix"> <div class="transfer-from"> <div class="transfer-title">' + b(a.sourceTitle) + '</div> <ul class="transfer-list thin-scroll"></ul> </div> <div class="transfer-to"> <div class="transfer-title"> <span>迁入到 :</span> ';
            return a.targetOrgs.length > 1 ? c += ' <div class="transfer-to-selector-handler form-control"> <b class="caret"></b> <strong>' + b(a.targetOrgs[0].name) + "</strong> </div> " : a.targetOrgs.length > 0 && (c += " " + b(a.targetOrgs[0].name) + " "), c += ' </div> <div class="transfer-personal-tips"></div> <ul class="transfer-list thin-scroll"></ul> </div></div><div class="modal-footer"> <button class="confirm-handler btn btn-primary pull-right">确定</button> <button class="cancel-handler btn btn-link pull-right">取消</button></div>'
        }
    }), define("views/organization/projects-transfer/templates/organizations-selector", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<ul class="organization-list selector-options thin-scroll"> ', d = a.collection;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <li class="organization-item clearfix selector-item ', e._id == a.selected._id && (c += "active"), c += '" data-id="' + e._id + '"> <div class="organization-info selector-item-content pull-left"> <strong class="organization-name">' + b(e.name) + '</strong> </div> <span class="icon icon-tick pull-right"></span> </li> ';
            return c += "</ul>"
        }
    }), define("views/organization/projects-transfer/templates/source-projects", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.projects;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <li data-id="' + e._id + '" class="cleafix"> <div class="logo" style="background-image:url(' + e.logo + ');"></div> <div class="project-name hinted" data-title="' + e.name + '">' + b(e.name) + '</div> <span class="btn btn-primary btn-small transfer-handle">迁入</span> </li>';
            return c
        }
    }), define("views/organization/projects-transfer/templates/target-projects", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.projects;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <li data-id="' + e.id + '" class="cleafix"> <div class="logo" style="background-image:url(' + e.logo + ');"></div> <div class="project-name hinted" data-title="' + e.name + '">' + b(e.name) + '</div> <span class="btn btn-default btn-small remove-handle">移除</span> </li>';
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/organization/projects-transfer/index", ["require", "exports", "module", "teambition", "thenjs", "view", "collections/organizations", "collections/projects", "views/core/selector/index", "./templates/basic", "./templates/organizations-selector", "./templates/source-projects", "./templates/target-projects", "essage"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n, o;
        return n = a("teambition"), l = a("thenjs"), m = a("view"), e = a("collections/organizations"), g = a("collections/projects"), i = a("views/core/selector/index"), c = a("./templates/basic"), f = a("./templates/organizations-selector"), j = a("./templates/source-projects"), k = a("./templates/target-projects"), o = a("essage"), h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "ProjectsTransferView", h.prototype.className = "projects-transfer-view modal-dialog modal-padding", h.prototype.events = {"click .confirm-handler": "submit","click .cancel-handler": "close","click .transfer-handle": "addToSelected","click .remove-handle": "removeSelected"}, h.prototype.initialize = function(a) {
                return a ? (this.options = a, 0 === this.options.sourceId && (this.options.sourceId = null), this.isTransferring = !1, this.loadData(function(a) {
                    return function() {
                        return a.renderBasic().renderSourceProjects().renderTargetSelect().renderTargetProjects()
                    }
                }(this)), this) : !1
            }, h.prototype.loadData = function(a) {
                return this.sourceTitle = this.options.sourceTitle, this.sourceTitle || (this.sourceTitle = null === this.options.sourceId ? "个人项目" : "组织项目"), this.options.targetIds = _.without(this.options.targetIds, this.options.sourceId), g.fetch(this.options.sourceId, {success: function(b) {
                    return function(c) {
                        var d, f, h;
                        return d = [], c.each(function(a) {
                            var b;
                            return b = a.get("_organizationId") || 0, c._boundToObjectId === b && 2 === a.hasRight() ? d.push(a.toJSON()) : void 0
                        }), f = e.get(0).getOrganizationsByIds(b.options.targetIds), b.projectsCollection = new g(d), b.targetOrgsCollection = new e(f), b.selectedOrgId = (null != (h = f[0]) ? h._id : void 0) || null, b.plan = n.user.get("plan"), a()
                    }
                }(this)}), this
            }, h.prototype.loadOrgData = function(a) {
                var b;
                return b = a.toJSON(), d.call(this.options.targetIds, 0) >= 0 && b.unshift({name: "个人项目",_id: n.user.id}), b
            }, h.prototype.renderBasic = function() {
                var a;
                return a = this.loadOrgData(this.targetOrgsCollection), this.$el.html(c({sourceTitle: this.sourceTitle,targetOrgs: a})), this.$transferFrom = this.$(".transfer-from .transfer-list"), this.$transferTo = this.$(".transfer-to .transfer-list"), this.$transferToSelectTitle = this.$(".transfer-to-selector-handler strong"), this.$transferPersonalTip = this.$(".transfer-personal-tips"), this.$submitter = this.$(".confirm-handler"), this.$cancel = this.$(".cancel-handler"), this
            }, h.prototype.renderSourceProjects = function() {
                var a;
                return a = this.projectsCollection.reject(function(a) {
                    return a._selected
                }), a = _.map(a, function(a) {
                    return a.toJSON()
                }), this.$transferFrom.html(j({projects: a})), this
            }, h.prototype.renderTargetProjects = function() {
                var a, b;
                return a = this.getSelected(this.selectedOrgId), a = _.map(a, function(a) {
                    return a.toJSON()
                }), null === this.selectedOrgId ? (b = this.getOwnTotalCount(), this.$transferPersonalTip.html("个人项目 里还有" + b + "个项目").show(), this.$transferTo.addClass("transfer-personal")) : (this.$transferTo.removeClass("transfer-personal"), this.$transferPersonalTip.hide()), this.$transferTo.html(k({projects: a})), this
            }, h.prototype.renderTargetSelect = function() {
                var a, b;
                return this.$(".transfer-to-selector-handler").length ? (this.$(".selector").remove(), a = this.loadOrgData(this.targetOrgsCollection), this.requestSubView(i, {$container: this.$el,$opener: this.$(".transfer-to-selector-handler"),selected: a[0],collection: a,template: f,position: {left: 370,right: "none"},select: function(a) {
                    return function(b) {
                        var c;
                        c = $(b.currentTarget).data("id"), c === n.user.id && (c = null), a.selectedOrgId = c, a.refreshSelectedOrg().renderTargetProjects()
                    }
                }(this)}), this.selectedOrgId = (null != (b = a[0]) ? b.id : void 0) || null, this) : this
            }, h.prototype.refreshView = function() {
                return this.renderSourceProjects().renderTargetProjects(), this
            }, h.prototype.refreshSelectedOrg = function() {
                var a;
                return null === this.selectedOrgId ? this.$transferToSelectTitle.html("个人项目") : (a = e.get(0).get(this.selectedOrgId), this.$transferToSelectTitle.html(a.get("name"))), this
            }, h.prototype.addToSelected = function(a) {
                var b, c;
                return b = $(a.currentTarget).closest("li").data("id"), b && !this.isTransferring ? (c = this.projectsCollection.find(function(a) {
                    return a.id === b
                }), c._selected = !0, c._targetOrganizationId = this.selectedOrgId, this.refreshView(), this) : void 0
            }, h.prototype.removeSelected = function(a) {
                var b, c;
                return b = $(a.currentTarget).closest("li").data("id"), b && !this.isTransferring ? (c = this.projectsCollection.find(function(a) {
                    return a.id === b
                }), c._targetOrganizationId = null, c._selected = !1, this.refreshView(), this) : void 0
            }, h.prototype.getSelected = function(a) {
                var b;
                return b = [], this.projectsCollection.each(function(c) {
                    return !c._selected || a && c._targetOrganizationId !== a ? void 0 : b.push(c)
                }), b
            }, h.prototype.getOwnTotalCount = function() {
                var a;
                return a = this.getSelected(this.selectedOrgId).length, this.plan.created + a
            }, h.prototype.submit = function(a) {
                return !this.$submitter.hasClass("disabled") && this.getSelected().length ? (this.isTransferring = !0, l.eachSeries(this.getSelected(), function(a) {
                    return function(b, c) {
                        var d;
                        return d = c._targetOrganizationId, c.transfer(d, {wait: !0,beforeSend: function() {
                            return a.$submitter.addClass("disabled").html("正在迁入"), a.$cancel.addClass("disabled")
                        },success: function() {
                            return b()
                        },error: function(a) {
                            return b(a)
                        }})
                    }
                }(this)).then(function(b) {
                    return function() {
                        var c;
                        return Essage.show({message: "迁入成功",status: "success"}, 2e3), "function" == typeof (c = b.options).success && c.success(), a !== !0 ? b.close() : void 0
                    }
                }(this)).fail(function(a) {
                    return function(b, c) {
                        var d;
                        switch (d = c.message, c.code) {
                            case 207:
                                d = "请升级新拥有者的项目套餐然后再重试";
                                break;
                            case 301:
                                d = "您没有转移该项目的权限";
                                break;
                            case 302:
                                d = "该项目未能成功转移, 请尝试刷新网页然后重试"
                        }
                        return Essage.show({message: d,status: "error"}, 2e3), a.$submitter.removeClass("disabled").html("确定"), a.$cancel.removeClass("disabled"), a.isTransferring = !1
                    }
                }(this))) : void 0
            }, h.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, h.prototype.remove = function() {
                var a;
                return "function" == typeof (a = this.options).onclose && a.onclose(), h.__super__.remove.apply(this, arguments)
            }, h
        }(m)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("lib/window/index", ["require", "exports", "module", "hotkey", "util", "view"], function(a) {
        var c, d, e, f, g, h;
        return d = a("hotkey"), e = a("util"), f = a("view"), h = [], c = $("body"), g = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "WindowView", f.prototype.className = "modal fade", f.prototype.hotkeys = {esc: function(a) {
                return a.preventDefault(), this.close()
            }}, f.prototype.delegateModalEvents = function() {
                return this.$el.on("shown.bs.modal", function(a) {
                    return function() {
                        return a.onOpen()
                    }
                }(this)), this.$el.on("hidden.bs.modal", function(a) {
                    return function() {
                        return a.remove()
                    }
                }(this)), this
            }, f.prototype.open = function(a, b) {
                var e;
                return e = h[0], h.unshift(this), this.$el.one("showing.bs.modal", function(a) {
                    return function() {
                        var b;
                        return e ? (b = parseInt(e.$el.css("z-index"), 10) + 1, a.modal.$backdrop.css("z-index", b - 1), a.$el.css("z-index", b)) : void 0
                    }
                }(this)), this.currentView = this.requestSubView(a, b), this.renderDialog ? this.renderDialog(this.currentView) : this.$el.html(this.currentView.$el), this.delegateModalEvents(), c.addClass("modals-open"), this.modal = this.$el.modal({keyboard: !1,backdrop: (null != b ? b.backdrop : void 0) || !0}).data("bs.modal"), d.add(this), this
            }, f.prototype.close = function() {
                var a;
                return null != (a = this.modal) && a.hide(), this
            }, f.prototype.onOpen = function() {
                var a, b, c;
                return $(document).off("focusin.bs.modal"), null != (a = this.currentView) && "function" == typeof a.onOpen && a.onOpen(), null != (b = this.currentView) && null != (c = b.options) && "function" == typeof c.onOpen && c.onOpen(), this
            }, f.prototype.remove = function() {
                var a, b, g, i;
                return null != (a = this.modal) && a.removeBackdrop(), null != (b = this.currentView) && "function" == typeof b.onClose && b.onClose(), null != (g = this.currentView) && null != (i = g.options) && "function" == typeof i.onClose && i.onClose(), e.removeItem(h, this), d.remove(this), h.length || ($(".modal-backdrop").remove(), c.removeClass("modals-open modal-open")), f.__super__.remove.apply(this, arguments)
            }, f
        }(f)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/organization-overdue/index", ["require", "exports", "module", "./templates/basic", "collections/organizations", "views/organization/projects-transfer/index", "view", "lib/window/index"], function(a) {
        var c, d, e, f, g, h;
        return c = a("./templates/basic"), e = a("collections/organizations"), f = a("views/organization/projects-transfer/index"), g = a("view"), h = a("lib/window/index"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "OrganizationOverdueView", d.prototype.className = "organization-overdue modal-dialog modal-padding", d.prototype.events = {"click .export-projects": "openProjectsExportTransfer"}, d.prototype.initialize = function(a) {
                return a._organizationId ? (this.options = a, this.organizationsCollection = e.get(0), this.organizationModel = this.organizationsCollection.get(a._organizationId), this.renderBasic(), this) : void 0
            }, d.prototype.renderBasic = function() {
                var a, b;
                return b = this.organizationModel.get("name"), a = this.options.inProject ? "该项目所在组织「" + b + "」已经到期，请尽快续费" : "该组织「" + b + "」已经到期，请尽快续费", this.$el.html(c({_organizaitonId: this.organizationModel.id,message: a,hasRight: this.organizationModel.hasRight(),projectsCount: this.organizationModel.get("projectsCount")})), this
            }, d.prototype.openProjectsExportTransfer = function() {
                var a, b;
                return a = e.get(0).getOrganizationsByRight(2), b = _.pluck(a, "id"), b.push(0), this.requestSubView(h).open(f, {sourceId: this.organizationModel.id,sourceTitle: this.organizationModel.get("name"),targetIds: b,onclose: function(a) {
                    return function() {
                        return a.close()
                    }
                }(this)}), this
            }, d.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, d.prototype.remove = function() {
                var a;
                return "function" == typeof (a = this.options).onclose && a.onclose(), d.__super__.remove.apply(this, arguments)
            }, d
        }(g)
    }), define("views/project/project-guide/templates/basic", [], function() {
        return function() {
            var a = '<header class="modal-header text-center"> <h1 class="success-icon"><span class="icon icon-circle-check"></span></h1> <p class="success-desc">项目创建成功 现在邀请伙伴一起加入吧</p></header><div class="guide-settings-content modal-content"></div><footer class="modal-footer clearfix"> <a class="guide-close pull-left">跳过</a> <a class="guide-enter pull-right btn btn-primary">进入项目</a></footer>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/team", ["require", "exports", "module", "teambition", "model", "lib/socket"], function(a) {
        var c, d, e, f;
        return f = a("teambition"), c = a("model"), d = a("lib/socket"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "team", c.prototype.urlRoot = "teams", c.prototype.defaults = {membersCount: 0,projectsCount: 0}, c.prototype.addProject = function(a, b) {
                return b || (b = {}), b.url = "" + this.url() + "/projects/" + a, b.attrs = {}, this.sync("update", this, b), this
            }, c.prototype.removeProject = function(a, b) {
                return b || (b = {}), b.url = "" + this.url() + "/projects/" + a, b.attrs = {}, this.sync("delete", this, b), this
            }, c.prototype.isMember = function(a) {
                return !!_.find(this.get("hasMembers"), function(b) {
                    return b._id === a
                })
            }, c.prototype.quit = function(a) {
                var b;
                return a || (a = {}), a.url = "" + this.url() + "/quit", a.attrs = {}, b = a.success, a.success = function(a) {
                    return function(c) {
                        var d;
                        return d = _.reject(a.get("hasMembers"), function(a) {
                            return a._id === f.user.id
                        }), a.set({hasMembers: d,membersCount: d.length}), "function" == typeof b ? b(c) : void 0
                    }
                }(this), this.sync("update", this, a), this
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/teams", ["require", "exports", "module", "collection", "models/team"], function(a) {
        var c, d, e;
        return c = a("collection"), e = a("models/team"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "teams", c.prototype.model = e, c
        }(c)
    }), define("lib/confirm/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="modal-dialog"> <div class="modal-content"> <header class="modal-header"> <h4 class="modal-title">' + a.title + '</h4> </header> <div class="modal-body"> <p>' + a.description + '</p> </div> <div class="modal-footer"> <button class="confirm-handler btn btn-primary pull-right">' + a.confirm + '</button> <button class="cancel-handler btn btn-link pull-right">' + a.cancel + "</button> </div> </div></div>";
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("lib/confirm/index", ["require", "exports", "module", "./templates/basic", "view"], function(a) {
        var c, d, e;
        return c = a("./templates/basic"), e = a("view"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "confirmView", d.prototype.className = "confirm-modal modal fade in", d.prototype.hotkeys = {esc: function(a) {
                return a.preventDefault(), this.hide()
            }}, d.prototype.events = {"click .cancel-handler": "cancel","click .confirm-handler": "confirm"}, d.prototype.initialize = function(a) {
                return this.options = _.extend({title: "",description: "",cancel: "取消",confirm: "确定",onCancel: function() {
                },onConfirm: function() {
                }}, a), this.render().show(), this
            }, d.prototype.render = function() {
                return this.$el.html(c(this.options)), this
            }, d.prototype.show = function() {
                return this.$el.appendTo("body"), this.$backdrop = $("<div></div>").addClass("confirm-modal-backdrop fade in").insertAfter(this.$el)
            }, d.prototype.hide = function() {
                var a;
                return null != (a = this.$el) && a.removeClass("in"), _.delay(function(a) {
                    return function() {
                        return a.$el ? (a.$backdrop.remove(), a.remove()) : void 0
                    }
                }(this), 350)
            }, d.prototype.cancel = function() {
                return this.options.onCancel(), this.hide()
            }, d.prototype.confirm = function() {
                return this.options.onConfirm(), this.hide()
            }, d.prototype.remove = function() {
                var a;
                return null != (a = this.$backdrop) && a.remove(), d.__super__.remove.apply(this, arguments)
            }, d
        }(e)
    }), define("views/member/member-finder/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            return a.isEmail ? c += ' <li> <a class="member-item" data-param="' + a.params + '"> ' + b(a.email) + " </a> </li>" : (c += ' <li> <a class="member-item ', a.invited && (c += "added"), c += '"> <div class="avatar img-circle img-24" style="background-image:url(' + a.avatarUrl + ');"> </div> ' + b(a.name) + " ", a.isActive && (c += " " + b(a.title || a.location || "") + " "), c += " </a> </li>"), c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/member/member-finder/index", ["require", "exports", "module", "collections/members", "./templates/basic", "util", "view"], function(a) {
        var c, e, f, g, h;
        return c = a("collections/members"), f = a("./templates/basic"), g = a("util"), h = a("view"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "MemberFinderView", e.prototype.initialize = function(a) {
                return (null != a ? a.collection : void 0) ? (this.options = a, this.reset(a.collection)) : void 0
            }, e.prototype.reset = function(a) {
                return this.$searchbox = this.options.$searchbox, this.collection = a || new c, this.initAutoComplete(), this
            }, e.prototype.initAutoComplete = function() {
                return this.$searchbox.autocomplete({appendTo: "body",autoFocus: !0,create: function() {
                    return function() {
                        return $("body > .ui-autocomplete.ui-menu").addClass("dropdown-menu").css({zIndex: 1e4,visibility: "visible",opacity: 1})
                    }
                }(this),select: function(a) {
                    return function(b, c) {
                        var d;
                        return "function" == typeof (d = a.options).select && d.select(c), a.$searchbox.val(""), !1
                    }
                }(this),source: function(a) {
                    return function(b, c) {
                        return b.term = b.term.trim(), a.search(b.term.trim(), {beforeSend: function() {
                            return a.showLoadingIndicator(a.$searchbox, {isPrepend: !0})
                        },success: function(d) {
                            return a.hideLoadingIndicator(), d = a.analysisResult(d, b.term), _.each(d, function(a) {
                                return a.name || (a.name = a.email)
                            }), c(d)
                        }})
                    }
                }(this)}), this.autocomplete = this.$searchbox.data("ui-autocomplete"), this.autocomplete._renderItem = function() {
                    return function(a, b) {
                        return $(f(b)).appendTo(a)
                    }
                }(this), this.autocomplete.liveRegion = $("<span>"), this
            }, e.prototype.search = function(a, b) {
                return a = a.trim(), g.isEmail(a.trim()) && (this.timer && clearTimeout(this.timer), this.timer = setTimeout(function(c) {
                    return function() {
                        return c.doSearch(a, b)
                    }
                }(this), 200)), !0
            }, e.prototype.doSearch = function(a, b) {
                return this.collection.search(a, b)
            }, e.prototype.analysisResult = function(a, b) {
                var c, e, f, h, i, j;
                if (c = this.collection.getMemberIds(), f = [], (null != a ? a.length : void 0) > 0)
                    for (h = 0, i = a.length; i > h; h++)
                        e = a[h], e.type = "member", j = e._id, d.call(c, j) >= 0 && (e.invited = !0), f.push(e);
                else
                    g.isEmail(b) && f.push({type: "email",email: b,isEmail: !0});
                return f
            }, e
        }(h)
    }), define("views/settings/project-settings-member/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="settings-part project-member-settings"> ';
            return a.hasRight > 0 && (b += ' <div class="row add-member-wrapper"> <div class="col-xs-6"> <h4>通过邮箱添加新成员</h4> <div class="member-finder"> <input class="member-info-input form-control" type="text" placeholder="输入邮箱 回车确认"/> </div> </div> <div class="col-xs-6"> <h4>通过链接添加新成员</h4> <div class="member-invite"> <input class="invite-member-link-input form-control" value="' + a.inviteLink + '" /> <a class="icon icon-refresh hinted reset-invite-member-btn" data-title="重置邀请链接后，原链接失效"></a> </div> </div> </div> '), b += " ", a.hasRecommendation || a.hasOrganization ? (b += ' <div class="member-nav"> <h4 class="member-tabs active" data-tab="project"> 项目成员列表 </h4> ', a.hasOrganization && (b += ' <span class="member-tabs-span">|</span> <h4 class="member-tabs" data-tab="organization"> 导入组织成员 </h4> '), b += " ", a.hasRecommendation && (b += ' <span class="member-tabs-span">|</span> <h4 class="member-tabs" data-tab="recommendation"> 推荐成员 </h4> '), b += " </div> ") : b += " <h4>项目成员列表</h4> ", b += ' <div class="project-member-column member-columns active"> <div class="teams-list-content clearfix"></div> <div class="members-list-content"></div> </div></div>'
        }
    }), define("views/settings/project-settings-member/templates/members-list", [], function() {
        return function(a) {
            var b = "";
            return "organization" == a.tab && (b += " <h5>成员</h5>"), b += '<ul class="members-list list"><li class="members-list-placeholder"> <div class="placeholder muted">还没有成员</div> </li></ul>'
        }
    }), define("views/settings/project-settings-member/templates/member", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            return "project" == a.tab ? (c += ' <li class="member" data-id="' + a._id + '"> <div class="avatar img-circle img-36" style="background-image:url(' + a.avatarUrl + ');"> ', a.hasVisited || (c += ' <span class="icon icon-leave-state never-visit"></span> '), c += ' </div> <p class="abstract"> ', c += a._id === a._userMeId ? ' <strong class="name hinted" data-title="我(' + a.name + ')">我(' + b(a.name) + ")</strong> " : ' <strong class="name hinted" data-title="' + a.name + '">' + b(a.name) + "</strong> ", c += ' </p> <p class="muted"> ', c += a.hasVisited || 0 != a.hasRight ? " " + a.role + b(a.title && "・" + a.title) + " " : " 该成员从未访问过此项目 ", c += " </p> ", a.myProjectRight > 0 && a._id != a._userMeId && (c += ' <div class="handlerset', 0 == a.isActive && a.password && (c += " no-btn"), c += '"> ', 0 == a.isActive && a.password && 0 == a.hasRight ? c += ' <span class="muted init-password">待激活，初始密码：' + a.password + '</span> <div class="dropdown"> <a data-toggle="dropdown"> <span class="icon icon-chevron-down"></span> </a> <ul class="dropdown-menu card"> <li><a class="authority-handler" data-type="member" data-id="' + a._id + '" data-action="resend"> 重发邀请信 </a></li> <li><a class="authority-handler delete-handler" data-type="member" data-id="' + a._id + '" data-action="delete"> 移除成员 </a></li> </ul> </div> ' : (c += " ", a.enableEdit && (c += " ", 1 == a.hasRight ? c += ' <a class="btn btn-primary btn-small authority-handler" data-type="member" data-id="' + a._id + '" data-action="member"> 取消管理员 </a> ' : 0 == a.hasRight && (c += ' <a class="btn btn-primary btn-small authority-handler" data-type="member" data-id="' + a._id + '" data-action="admin"> 设为管理员 </a> '), c += " "), c += " ", a.enableRemove && (c += ' <a class="btn btn-danger btn-small authority-handler delete-handler" data-type="member" data-id="' + a._id + '" data-action="delete"> 移除成员 </a> '), c += " "), c += " </div> "), c += " </li>") : (c += ' <li class="member" data-id="' + a._id + '"> <div class="avatar img-circle img-36" style="background-image:url(' + a.avatarUrl + ');"></div> <p class="abstract"> <strong class="name hinted" data-title="' + a.name + '">' + b(a.name) + '</strong> </p> <p class="muted">' + b(a.title) + "</p> ", a.myProjectRight >= 0 && a._id != a._userMeId && (c += ' <div class="handlerset"> ', c += a.inProject ? ' <span class="muted">已加入项目</span> ' : ' <a class="btn btn-primary btn-small authority-handler" data-type="member" data-id="' + a._id + '" data-action="add"> 加入项目 </a> ', c += " </div> "), c += " </li>"), c
        }
    }), define("views/settings/project-settings-member/templates/teams-list", [], function() {
        return function(a) {
            var b = '<div class="organization-teams-panel"> ';
            return "organization" == a.tab && (b += ' <h5 class="team-header">团队</h5> '), b += ' <ul class="teams-list list"> <li class="teams-list-placeholder"> <div class="placeholder muted">还没有导入团队</div> </li> </ul></div>'
        }
    }), define("views/settings/project-settings-member/templates/team", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            if ("project" == a.tab) {
                c += ' <li class="team two-col" data-id="' + a._id + '"> <div class="box-wrap"> <p class="abstract"> <span class="name">' + b(a.name) + "・" + a.hasMembers.length + "</span> ", a.hasRight > 0 && (c += ' <a class="icon icon-trash-bold hinted authority-handler delete-handler" data-type="team" data-id="' + a._id + '" data-title="移除团队" data-action="delete"> </a> '), c += ' </p> <div class="team-member-list clearfix"> ';
                var d = a.hasMembers;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; )
                        e = d[f += 1], c += " ", 7 > f && (c += ' <div class="avatar img-circle img-24 hinted" data-title="' + e.name + '" style="background-image:url(' + e.avatarUrl + ');"></div> '), c += " ";
                c += " ", a.hasMembers.length >= 7 && (c += ' <div class="pull-right"><a class="view-all-team-members hinted" data-title="查看团队所有成员" data-team-id="' + a._id + '" >...</a></div> '), c += " </div> </div> </li>"
            } else if ("organization" == a.tab) {
                c += ' <li class="team" data-id="' + a._id + '"> <p class="abstract"> <strong class="name">' + b(a.name) + "・" + a.hasMembers.length + "</strong> </p> ", a.hasRight > 0 && (c += ' <div class="handlerset"> ', c += a.inProject ? ' <span class="muted">已导入</span> ' : ' <a class="btn btn-primary btn-small authority-handler" data-type="team" data-id="' + a._id + '" data-action="add"> 导入 </a> ', c += " </div> "), c += ' <div class="team-member-list"> ';
                var h = a.hasMembers;
                if (h)
                    for (var e, i = -1, j = h.length - 1; j > i; )
                        e = h[i += 1], c += ' <div class="avatar img-circle img-24 hinted" data-title="' + e.name + '" style="background-image:url(' + e.avatarUrl + ');"></div> ';
                c += " </div> </li>"
            }
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/settings/project-settings-member/index", ["require", "exports", "module", "teambition", "thenjs", "util", "view", "collections/members", "collections/organizations", "collections/teams", "lib/confirm/index", "views/member/member-finder/index", "./templates/basic", "./templates/members-list", "./templates/member", "./templates/teams-list", "./templates/team", "essage"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t;
        return s = a("teambition"), o = a("thenjs"), p = a("util"), q = a("view"), f = a("collections/members"), j = a("collections/organizations"), l = a("collections/teams"), e = a("lib/confirm/index"), g = a("views/member/member-finder/index"), c = a("./templates/basic"), i = a("./templates/members-list"), h = a("./templates/member"), n = a("./templates/teams-list"), m = a("./templates/team"), t = a("essage"), r = ["project", "organization", "recommendation"], k = function(a) {
            function j() {
                return j.__super__.constructor.apply(this, arguments)
            }
            return b(j, a), j.prototype.viewName = "ProjectSettingsMemberView", j.prototype.className = "project-settings-member-view", j.prototype.events = {"click .member-tabs": "toggle","click .authority-handler": "handleAction","click .reset-invite-member-btn": "resetInvite"}, j.prototype.initialize = function(a) {
                return (null != a ? a.projectModel : void 0) ? (this.options = a, this.projectModel = a.projectModel, this.organizationId = this.projectModel.get("_organizationId"), this.renderBasic(), _.delay(function(a) {
                    return function() {
                        return a.toggle()
                    }
                }(this), 100), this) : void 0
            }, j.prototype.renderBasic = function() {
                var a;
                return a = _.extend(this.projectModel.toJSON(), {hasRight: this.projectModel.hasRight(),hasRecommendation: this.projectModel.hasRight() && this.options.hasRecommendation !== !1,hasOrganization: this.projectModel.hasRight() && this.projectModel.get("_organizationId")}), this.$el.html(c(a)), this.$inviteInput = this.$(".invite-member-link-input"), this.$teamsListContent = this.$(".teams-list-content"), this.$membersListContent = this.$(".members-list-content"), this
            }, j.prototype.toggle = function(a) {
                var b, c;
                return a && (b = $(a.currentTarget), b.siblings().removeClass("active"), c = b.data("tab")), d.call(r, c) < 0 && (c = r[0]), this.tab = c, this.$(".member-tabs[data-tab='" + c + "']").addClass("active"), this.$membersListContent.empty(), this.$teamsListContent.empty(), this.showLoadingIndicator(this.$membersList), this.loadDatas({success: function(a) {
                    return function() {
                        return a.hideLoadingIndicator(), a.renderMembers(), a.renderTeams(), a.listen()
                    }
                }(this)}), this
            }, j.prototype.loadDatas = function(a) {
                switch (this.tab) {
                    case r[0]:
                        this.loadProjectMembersAndTeams(a);
                        break;
                    case r[1]:
                        this.loadOrganizationMembersAndTeams(a);
                        break;
                    case r[2]:
                        this.projectModel.getRecommendMembers({success: function(b) {
                            return function(c) {
                                return b.recommendationMembersCollection = new f(c), a.success()
                            }
                        }(this)})
                }
                return this
            }, j.prototype.loadProjectMembersAndTeams = function(a) {
                return o.parallel([function(a) {
                    return function(b) {
                        return f.fetch(a.projectModel.id, {boundToObjectType: "project",attrs: {excludeTeamMembers: !0},success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this), function(a) {
                    return function(b) {
                        return l.fetch(a.projectModel.id, {boundToObjectType: "project",success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this)]).fin(function(b) {
                    return function(c, d, e) {
                        return d ? void 0 : (b.projectMembersCollection = e[0], b.projectTeamsCollection = e[1], b.initMemberFinder(), a.success())
                    }
                }(this))
            }, j.prototype.initMemberFinder = function() {
                return this.$memberInput = this.$(".member-info-input"), this.$memberInput.length ? this.requestSubView(g, {collection: this.projectMembersCollection,$searchbox: this.$memberInput,select: function(a) {
                    return function(b) {
                        return a.addMember(b, {success: function() {
                            var a;
                            return a = b.item.email, Essage.show({message: "成功添加成员，已向 " + a + " 发送邀请信",status: "success"}, 4e3)
                        }})
                    }
                }(this)}) : void 0
            }, j.prototype.loadOrganizationMembersAndTeams = function(a) {
                return o.parallel([function(a) {
                    return function(b) {
                        return f.fetch(a.organizationId, {boundToObjectType: "organization",success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this), function(a) {
                    return function(b) {
                        return l.fetch(a.organizationId, {boundToObjectType: "organization",success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this)]).fin(function(b) {
                    return function(c, d, e) {
                        return d ? void 0 : (b.organizationMembersCollection = e[0], b.organizationTeamsCollecton = e[1], a.success())
                    }
                }(this))
            }, j.prototype.listen = function() {
                switch (this.stopListening(), this.tab) {
                    case r[0]:
                        this.listenTo(this.projectMembersCollection, "add", function(a) {
                            return function(b) {
                                return a.renderMember(b, {isPrepend: !0})
                            }
                        }(this)), this.listenTo(this.projectMembersCollection, "change", function(a) {
                            return function(b) {
                                return b.get("isQuited") ? a.removeMember(b) : a.renderMember(b)
                            }
                        }(this)), this.listenTo(this.projectMembersCollection, "remove", this.removeMember), this.listenTo(this.projectTeamsCollection, "add change", this.renderTeam), this.listenTo(this.projectTeamsCollection, "remove", this.removeTeam);
                        break;
                    case r[1]:
                        this.listenTo(this.organizationMembersCollection, "add", function(a) {
                            return function(b) {
                                return a.renderMember(b)
                            }
                        }(this)), this.listenTo(this.projectMembersCollection, "change:isQuited", function(a) {
                            return function(b) {
                                return b.get("isQuited") ? a.removeMember(b) : a.renderMember(b)
                            }
                        }(this));
                        break;
                    case r[2]:
                        this.listenTo(this.recommendationMembersCollection, "remove", this.removeMember), this.listenTo(this.recommendationMembersCollection, "change add", this.renderMember)
                }
                return this
            }, j.prototype.renderMembers = function() {
                var a, b;
                switch (this.$membersListContent.empty(), this.$membersListContent.html(i({tab: this.tab})), a = this.$membersListContent.find(".members-list"), this.tab) {
                    case r[0]:
                        b = this.projectMembersCollection;
                        break;
                    case r[1]:
                        b = this.organizationMembersCollection;
                        break;
                    case r[2]:
                        b = this.recommendationMembersCollection
                }
                return b.length && (a.empty(), b.sort(), b.each(function(a) {
                    return function(b) {
                        return a.renderMember(b)
                    }
                }(this))), this
            }, j.prototype.isRenderMember = function(a) {
                var b, c, d, e;
                switch (b = a.get("in"), this.tab) {
                    case r[0]:
                        return "team" === b ? !1 : !!(null != (c = this.projectMembersCollection) ? c.get(a.id) : void 0);
                    case r[1]:
                        return !!(null != (d = this.organizationMembersCollection) ? d.get(a.id) : void 0);
                    case r[2]:
                        return !!(null != (e = this.recommendationMembersCollection) ? e.get(a.id) : void 0)
                }
                return !1
            }, j.prototype.renderMember = function(a, b) {
                var c, d, e, f, g;
                if (this.isRenderMember(a))
                    return g = _.extend({isPrepend: !1}, b), c = this.$membersListContent.find(".members-list"), e = a.toJSON(), e.name = $("<div>").text(e.name).html(), e.tab = this.tab, e.myProjectRight = this.projectModel.hasRight(), e.myOrgRight = this.projectModel.get("hasOrgRight"), e.role = a.getRole(), e.inProject = !!this.projectMembersCollection.get(a.id), e._userMeId = s.user.id, e.hasOrgRight > -2 || (e.hasOrgRight = -2), this.projectModel.get("isPublic") && (e.hasVisited = !0), e.enableEdit = e.hasOrgRight < 1 && 2 === Math.max(e.myProjectRight, e.myOrgRight), e.enableRemove = Math.max(e.myProjectRight, e.myOrgRight) > Math.max(e.hasRight, e.hasOrgRight), f = g.isPrepend ? "prepend" : "append", d = c.find(".member[data-id=" + a.id + "]"), d.length ? d.replaceWith($(h(e))) : c[f](h(e)), this
            }, j.prototype.renderTeams = function() {
                var a, b;
                if (this.$teamsListContent.empty(), this.tab !== r[2] && this.organizationId) {
                    switch (this.$teamsListContent.html(n({tab: this.tab})), a = this.$teamsListContent.find(".teams-list"), this.tab) {
                        case r[0]:
                            b = this.projectTeamsCollection;
                            break;
                        case r[1]:
                            b = this.organizationTeamsCollecton
                    }
                    return b.length ? (a.empty(), b.each(function(a) {
                        return function(b) {
                            return a.renderTeam(b)
                        }
                    }(this))) : void 0
                }
            }, j.prototype.isRenderteam = function(a) {
                var b, c;
                switch (this.tab) {
                    case r[0]:
                        return !!(null != (b = this.projectTeamsCollection) ? b.get(a.id) : void 0);
                    case r[1]:
                        return !!(null != (c = this.organizationTeamsCollecton) ? c.get(a.id) : void 0)
                }
                return !1
            }, j.prototype.renderTeam = function(a, b) {
                var c, d, e, f, g;
                if (this.isRenderteam(a))
                    return c = this.$teamsListContent.find(".teams-list"), g = _.extend({isPrepend: !1}, b), e = a.toJSON(), e.tab = this.tab, e.hasRight = a.hasRight(), e.inProject = !!this.projectTeamsCollection.get(a.id), f = g.isPrepend ? "prepend" : "append", d = c.find(".team[data-id=" + a.id + "]"), d.length ? d.replaceWith($(m(e))) : c[f](m(e)), this
            }, j.prototype.removeMember = function(a) {
                return this.$membersListContent.find(".member[data-id=" + a.id + "]").remove(), this
            }, j.prototype.removeTeam = function(a) {
                return this.$teamsListContent.find(".team[data-id='" + a.id + "']").remove(), this.$teamsListContent.find(".team").length || this.renderTeams(), this
            }, j.prototype.addMember = function(a, b) {
                var c, d;
                return d = _.extend({boundToObjectType: "project"}, b), c = a.email ? {email: a.email} : {email: a.item.email}, this.projectMembersCollection.addMember(c, d), this
            }, j.prototype.resetInvite = function(a) {
                var b;
                return b = $(a.currentTarget), b.hasClass("disabled") ? !1 : this.projectModel.resetInvite({beforeSend: function() {
                    return b.addClass("disabled")
                },success: function(a) {
                    return function(c) {
                        return b.removeClass("disabled"), c ? (a.$inviteInput.val(c.inviteLink), Essage.show({message: "重置成功",status: "success"}, 2e3)) : !1
                    }
                }(this),error: function() {
                    return b.removeClass("disabled"), Essage.show({message: "重置链接失败，请重试",status: "error"}, 2e3)
                }})
            }, j.prototype.getMemberModelById = function(a) {
                switch (this.tab) {
                    case r[0]:
                        return this.projectMembersCollection.get(a);
                    case r[1]:
                        return this.organizationMembersCollection.get(a);
                    case r[2]:
                        return this.recommendationMembersCollection.get(a)
                }
            }, j.prototype.handleMemberAction = function(a) {
                var b, c, d, e, f, g;
                if (b = $(a.currentTarget), b.hasClass("disabled"))
                    return !1;
                if (g = b.data("id"), e = this.getMemberModelById(g))
                    switch (c = b.data("action")) {
                        case "admin":
                            return e.saveAttr("admin");
                        case "member":
                            return e.saveAttr("member");
                        case "add":
                            return this.addMember(e.toJSON(), {wait: !0,beforeSend: function() {
                                return function() {
                                    return b.html("正在添加")
                                }
                            }(this),success: function(a) {
                                return function() {
                                    return a.projectMembersCollection.add(e), a.renderMember(e)
                                }
                            }(this)});
                        case "resend":
                            for (e.saveAttr("resend"), b.addClass("disabled").html("邮件已发送(30秒后可以重新发送)"), Essage.show({message: "邮件已发送(30秒后可以重新发送)",status: "success"}, 2e3), d = 30, f = 30; --d; )
                                setTimeout(function() {
                                    return function() {
                                        return --f, b.html("邮件已发送(" + f + "秒后可以重新发送)")
                                    }
                                }(this), 1e3 * (30 - d));
                            return setTimeout(function() {
                                return function() {
                                    return b.removeClass("disabled").html("重发邀请信")
                                }
                            }(this), 3e4);
                        case "delete":
                            return e.destroy({wait: !0,beforeSend: function() {
                                return function() {
                                    return b.html("正在移除")
                                }
                            }(this),success: function(a) {
                                return function() {
                                    var b;
                                    return (null != (b = a.projectTeamsCollection) ? b.length : void 0) ? a.projectMembersCollection.fetch() : void 0
                                }
                            }(this)})
                    }
            }, j.prototype.getTeamModelById = function(a) {
                switch (this.tab) {
                    case r[0]:
                        return this.projectTeamsCollection.get(a);
                    case r[1]:
                        return this.organizationTeamsCollecton.get(a)
                }
            }, j.prototype.handleTeamAction = function(a) {
                var b, c, d, f, g;
                if (b = $(a.currentTarget), b.hasClass("disabled"))
                    return !1;
                if (f = b.data("id"), g = this.projectModel.id, d = this.getTeamModelById(f))
                    switch (c = b.data("action")) {
                        case "add":
                            return d.addProject(g, {beforeSend: function() {
                                return function() {
                                    return b.html("正在导入")
                                }
                            }(this),success: function(a) {
                                return function() {
                                    return a.projectTeamsCollection.add(d), a.renderTeam(d)
                                }
                            }(this)});
                        case "delete":
                            return this.requestSubView(e, {title: "确认移除团队",description: "一旦移除了团队，该团队下的所有成员将会被移除",onConfirm: function(a) {
                                return function() {
                                    return d.removeProject(g, {success: function() {
                                        return a.projectTeamsCollection.remove(d), a.renderTeam(d)
                                    }})
                                }
                            }(this)})
                    }
            }, j.prototype.handleAction = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = b.data("type"), "member" === c ? this.handleMemberAction(a) : "team" === c ? this.handleTeamAction(a) : void 0
            }, j
        }(q)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/project/project-guide/index", ["require", "exports", "module", "teambition", "./templates/basic", "views/settings/project-settings-member/index", "thenjs", "util", "view"], function(a) {
        var c, d, e, f, g, h, i;
        return i = a("teambition"), c = a("./templates/basic"), e = a("views/settings/project-settings-member/index"), f = a("thenjs"), g = a("util"), h = a("view"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "ProjectCreatedGuideView", d.prototype.className = "project-guide-view modal-dialog card modal-padding", d.prototype.events = {"click .guide-close, .guide-enter": "close"}, d.prototype.initialize = function(a) {
                return (null != a ? a.projectModel : void 0) ? (this.projectModel = a.projectModel, this.renderBasic(), this.renderContent(), this.listen(), this) : void 0
            }, d.prototype.renderBasic = function() {
                return this.$el.html(c(this.projectModel.toJSON())), this.$content = this.$el.find(".guide-settings-content"), this
            }, d.prototype.renderContent = function() {
                return this.requestSubView(e, {projectModel: this.projectModel}).$el.appendTo(this.$content), this
            }, d.prototype.listen = function() {
                return this.listenTo(this.projectModel, "remove", this.close), this
            }, d.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, d
        }(h)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/archive", ["require", "exports", "module", "model", "util"], function(a) {
        var c, d, e;
        return d = a("model"), e = a("util"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "archive", c.prototype.urlRoot = "archives", c.prototype.getObjectUrl = function() {
                var a;
                return a = function() {
                    switch (this.get("boundToObjectType")) {
                        case "task":
                            return "tasks";
                        case "post":
                            return "posts";
                        case "work":
                            return "works";
                        case "event":
                            return "events";
                        case "tag":
                            return "tags";
                        case "tasklist":
                            return "tasklists";
                        case "collection":
                            return "collections"
                    }
                }.call(this), "" + a + "/" + this.get("_boundToObjectId")
            }, c.prototype.unarchiveObject = function(a) {
                var b;
                return a || (a = {}), a.url = "" + this.getObjectUrl() + "/archive", a.attrs = {}, b = a.success || function() {
                }, a.success = function(a) {
                    return function() {
                        var c;
                        return null != (c = a.collection) && c.remove(a), b(a)
                    }
                }(this), this.sync("delete", this, a), this
            }, c.prototype.deleteObject = function(a) {
                var b;
                return a || (a = {}), a.url = "" + this.getObjectUrl(), a.attrs = {}, b = a.success || function() {
                }, a.success = function(a) {
                    return function() {
                        var c;
                        return null != (c = a.collection) && c.remove(a), b(a)
                    }
                }(this), this.sync("delete", this, a), this
            }, c
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/archives", ["require", "exports", "module", "models/archive", "collection"], function(a) {
        var c, d, e;
        return c = a("models/archive"), e = a("collection"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.name = "archives", d.prototype.model = c, d.prototype.pageNum = 20, d.prototype.boundToObjectType = "project", d.prototype.initialize = function(a, b) {
                return this._projectId = b._projectId, d.__super__.initialize.apply(this, arguments)
            }, d.prototype.parse = function(a) {
                return Array.isArray(a) ? _.each(a, function(a) {
                    return function(b) {
                        return b._projectId = a._projectId
                    }
                }(this)) : a && (a._projectId = this._projectId), a
            }, d.prototype.sync = function(a, b, c) {
                return c.url = "projects/" + this._projectId + "/archives", d.__super__.sync.apply(this, arguments)
            }, d
        }(e)
    }), define("views/core/archive/templates/archive", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="archive ';
            return a.hasRight > 0 && (c += "editable"), c += '" data-id="' + a._id + '"> <div class="avatar img-circle img-24" style="background-image:url(' + a.creator.avatarUrl + ')"></div> <div class="archive-body clearfix" data-type="' + a.boundToObjectType + '"> <p class="archive-title"><span class="archive-creator">' + b(a.creator.name) + "</span>" + b(a.title) + '</p> <p class="archive-content"> <span class="icon ' + a.icon + '"></span> <span class="hinted auto-hint" data-title="' + a.subTitle + '">' + b(a.subTitle) + '</span> </p> </div> <div class="time-stamp"> <time class="muted" datetime="' + a.created + '"></time> </div> ', a.hasRight > 0 && (c += ' <div class="archive-handler-set"> <a class="unarchive-handler icon icon-put-back hinted" data-title="取消归档"></a> <a class="remove-handler icon icon-trash hinted" data-title="' + a.deleteTitle + '"></a> </div> '), c += "</li>"
        }
    }), define("views/core/archive/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="modal-content"> <header class="modal-header"> <h4 class="modal-title"> <a data-toggle="dropdown"> <span class="archive-type">项目归档</span> <span class="caret"></span> </a> <ul class="dropdown-menu"> ', c = a.archives;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += " ", d.hasLine && (b += ' <li class="divider"></li> '), b += ' <li> <a class="archive-item" data-type="' + d.type + '" data-gta="event" data-label="show ' + d.label + ' archives">' + d.title + "</a> </li> ";
            return b += ' </ul> </h4> <a class="modal-close icon icon-remove" data-dismiss="modal"></a> </header> <div class="modal-body"> <ul class="archive-list thin-scroll"></ul> </div></div>'
        }
    }), define("lib/scrollable", [], function() {
        var a, b, c;
        return a = $("body"), b = $(window), c = {scrollTo: function(b, c) {
            var d;
            return this.$scrollFrame !== a && (d = a.scrollTop()), this.$scrollFrame.scrollTop(this._getScrollposition(b, c)), null != d && a.scrollTop(d), this
        },slideTo: function(a, b, c, d) {
            return c || (c = 0), this.$scrollFrame.stop(!0), this.$scrollFrame.animate({scrollTop: this._getScrollposition(a, b) - c}, "fast", null, function() {
                return function() {
                    return "function" == typeof d ? d() : void 0
                }
            }(this))
        },_getScrollposition: function(c, d) {
            var e, f, g;
            return c && this.$scrollFrame !== c ? (g = c[0].getBoundingClientRect(), this.$scrollFrame === a ? f = d === !0 ? g.top - 170 : g.bottom - b.height() + 170 : (e = this.$scrollFrame[0].getBoundingClientRect(), f = d === !0 ? g.top - e.top - 20 : g.bottom - e.bottom + 20), f += this.$scrollFrame.scrollTop()) : (f = this.$scrollFrame[0].scrollHeight, f -= this.$scrollFrame === a ? b.height() : this.$scrollFrame.height()), f
        },setupScroll: function(b, c) {
            var d;
            return c || (c = {}), null != (d = this.$scrollFrame) && d.scrollTop(0).off("scroll"), this.$scrollFrame = b || a, c.shadow && (this.$scrollFrame.on("scroll", function(a) {
                return function() {
                    return a._updateScrollStyle()
                }
            }(this)), this._updateScrollStyle()), this.loadMore ? this.setupLoadMore() : void 0
        },_updateScrollStyle: function() {
            var a;
            return null != (a = this.$el) ? a.toggleClass("overflow-top", !!this.$scrollFrame.scrollTop()) : void 0
        },setupLoadMore: function(c, d) {
            var e, f, g;
            return g = "scroll.loadmore", e = this.$scrollFrame === a ? $(document) : this.$scrollFrame, null != e && e.off(g), c !== !1 ? (c || (c = 200), (f = function(a) {
                return function() {
                    return a.$el ? e.on(g, function(h) {
                        var i, j;
                        return a.$el ? (j = a.$scrollFrame.scrollTop(), i = a.$scrollFrame[0].scrollHeight - j, i -= h.currentTarget.body ? b.height() : a.$scrollFrame.height(), d && 0 >= j || c >= i && j >= 0 ? (e.off(g), _.delay(function() {
                            return a.loadMore(f, d && 0 >= j)
                        }, 300)) : void 0) : e.off(g)
                    }) : void 0
                }
            }(this))()) : void 0
        }}
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/core/archive/index", ["require", "exports", "module", "teambition", "collections/archives", "./templates/archive", "./templates/basic", "lib/scrollable", "view"], function(a) {
        var c, d, e, f, g, h, i, j, k, l;
        return l = a("teambition"), e = a("collections/archives"), c = a("./templates/archive"), f = a("./templates/basic"), g = a("lib/scrollable"), h = a("view"), k = [{type: "task",label: "task",title: "任务归档"}, {type: "post",label: "post",title: "分享归档"}, {type: "work",label: "file",title: "文件归档"}, {type: "event",label: "event",title: "日程归档"}, {type: "entry",label: "entry",title: "账目归档"}, {type: "tag",label: "tag",title: "标签归档",hasLine: !0}, {type: "collection",label: "folder",title: "文件夹归档"}, {type: "tasklist",label: "task group",title: "任务分组归档"}], i = {task: {icon: "icon-board-bold",deleteTitle: "删除任务",successMessage: "已成功解档了任务"},post: {icon: "icon-wall-bold",deleteTitle: "删除分享",successMessage: "已成功解档了分享"},event: {icon: "icon-calendar-bold",deleteTitle: "删除分享",successMessage: "已成功解档了日程"},work: {icon: "icon-file-bold",deleteTitle: "删除文件",successMessage: "已成功解档了文件"},entry: {icon: "icon-menu",deleteTitle: "删除账目",successMessage: "成功取消账目的归档"},tag: {icon: "icon-tag",deleteTitle: "删除标签",successMessage: "已成功解档了标签"},collection: {icon: "icon-folder-bold",deleteTitle: "删除文件夹",successMessage: "已成功解档了文件夹"},tasklist: {icon: "icon-th-list-bold",deleteTitle: "删除任务分组",successMessage: "已成功解档了任务分组"}}, j = {posts: "post",files: "work",events: "event",bookkeeping: "entry",tasks: "task"}, d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "ArchiveView", d.prototype.className = "archive-view modal-dialog modal-padding", d.prototype.events = {"click .archive-item": "switchArchive","click .unarchive-handler": "unarchiveObject","click .remove-handler": "deleteObject"}, d.prototype.initialize = function(a) {
                var b;
                return this._projectId = a._projectId, a.appName || (a.appName = l.APP.currentAppName), this.currentArchive = (b = j[a.appName]) ? b : j.tasks, this.renderBasic(), this.reset(), this
            }, d.prototype.reset = function() {
                return this.refreshSelected(), this.load({success: function(a) {
                    return function() {
                        return a.listen(), a.renderArchives(), a.setupScroll(a.$archiveList), a.setupLoadMore(10)
                    }
                }(this)})
            }, d.prototype.load = function(a) {
                return e.fetch("" + this._projectId + "_" + this.currentArchive, {boundToObjectType: "",_projectId: this._projectId,attrs: {objectType: this.currentArchive},beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$archiveList)
                    }
                }(this),success: function(b) {
                    return function(c) {
                        return b.$el ? (b.hideLoadingIndicator({animated: !1}), b.archivesCollection = c, null != a && "function" == typeof a.success ? a.success() : void 0) : void 0
                    }
                }(this)}), this
            }, d.prototype.loadMore = function(a) {
                var b;
                return null != (b = this.archivesCollection) && b.loadMore({attrs: {objectType: this.currentArchive},beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$archiveList)
                    }
                }(this),success: function(b) {
                    return function() {
                        return b.$el ? (b.hideLoadingIndicator({animated: !0}), b.archivesCollection.hasMore ? "function" == typeof a ? a() : void 0 : b.showEndPoint(b.$archiveList)) : void 0
                    }
                }(this)}), this
            }, d.prototype.listen = function() {
                return this.stopListening(), this.listenTo(this.archivesCollection, "add", this.renderArchive), this.listenTo(this.archivesCollection, "remove destroy", this.removeArchive), this
            }, d.prototype.renderBasic = function() {
                var a;
                return a = {archives: k}, this.$el.html(f(a)), this.$archiveTitle = this.$(".archive-type"), this.$archiveList = this.$(".archive-list"), this
            }, d.prototype.renderArchives = function() {
                return this.$archiveList.empty(), this.archivesCollection.each(function(a) {
                    return function(b) {
                        return a.renderArchive(b)
                    }
                }(this)), this
            }, d.prototype.renderArchive = function(a) {
                var b, d, e;
                return e = a.toJSON(), e.hasRight = a.hasRight(), e = _.extend(e, i[e.boundToObjectType]), b = $(c(e)), d = this.$(".archive[data-id=" + e._id + "]"), d.length ? d.replaceWith(b) : this.$archiveList.append(b), b.find("time").timesince(), this
            }, d.prototype.refreshSelected = function() {
                var a;
                return a = this.$(".archive-item[data-type=" + this.currentArchive + "]"), a.parent().addClass("selected").siblings().removeClass("selected"), this.$archiveTitle.text(a.text()), this
            }, d.prototype.removeArchive = function(a) {
                return this.$archiveList.find(".archive[data-id=" + a.id + "]").remove(), this
            }, d.prototype.switchArchive = function(a) {
                var b;
                return b = a.currentTarget ? $(a.currentTarget) : a, this.currentArchive = b.data("type"), this.reset(), this
            }, d.prototype.unarchiveObject = function(a) {
                var b, c, d, e;
                return b = $(a.currentTarget).closest(".archive"), d = this.archivesCollection.get(b.data("id")), c = d.toJSON(), e = i[c.boundToObjectType], d.unarchiveObject({success: function() {
                    return function() {
                        return Essage.show({message: e.successMessage,status: "success"}, 2e3)
                    }
                }(this)}), this
            }, d.prototype.deleteObject = function(a) {
                var b, c;
                return b = $(a.currentTarget).closest(".archive"), c = this.archivesCollection.get(b.data("id")), c.deleteObject({success: function() {
                    return function() {
                        return Essage.show({message: "删除成功",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, d
        }(h), _.extend(d.prototype, g), d
    }), define("views/core/icalendar/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="modal-content"> <header class="modal-header"> <h4 class="modal-title">订阅「' + a.title + '」</h4> <a class="modal-close icon icon-remove" data-dismiss="modal"></a> </header> <div class="modal-body"> <div> <div class="icalendar-qrcode pull-left"></div> <div class="icalendar-msg"> <p class="msg1">扫描二维码获取「' + a.title + '」的订阅链接</p> <p class="msg2">点击链接直接订阅「' + a.title + '」，或者复制到日历软件中手动添加订阅 <a class="icalendar-url link-add-handler" href="' + a.webcal + '" target="_blank">' + a.webcal + '</a> </p> </div> </div> <div class="icalendar-footer"> <!-- <a class="icalendar-reset"><i class="icon icon-refresh"></i> 重新生成订阅链接</a> --> <a class="icalendar-howto" href="https://www.teambition.com/question/3010" target="_blank"><i class="icon icon-question"></i> 查看如何使用</a> </div> </div></div>';
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/core/icalendar/index", ["require", "exports", "module", "teambition", "./templates/basic", "lib/http", "view"], function(a) {
        var c, d, e, f, g;
        return g = a("teambition"), c = a("./templates/basic"), d = a("lib/http"), f = a("view"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "ICalendarView", e.prototype.className = "icalendar-view modal-dialog modal-padding", e.prototype.initialize = function(a) {
                return a ? (this.options = a, this.renderBasic(), this) : !1
            }, e.prototype.renderBasic = function() {
                return this.$el.html(c(this.options)), this.$qr = this.$(".icalendar-qrcode"), this.renderQr(), this
            }, e.prototype.renderQr = function() {
                return d.ajax("qrcode", {data: {data: encodeURIComponent(this.options.webcal)},success: function(a) {
                    return function(b) {
                        return b.calQRCodeUrl ? a.$qr.attr("style", "background-image:url(" + b.calQRCodeUrl + ");") : void 0
                    }
                }(this)})
            }, e
        }(f)
    }), define("views/core/popover-menu/templates/basic", [], function() {
        return function(a) {
            var b = "";
            return a.searchPlaceholder ? b += '<div class="menu-input"> <input class="filter-input form-control" placeholder="' + a.searchPlaceholder + '"/></div>' : a.addPlaceholder && (b += '<div class="menu-input add-form"> <input class="add-input form-control" placeholder="' + a.addPlaceholder + '"/> <button class="btn btn-link link-add-handler">添加</button></div>'), b += '<ul class="list-unstyled thin-scroll ', (a.searchPlaceholder || a.addPlaceholder) && (b += "with-input"), b += '"></ul>'
        }
    }), define("views/core/popover-menu/templates/list", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.dataList;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="menu-item ', e.selected && (c += "selected"), c += '" data-id="' + e._id + '"> <a>' + b(e.title) + "</a></li>";
            return c
        }
    }), define("lib/popover/templates/basic", [], function() {
        return function() {
            var a = '<div class="popover"> <header class="popover-header"> <a class="popover-back-handler icon icon-chevron-left"></a> <h3 class="popover-title">Popover Title</h3> <a class="popover-close-handler icon icon-remove"></a> </header> <div class="popover-content thin-scroll"></div></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("lib/popover/index", ["require", "exports", "module", "./templates/basic", "util", "view"], function(a) {
        var c, d, e, f, g;
        return d = a("./templates/basic"), f = a("util"), g = a("view"), c = $("body"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "PopoverView", c.prototype.hotkeys = {esc: function(a) {
                return a.preventDefault(), this.hide()
            }}, c.prototype.initialize = function(a) {
                return a.$toggler && "function" == typeof this.render ? (this.options = _.extend({title: this.popoverTitle,html: !0,placement: "bottom",trigger: "click",container: "body",animation: !1,template: d(),viewport: {selector: "body",padding: 20}}, a), a.width && (this.width = a.width), this.$toggler = $(a.$toggler), this.setup().delegatePopoverEvents(), this) : void 0
            }, c.prototype.setup = function() {
                return this.$toggler.popover(this.options), this.popover = this.$toggler.data("bs.popover"), this.$popover = this.popover.tip(), this.$title = this.$popover.find(".popover-title"), this.$content = this.$popover.find(".popover-content"), this.setElement(this.$content), this.width && this.$popover.width(this.width), this.className && this.$popover.addClass(this.className), this
            }, c.prototype.delegatePopoverEvents = function() {
                return this.$popover.find(".popover-close-handler").click(function(a) {
                    return function() {
                        return a.hide()
                    }
                }(this)), this.$toggler.on("shown.bs.popover", function(a) {
                    return function() {
                        return a.onShown()
                    }
                }(this)), this.$toggler.on("hidden.bs.popover", function(a) {
                    return function() {
                        return a.onHidden()
                    }
                }(this)), this
            }, c.prototype.show = function() {
                return this.popover.show(), this
            }, c.prototype.onShown = function() {
                var a;
                return "function" == typeof this.reset && this.reset(), this.$popover.handleClickOutside(function(a) {
                    return function() {
                        return _.delay(function() {
                            return a.hide()
                        }, 218)
                    }
                }(this), "click.popover"), this.$toggler.addClass("open"), this.returnMainMenu(), this.fixPosition(), this.delegateEvents(), "function" == typeof (a = this.options).onShown && a.onShown(), this.setupHotKey(), this.$(".thin-scroll").on("mousewheel", f.mousewheel), this
            }, c.prototype.hide = function() {
                var a;
                return null != (a = this.popover) && a.hide(), this
            }, c.prototype.onHidden = function() {
                var a, b, c;
                return this.$(".thin-scroll").off("mousewheel"), this.removeHotKey(), null != (b = this.$popover) && b.detach(), null != (c = this.$toggler) && c.removeClass("open"), "function" == typeof (a = this.options).onHidden && a.onHidden(), this
            }, c.prototype.enterSubMenu = function(a, b) {
                return a = a.trim(), this.$popover.addClass("in-submenu"), a && this.$title.text(a), this.$popover.find(".popover-back-handler").one("click", function(a) {
                    return function() {
                        return a.returnMainMenu()
                    }
                }(this)), b()
            }, c.prototype.returnMainMenu = function() {
                var a, b;
                return this.$popover.removeClass("in-submenu"), a = null != (b = this.options.title) ? b.trim() : void 0, a && this.$title.text(this.options.title), "function" == typeof this.render && this.render(), this
            }, c.prototype.fixPosition = function() {
                var a, b, c, d, e;
                if ((null != (e = this.$popover) ? e.hasClass("in") : 0) && this.$popover.parent()[0] === document.body)
                    return d = window.innerHeight, b = this.$popover[0].getBoundingClientRect(), c = this.$toggler[0].getBoundingClientRect(), a = document.documentElement.scrollTop || document.body.scrollTop, b.top <= 0 ? (this.$popover.removeClass("top").addClass("bottom"), this.$popover.css("top", a + c.bottom)) : b.bottom >= d && (this.$popover.removeClass("bottom").addClass("top"), this.$popover.css("top", a + c.top - b.height)), this.options.fixed ? (b = this.$popover[0].getBoundingClientRect(), this.$popover.css({position: "fixed",top: b.top,left: b.left})) : void 0
            }, c.prototype.remove = function() {
                var a, b, d;
                return null != (a = this.$popover) && a.remove(), null != (b = this.$toggler) && b.off(".popover"), null != (d = this.popover) && d.destroy(), c.__super__.remove.apply(this, arguments)
            }, c
        }(g)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/core/popover-menu/index", ["require", "exports", "module", "./templates/basic", "./templates/list", "lib/popover/index", "lib/scrollable"], function(a) {
        var c, d, e, f, g;
        return c = a("./templates/basic"), d = a("./templates/list"), f = a("lib/popover/index"), g = a("lib/scrollable"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "PopoverMenuView", e.prototype.className = "popover-menu-view", e.prototype.popoverTitle = "Menu", e.prototype.width = 200, e.prototype.hotkeys = {"up|down|enter": "filterData",esc: function(a) {
                var b;
                return a.preventDefault(), null != (b = this.$popover) && b.parent().trigger("click"), this.hide()
            }}, e.prototype.events = {"click .menu-item": "toggleItem","click .link-add-handler": "addItem","keyup .menu-input input": "filterData"}, e.prototype.initialize = function(a) {
                return (null != a ? a.dataList : void 0) ? (this.multi = a.multi, this.dataList = a.dataList || [], this.selected = a.selected, this.multi && !_.isArray(this.selected) && (this.selected = []), this.ListTemplate = a.ListTemplate || d, e.__super__.initialize.apply(this, arguments), this) : void 0
            }, e.prototype.render = function() {
                return this.$el.html(c({searchPlaceholder: this.options.searchPlaceholder,addPlaceholder: this.options.addPlaceholder})), this.$ul = this.$("ul"), this.$addInput = this.$(".add-input"), this.renderItems(this.dataList, this.selected), this.$("input").focusAtEnd(), this.setupScroll(this.$ul), this
            }, e.prototype.renderItems = function(a, b) {
                return this.$ul ? (_.isArray(b) || (b = [b]), _.each(a, function(a) {
                    return a.selected = b.indexOf(a._id) >= 0
                }), this.$ul.html(this.ListTemplate({dataList: a})), a !== this.dataList && this.$ul.find(".menu-item:first").addClass("active"), this) : void 0
            }, e.prototype.update = function(a, b) {
                return this.dataList = a, null != b && (this.selected = b), this.renderItems(this.dataList, this.selected), this
            }, e.prototype.filterData = function(a) {
                var b, c, d;
                switch (a.keyCode) {
                    case 38:
                        return this.switchActive("up");
                    case 40:
                        return this.switchActive("down");
                    case 13:
                        if (b = this.$ul.find(".active"), b.length)
                            return b.trigger("click");
                        if (this.$addInput.val().trim())
                            return this.addItem()
                }
                return d = $(a.currentTarget).val().trim().toLowerCase(), d ? (c = [], _.each(this.dataList, function(a) {
                    return a.title.toLowerCase().indexOf(d) >= 0 ? c.push(a) : void 0
                })) : c = this.dataList, this.renderItems(c, this.selected)
            }, e.prototype.toggleItem = function(a) {
                var b, c, d;
                return a.currentTarget ? (b = $(a.currentTarget), c = b.data("id"), b.toggleClass("selected")) : (c = a, b = this.$ul.find(".menu-item[data-id=" + c + "]"), b.addClass("selected")), b.hasClass("selected") ? this.options.select(c) : ("function" == typeof (d = this.options).unselect && d.unselect(c), c = ""), this.multi ? this.selected = this.$ul.find(".menu-item selected").map(function() {
                    return $(this).data("id")
                }).toArray() : (this.selected = c, b.siblings().removeClass("selected"), this.hide()), this
            }, e.prototype.addItem = function() {
                var a, b;
                return (b = this.$addInput.val().trim()) ? (this.$addInput.val(""), a = _.find(this.dataList, function(a) {
                    return a.title === b
                }), a ? this.toggleItem(a._id) : this.options.add(b), this) : void 0
            }, e.prototype.switchActive = function(a) {
                var b, c, d, e, f;
                return b = this.$ul.find(".active"), "up" === a && (f = b.removeClass("active").prev(), d = this.$ul.find("li:last"), f.length > 0 ? f.addClass("active") : d.addClass("active")), "down" === a && (e = b.removeClass("active").next(), c = this.$ul.find("li:first"), e.length > 0 ? e.addClass("active") : c.addClass("active")), this.slideTo(this.$ul.find(".active"))
            }, e
        }(f), _.extend(e.prototype, g), e
    });
    var d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("lib/uploader/index", ["require", "exports", "module", "essage", "teambition", "thenjs", "util", "webuploader"], function(a) {
        var b, c, e, f, g, h, i, j;
        return j = a("essage"), i = a("teambition"), b = a("thenjs"), e = a("util"), f = a("webuploader"), g = /\/.*$/, h = ["app"], c = function() {
            function a(a) {
                var c, e, i;
                i = this.setupOptions(a), e = i.onError, i.onError = null, c = this.uploader = f.create(i), c.on("beforeFileQueued", function() {
                    return function(a) {
                        var b, c;
                        return c = a.ext, d.call(h, c) >= 0 ? (b = a.ext, Essage.show({message: "不支持该文件类型(." + b + ")，请压缩后上传",status: "error"}, 4e3), !1) : void 0
                    }
                }(this)).on("filesQueued", function() {
                    return function(a) {
                        return b.each(a, function(a, b) {
                            var d;
                            return b.retry = 0, b.category = b.type.replace(g, ""), !b.ext && ~b.type.indexOf("image/") && (d = b.type.slice(6), d && (b.name += "." + d)), c.makeThumb(b, function(d, e) {
                                var f;
                                return f = i.onCreate({fileName: b.name,fileSize: b.size,fileType: b.ext,fileCategory: b.category,thumbnail: e,thumbnailUrl: e}), f && (b.model = f, f.removeFile = function() {
                                    return c.cancelFile(b), c.removeFile(b, !0)
                                }), a()
                            })
                        }).fin(function() {
                            return c.upload()
                        })
                    }
                }(this)).on("uploadProgress", function() {
                    return function(a, b) {
                        return i.onProgress(.9 * b, a.model)
                    }
                }(this)).on("uploadError", function() {
                    return function(a, b) {
                        return a.retry < 2 ? (a.retry++, c.retry()) : (Essage.show({message: "文件上传失败",status: "error"}, 4e3), c.removeFile(a), e(b, a.model))
                    }
                }(this)).on("uploadSuccess", function() {
                    return function(a, b) {
                        var d;
                        return i.onProgress(1, a.model), delete b._raw, b.code ? (c.trigger("error", b.message), e(b.message, a.model)) : (b = null != (d = a.model) ? d.parse(b) : void 0, i.onComplete(b, a.model))
                    }
                }(this)).on("startUpload", function() {
                    return function() {
                        return i.onStart(c)
                    }
                }(this)).on("stopUpload", function() {
                    return function() {
                        return i.onStop(c)
                    }
                }(this)).on("uploadFinished", function() {
                    return function() {
                        return i.onFinish()
                    }
                }(this)).on("error", function() {
                    return function(a) {
                        return a = function() {
                            switch (a) {
                                case "Q_EXCEED_NUM_LIMIT":
                                    return "最多一次性上传 50 个文件！";
                                case "F_EXCEED_SIZE":
                                    return "文件 " + name + " 过大，请选择 200MB 以内的文件！";
                                case "F_DUPLICATE":
                                    return "该文件已上传！";
                                case "Q_TYPE_DENIED":
                                    return "不支持该文件类型或者文件大小为 0";
                                default:
                                    return a
                            }
                        }(), Essage.show({message: a,status: "error"}, 4e3)
                    }
                }(this))
            }
            return a.prototype.setupOptions = function(a) {
                return _.extend({server: "" + i.uploadUrl + "/upload",dnd: null,paste: null,pick: {id: null,label: "",multiple: !1},accept: {title: "Images",extensions: "gif,jpg,jpeg,bmp,png",mimeTypes: "image/*"},thumb: {width: 200,height: 200,quality: 100,allowMagnify: !0,crop: !1,preserveHeaders: !1,type: "image/jpeg"},compress: !1,prepareNextFile: !0,chunked: !1,chunkSize: 5242880,chunkRetry: 2,threads: 3,formdata: null,fileNumLimit: 50,fileSingleSizeLimit: 209715200,duplicate: !1,withCredentials: !0,disableGlobalDnd: !1,onCreate: function() {
                },onStart: function() {
                },onStop: function() {
                },onProgress: function() {
                },onComplete: function() {
                },onError: function() {
                },onFinish: function() {
                }}, a)
            }, a.prototype.destroy = function() {
                return this.uploader.destroy()
            }, a
        }()
    }), define("views/settings/project-settings-archive/templates/basic", [], function() {
        return function() {
            var a = '<div class="modal-content"> <header class="modal-header"> <h4 class="modal-title">归档项目</h4> <a class="modal-close pull-right icon icon-remove" data-dismiss="modal"></a> </header> <div class="modal-body"> <p>如果项目已经完成或是暂时中止，你可以先将项目归档。归档的项目可以很容易地再次激活，并且不会有数据丢失</p> </div> <div class="modal-footer"> <button class="confirm-handler btn btn-primary">归档项目</button> </div></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/settings/project-settings-archive/index", ["require", "exports", "module", "essage", "teambition", "./templates/basic", "collections/projects", "view"], function(a) {
        var c, d, e, f, g, h;
        return h = a("essage"), g = a("teambition"), c = a("./templates/basic"), e = a("collections/projects"), f = a("view"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "ProjectSettingsArchiveView", d.prototype.className = "project-settings-archive-view modal-dialog modal-padding", d.prototype.events = {"click .confirm-handler": "submit"}, d.prototype.initialize = function(a) {
                return this.projectModel = a.projectModel, this.renderBasic(), this
            }, d.prototype.renderBasic = function() {
                return this.$el.html(c()), this
            }, d.prototype.submit = function() {
                return this.projectModel.save(null, {wait: !0,attrs: {isArchived: !0},success: function(a) {
                    return function() {
                        var b, c;
                        return Essage.show({message: "已成功归档项目，你可以在首页的底部找到所有已归档的项目",status: "success"}, 2e3), null != (b = a.projectModel) && null != (c = b.collection) && c.remove(a.projectModel), e.get("archived_0").add(a.projectModel), a.close(), g.router.getUrl().match(/organization/i) ? void 0 : g.router.navigate("projects", {trigger: !0})
                    }
                }(this),error: function() {
                    return function() {
                        return Essage.show({message: "未能归档项目，请稍后再试",status: "error"})
                    }
                }(this)}), this
            }, d.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, d
        }(f)
    }), define("views/settings/project-settings-delete/templates/basic", [], function() {
        return function() {
            var a = '<div class="modal-content"> <header class="modal-header"> <h4 class="modal-title">删除项目</h4> <a class="modal-close pull-right icon icon-remove" data-dismiss="modal"></a> </header> <div class="modal-body"> <p>一旦你删除了项目，所有与项目有关的信息将会被永久删除。这是一个不可恢复的操作，请谨慎对待！</p> </div> <div class="modal-footer"> <p> <a class="btn btn-danger confirm-handler form-control">删除项目</a> <input class="delete-input form-control" type="text" placeholder="请输入“DELETE”以确认"/> </p> </div></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/settings/project-settings-delete/index", ["require", "exports", "module", "essage", "teambition", "./templates/basic", "view"], function(a) {
        var c, d, e, f, g;
        return g = a("essage"), f = a("teambition"), c = a("./templates/basic"), e = a("view"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "ProjectSettingsDeleteView", d.prototype.className = "project-settings-delete-view modal-dialog modal-padding", d.prototype.events = {"click .confirm-handler": "submit"}, d.prototype.initialize = function(a) {
                return this.projectModel = a.projectModel, this.renderBasic(), this
            }, d.prototype.renderBasic = function() {
                return this.$el.html(c()), this
            }, d.prototype.submit = function(a) {
                var b, c, d;
                return d = this.$(".delete-input:visible"), d.val() ? "DELETE" === d.val().toUpperCase() ? this.deleteProject() : d.val("") : (b = $(a.currentTarget), c = b.next(), b.transition({width: 165}, function() {
                    return function() {
                        return c.show()
                    }
                }(this))), this
            }, d.prototype.deleteProject = function() {
                return this.projectModel.destroy({wait: !0,success: function(a) {
                    return function() {
                        return a.close(), f.router.navigate("projects", {trigger: !0}), Essage.show({message: "已成功删除项目",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, d.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, d
        }(e)
    }), define("views/settings/project-settings-quit/templates/basic", [], function() {
        return function() {
            var a = '<div class="modal-content"> <header class="modal-header"> <h4 class="modal-title">退出项目</h4> <a class="modal-close pull-right icon icon-remove" data-dismiss="modal"></a> </header> <div class="modal-body"> <p>一旦你退出了该项目，你将不能查看任何关于该项目的信息。退出项目后，如果想重新加入，请联系项目管理员。</p> </div> <div class="modal-footer"> <button class="confirm-handler btn btn-primary">退出项目</button> </div></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/settings/project-settings-quit/index", ["require", "exports", "module", "essage", "teambition", "./templates/basic", "view"], function(a) {
        var c, d, e, f, g;
        return g = a("essage"), f = a("teambition"), c = a("./templates/basic"), e = a("view"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "ProjectSettingsQuitView", d.prototype.className = "project-settings-quit-view modal-dialog modal-padding", d.prototype.events = {"click .confirm-handler": "submit"}, d.prototype.initialize = function(a) {
                return this.projectModel = a.projectModel, this.renderBasic(), this
            }, d.prototype.renderBasic = function() {
                return this.$el.html(c()), this
            }, d.prototype.submit = function() {
                return this.projectModel.quit({wait: !0,success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功退出项目",status: "success"}, 2e3), setTimeout(function() {
                            return a.projectModel.collection.remove(a.projectModel), f.router.navigate("/projects", {trigger: !0})
                        }, 1e3)
                    }
                }(this)}), this
            }, d.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, d
        }(e)
    }), define("views/settings/project-settings-transfer/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="modal-content"> <header class="modal-header"> <h4 class="modal-title">移交项目</h4> <a class="modal-close pull-right icon icon-remove" data-dismiss="modal"></a> </header> <div class="modal-body"> <p>请注意, 当你移交项目后, 您将不再是项目的拥有者。只有你可以执行这个操作。</p> <label class="form-control-select"> <select class="project-owner-select form-control"> <option value="0" selected>请选择新的拥有者</option> ', d = a;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <option value="' + e._id + '">' + b(e.name) + "</option> ";
            return c += ' </select> </label> </div> <div class="modal-footer"> <button class="confirm-handler btn btn-primary">移交项目</button> </div></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/settings/project-settings-transfer/index", ["require", "exports", "module", "essage", "teambition", "./templates/basic", "view"], function(a) {
        var c, e, f, g, h;
        return h = a("essage"), g = a("teambition"), c = a("./templates/basic"), f = a("view"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "ProjectSettingsTransferView", e.prototype.className = "project-settings-transfer-view modal-dialog modal-padding", e.prototype.events = {"change .project-owner-select": "validateOwner","click .confirm-handler": "submit"}, e.prototype.initialize = function(a) {
                return this.projectModel = a.projectModel, this.organizationsCollection = a.organizationsCollection, this.renderBasic(), this
            }, e.prototype.renderBasic = function() {
                var a, b, d, e, f;
                for (a = this.projectModel.get("_organizationId") ? [g.user.toJSON()] : [], f = this.organizationsCollection.toJSON(), d = 0, e = f.length; e > d; d++)
                    b = f[d], b._id !== this.projectModel.get("_organizationId") && a.push(b);
                return this.$el.html(c(a)), this.$confirmHandler = this.$(".confirm-handler"), this
            }, e.prototype.validateOwner = function(a) {
                var b;
                return b = $(a.currentTarget).val(), b === g.user.id || d.call(this.organizationsCollection.pluck("_id"), b) >= 0 ? (this.$confirmHandler.removeAttr("disabled"), this.ownerId = b) : (this.$confirmHandler.attr("disabled", "disabled"), this.ownerId = null), this
            }, e.prototype.submit = function() {
                return this.ownerId ? (this.projectModel.transfer(this.ownerId, {wait: !0,success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功移交项目",status: "success"}, 2e3), setTimeout(function() {
                            return a.close(), g.router.navigate("/projects", {trigger: !0})
                        }, 1e3)
                    }
                }(this),error: function() {
                    return function(a) {
                        return Essage.show({message: a.message,status: "error"}, 2e3)
                    }
                }(this)}), this) : void 0
            }, e.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, e
        }(f)
    }), define("views/settings/project-settings/templates/advanced-tab", [], function() {
        return function(a) {
            var b = '<div class="settings-part advanced-settings"> <div class="navigation-setting ';
            a.hasRight > 0 && (b += "apps-sortable"), b += '"> <h4>项目导航设置</h4> <div class="apps-in-navigation"> <h5 class="muted">添加至导航的应用（拖动排序）</h5> <ul class="list-inline clearfix"> ';
            var c = a.appsIn;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += ' <li class="app-card" data-app="' + d.name + '"> <span class="icon ' + d.icon + '"></span> <span class="app-title">' + d.title + "</span> ", d.allowRemove && (b += ' <a class="move-app"> <span class="hide-app">隐藏</span> <span class="add-app">添加</span> </a> '), b += " </li> ";
            b += ' </ul> </div> <div class="apps-out-navigation"> <h5 class="muted">未添加至导航的应用</h5> <ul class="list-inline clearfix"> ';
            var g = a.appsOut;
            if (g)
                for (var d, e = -1, h = g.length - 1; h > e; )
                    d = g[e += 1], b += ' <li class="app-card" data-app="' + d.name + '"> <span class="icon ' + d.icon + '"></span> <span class="app-title">' + d.title + '</span> <a class="move-app"> <span class="hide-app">隐藏</span> <span class="add-app">添加</span> </a> </li> ';
            return b += ' </ul> </div> </div> <div class="other-settings"> <h4>其它设置</h4> ', 1 == a.hasRight ? (b += ' <a class="btn btn-primary advanced-handler" data-action="archive">归档项目</a> ', a.isInTeam || (b += ' <a class="btn btn-danger advanced-handler" data-action="quit">退出项目</a> '), b += " ") : 2 == a.hasRight ? (b += " ", a.organizations.length > 0 && (b += ' <a class="btn btn-primary advanced-handler" data-action="transfer">移交项目</a> '), b += ' <a class="btn btn-primary advanced-handler" data-action="archive">归档项目</a> ', a._organizationId && (b += ' <a class="btn btn-danger advanced-handler" data-action="quit">退出项目</a> '), b += ' <a class="btn btn-danger advanced-handler" data-action="delete">删除项目</a> ') : (b += ' <p class="quit-message">一旦你退出了该项目，你将不能查看任何关于该项目的信息。退出项目后，如果想重新加入，请联系项目管理员。</p> ', a.isInTeam || (b += ' <button class="quit-handler btn btn-danger">退出项目</button> '), b += " "), b += " </div></div>"
        }
    }), define("views/settings/project-settings/templates/basic", [], function() {
        return function(a) {
            var b = '<header class="project-settings-header card-header no-bottom project-cover project-cover-' + a.category + '"> <p class="card-title pull-left">项目设置</p> <a class="modal-close pull-right icon icon-remove icon-white" data-dismiss="modal"></a> <div class="logo-uploader"> <div class="logo"> <div class="progress-mask"></div> </div> </div></header><nav class="project-settings-navigation"> <ul class="section-switcher nav nav-tabs"> <li class="project-info"> <a class="section-switcher-toggler" data-toggle="project-info" data-gta="event" data-label="enter project info settings"> 项目信息</a> </li> <li class="member-settings"> <a class="section-switcher-toggler" data-toggle="member-settings" data-gta="event" data-label="enter project members settings"> 成员管理</a> </li> <li class="advanced-settings"> <a class="section-switcher-toggler" data-toggle="advanced-settings" data-gta="event" data-label="enter advanced project settings"> 高级设置</a> </li> </ul></nav><div class="project-settings-content card-content"></div>';
            return b
        }
    }), define("views/settings/project-settings/templates/profile-tab", [], function() {
        return function(a) {
            var b = '<div class="settings-part project-info-settings"> <div class="project-info-content"> <form class="project-info-form form-horizontal"> <div class="form-group"> <label>项目名称</label> <input class="setting-part form-control" type="text" data-type="name" placeholder="项目名称" value="' + a.name + '" ';
            return a.hasRight < 2 && (b += "disabled"), b += ' /> </div> <div class="form-group"> <label>项目类别</label> <label class="form-control-select"> <select class="setting-part form-control" data-type="category" ', a.hasRight < 2 && (b += "disabled"), b += '> <option value="design" ', "design" === a.category && (b += "selected"), b += '> 设计项目 </option> <option value="internet" ', "internet" === a.category && (b += "selected"), b += '> 互联网项目 </option> <option value="education" ', "education" === a.category && (b += "selected"), b += '> 教育项目 </option> <option value="media" ', "media" === a.category && (b += "selected"), b += '> 媒体项目 </option> <option value="app" ', "app" === a.category && (b += "selected"), b += '> 移动应用项目 </option> <option value="other" ', "other" === a.category && (b += "selected"), b += '> 其他项目 </option> </select> </label> </div> <div class="form-group"> <label>项目简介</label> <textarea class="setting-part form-control" data-type="description" ', a.hasRight < 1 && (b += "disabled"), b += ' placeholder="介绍一下这个项目">' + (a.description || "") + '</textarea> </div> <div class="form-group"> <label>项目公开性</label> <label class="form-control-select"> <select class="setting-part form-control" data-type="isPublic" ', a.hasRight < 2 && (b += "disabled"), b += '> <option value="public" ', a.isPublic && (b += "selected"), b += '> 公开项目（所有访客可见） </option> <option value="private" ', a.isPublic || (b += "selected"), b += "> 私有项目（仅项目成员可见） </option> </select> </label> </div> ", a.hasRight > 0 && (b += ' <button class="btn btn-save btn-primary btn-largest disabled" type="submit" data-gta="event" data-label="save changes"> 保存 </button> '), b += " </form> </div></div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/settings/project-settings/index", ["require", "exports", "module", "teambition", "thenjs", "lib/uploader/index", "util", "view", "thenjs", "collections/members", "collections/apps", "collections/organizations", "lib/confirm/index", "views/settings/project-settings-archive/index", "views/settings/project-settings-delete/index", "views/settings/project-settings-quit/index", "views/settings/project-settings-member/index", "views/settings/project-settings-transfer/index", "lib/window/index", "./templates/advanced-tab", "./templates/basic", "./templates/profile-tab", "essage"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x;
        return w = a("teambition"), q = a("thenjs"), r = a("lib/uploader/index"), s = a("util"), t = a("view"), q = a("thenjs"), h = a("collections/members"), e = a("collections/apps"), i = a("collections/organizations"), g = a("lib/confirm/index"), k = a("views/settings/project-settings-archive/index"), l = a("views/settings/project-settings-delete/index"), m = a("views/settings/project-settings-quit/index"), n = a("views/settings/project-settings-member/index"), p = a("views/settings/project-settings-transfer/index"), u = a("lib/window/index"), c = a("./templates/advanced-tab"), f = a("./templates/basic"), j = a("./templates/profile-tab"), x = a("essage"), v = ["tasks", "posts", "files", "events", "tags"], o = function(a) {
            function g() {
                return g.__super__.constructor.apply(this, arguments)
            }
            return b(g, a), g.prototype.viewName = "ProjectSettingsView", g.prototype.className = "project-settings-view modal-dialog card", g.prototype.events = {"click .section-switcher-toggler": "switch","click .view-all-team-members": "viewAllTeamMembers","change .setting-part": "collectChange","input .setting-part": "collectChange","submit .project-info-form": "submitProjectInfo","click .advanced-handler": "showAdvanced","click .move-app": "moveApp","click .quit-handler": "quit"}, g.prototype.initialize = function(a) {
                return (null != a ? a.projectModel : void 0) ? (this.changes = {}, this.options = a, this.projectModel = a.projectModel, this.appsCollection = e.get(0), this.loadData({success: function(a) {
                    return function() {
                        return a.organizationModel = a.organizationsCollection.get(a.projectModel.get("_organizationId")), a.renderBasic(), a.toggle(a.options.tab || "project-info")
                    }
                }(this)}), this) : !1
            }, g.prototype.loadData = function(a) {
                return null == a && (a = {}), q.parallel([function(a) {
                    return function(b) {
                        return h.fetch(a.projectModel.id, {boundToObjectType: "project",success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this), function() {
                    return function(a) {
                        return i.fetch(0, {success: function(b) {
                            return a(null, b)
                        },error: function(b) {
                            return a(b, null)
                        }})
                    }
                }(this)]).fin(function(b) {
                    return function(c, d, e) {
                        return d ? console.error(d) : (b.projectMembersCollection = e[0], b.organizationsCollection = e[1], "function" == typeof a.success ? a.success() : void 0)
                    }
                }(this))
            }, g.prototype.viewAllTeamMembers = function(a) {
                var b, c;
                return a.preventDefault(), b = this.projectModel.get("_organizationId"), c = $(a.currentTarget).data("team-id"), w.router.navigate("/organization/" + b + "/teams/" + c, {trigger: !0}), this
            }, g.prototype["switch"] = function(a) {
                return this.toggle($(a.currentTarget).data("toggle")), this
            }, g.prototype.toggle = function(a) {
                switch (this.tab = a, this.$navigation.find(".active").removeClass("active"), this.$navigation.find("." + a).addClass("active"), a) {
                    case "project-info":
                        this.renderProfileTab(), this.listen(a);
                        break;
                    case "member-settings":
                        this.renderSettingsMember();
                        break;
                    case "advanced-settings":
                        this.renderAdvancedTab()
                }
                return this
            }, g.prototype.listen = function(a) {
                switch (this.stopListening(), this.listenTo(this.projectModel, "remove", this.close), a) {
                    case "project-info":
                        this.listenTo(this.projectModel, "change:logo", this.renderLogo);
                        break;
                    case "advanced-settings":
                        this.listenTo(this.projectModel, "change", this.renderAdvancedTab)
                }
                return this
            }, g.prototype.renderBasic = function() {
                return this.$el.html(f(this.projectModel.toJSON())), this.$header = this.$(".project-settings-header"), this.$navigation = this.$(".project-settings-navigation"), this.$content = this.$(".project-settings-content"), this.$footer = this.$(".project-settings-footer"), this.renderLogo(), this.projectModel.hasRight() > 0 && this.initLogoUploader(), this
            }, g.prototype.renderLogo = function() {
                return this.$header.find(".logo").css({"background-image": "url(" + this.projectModel.get("logo") + ")"}), this
            }, g.prototype.renderProfileTab = function() {
                var a;
                return a = _.extend(this.projectModel.toJSON(), {hasRight: this.projectModel.hasRight()}), this.$content.html(j(a)), this.$footer.show(), this
            }, g.prototype.renderSettingsMember = function() {
                var a;
                return null != (a = this.memberSettingsView) && a.remove(), this.memberSettingsView = this.requestSubView(n, {projectModel: this.projectModel}), this.$content.html(this.memberSettingsView.$el)
            }, g.prototype.renderAdvancedTab = function() {
                var a, b, e, f, g, h, i;
                f = null != (h = this.projectMembersCollection.get(w.user.id)) ? h.toJSON() : void 0, b = _.extend(this.projectModel.toJSON(), {organizations: this.organizationsCollection.toJSON(),hasRight: this.projectModel.hasRight(),appsIn: [],appsOut: [],isInTeam: "team" === (null != f ? f["in"] : void 0)}), i = b.navigation;
                for (e in i)
                    g = i[e], a = this.appsCollection.get(e), a && b[g >= 0 ? "appsIn" : "appsOut"].push({name: e,title: a.get("title"),icon: a.getIcon(),allowRemove: !(d.call(v, e) >= 0)});
                return b.appsIn.sort(function(a) {
                    return b.navigation[a.name] - b.navigation[a.name]
                }), this.$content.html(c(b)), this.$footer.hide(), this.checkAppsOut(), this.projectModel.hasRight() > 0 && this.initSortable(), this
            }, g.prototype.initLogoUploader = function() {
                var a, b, c;
                return b = this.$header.find(".logo"), a = $('<a class="icon icon-pencil edit-handler"></a>').appendTo(b), c = this.$header.find(".progress-mask"), this.uploader = new r({model: this.projectModel,pick: {id: a,label: " ",multiple: !1},dnd: b,type: "logo",duplicate: !0,onCreate: function(a) {
                    return function(b) {
                        return a.projectModel.set("logo", b.thumbnailUrl)
                    }
                }(this),onStart: function() {
                    return function() {
                        return c.css("clip", "rect(0, 132px, 132px, 0)").html("")
                    }
                }(this),onProgress: function() {
                    return function(a) {
                        var b;
                        return b = 132 * a / 100, c.css("clip", "rect(" + b + "px, 132px, 132px, 0)")
                    }
                }(this),onComplete: function(a) {
                    return function(b) {
                        return c.css("clip", "rect(132px, 132px, 132px, 0)"), a.projectModel.save(null, {attrs: {logo: b.thumbnailUrl}})
                    }
                }(this)}), this
            }, g.prototype.submitProjectInfo = function(a) {
                return null != a && a.preventDefault(), _.isEmpty(this.changes) ? (null != a ? a.success : void 0) instanceof Function ? null != a && a.success() : this.close() : this.projectModel.save(null, {wait: !0,attrs: this.changes,success: function(b) {
                    return function() {
                        return b.changes = {}, null != a && "function" == typeof a.success && a.success(), a instanceof $.Event ? b.close() : void 0
                    }
                }(this)}), this
            }, g.prototype.collectChange = function(a) {
                var b, c, d, e, f;
                return b = $(".btn-save"), c = $(a.currentTarget), f = c.val(), e = c.data("type"), d = this.projectModel.get(e), "isPublic" === e && (f = "public" === f, d = d || !1), d === f ? delete this.changes[e] : this.changes[e] = f, _.isEmpty(this.changes) ? b.addClass("disabled") : b.removeClass("disabled"), this
            }, g.prototype.initSortable = function() {
                var a;
                return a = !1, this.$(".apps-sortable .list-inline").sortable({items: ".app-card",connectWith: ".apps-sortable .list-inline",helper: "clone",placeholder: "app-card sortable-placeholder",tolerance: "pointer",zIndex: 2001,scroll: !1,over: function() {
                    return function(b) {
                        a = !!$(b.target).closest(".apps-out-navigation").length
                    }
                }(this),receive: function() {
                    return function(a, b) {
                        var c;
                        if ($(a.target).closest(".apps-out-navigation").length)
                            return c = b.item.data("app"), d.call(v, c) >= 0 ? !1 : void 0
                    }
                }(this),update: function(b) {
                    return function(c, e) {
                        var f, g, h;
                        return f = $(c.target), a && (h = e.item.data("app"), d.call(v, h) >= 0) ? !1 : f.closest(".apps-in-navigation").length ? (g = f.sortable("toArray", {attribute: "data-app"}), b.updateNavigation(g), b.checkAppsOut()) : void 0
                    }
                }(this)}), this
            }, g.prototype.moveApp = function(a) {
                var b, c, d;
                return c = $(a.currentTarget).parent(), b = this.$(c.closest(".apps-out-navigation").length ? ".apps-in-navigation ul" : ".apps-out-navigation ul"), c.appendTo(b), d = [], this.$(".apps-in-navigation ul").children().each(function() {
                    return d.push($(this).data("app"))
                }), this.updateNavigation(d), this.checkAppsOut(), this
            }, g.prototype.updateNavigation = function(a) {
                var b, c, d;
                if (a.length) {
                    c = _.clone(this.projectModel.get("navigation"));
                    for (b in c)
                        d = c[b], c[b] = _.indexOf(a, b);
                    return this.projectModel.setNavigation(c, {success: function(a) {
                        return function(b) {
                            return a.projectModel.set(b)
                        }
                    }(this)}), this
                }
            }, g.prototype.checkAppsOut = function() {
                var a;
                return a = this.$(".apps-out-navigation"), a[a.find(".app-card").length ? "show" : "hide"](), this
            }, g.prototype.checkApp = function() {
                var a, b, c;
                return c = w.router.getUrl(), b = c.match(/project\/\w+\/(\w+)/), 2 === (null != b ? b.length : void 0) && (a = b[1], this.projectModel.get("navigation")[a] < 0) ? w.router.navigate(b[0].replace(a, this.projectModel.getFirstApp()), {trigger: !0}) : void 0
            }, g.prototype.showAdvanced = function(a) {
                var b, c;
                switch (b = $(a.currentTarget), b.data("action")) {
                    case "transfer":
                        c = p;
                        break;
                    case "archive":
                        c = k;
                        break;
                    case "delete":
                        c = l;
                        break;
                    case "quit":
                        c = m
                }
                return this.requestSubView(u).open(c, {projectModel: this.projectModel,organizationsCollection: this.organizationsCollection}), this
            }, g.prototype.quit = function() {
                return this.projectModel.quit({wait: !0,success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功退出项目",status: "success"}, 2e3), setTimeout(function() {
                            return a.projectModel.collection.remove(a.projectModel), w.router.navigate("/projects", {trigger: !0})
                        }, 1e3)
                    }
                }(this)}), this
            }, g.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, g.prototype.remove = function() {
                var a;
                return "function" == typeof this.checkApp && this.checkApp(), null != (a = this.uploader) && a.destroy(), g.__super__.remove.apply(this, arguments)
            }, g
        }(t)
    }), define("views/project/project-menu/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="list project-menu-list"> ';
            return a.hasRight >= 0 && (b += ' <li> <a class="project-archives-handler" data-gta="event" data-label="open project archives"> <span class="icon icon-archive"></span>查看归档 </a> </li> '), b += " ", b += " ", a.isPublic && (b += ' <li> <a class="share-project-handler" data-gta="event" data-label="share project"> <span class="icon icon-share"></span>分享项目 </a> </li> '), b += " ", a._organizationId && (a.hasOrgRight >= 0 || a.organization.isPublic) && (b += ' <li> <a class="enter-organization-handler" data-gta="event" data-label="enter organization from project"> <span class="icon icon-users"></span>进入组织 </a> </li> '), b += " ", a.hasRight >= 0 && (b += ' <li> <a class="project-calendar-handler" data-gta="event" data-label="open project calendar"> <span class="icon icon-calendar-bold"></span>订阅项目 </a> </li> <li> <a class="project-settings-handler" data-gta="event" data-label="open project settings"> <span class="icon icon-cog"></span>项目设置 </a> </li> '), b += "</ul>"
        }
    }), define("views/project/project-menu/templates/copy", [], function() {
        return function() {
            var a = '<div class="copy-project-wrap"> <div class="form-group"> <h5>项目名称</h5> <input class="project-name form-control margin-bottom"/> </div> <div class="project-owner form-group"> <h5>拥有者</h5> <div> <div class="open-selector-handler form-control"> <span class="selector-title"></span> <span class="icon icon-chevron-down"></span> </div> </div> </div> <div class="project-permission form-group"> <h5>项目公开性</h5> <div> <div class="open-selector-handler form-control"> <span class="selector-title">私有项目（仅项目成员可见）</span> <span class="icon icon-chevron-down"></span> </div> </div> </div> <button class="btn btn-primary">确定</button></div>';
            return a
        }
    }), define("views/project/project-menu/templates/share", [], function() {
        return function(a) {
            var b = '<div class="share-project-wrap"> <div class="form-group"> <h5>分享链接</h5> <input class="project-name form-control margin-bottom" value=' + a.shareLink + '/> </div> <div> <h5>分享到</h5> <div class="share-project-btn"> <a href="http://service.weibo.com/share/share.php?ralateUid=2673498793&url=' + a.weiboLink + "&title=" + a.weiboBody + '" target="_blank" title="分享到微博" class="share-handler"><span class="icon icon-weibo"></span></a> <a href="mailto:?subject=' + a.mailTitle + "&body=" + a.mailBody + '" title="通过邮件分享" class="share-handler"><span class="icon icon-td-envelope"></span></a> </div> </div></div>';
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/project/project-menu/index", ["require", "exports", "module", "teambition", "util", "collections/organizations", "collections/projects", "views/core/archive/index", "views/core/icalendar/index", "views/core/popover-menu/index", "lib/popover/index", "views/settings/project-settings/index", "lib/window/index", "./templates/basic", "./templates/copy", "./templates/share", "essage"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q;
        return p = a("teambition"), n = a("util"), g = a("collections/organizations"), l = a("collections/projects"), c = a("views/core/archive/index"), f = a("views/core/icalendar/index"), h = a("views/core/popover-menu/index"), i = a("lib/popover/index"), k = a("views/settings/project-settings/index"), o = a("lib/window/index"), d = a("./templates/basic"), e = a("./templates/copy"), m = a("./templates/share"), q = a("essage"), j = function(a) {
            function i() {
                return i.__super__.constructor.apply(this, arguments)
            }
            return b(i, a), i.prototype.viewName = "ProjectMenuView", i.prototype.className = "project-menu-view", i.prototype.popoverTitle = "项目菜单", i.prototype.events = {"click .project-settings-handler": "showProjectSettings","click .project-archives-handler": "showProjectArchives","click .enter-organization-handler": "navigateToOrganization","click .copy-project-handler": "enterCopySubMenu","click .share-project-handler": "enterShareSubMenu","click .copy-project-wrap button": "submitCopy","click .project-calendar-handler": "showICalendar","keyup .project-name": "checkSubimt"}, i.prototype.initialize = function(a) {
                return this.projectModel = a.projectModel, this.organizationsCollection = g.get(0), i.__super__.initialize.apply(this, arguments)
            }, i.prototype.render = function() {
                var a;
                return a = this.projectModel.toJSON(), a.user = p.user.toJSON(), a.hasRight = this.projectModel.hasRight(), this.options.isCopy ? (this.$title.text("复制项目"), this.$el.html(e()), this.$submit = this.$(".copy-project-wrap button"), this.$input = this.$("input.project-name"), this.selectedOrgId = null, this.selectedPermission = "private", this.initOwnerSelector().renderOwner(), this.initPermission().renderPermission(), this.checkSubimt(), this.$input.focusAtEnd()) : this.$el.html(d(a)), this
            }, i.prototype.showProjectSettings = function() {
                return this.requestSubView(o).open(k, {projectModel: this.projectModel,tab: "project-info"}), this.hide(), this
            }, i.prototype.showProjectArchives = function() {
                return this.requestSubView(o).open(c, {_projectId: this.projectModel.id,appName: this.options.appName}), this.hide(), this
            }, i.prototype.navigateToOrganization = function() {
                var a;
                if (a = this.projectModel.get("_organizationId"))
                    return p.router.navigate("/organization/" + a + "/projects", {trigger: !0})
            }, i.prototype.enterCopySubMenu = function() {
                return this.enterSubMenu("复制项目", function(a) {
                    return function() {
                        return a.$el.html(e()), a.$submit = a.$(".copy-project-wrap button"), a.$input = a.$("input.project-name"), a.selectedOrgId = null, a.selectedPermission = "private", a.initOwnerSelector().renderOwner(), a.initPermission().renderPermission(), a.checkSubimt(), a.$input.focusAtEnd()
                    }
                }(this)), this
            }, i.prototype.enterShareSubMenu = function() {
                var a, b, c, d, e, f;
                return e = p.user.get("name"), d = this.projectModel.get("name"), c = this.projectModel.get("shortLink"), b = this.projectModel.get("description"), a = b ? "" + e + " 邀请你查看来自 Teambition 的公开项目「" + d + "」。这个项目是关于 “" + b + "”。链接是：" + c : "" + e + " 邀请你查看来自 Teambition 的公开项目「" + d + "」。链接是：" + c, f = b ? "我在 Teambition 上发现了一个有用的公开项目「" + d + "」。这个项目是关于 “" + b + "”。" : "我在 Teambition 上发现了一个有用的公开项目「" + d + "」。", this.enterSubMenu("分享项目", function(b) {
                    return function() {
                        return b.$el.html(m({shareLink: c,mailTitle: encodeURIComponent("分享公开项目 “" + d + "”"),mailBody: encodeURIComponent(a),weiboLink: encodeURIComponent(c),weiboBody: encodeURIComponent(f)}))
                    }
                }(this)), this
            }, i.prototype.initOwnerSelector = function() {
                var a;
                return null != (a = this.ownerMenuView) && a.remove(), this.ownerMenuView = this.requestSubView(h, {$toggler: this.$(".project-owner .open-selector-handler"),width: 240,dataList: this.getOwners(),selected: this.selectedOrgId,select: function(a) {
                    return function(b) {
                        return a.selectedOrgId = b === p.user.id ? null : b, a.renderOwner()
                    }
                }(this)}), this
            }, i.prototype.initPermission = function() {
                var a;
                return null != (a = this.permissionMenuView) && a.remove(), this.permissionMenuView = this.requestSubView(h, {$toggler: this.$(".project-permission .open-selector-handler"),width: 240,dataList: [{title: "公开项目（所有访客可见）",_id: "public"}, {title: "私有项目（仅项目成员可见）",_id: "private"}],selected: this.selectedPermission,select: function(a) {
                    return function(b) {
                        return a.selectedPermission = b, a.renderPermission()
                    }
                }(this)}), this
            }, i.prototype.renderOwner = function() {
                var a;
                return a = this.organizationsCollection.get(this.selectedOrgId), this.$(".project-owner .selector-title").text(a ? a.get("name") : "我"), this
            }, i.prototype.renderPermission = function() {
                return this.$(".project-permission .selector-title").text("public" === this.selectedPermission ? "公开项目（所有访客可见）" : "私有项目（仅项目成员可见）"), this
            }, i.prototype.getOwners = function() {
                var a, b, c, d, e;
                if (c = [], c.push({title: "我",plan: p.user.get("plan"),_id: p.user.id}), c._userMeId = p.user.id, b = this.organizationsCollection.toJSON(), (null != b ? b.length : void 0) > 0)
                    for (d = 0, e = b.length; e > d; d++)
                        a = b[d], a.hasRight > 0 && c.push({title: a.name,plan: a.plan,_id: a._id});
                return c
            }, i.prototype.checkSubimt = function() {
                return this.disableSubmit(!this.$input.val().trim())
            }, i.prototype.disableSubmit = function(a) {
                return this.$submit.prop("disabled", a), this.$submit[a ? "addClass" : "removeClass"]("disabled"), this
            }, i.prototype.submitCopy = function() {
                var a;
                if (!this.$submit.prop("disabled") && (this.projectModel.get("isPublic") || this.projectModel.hasRight() > 1) && (a = this.$input.val().trim()))
                    return this.disableSubmit(!0), this.projectModel.copy({attrs: {_id: this.projectModel.id,name: a,_organizationId: this.selectedOrgId,isPublic: "public" === this.selectedPermission},success: function(a) {
                        return function(b) {
                            var c;
                            return l.get(0).add(b), b._organizationId && null != (c = l.find(b._organizationId)) && c.add(b), a.hide(), n.message({tips: "成功复制项目：",url: "/project/" + b._id,title: b.name})
                        }
                    }(this),error: function(a) {
                        return function() {
                            return a.disableSubmit(!1), Essage.show({message: "项目复制失败",status: "error"}, 2e3)
                        }
                    }(this)})
            }, i.prototype.showICalendar = function() {
                return this.requestSubView(o).open(f, {title: this.projectModel.get("name"),webcal: this.projectModel.get("taskCalLink")}), this.hide(), this
            }, i
        }(i)
    }), define("views/project/project-switcher/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="project-search"> <input class="form-control" placeholder="查找项目"></div><ul class="project-list list-underscore thin-scroll">', d = a.projects;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += " ", "groupBy" == e.type ? c += ' <li class="group-by"> <p class="group-name">' + b(e.groupName) + "</p> </li> " : (c += ' <li class="project-item" data-id="' + e._id + '" data-gta="event" data-label="switch project"> <a class="clearfix"> <div class="project-logo pull-left" style="background-image: url(' + e.logo + ')"></div> <span>' + b(e.name) + "</span> ", e.isPublic && (c += ' <span class="label public-label">公开</span> '), c += " </a> </li> ");
            return c += "</ul>"
        }
    }), define("views/project/project-switcher/templates/list", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            if (a.projects.length) {
                var d = a.projects;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; )
                        e = d[f += 1], c += ' <li class="project-item ', 0 == f && (c += "active"), c += " ", a.selectedId == e._id && (c += "selected"), c += '" data-id="' + e._id + '" data-gta="event" data-label="switch project"> <a class="clearfix"> <div class="project-logo pull-left" style="background-image: url(' + e.logo + ')"></div> <span>' + b(e.name) + "</span> ", e.isPublic && (c += ' <span class="label public-label">公开</span> '), c += " </a> </li>"
            } else
                c += '<div class="placeholder no-result"> <span class="icon icon-search-warning"></span> <p>抱歉，没有找到该项目</p></div>';
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/project/project-switcher/index", ["require", "exports", "module", "./templates/basic", "./templates/list", "lib/popover/index", "lib/scrollable", "util"], function(a) {
        var c, d, e, f, g, h;
        return c = a("./templates/basic"), d = a("./templates/list"), e = a("lib/popover/index"), g = a("lib/scrollable"), h = a("util"), f = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "ProjectSwitcherView", e.prototype.className = "project-switcher-view", e.prototype.popoverTitle = "Menu", e.prototype.hotkeys = {"up|down|enter": "searchProjects",esc: function(a) {
                var b;
                return a.preventDefault(), null != (b = this.$popover) && b.parent().trigger("click"), this.hide()
            }}, e.prototype.events = {"click .project-item": "switchProject","keyup input": "searchProjects","mousewheel .project-list": h.mousewheel}, e.prototype.render = function() {
                return this.options.projectsCollection ? (this.genProjects(), this.$el.html(c({projects: this.projects,selectedId: this.options.selectedId})), this.$list = this.$(".project-list"), this.$list.find(".project-item[data-id=" + this.options.selectedId + "]:first").addClass("selected"), this.$(".group-by").next(".project-item").addClass("underscore"), this.$el.find("input").focusAtEnd(), this.layout(), this.setupScroll(this.$list), this) : void 0
            }, e.prototype.genProjects = function() {
                var a, b, c, d, e;
                return b = this.options.projectsCollection, a = this.options.organizationsCollection, d = b.groupBy(function() {
                    return function(b) {
                        var c;
                        return c = b.get("_organizationId"), c && !a.get(c) && b.get("organization") && a.add(b.get("organization")), c || null
                    }
                }(this)), e = b.getStarProjects(), this.projects = [], e.length && (this.projects.push({type: "groupBy",groupName: "星标项目"}), _.each(e, function(a) {
                    return function(b) {
                        return a.projects.push(b.toJSON())
                    }
                }(this))), c = _.keys(d), c = _.map(c, function() {
                    return function(b) {
                        var c;
                        return {_id: b,name: (null != (c = a.get(b)) ? c.get("name") : void 0) || ""}
                    }
                }(this)), c = _.sortBy(c, function() {
                    return function(a) {
                        return a.name
                    }
                }(this)), _.each(c, function(a) {
                    return function(b) {
                        return a.projects.push({type: "groupBy",groupName: b.name || "个人项目"}), _.each(d[b._id], function(b) {
                            return b.hasRight() >= 0 ? a.projects.push(b.toJSON()) : void 0
                        })
                    }
                }(this)), this
            }, e.prototype.layout = function() {
                return this.$list.css("maxHeight", Math.max(.7 * $(window).height(), 300)), this
            }, e.prototype.searchProjects = function(a) {
                var b, c, e, f;
                switch (a.keyCode) {
                    case 38:
                        return this.switchActive("up");
                    case 40:
                        return this.switchActive("down");
                    case 13:
                        return b = this.$list.find(".active"), b.length || (b = this.$list.find("li:first")), b.trigger("click")
                }
                return c = {}, e = $(a.currentTarget).val().trim().toLowerCase(), e ? (f = [], _.each(this.projects, function(a) {
                    var b;
                    if (a.pinyin || a.name)
                        return c[a._id] || -1 === a.name.toLowerCase().indexOf(e) && -1 === (null != (b = a.pinyin) ? b.toLowerCase().indexOf(e) : void 0) ? void 0 : (c[a._id] = !0, f.push(a))
                }), this.$list.html(d({projects: f,selectedId: this.options.selectedId}))) : this.render(), this
            }, e.prototype.switchProject = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), c = this.options.projectsCollection.get(b.data("id")), c && "function" == typeof (d = this.options).onSelectedChange && d.onSelectedChange(c), this
            }, e.prototype.switchActive = function(a) {
                var b, c, d, e, f;
                return b = this.$list.find(".active"), b.length || (b = this.$list.find(".selected")), "up" === a && (f = b.removeClass("active").prevAll(".project-item:first"), d = this.$list.find("li.project-item:last"), f.length > 0 ? f.addClass("active") : d.addClass("active")), "down" === a && (e = b.removeClass("active").nextAll(".project-item:first"), c = this.$list.find("li.project-item:first"), e.length > 0 ? e.addClass("active") : c.addClass("active")), this.slideTo(this.$list.find(".active"))
            }, e
        }(e), _.extend(f.prototype, g), f
    }), define("views/core/app-switcher/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="project-title-wrap pull-left clearfix"> ';
            c += a.user.isGhost ? ' <span class="project-switcher-handler"> <strong class="project-name">' + b(a.name) + "</strong> </span> " : ' <a class="project-switcher-handler" data-gta="event" data-label="toggle projects"> <strong class="project-name">' + b(a.name) + '</strong><span class="icon icon-chevron-down"></span> </a> ', c += ' <span class="label public-label">公开</span></div><ul class="nav nav-underscore pull-left guide-handler" data-guide="navThree">';
            var d = a.apps;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="', e.name === a.appName && (c += "active"), c += '"> <a class="app" data-app="' + e.name + '" data-gta="event" data-label="enter ' + e.name + '" data-use-mixpanel="true"> ' + e.title + " </a></li>";
            return c += '</ul><div class="more-settings pull-right"> ', a.user.isGhost ? c += ' <span> <span class="icon icon-star"></span> <span class="project-stars-count">' + (a.starsCount || 0) + "</span> </span> " : (c += ' <a class="flag-handler ', a.isStar && (c += "starred"), c += '" data-gta="event" data-label="star project"> <span class="icon icon-star"></span> <span class="project-stars-count">' + (a.starsCount || 0) + "</span> </a> "), c += " ", a.user.isGhost || 2 != a.hasRight && !a.isPublic || (c += ' <a class="copy-project-handler hinted" data-title="复制项目" data-gta="event" data-label="copy project"> <span class="icon icon-copy-task"></span> <span class="project-forks-count">' + (a.forksCount || 0) + "</span> </a> "), c += ' <a class="project-menu-handler" data-gta="event" data-label="expand project menu"> <span class="icon icon-chevron-down"></span> </a></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/core/app-switcher/index", ["require", "exports", "module", "teambition", "lib/guide-point/index", "view", "collections/apps", "collections/organizations", "collections/projects", "views/organization/organization-expiring/index", "views/organization/organization-overdue/index", "views/project/project-guide/index", "views/project/project-menu/index", "views/project/project-switcher/index", "lib/window/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p;
        return p = a("teambition"), f = a("lib/guide-point/index"), n = a("view"), d = a("collections/apps"), i = a("collections/organizations"), m = a("collections/projects"), g = a("views/organization/organization-expiring/index"), h = a("views/organization/organization-overdue/index"), j = a("views/project/project-guide/index"), k = a("views/project/project-menu/index"), l = a("views/project/project-switcher/index"), o = a("lib/window/index"), e = a("./templates/basic"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "AppSwitcherView", c.prototype.tagName = "nav", c.prototype.className = "app-switcher sub-nav sub-navigator", c.prototype.events = {"click .app": "route","click a.project-switcher-handler": "toggleProjectSwitcher","click .flag-handler": "toggleProjectStar","click .copy-project-handler": "openCopyMenu","click .project-menu-handler": "toggleProjectMenu"}, c.prototype.initialize = function(a) {
                return a.projectModel ? (this.options = _.extend({}, a), this.projectModel = a.projectModel, this.renderBasic().renderProject().renderGuide().listen(), _.delay(function(a) {
                    return function() {
                        return a.projectModel.isExpiring() ? a.renderExpiring() : a.projectModel.isOverdue() && a.renderOverdue(), f.initialize(a)
                    }
                }(this)), this) : void 0
            }, c.prototype.listen = function() {
                return this.listenTo(this.projectModel, "change:name change:isStar change:isPublic change:starsCount change:forksCount", this.renderProject), this.listenTo(this.projectModel, "change:navigation", this.renderBasic), this
            }, c.prototype.renderBasic = function() {
                var a, b, c;
                return b = _.extend(this.projectModel.toJSON(), {apps: [],user: p.user.toJSON()}), c = this.projectModel.get("navigation"), a = d.get().toJSON(), _.each(a, function(a) {
                    return c[a.name] >= 0 ? b.apps.push(a) : void 0
                }), b.apps.sort(function(a, b) {
                    return c[a.name] - c[b.name]
                }), b.appName = this.options.appName, b.hasRight = this.projectModel.hasRight(), this.$el.html(e(b)), this.$Project = this.$(".project-title-wrap"), this
            }, c.prototype.renderGuide = function() {
                return this.projectModel.get("isNew") && (this.projectModel.set("isNew", !1), this.requestSubView(o).open(j, {projectModel: this.projectModel})), this
            }, c.prototype.renderOverdue = function() {
                return this.requestSubView(o).open(h, {inProject: !0,_organizationId: this.projectModel.get("_organizationId"),onclose: function() {
                    return function() {
                        return p.router.navigate("/projects", {trigger: !0})
                    }
                }(this)}), this
            }, c.prototype.renderExpiring = function() {
                return this.requestSubView(g, {_organizationId: this.projectModel.get("_organizationId")}), this
            }, c.prototype.renderProject = function() {
                return this.$Project[this.projectModel.get("isPublic") ? "addClass" : "removeClass"]("public"), this.$(".flag-handler")[this.projectModel.get("isStar") ? "addClass" : "removeClass"]("starred"), this.$(".project-stars-count").text(this.projectModel.get("starsCount") || 0), this.$(".project-forks-count").text(this.projectModel.get("forksCount") || 0), this.$Project.find(".project-name").text(this.projectModel.get("name")), this
            }, c.prototype.route = function(a) {
                var b, c, e, f;
                return b = $(a.currentTarget), b.parent().hasClass("active") || (c = b.data("app"), f = p.router.getUrl(), e = _.map(d.get().toJSON(), function(a) {
                    return a.name
                }).join("|"), f = f.replace(new RegExp("(" + e + ")+\\S*"), c), p.router.navigate(f, {trigger: !0})), this
            }, c.prototype.toggleProjectSwitcher = function(a) {
                return this.projectSwitcherView || (this.projectSwitcherView = this.requestSubView(l, {selectedId: this.projectModel.id,$toggler: $(a.currentTarget),projectsCollection: m.get(0),organizationsCollection: i.get(0),onSelectedChange: function(a) {
                    return function(b) {
                        var c;
                        if (a.projectModel.id !== b.id)
                            return c = "project/" + b.id + "/" + a.options.appName, p.router.navigate(c, {trigger: !0})
                    }
                }(this)}).show()), this
            }, c.prototype.toggleProjectStar = function() {
                var a;
                return a = this.projectModel, a.toggleStar({success: function() {
                    return function(b) {
                        return b.isStar ? m.get(0).add(a) : a.hasRight() >= 0 || m.get(0).remove(a.id), Essage.show({message: b.isStar ? "星标成功，该项目会在您的星标项目中" : "取消星标成功",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, c.prototype.openCopyMenu = function(a) {
                return this.projectCopyMenu || (this.projectCopyMenu = this.requestSubView(k, {$toggler: $(a.currentTarget),projectModel: this.projectModel,isCopy: !0}).show()), this
            }, c.prototype.toggleProjectMenu = function(a) {
                return this.projectMenuView || (this.projectMenuView = this.requestSubView(k, {$toggler: $(a.currentTarget),projectModel: this.projectModel}).show()), this
            }, c
        }(n)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/tasklist", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return c = a("model"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "tasklist", c.prototype.urlRoot = "tasklists", c.prototype.defaults = {objectType: "tasklist",stageIds: []}, c.prototype.setStageIds = function(a, b) {
                return b || (b = {}), b.url = "" + this.url() + "/stageIds", b.attrs = {stageIds: a}, this.sync("update", this, b), this
            }, c.prototype.checkStageIds = function(a, b) {
                var c, d, e, f;
                if (d = this.get("stageIds"), d.indexOf(a) < 0)
                    for (d.push(d[d.length - 1]), c = e = d.length - 1; e >= 0; c = e += -1) {
                        if (f = d[c], b === d[c - 1]) {
                            d[c] = a;
                            break
                        }
                        d[c] = d[c - 1]
                    }
                return d
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/stage", ["require", "exports", "module", "model", "lib/socket"], function(a) {
        var c, d, e;
        return c = a("model"), d = a("lib/socket"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "stage", c.prototype.urlRoot = "stages", c.prototype.defaults = {name: "",_tasklistId: "",_prevId: ""}, c.prototype.isLast = function() {
                var a;
                return (null != (a = this.collection) ? a.last() : void 0) === this
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/stages", ["require", "exports", "module", "collection", "lib/socket", "models/stage"], function(a) {
        var c, d, e, f;
        return c = a("collection"), d = a("lib/socket"), f = a("models/stage"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "stages", c.prototype.model = f, c.prototype.boundToObjectType = "tasklist", c.prototype.orderBy = !1, c.prototype.initialize = function() {
                return this.on("change:isLocked", function(a) {
                    return function(b, c) {
                        return c ? a.each(function(a) {
                            return d.trigger(":change:tasks/" + a.id + "/locked", {lockedStageId: b.id})
                        }) : void 0
                    }
                }(this)), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.getPreviousStage = function(a, b) {
                var c, d;
                return c = this.get(a), d = c.get("_prevId"), d || (d = b[b.indexOf(a) - 1]), this.get(d)
            }, c.prototype.isLocked = function() {
                return this.last().get("isLocked")
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/tasklists", ["require", "exports", "module", "collection", "models/tasklist"], function(a) {
        var c, d, e;
        return c = a("collection"), e = a("models/tasklist"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "tasklists", c.prototype.model = e, c.prototype.boundToObjectType = "project", c.prototype.getTasksPercent = function(a) {
                return 100 * a / this.reduce(function(a, b) {
                    return Math.max(a, b.get("totalCount"))
                }, a || 1)
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/task", ["require", "exports", "module", "teambition", "model", "moment", "rrule"], function(a) {
        var c, d, e, f, g;
        return g = a("teambition"), c = a("model"), d = a("moment"), e = a("rrule"), f = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "task", c.prototype.urlRoot = "tasks", c.prototype.defaults = {objectType: "task",isDone: !1,isRedo: !1,content: "",note: "",priority: 0,involveMembers: []}, c.prototype.initialize = function() {
                return this.on("change:_executorId change:isDone change:dueDate", function(a) {
                    return function() {
                        var b;
                        if (a.get("_id") && (a.get("_executorId") === g.user.id || a.previous("_executorId") === g.user.id) && (b = a.get("dueDate") || a.previous("dueDate")) && d().endOf("day").isAfter(b))
                            return g.user.fetchTodayTasks()
                    }
                }(this)), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.parse = function(a) {
                return a = _.extend(this.toJSON(), a), a._executorId || (a._executorId = ""), a.executor && a.executor._id !== a._executorId && (a.executor = null), a
            }, c.prototype.markDone = function() {
                return this.save(null, {attrs: {isDone: !0}}), this
            }, c.prototype.markUndo = function() {
                return this.save(null, {attrs: {isDone: !1}}), this
            }, c.prototype.editDueDate = function(a, b) {
                var c;
                return b || (b = {}), b.attrs = {dueDate: null}, null == a ? this.save(null, b) : (a instanceof Date || (a = new Date(a)), a.getFullYear() && (c = this.get("dueDate"), c instanceof Date || (c = new Date(c)), c.toDateString() !== a.toDateString() && (b.attrs = {dueDate: a}, this.save(null, b))), this)
            }, c.prototype.updateContent = function(a) {
                return this.save(null, {attrs: {content: a}}), this
            }, c.prototype.updateExecutor = function(a, b) {
                return b || (b = {}), b.attrs = {_executorId: a}, this.save(null, b), this
            }, c.prototype.getScope = function() {
                var a, b;
                return this.get("isDone") ? "past" : (a = d(this.get("dueDate") || null).valueOf(), b = d().endOf("day"), this.get("startOnToday") || a && a <= b.valueOf() ? "today" : a && a <= b.add(7, "days").valueOf() ? "recent" : "future")
            }, c.prototype.isInvolved = function(a) {
                return _.find(this.get("involveMembers"), function(b) {
                    return b === a
                })
            }, c.prototype.isExecutor = function(a) {
                var b, c;
                return b = this.get("_executorId") === a, !b && (c = this.get("subtasks")) && (b = !!_.find(c, function(b) {
                    return b._executorId === a
                })), b
            }, c.prototype.getRRule = function() {
                var a;
                return a = this.get("recurrence"), a && (a = _.find(a, function(a) {
                    return -1 !== a.indexOf("RRULE:")
                })), a && (a = a.replace("RRULE:", "")), a && (a = e.fromString(a)), a
            }, c.prototype.genRecurrence = function(a) {
                var b;
                return a = "RRULE:" + a.toString(), b = this.get("recurrence") || [], b = _.map(b, function(b) {
                    return -1 !== b.indexOf("RRULE:") ? a : b
                }), b.length || b.push(a), b
            }, c.prototype.hasEditRight = function() {
                return this.get("_executorId") === g.user.id || this.hasRight() > 0
            }, c.prototype.forkOrMove = function(a, b, c) {
                return c || (c = {}), c.url = "" + this.url() + "/" + a, c.attrs = _.extend({_stageId: b}, c.attrs), this.sync("update", this, c), this
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/tasks", ["require", "exports", "module", "collection", "moment", "lib/socket", "models/task"], function(a) {
        var c, d, e, f, g;
        return c = a("collection"), d = a("moment"), e = a("lib/socket"), f = a("models/task"), g = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "tasks", c.prototype.model = f, c.prototype.boundToObjectType = "stage", c.prototype.pageNum = 20, c.prototype.initialize = function() {
                return _.delay(function(a) {
                    return function() {
                        return a.on("change:_stageId", function(b, d) {
                            var e;
                            if (24 === a._boundToObjectId.length)
                                return a.boundToObjectType && a._boundToObjectId !== d && a.remove(b), null != (e = c.find(d)) ? e.add(b.toJSON()) : void 0
                        }), e.on(":change:tasks/" + a._boundToObjectId + "/locked", function(b) {
                            var c;
                            return c = b.lockedStageId, _.each(a.models.slice(), function(b) {
                                return b.get("isDone") ? b.set("_stageId", c) : a._boundToObjectId === c ? b.set({isDone: !0,accomplished: (new Date).toISOString()}) : void 0
                            })
                        })
                    }
                }(this)), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.getDoneTaskCount = function() {
                return this.where({isDone: !0}).length
            }, c.prototype.comparator = function(a, b) {
                var c, d, e, f;
                return d = a.get("isDone") - b.get("isDone"), a.get("isDone") && !d ? d = new Date(b.get("accomplished")) - new Date(a.get("accomplished")) : (d || (d = b.get("priority") - a.get("priority")), d || (c = new Date(a.get("dueDate")).getTime() || Number.MAX_VALUE, f = new Date(b.get("dueDate")).getTime() || Number.MAX_VALUE, e = (new Date).getTime(), d = f - c, (d > 0 && f > e || 0 > d && c > e) && (d = -d)), d || (d = new Date(a.get("created")) - new Date(b.get("created")))), d
            }, c.prototype.checkHasMore = function(a) {
                return this.pageNum <= a.reduce(function(a, b) {
                    return +b.isDone + a
                }, 0)
            }, c
        }(c), f.Collection = g, g
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/stage-template", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return c = a("model"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "stageTemplate", c.prototype.urlRoot = "stagetemplates", c.prototype.defaults = {title: "",description: "","class": "tasklist_custom",stages: []}, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/stage-templates", ["require", "exports", "module", "collection", "models/stage-template"], function(a) {
        var c, d, e;
        return c = a("collection"), d = a("models/stage-template"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "stagetemplates", c.prototype.model = d, c.prototype.orderBy = "latest-created", c
        }(c)
    }), define("views/board/scrum-pannel/templates/archive", [], function() {
        return function(a) {
            var b = "";
            return b += a.isLast ? ' <p class="edit-info muted"> 抱歉，您不能归档或删除最后一个任务分组. </p>' : ' <form class="tasklist-archive-form"> <p>您确定要归档这个任务分组吗</p> <button class="btn btn-primary" type="submit">确定</button> </form>'
        }
    }), define("views/board/scrum-pannel/templates/basic", [], function() {
        return function(a) {
            var b = '<section class="scrum-pannel-content thin-scroll ';
            return a.noEditor && (b += "no-editor"), b += '"> ', a.noEditor || (b += ' <div class="tasklist-editor-wrap"> <div class="scrum-pannel-header"> <a class="icon icon-chevron-left editor-back-handler"></a> <a class="tasklist-editor-toggler" data-gta="event" data-label="expand edit task group"> <strong class="tasklist-editor-title">编辑任务分组</strong> <span class="icon icon-chevron-down pull-right"></span> </a> <a class="icon icon-remove scrum-pannel-handler pull-right"></a> </div> <div class="tasklist-editor-content"></div> </div> '), b += ' <div class="scrum-filter-wrap"> <div class="scrum-pannel-header"> <strong>任务筛选</strong> <a class="filter-clear-handler pull-right">清除筛选</a> ', a.noEditor && (b += ' <a class="icon icon-remove scrum-pannel-handler pull-right"></a> '), b += ' </div> <div class="filter-input-wrap"> <input class="form-control" placeholder="查找相关任务" data-gta="event" data-label="filter task by keyword" /> </div> <ul class="scrum-filter-tags list"></ul> <ul class="scrum-filter-executors list"></ul> </div> <div class="scrum-filter-done-wrap"> <a class="filter-done-handler" data-gta="event" data-label="hide completed task"> <div class="check-box pull-left"> <span class="icon icon-tick"></span> </div> <span>隐藏已完成任务</span> </a> </div> <div class="scrum-filter-today-wrap"> <a class="filter-today-handler" data-gta="event" data-label="task modified today"> <div class="check-box pull-left"> <span class="icon icon-tick"></span> </div> <span>今日更新</span> </a> </div></section>'
        }
    }), define("views/board/scrum-pannel/templates/delete", [], function() {
        return function(a) {
            var b = "";
            return b += a.isLast ? ' <p class="edit-info muted"> 抱歉，您不能归档或删除最后一个任务分组. </p>' : ' <form class="tasklist-delete-form"> <p>您确定要永远删除这个任务分组吗</p> <button class="btn btn-danger" type="submit">删除</button> </form>'
        }
    }), define("views/board/scrum-pannel/templates/edit", [], function() {
        return function(a) {
            var b = '<form class="tasklist-edit-form"> <input class="form-control" placeholder="任务分组名称" type="text" value="' + a.title + '" /> <textarea class="form-control" placeholder="任务分组描述">' + a.description + '</textarea> <button class="btn btn-primary" type="submit">保存</button></form>';
            return b
        }
    }), define("views/board/scrum-pannel/templates/executors", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.executors;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="member-wrap ', a.selected.indexOf(e._id) >= 0 && (c += "selected"), c += '" data-id="' + e._id + '"> <a class="member" data-gta="event" data-label="filter task by member"> ', c += e._id ? ' <div class="avatar img-circle img-24" style="background-image:url(' + e.avatarUrl + ');"></div> ' + b(e.name) + " " : ' <div class="avatar img-circle img-24 no-avatar"></div> 待认领 ', c += " </a></li>";
            return c
        }
    }), define("views/board/scrum-pannel/templates/menu", [], function() {
        return function(a) {
            var b = '<ul class="list"> ';
            return a.hasRight > 0 && (b += ' <li> <a class="edit-tasklist-handler" data-gta="event" data-label="open tasklist editor"> <span class="icon icon-pencil"></span> 编辑任务分组 </a> </li> '), b += ' <li> <a class="stage-template-handler" data-gta="event" data-label="create stage template"> <span class="icon icon-plus"></span> 保存为任务分组模板 </a> </li> ', a.hasRight > 0 && (b += " ", a.tasklistCount > 1 && (b += ' <li> <a class="archive-tasklist-handler" data-gta="event" data-label="archive tasklist"> <span class="icon icon-archive"></span> 归档任务分组 </a> </li> '), b += ' <li> <a class="delete-tasklist-handler" data-gta="event" data-label="delete tasklist"> <span class="icon icon-trash"></span> 删除任务分组 </a> </li> '), b += "</ul>"
        }
    }), define("views/board/scrum-pannel/templates/stage-template-created", [], function() {
        return function(a) {
            var b = '<form class="stage-template-created"> <p class="stage-template-success">' + a.successInfo + '</p> <p class="muted">你可以在（任务分组 > 添加 > 模板）中选择使用</p> <button class="btn btn-primary">确定</button></form>';
            return b
        }
    }), define("views/board/scrum-pannel/templates/stage-template", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<form class="stage-template-form"> <p class="muted">将当前任务阶段保存为模板</p> <input class="form-control" placeholder="自定义模板" type="text" /> <p class="stage-template-stages muted"> <span class="stage-name">' + b(a.stages[0]) + "</span> ", d = a.stages.slice(1);
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <span class="stage-name">&gt; ' + b(e) + "</span> ";
            return c += ' </p> <button class="btn btn-primary" type="submit">保存</button></form>'
        }
    }), define("views/board/scrum-pannel/templates/tags", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.tags;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="tag-wrap ', a.selected.indexOf(e._id) >= 0 && (c += "selected"), c += '" data-id="' + e._id + '"> <a class="tag" data-gta="event" data-label="filter task by tag"> <span class="tag-label tag-label-' + e.color + '"></span> <span class="tag-name">' + b(e.name) + "</span> </a></li>";
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/scrum-pannel/index", ["require", "exports", "module", "teambition", "moment", "util", "view", "collections/members", "collections/stage-templates", "collections/tags", "collections/tasks", "./templates/archive", "./templates/basic", "./templates/delete", "./templates/edit", "./templates/executors", "./templates/menu", "./templates/stage-template-created", "./templates/stage-template", "./templates/tags"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t;
        return t = a("teambition"), j = a("moment"), r = a("util"), s = a("view"), h = a("collections/members"), l = a("collections/stage-templates"), o = a("collections/tags"), q = a("collections/tasks"), c = a("./templates/archive"), d = a("./templates/basic"), e = a("./templates/delete"), f = a("./templates/edit"), g = a("./templates/executors"), i = a("./templates/menu"), m = a("./templates/stage-template-created"), n = a("./templates/stage-template"), p = a("./templates/tags"), k = function(a) {
            function k() {
                return k.__super__.constructor.apply(this, arguments)
            }
            return b(k, a), k.prototype.viewName = "ScrumPanelView", k.prototype.className = "scrum-pannel", k.prototype.events = {"click .scrum-pannel-handler": "toggle","click .tasklist-editor-toggler": "toggleTasklistEditor","click .editor-back-handler": "renderMenu","click .edit-tasklist-handler": "enterEditSubMenu","click .stage-template-handler": "enterStageTemplateMenu","click .archive-tasklist-handler": "enterArchiveSubMenu","click .delete-tasklist-handler": "enterDeleteSubMenu","submit .tasklist-edit-form": "submitEditForm","submit .stage-template-form": "submitStageTemplateForm","submit .tasklist-delete-form": "submitDeleteForm","submit .tasklist-archive-form": "submitArchiveForm","submit .stage-template-created": "createdForm","click .filter-done-handler": "toggleHideDone","click .filter-today-handler": "toggleTodayUpdate","click .filter-clear-handler": "clearFilter","click .scrum-filter-wrap .tag": "filterByTag","click .scrum-filter-wrap .member": "filterByExecutor","keyup .scrum-filter-wrap input": "filterByQuery"}, k.prototype.initialize = function(a) {
                return (null != a ? a.tasklistModel : void 0) && a._projectId ? (this.options = a, this._projectId = a._projectId, this.tasklistModel = a.tasklistModel, this.tasksCollection = a.tasksCollection, this.stagesCollection = a.stagesCollection, this.tagsCollection = o.get(this._projectId), this.membersCollection = h.get(this._projectId), this.tasks = [], this.tagIds = {}, this.executorIds = {}, this.reset().renderBasic().listen(), k.__super__.initialize.apply(this, arguments)) : !1
            }, k.prototype.reset = function() {
                return this.onlyTodayUpdated = !1, this.selectedExecutorIds = [], this.selectedTagIds = [], this.queryWord = "", this.filtering = !1, this
            }, k.prototype.listen = function() {
                var a;
                return a = "add remove change:_executorId change:tagIds change:content change:note", this.tasksCollection ? this.listenTo(this.tasksCollection, a, this.genFilterList) : this.stagesCollection.each(function(b) {
                    return function(c) {
                        return b.listenTo(q.get(c.id), a, b.genFilterList)
                    }
                }(this)), this
            }, k.prototype.toggle = function() {
                return this.$boardScrum.toggleClass("scrum-pannel-active"), this.$boardScrum.hasClass("scrum-pannel-active") && (this.genFilterList(), _.delay(function(a) {
                    return function() {
                        var b;
                        return null != (b = a.$input) ? b.focusAtEnd() : void 0
                    }
                }(this), 100)), this
            }, k.prototype.renderBasic = function() {
                return this.$el.html(d({noEditor: !this.stagesCollection})), this.$editorWrap = this.$(".tasklist-editor-wrap"), this.$editotContent = this.$(".tasklist-editor-content"), this.$editorTitle = this.$(".tasklist-editor-title"), this.$tags = this.$(".scrum-filter-tags"), this.$executors = this.$(".scrum-filter-executors"), this.$input = this.$(".filter-input-wrap input"), _.delay(function(a) {
                    return function() {
                        return a.$boardScrum = a.parentView.$el.removeClass("scrum-pannel-active"), a.$boardContent = a.$boardScrum.find(".board-scrum-content")
                    }
                }(this)), this
            }, k.prototype.genFilterList = function(a) {
                var b, c;
                return (null != (c = this.$boardScrum) ? c.hasClass("scrum-pannel-active") : void 0) || a ? (this.tasks = [], this.tagIds = {}, this.executorIds = {}, b = function(a) {
                    return function(b) {
                        var c;
                        return a.tasks.push(b), c = b.get("_executorId"), c && a.membersCollection.get(c) || (c = ""), a.executorIds[c] = (a.executorIds[c] || 0) + 1, _.each(b.get("tagIds"), function(b) {
                            return a.tagIds[b] = (a.tagIds[b] || 0) + 1
                        })
                    }
                }(this), this.tasksCollection ? this.tasksCollection.each(b) : this.stagesCollection.each(function() {
                    return function(a) {
                        return q.get(a.id).each(b)
                    }
                }(this)), this.renderExecutors(), this.renderTags(), this.filtering && this.filterTasks(), this) : this
            }, k.prototype.filterByTag = function(a) {
                var b;
                return b = $(a.currentTarget).parent(), b.toggleClass("selected"), this.selectedTagIds = b.hasClass("selected") ? _.union(this.selectedTagIds, [b.data("id")]) : _.without(this.selectedTagIds, b.data("id")), this.filterTasks(), this
            }, k.prototype.filterByExecutor = function(a) {
                var b;
                return b = $(a.currentTarget).parent(), b.toggleClass("selected"), this.selectedExecutorIds = b.hasClass("selected") ? _.union(this.selectedExecutorIds, [b.data("id")]) : _.without(this.selectedExecutorIds, b.data("id")), this.filterTasks(), this
            }, k.prototype.filterByQuery = function() {
                return this.throttleFilter || (this.throttleFilter = _.throttle(function(a) {
                    return function() {
                        return a.$el ? (a.queryWord = a.$input.val().trim().toLowerCase(), a.filterTasks()) : void 0
                    }
                }(this), 400, {leading: !1})), this.throttleFilter(), this
            }, k.prototype.clearFilter = function() {
                return this.$input.val(""), this.$tags.find(".selected").removeClass("selected"), this.$executors.find(".selected").removeClass("selected"), this.$boardContent.find(".task.hide").removeClass("hide"), this.$boardScrum.removeClass("hide-done filtering-task"), this.$(".filter-today-handler").removeClass("active"), this.parentView.trigger("filtering", this.filtering), this.reset(), this
            }, k.prototype.filterTasks = function() {
                var a;
                return this.filtering = !1, a = j().startOf("day").valueOf(), _.each(this.tasks, function(b) {
                    return function(c) {
                        var d, e, f, g;
                        return d = b.$boardContent.find(".task[data-id=" + c.id + "]"), f = !1, g = c.get("_executorId") || "", b.onlyTodayUpdated && new Date(c.get("updated")) < a && (f = !0), !f && b.selectedExecutorIds.length && b.selectedExecutorIds.indexOf(g) < 0 && (f = !0), f || !b.selectedTagIds.length || _.find(c.get("tagIds"), function(a) {
                            return _.contains(b.selectedTagIds, a)
                        }) || (f = !0), !f && b.queryWord && (e = b.membersCollection.get(g), !r.matchString(c.get("content").toLowerCase(), b.queryWord) && !r.matchString((c.get("note") || "").toLowerCase(), b.queryWord) && (!e || e.get("name").toLowerCase().indexOf(b.queryWord) < 0 && e.get("pinyin").indexOf(b.queryWord) < 0) && d.text().toLowerCase().indexOf(b.queryWord) < 0 && (f = !0)), d[f ? "addClass" : "removeClass"]("hide"), f ? b.filtering = !0 : void 0
                    }
                }(this)), this.checkFiltering(), this
            }, k.prototype.checkFiltering = function() {
                var a;
                return a = this.filtering || this.$boardScrum.hasClass("hide-done"), this.$boardScrum[a ? "addClass" : "removeClass"]("filtering-task"), this.parentView.trigger("filtering", a), this
            }, k.prototype.renderTags = function() {
                var a;
                return a = [], _.each(this.tagIds, function(b) {
                    return function(c, d) {
                        var e;
                        return (e = b.tagsCollection.get(d)) ? a.push(e.toJSON()) : void 0
                    }
                }(this)), a.sort(function(a) {
                    return function(b, c) {
                        return a.tagIds[c._id] - a.tagIds[b._id]
                    }
                }(this)), this.$tags.html(p({tags: a,selected: this.selectedTagIds})), this
            }, k.prototype.renderExecutors = function() {
                var a;
                return a = [], _.each(this.executorIds, function(b) {
                    return function(c, d) {
                        var e;
                        return (e = b.membersCollection.get(d)) ? a.push(e.toJSON()) : void 0
                    }
                }(this)), this.executorIds[""] && a.push({_id: ""}), a.sort(function(a) {
                    return function(b, c) {
                        return a.executorIds[c._id] - a.executorIds[b._id]
                    }
                }(this)), this.$executors.html(g({executors: a,selected: this.selectedExecutorIds})), this
            }, k.prototype.toggleTasklistEditor = function() {
                return this.renderMenu(), this.$editorWrap.toggleClass("open")
            }, k.prototype.renderMenu = function() {
                var a, b;
                return a = this.tasklistModel.toJSON(), a.hasRight = this.stagesCollection && this.tasklistModel.hasRight(), a.tasklistCount = (null != (b = this.tasklistModel.collection) ? b.length : void 0) || 0, this.$editorWrap.removeClass("in-submenu"), this.$editorTitle.text("编辑任务分组"), this.$editotContent.html(i(a)), this
            }, k.prototype.enterEditSubMenu = function() {
                return this.$editorTitle.text("编辑任务分组"), this.$editotContent.html(f(this.tasklistModel.toJSON())), this.$editorWrap.addClass("in-submenu"), this.$editotContent.find("input:first").focusAtEnd(), this
            }, k.prototype.enterStageTemplateMenu = function() {
                return this.stages = [], this.stagesCollection.each(function(a) {
                    return function(b) {
                        return a.stages.push(b.get("name").replace(/,/g, ""))
                    }
                }(this)), this.$editorTitle.text("自定义模板"), this.$editotContent.html(n({stages: this.stages})), this.$editorWrap.addClass("in-submenu"), this.$editotContent.find("input:first").focusAtEnd(), this
            }, k.prototype.enterStageTemplateCreatedMenu = function(a) {
                var b;
                return b = a.get("title"), this.$editotContent.html(m({successInfo: "添加 " + b + " 成功"})), this
            }, k.prototype.enterArchiveSubMenu = function() {
                var a;
                return this.$editorTitle.text("归档任务分组"), this.$editotContent.html(c({isLast: 1 === (null != (a = this.tasklistModel.collection) ? a.length : void 0)})), this.$editorWrap.addClass("in-submenu"), this
            }, k.prototype.enterDeleteSubMenu = function() {
                var a;
                return this.$editorTitle.text("删除任务分组"), this.$editotContent.html(e({isLast: 1 === (null != (a = this.tasklistModel.collection) ? a.length : void 0)})), this.$editorWrap.addClass("in-submenu"), this
            }, k.prototype.submitEditForm = function(a) {
                var b, c, d;
                return a.preventDefault(), b = $(a.currentTarget), d = b.find("input").val().trim(), c = b.find("textarea").val(), d ? this.tasklistModel.save(null, {attrs: {title: d,description: c},success: function(a) {
                    return function() {
                        return a.renderMenu()
                    }
                }(this)}) : b.find("input").focusAtEnd(), this
            }, k.prototype.submitStageTemplateForm = function(a) {
                var b, c, d;
                return a.preventDefault(), b = $(a.currentTarget), d = b.find("input").val().trim(), d ? (c = l.get(0), c.create(null, {wait: !0,attrs: {title: d,stages: this.stages.join(",")},success: function(a) {
                    return function(b) {
                        return a.enterStageTemplateCreatedMenu(b)
                    }
                }(this)}), t.gta.event(null, "create", "board|create stage template")) : b.find("input").focusAtEnd(), this
            }, k.prototype.submitArchiveForm = function(a) {
                return a.preventDefault(), this.tasklistModel.archive({success: function() {
                    return function() {
                        return Essage.show({message: "已成功归档了任务分组",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, k.prototype.submitDeleteForm = function(a) {
                return a.preventDefault(), this.tasklistModel.destroy({wait: !0,success: function() {
                    return function() {
                        return Essage.show({message: "删除成功",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, k.prototype.createdForm = function(a) {
                return a.preventDefault(), this.renderMenu(), this
            }, k.prototype.toggleHideDone = function() {
                return this.$boardScrum.toggleClass("hide-done"), this.checkFiltering(), this
            }, k.prototype.toggleTodayUpdate = function(a) {
                var b;
                return b = $(a.currentTarget), b.toggleClass("active"), this.onlyTodayUpdated = b.hasClass("active"), this.filterTasks(), this
            }, k.prototype.remove = function() {
                return "function" == typeof this.clearFilter && this.clearFilter(), k.__super__.remove.apply(this, arguments)
            }, k
        }(s)
    }), define("views/board/stage/stage-menu/templates/add", [], function() {
        return function() {
            var a = '<form class="stage-add-form"> <p>新阶段将被添加在当前阶段之后</p> <input class="form-control" type="text" placeholder="阶段名称"></input> <button class="btn btn-primary" type="submit" data-gta="event" data-label="add stage">创建</button></form>';
            return a
        }
    }), define("views/board/stage/stage-menu/templates/basic", [], function() {
        return function(a) {
            var b = "";
            return a.hasRight > 0 ? (b += ' <ul class="list"> <li> <a class="edit-stage-handler"> <span class="icon icon-pencil"></span>编辑阶段 </a> </li> ', a.isLocked && a.isLast || (b += ' <li> <a class="add-next-stage-handler"> <span class="icon icon-add-stage"></span>在此后添加新阶段 </a> </li> '), b += " ", a.isLast && (b += " ", b += a.isLocked ? ' <li> <a class="locked-stage-handler"> <span class="icon icon-stage"></span>切换至自由模式 </a> </li> ' : ' <li> <a class="locked-stage-handler"> <span class="icon icon-tick"></span>切换至流程模式 </a> </li> ', b += " "), b += " ", !(a.stagesCount > 2) || a.isLocked && a.isLast || (b += ' <li> <a class="delete-stage-handler"> <span class="icon icon-trash"></span>删除阶段 </a> </li> '), b += " </ul>") : (b += ' <p class="muted"> 您不能修改这个阶段. ', a.hasRightMembers && (b += "仅" + a.hasRightMembers + "可以修改."), b += " </p>"), b
        }
    }), define("views/board/stage/stage-menu/templates/delete", [], function() {
        return function(a) {
            var b = '<form class="stage-delete-form"> ';
            return b += a.deletable ? ' <p>您确定要永远删除这个阶段吗?</p> <button class="btn btn-danger" type="submit" data-gta="event" data-label="delete stage">删除</button> ' : " <p>请先清空此阶段上的任务，然后再删除这个阶段.</p> ", b += "</form>"
        }
    }), define("views/board/stage/stage-menu/templates/edit", [], function() {
        return function(a) {
            var b = '<form class="stage-edit-form"> <input class="form-control" placeholder="阶段名称" type="text" value="' + a.name + '"></input> <button class="btn btn-primary" type="submit" data-gta="event" data-label="edit stage">保存</button></form>';
            return b
        }
    }), define("views/board/stage/stage-menu/templates/locked", [], function() {
        return function(a) {
            var b = '<form class="stage-locked-form"> <p class="stage-template-success"> ';
            return b += a.isLocked ? "切换至自由模式后，该阶段后面可以新增加阶段，各阶段相互独立，即退出了任务流程模式" : "切换至流程模式后，该阶段的任务会变成已完成状态，其它阶段已完成的任务也会自动进入该阶段，即形成了任务流程模式", b += ' </p> <button class="btn btn-primary">确定</button></form>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/stage/stage-menu/index", ["require", "exports", "module", "./templates/add", "./templates/basic", "./templates/delete", "./templates/edit", "./templates/locked", "lib/popover/index"], function(a) {
        var c, d, e, f, g, h, i;
        return c = a("./templates/add"), d = a("./templates/basic"), e = a("./templates/delete"), f = a("./templates/edit"), g = a("./templates/locked"), h = a("lib/popover/index"), i = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "StageMenuView", h.prototype.popoverTitle = "阶段菜单", h.prototype.width = 250, h.prototype.events = {"click .edit-stage-handler": "enterEditSubMenu","click .add-next-stage-handler": "enterAddNextSubMenu","click .delete-stage-handler": "enterDeleteSubMenu","click .locked-stage-handler": "enterLockedSubMenu","submit .stage-edit-form": "submitEditForm","submit .stage-add-form": "submitAddForm","submit .stage-delete-form": "submitDeleteForm","submit .stage-locked-form": "submitLocked"}, h.prototype.render = function() {
                var a;
                if (this.options.stageModel && this.options.tasklistModel && this.options.tasksCollection)
                    return this.stageModel = this.options.stageModel, this.stagesCollection = this.stageModel.collection, a = this.stageModel.toJSON(), a.hasRight = this.options.tasklistModel.hasRight(), a.isLast = this.stageModel.isLast(), a.stagesCount = this.stagesCollection.length, this.$el.html(d(a)), this
            }, h.prototype.enterEditSubMenu = function() {
                return this.enterSubMenu("编辑阶段", function(a) {
                    return function() {
                        return a.$el.html(f(a.stageModel.toJSON())), a.$("input").focusAtEnd()
                    }
                }(this)), this
            }, h.prototype.enterAddNextSubMenu = function() {
                return this.enterSubMenu("添加阶段", function(a) {
                    return function() {
                        return a.$el.html(c()), a.$el.find("input").focusAtEnd()
                    }
                }(this)), this
            }, h.prototype.enterLockedSubMenu = function() {
                var a, b;
                return a = this.stageModel.get("isLocked"), b = a ? "切换至自由模式" : "切换至流程模式", this.enterSubMenu(b, function(b) {
                    return function() {
                        return b.$el.html(g({isLocked: a}))
                    }
                }(this)), this
            }, h.prototype.enterDeleteSubMenu = function() {
                var a, b;
                return a = null != (b = this.options.tasksCollection) ? b.length : void 0, this.enterSubMenu("删除阶段", function(b) {
                    return function() {
                        return b.$el.html(e({deletable: 0 === a ? !0 : !1}))
                    }
                }(this)), this
            }, h.prototype.submitEditForm = function(a) {
                var b, c;
                return a.preventDefault(), b = $(a.currentTarget), c = b.find("input").val().trim().replace(/,/g, ""), c ? this.stageModel.save(null, {attrs: {name: c},success: function(a) {
                    return function() {
                        return a.hide()
                    }
                }(this)}) : b.find("input").focusAtEnd(), this
            }, h.prototype.submitAddForm = function(a) {
                var b, c;
                return a.preventDefault(), b = $(a.currentTarget), c = b.find("input").val().trim(), c ? this.stagesCollection.create({name: c,_tasklistId: this.stageModel.get("_tasklistId"),_prevId: this.stageModel.id}, {wait: !0,success: function(a) {
                    return function() {
                        return a.hide()
                    }
                }(this)}) : b.find(input).focusAtEnd(), this
            }, h.prototype.submitDeleteForm = function(a) {
                return a.preventDefault(), this.stagesCollection.length >= 2 ? (this.stageModel.destroy({success: function(a) {
                    return function() {
                        return a.hide()
                    }
                }(this)}), this) : void 0
            }, h.prototype.submitLocked = function(a) {
                return a.preventDefault(), this.stageModel.isLast() ? (this.stageModel.save(null, {attrs: {isLocked: !this.stageModel.get("isLocked")}}), this.hide(), this) : void 0
            }, h
        }(h)
    }), define("views/member/member-involve/templates/basic", [], function() {
        return function() {
            var a = '<div class="involve-header"> <span>参与者</span></div><ul class="involve-members clearfix"> <li class="involve-member-add"> <a class="add-involvement-handler clearfix" data-gta="event" data-label="add involver"> <span class="icon icon-plus-sign hinted" data-title="添加参与者"></span> </a> </li></ul>';
            return a
        }
    }), define("views/member/member-involve/templates/list", [], function() {
        return function(a) {
            var b = "", c = a.members;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += '<li class="involve-member hinted" data-id="' + d._id + '" data-title="' + d.name + '"> <div class="avatar img-circle" style="background-image:url(' + d.avatarUrl + ');"></div> ', d.removeable && (b += ' <a class="remove-member-handler">&times;</a> '), b += "</li>";
            return b
        }
    }), define("views/member/member-menu/templates/basic", [], function() {
        return function(a) {
            var b = "";
            return a.searchPlaceholder && (b += '<div class="menu-input"> <input class="filter-input form-control" placeholder="' + a.searchPlaceholder + '"/></div>'), b += '<ul class="list-unstyled thin-scroll"></ul>'
        }
    }), define("views/member/member-menu/templates/member", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            a.noAssign && (c += ' <li class="member-item one" data-id=""> <a> <div class="avatar img-circle no-avatar"></div> 待认领 </a> </li>'), a.all && (c += ' <li class="member-item all"> <a data-gta="event" data-label="involve all members"> <span class="icon icon-users-bold icon-gray"></span> 所有成员 </a> </li>');
            var d = a.teams;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <li class="member-item team" data-id="' + e._id + '"> <a data-gta="event" data-label="involve team members"> <span class="icon icon-users-bold icon-gray"></span> ' + b(e.name) + " · " + e.hasMembers.length + " </a> </li>";
            var h = a.members;
            if (h)
                for (var i, f = -1, j = h.length - 1; j > f; )
                    i = h[f += 1], c += ' <li class="member-item one" data-id="' + i._id + '"> <a> <div class="avatar img-circle" style="background-image:url(' + i.avatarUrl + ');"></div> ' + b(i.name) + " </a> </li>";
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/member/member-menu/index", ["require", "exports", "module", "./templates/basic", "./templates/member", "lib/popover/index", "lib/scrollable"], function(a) {
        var c, e, f, g, h;
        return c = a("./templates/basic"), f = a("./templates/member"), g = a("lib/popover/index"), h = a("lib/scrollable"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "MemberMenuView", e.prototype.className = "member-menu-view", e.prototype.popoverTitle = "Menu", e.prototype.width = 200, e.prototype.hotkeys = {"up|down|enter": "filterMembers",esc: function(a) {
                var b;
                return a.preventDefault(), null != (b = this.$popover) && b.parent().trigger("click"), this.hide()
            }}, e.prototype.events = {"click .one": "selectedMember","click .all": "selectedAllMember","click .team": "selectedTeamMember","mouseenter .member-item": "activate","keydown .filter-input": "keydownFilterInput","keyup .filter-input": "filter"}, e.prototype.initialize = function(a) {
                return (null != a ? a.membersCollection : void 0) ? (this.resident = a.resident || [], this.excludes = a.excludes || [], this.selected = a.selected || [], this.membersCollection = a.membersCollection, this.teamsCollection = a.teamsCollection, this.members = _.filter(this.membersCollection.toJSON(), function(a) {
                    return function(b) {
                        var c;
                        return c = b._id, d.call(a.excludes, c) < 0
                    }
                }(this)), this.listen(), e.__super__.initialize.apply(this, arguments), this) : void 0
            }, e.prototype.listen = function() {
                return this.listenTo(this.membersCollection, "add remove", this.render), this
            }, e.prototype.render = function() {
                return this.$el.html(c({searchPlaceholder: "查找成员"})), this.$list = this.$("ul"), this.renderMembers(), this.refreshSelected(), this.$("input").focusAtEnd(), this.setupScroll(this.$list), this.filter(), this
            }, e.prototype.renderMembers = function() {
                var a, b, c;
                return a = {teams: this.options.multi && ((null != (b = this.teamsCollection) ? b.toJSON() : void 0) || []),members: this.members,all: this.options.multi,noAssign: this.options.noAssign}, null != (c = this.teamsCollection) && c.each(function(b) {
                    return "default" === b.get("type") ? a.all = !1 : void 0
                }), this.$list.html(f(a)), this
            }, e.prototype.refreshSelected = function() {
                return this.$(".member-item").removeClass("selected"), this.$(".member-item").each(function(a) {
                    return function(b, c) {
                        var e, f;
                        return e = $(c), f = e.data("id"), d.call(a.selected, f) >= 0 || d.call(a.resident, f) >= 0 ? e.addClass("selected") : void 0
                    }
                }(this)), this
            }, e.prototype.selectedMember = function(a) {
                var b, c, e, f;
                return b = $(a.currentTarget), f = b.data("id"), this.options.multi ? (c = b.hasClass("selected") ? "unselect" : "select", "unselect" === c && d.call(this.resident, f) >= 0 || ("function" == typeof (e = this.options)[c] ? e[c](f) : void 0) === !1 || (this.selected = "select" === c ? _.union(this.selected, [f]) : _.without(this.selected, f), this.refreshSelected())) : (this.selected = [f], this.refreshSelected(), this.options.select(f), this.hide()), this
            }, e.prototype.selectedAllMember = function() {
                var a;
                return this.$(".one").addClass("selected"), a = _.pluck(this.members, "_id"), this.options.selectAll(a), this.selected = a, this.hide(), this
            }, e.prototype.selectedTeamMember = function(a) {
                var b;
                if (b = this.teamsCollection.get($(a.currentTarget).data("id")))
                    return _.each(b.get("hasMembers"), function(a) {
                        return function(b) {
                            var c;
                            if ("function" == typeof (c = a.options).select ? c.select(b._id) : void 0)
                                return a.selected = _.union(a.selected, [b._id])
                        }
                    }(this)), this.refreshSelected()
            }, e.prototype.keydownFilterInput = function(a) {
                var b;
                switch (a.keyCode) {
                    case 38:
                        return a.preventDefault(), this.switchActive("up");
                    case 40:
                        return a.preventDefault(), this.switchActive("down");
                    case 13:
                        return b = this.$(".member-item.active"), b.trigger("click")
                }
            }, e.prototype.filter = function() {
                var a, b, c;
                return a = this.$(".filter-input"), c = a.val().trim().toLowerCase(), c ? (this.$(".member-item:not(.one)").hide(), b = _.map(this.filterDatas(c), "_id"), this.$(".member-item").each(function() {
                    var c;
                    return a = $(this), c = a.data("id"), d.call(b, c) >= 0 ? a.show() : a.hide()
                })) : this.$(".member-item").show(), this.actvateFirst(), this.slideTo(this.$(".member-item.active")), this
            }, e.prototype.filterDatas = function(a) {
                var b;
                return a ? (b = function(b, c, d) {
                    var e, f, g;
                    for (d = [], d.push(b.name.toLowerCase()), d.push(b.pinyin.toLowerCase()), d.push(b.py.toLowerCase()), f = 0, g = d.length; g > f; f++)
                        if (e = d[f], e.indexOf(a) >= 0)
                            return !0;
                    return !1
                }, _.filter(this.members, b)) : this.members
            }, e.prototype.activate = function(a) {
                var b;
                return b = $(a.currentTarget), b.length && !b.hasClass("active") ? (b.addClass("active").siblings().removeClass("active"), this) : void 0
            }, e.prototype.actvateFirst = function() {
                var a;
                return a = this.$("li:visible"), a.filter(".active").length || (this.$("li.active").removeClass("active"), a.first().addClass("active")), this
            }, e.prototype.switchActive = function(a) {
                var b, c, d, e, f, g;
                return f = (new Date).getTime(), f - this.lastSwitchTime < 100 ? void 0 : (this.lastSwitchTime = f, d = this.$("li:visible"), b = d.filter(".active"), e = d.index(b), "down" === a ? (g = e + 1, g >= d.length && (g = 0)) : (g = e - 1, 0 > g && (g = d.length - 1)), c = d.eq(g), d.removeClass("active"), c.addClass("active"), this.slideTo(c), this)
            }, e
        }(g), _.extend(e.prototype, h), e
    }), define("views/member/member-involve/templates/placeholder", [], function() {
        return function() {
            var a = '<li class="involve-member"> <div class="involve-placeholder">暂无参与者</div></li>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/member/member-involve/index", ["require", "exports", "module", "./templates/basic", "./templates/list", "views/member/member-menu/index", "./templates/placeholder", "collections/projects", "teambition", "collections/teams", "view"], function(a) {
        var c, e, f, g, h, i, j, k, l;
        return c = a("./templates/basic"), e = a("./templates/list"), g = a("views/member/member-menu/index"), h = a("./templates/placeholder"), i = a("collections/projects"), j = a("teambition"), k = a("collections/teams"), l = a("view"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "MemberInvolveView", f.prototype.tagName = "div", f.prototype.className = "involve-view", f.prototype.events = {"click .add-involvement-handler": "openMemberMenu","click .remove-member-handler": "quickRemoveMember"}, f.prototype.initialize = function(a) {
                var b;
                if ((null != a ? a.objectModel : void 0) && a.membersCollection)
                    return this.options = a, this._projectId = a._projectId || a.objectModel.get("_projectId"), this.projectModel = i.getOne(0, this._projectId), b = function(b) {
                        return function(c) {
                            return b.objectModel = a.objectModel, b.membersCollection = a.membersCollection, b.teamsCollection = c, b.renderBasic().setInvolve().render().listen().initDroppable()
                        }
                    }(this), this.projectModel.hasRight() >= 0 ? k.fetch(this._projectId, {boundToObjectType: "project",success: b}) : this.projectModel.get("isPublic") ? b(new k) : _.delay(function(a) {
                        return function() {
                            return a.$el.parent().addClass("hide")
                        }
                    }(this)), this
            }, f.prototype.listen = function() {
                return this.listenTo(this.objectModel, "change:involveMembers", this.refresh), this.listenTo(this.membersCollection, "change", this.render), this
            }, f.prototype.setInvolve = function() {
                var a, b;
                return this.involves = (null != (a = this.objectModel.get("involveMembers")) ? a.slice() : void 0) || (null != (b = this.options.resident) ? b.slice() : void 0) || [], this
            }, f.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$list = this.$(".involve-members"), this
            }, f.prototype.render = function() {
                var a, b, c, d, f, g, i, k;
                for (a = this.objectModel.hasRight() > 0, c = [], i = this.involves, d = 0, f = i.length; f > d; d++)
                    g = i[d], b = null != (k = this.membersCollection.get(g)) ? k.toJSON() : void 0, (null != b ? b._id : void 0) && (b._id === this.objectModel.get("_creatorId") ? b.name += "，创建者" : b._id === this.objectModel.get("_executorId") && (b.name += "，执行者"), b.removeable = (a || b._id === j.user.id) && this.ensurePermission(b._id), c.push(b));
                return this.$list.find(".involve-member").remove(), this.$list.prepend(e({members: c})), this.projectModel.hasRight() < 0 && (this.$(".involve-member-add").remove(), c.length || this.$list.html(h())), this
            }, f.prototype.openMemberMenu = function() {
                var a;
                if (!this.memberMenu)
                    return a = _.extend({}, this.options, {fixed: this.$el.closest(".panel-view").length,$toggler: this.$(".add-involvement-handler"),multi: !0,selected: this.involves,select: function(a) {
                        return function(b) {
                            return a.addMember(b)
                        }
                    }(this),unselect: function(a) {
                        return function(b) {
                            return a.removeMember(b)
                        }
                    }(this),selectAll: function(a) {
                        return function(b) {
                            return a.involveAll(b)
                        }
                    }(this),onHidden: function(a) {
                        return function() {
                            return a.saveInvolve()
                        }
                    }(this),collection: this.membersCollection,teamsCollection: this.teamsCollection,type: this.options.type}), this.memberMenu = this.requestSubView(g, a).show(), this
            }, f.prototype.hideMemberMenu = function() {
                var a;
                return null != (a = this.memberMenu) && a.hide(), this
            }, f.prototype.refresh = function(a, b) {
                return this.involves = _.isArray(b) && b ? b : _.union(this.objectModel.get("involveMembers"), this.involves), this.render(), this
            }, f.prototype.ensurePermission = function(a, b) {
                var c, e;
                return c = d.call(this.involves, a) >= 0 ? "unselect" : "select", this.options.uneditable || a === (null != (e = this.objectModel) ? e.get("_executorId") : void 0) && d.call(this.objectModel.get("involveMembers"), a) >= 0 || "unselect" === c && this.options.undeletable && d.call(this.objectModel.get("involveMembers"), a) >= 0 ? !1 : ("function" == typeof b ? b(c) : void 0) || !0
            }, f.prototype.addMember = function(a) {
                return this.ensurePermission(a, function(b) {
                    return function() {
                        return b.addInvolve(a)
                    }
                }(this)), this
            }, f.prototype.removeMember = function(a) {
                return this.ensurePermission(a, function(b) {
                    return function() {
                        return b.removeInvolve(a)
                    }
                }(this)), this
            }, f.prototype.involveAll = function(a) {
                return this.involves = a, this.render(), this.objectModel.id || this.saveInvolve(), this
            }, f.prototype.addInvolve = function(a) {
                return this.involves = _.union(this.involves, [a]), this.render(), this.fadeInAvatar(a), this.objectModel.id || this.saveInvolve(), this
            }, f.prototype.removeInvolve = function(a) {
                return this.involves = _.without(this.involves, a), this.fadeOutAvatar(a), this.objectModel.id || this.saveInvolve(), this
            }, f.prototype.saveInvolve = function() {
                var a;
                if (this.objectModel && (a = this.involves.slice(), !_.isEqual(a, this.objectModel.get("involveMembers"))))
                    return this.objectModel.set({involveMembers: a}), this.objectModel.id && this.objectModel.save(null, {attrs: {involveMembers: a}}), this
            }, f.prototype.fadeInAvatar = function(a) {
                return this.$list.find(".involve-member[data-id=" + a + "]").transition({opacity: 0}, 0).transition({opacity: 1}), this
            }, f.prototype.fadeOutAvatar = function(a) {
                return this.$list.find(".involve-member[data-id=" + a + "]").transition({opacity: 0}, function() {
                    return $(this).remove()
                }), this
            }, f.prototype.initDroppable = function() {
                var a, b;
                return this.projectModel.hasRight() >= 0 ? (a = this.options.dropArea ? this.options.dropArea : this.$list, b = null, a.droppable({hoverClass: "hover",accept: ".member",drop: function(a) {
                    return function() {
                        return b ? (a.saveInvolve(), b = null) : void 0
                    }
                }(this),over: function(a) {
                    return function(c, d) {
                        return a.involves.indexOf(d.helper.data("id")) > -1 ? void 0 : (b = d.helper.data("id"), a.addMember(b))
                    }
                }(this),out: function(a) {
                    return function() {
                        return b ? (a.removeMember(b), b = null) : void 0
                    }
                }(this)}), this) : this
            }, f.prototype.quickRemoveMember = function(a) {
                var b;
                return this.projectModel.hasRight() >= 0 ? (b = $(a.currentTarget).parent().data("id"), this.removeMember(b), _.delay(function(a) {
                    return function() {
                        return a.saveInvolve()
                    }
                }(this), 100), this) : this
            }, f
        }(l)
    }), define("views/core/popover-confirm/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="popover-desc"> <p>' + a.description + '</p></div><div class="popover-button-group cleaxfix"> ';
            return a.cancelStr && (b += ' <div class="btn-wrap pull-left', a.confirmStr || (b += " full-width"), b += '"> <button class="popover-cancel-handler btn btn-default">' + a.cancelStr + "</button> </div> "), b += " ", a.confirmStr && (b += ' <div class="btn-wrap pull-left', a.cancelStr || (b += " full-width"), b += '"> <button class="popover-confirm-handler btn btn-primary">' + a.confirmStr + "</button> "), b += "</div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/core/popover-confirm/index", ["require", "exports", "module", "./templates/basic", "lib/popover/index"], function(a) {
        var c, d, e;
        return c = a("./templates/basic"), e = a("lib/popover/index"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "PopoverConfirmView", d.prototype.className = "popover-confirm-view", d.prototype.width = 300, d.prototype.events = {"click .popover-cancel-handler": "cancel","click .popover-confirm-handler": "confirm"}, d.prototype.render = function() {
                return this.$el.html(c({description: this.options.description,cancelStr: this.options.cancelStr,confirmStr: this.options.confirmStr})), this
            }, d.prototype.cancel = function() {
                var a;
                return null != (a = this.options) && a.onCancel(), this.hide()
            }, d.prototype.confirm = function() {
                var a;
                return null != (a = this.options) && a.onConfirm(), this.hide()
            }, d.prototype.hide = function() {
                return this.remove()
            }, d
        }(e)
    }), define("views/tag/tag-picker/templates/basic", [], function() {
        return function() {
            var a = '<div class="tag-picker-header"> <span>标签</span></div><ul class="tag-picker-list clearfix"> <li class="tag-picker-add"> <a class="add-tag-handler clearfix" data-gta="event" data-label="add tag"> <span class="icon icon-plus-sign hinted" data-title="添加标签"></span> </a> </li></ul>';
            return a
        }
    }), define("views/tag/tag-picker/templates/list", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.dataList;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="menu-item tag-item ', e.selected && (c += "selected"), c += '" data-id="' + e._id + '"> <a class="tag"> <span class="tag-label tag-label-' + e.color + '"></span> <span class="tag-name">' + b(e.title) + "</span> </a></li>";
            return c
        }
    }), define("views/tag/tag-picker/templates/placeholder", [], function() {
        return function() {
            var a = '<li class="tag-wrap"> <div class="tag-placeholder">暂无标签</div></li>';
            return a
        }
    }), define("views/tag/tag-picker/templates/tags", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.tags;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="tag-wrap ', a.hasRight >= 0 && (c += "removeable"), c += '" data-id="' + e._id + '"> <a class="tag label"> <span class="tag-label tag-label-' + e.color + '"></span> <span class="tag-name">' + b(e.name) + "</span> </a> ", a.hasRight >= 0 && (c += ' <a class="remove-tag-handler">&times;</a> '), c += "</li>";
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/tag/tag-picker/index", ["require", "exports", "module", "teambition", "view", "collections/projects", "collections/tags", "views/core/popover-menu/index", "./templates/basic", "./templates/list", "./templates/placeholder", "./templates/tags"], function(a) {
        var c, d, e, f, g, h, i, j, k, l;
        return l = a("teambition"), k = a("view"), g = a("collections/projects"), i = a("collections/tags"), f = a("views/core/popover-menu/index"), c = a("./templates/basic"), d = a("./templates/list"), e = a("./templates/placeholder"), j = a("./templates/tags"), h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "TagPickerView", h.prototype.className = "tag-picker-view", h.prototype.events = {"click .add-tag-handler": "openTagMenu","click .tag": "gotoTagView","click .remove-tag-handler": "quickRemoveTag"}, h.prototype.initialize = function(a) {
                return (null != a ? a.objectModel : void 0) && (null != a ? a._projectId : void 0) ? (this.options = a, this._projectId = a._projectId, this.projectModel = g.getOne(0, this._projectId), this.projectModel.hasRight() >= 0 || this.projectModel.get("isPublic") ? i.fetch(null != a ? a._projectId : void 0, {boundToObjectType: "project",success: function(b) {
                    return function(c) {
                        return b.objectModel = a.objectModel, b.tagsCollection = c, b.renderBasic().setTags().render().listen()
                    }
                }(this)}) : _.delay(function(a) {
                    return function() {
                        return a.$el.parent().addClass("hide")
                    }
                }(this)), this) : void 0
            }, h.prototype.listen = function() {
                return this.listenTo(this.objectModel, "change:tagIds", this.refresh), this.listenTo(this.tagsCollection, "change", this.render), this
            }, h.prototype.setTags = function() {
                var a;
                return this.tags = (null != (a = this.objectModel.get("tagIds")) ? a.slice() : void 0) || [], this
            }, h.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$list = this.$(".tag-picker-list"), this
            }, h.prototype.render = function() {
                var a, b, c, d, f, g, h;
                for (b = [], f = this.tags, c = 0, d = f.length; d > c; c++)
                    h = f[c], a = null != (g = this.tagsCollection.get(h)) ? g.toJSON() : void 0, (null != a ? a._id : void 0) && !a.isArchived && b.push(a);
                return this.$list.find(".tag-wrap").remove(), this.$list.prepend(j({tags: b,hasRight: this.projectModel.hasRight()})), this.projectModel.hasRight() < 0 && (this.$(".tag-picker-add").remove(), b.length || this.$list.html(e())), this
            }, h.prototype.openTagMenu = function() {
                var a, b;
                return null != (b = this.tagMenu) && b.remove(), a = _.extend({}, this.options, {fixed: this.$el.closest(".panel-view").length,$toggler: this.$(".add-tag-handler"),ListTemplate: d,multi: !0,selected: this.tags,addPlaceholder: "添加标签",select: function(a) {
                    return function(b) {
                        return a.setTag(b)
                    }
                }(this),unselect: function(a) {
                    return function(b) {
                        return a.removeTag(b)
                    }
                }(this),add: function(a) {
                    return function(b) {
                        return a.addTag(b)
                    }
                }(this),onHidden: function(a) {
                    return function() {
                        return a.saveTags()
                    }
                }(this),dataList: this.tagsCollection.map(function(a) {
                    return {_id: a.get("_id"),title: a.get("name"),color: a.get("color")}
                })}), this.tagMenu = this.requestSubView(f, a).show(), this
            }, h.prototype.hideTagMenu = function() {
                var a;
                return null != (a = this.tagMenu) && a.hide(), this
            }, h.prototype.refresh = function() {
                return this.setTags().render(), this
            }, h.prototype.addTag = function(a) {
                return this.tagsCollection.create({name: a,_projectId: this._projectId,color: "gray"}, {wait: !0,success: function(a) {
                    return function(b) {
                        return a.tags = _.union(a.tags, [b.id]), a.tagMenu.update(a.tagsCollection.map(function(a) {
                            return {_id: a.get("_id"),title: a.get("name"),color: a.get("color")}
                        }), a.tags.slice()), a.render(), a.fadeIn(b.id), a.objectModel.id ? void 0 : a.saveTags()
                    }
                }(this)}), this
            }, h.prototype.setTag = function(a) {
                return this.tags = _.union(this.tags, [a]), this.render(), this.fadeIn(a), this.objectModel.id || this.saveTags(), this
            }, h.prototype.removeTag = function(a) {
                return this.tags = _.without(this.tags, a), this.fadeOut(a), this.objectModel.id || this.saveTags(), this
            }, h.prototype.saveTags = function() {
                var a;
                if (this.objectModel && (a = this.tags.slice(), !_.isEqual(a, this.objectModel.get("tagIds"))))
                    return this.objectModel.set("tagIds", a), this.objectModel.id && this.objectModel.saveAttr("tagIds", a), this
            }, h.prototype.fadeIn = function(a) {
                return this.$list.find(".tag-wrap[data-id=" + a + "]").transition({opacity: 0}, 0).transition({opacity: 1}), this
            }, h.prototype.fadeOut = function(a) {
                return this.$list.find(".tag-wrap[data-id=" + a + "]").transition({opacity: 0}, function() {
                    return $(this).remove()
                }), this
            }, h.prototype.gotoTagView = function(a) {
                var b, c;
                return c = $(a.currentTarget).parent().data("id"), b = "/project/" + this._projectId + "/tags/tag/" + c, l.router.navigate(b, {trigger: !0}), this
            }, h.prototype.quickRemoveTag = function(a) {
                var b;
                return b = $(a.currentTarget).parent().data("id"), this.removeTag(b), _.delay(function(a) {
                    return function() {
                        return a.saveTags()
                    }
                }(this), 100), this
            }, h
        }(k)
    }), define("views/board/task/task-priority/templates/basic", [], function() {
        return function(a) {
            var b = "", c = a.priorityLabels;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += '<li class="', a.currentPriority === e && (b += "selected"), b += '" data-priority="' + e + '"> <a><span class="icon icon-circle-bold task-priority-' + e + '"></span> ' + d + " </a></li>";
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("lib/dropdown/index", ["require", "exports", "module", "util", "view"], function(a) {
        var c, d, e;
        return d = a("util"), e = a("view"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "DropdownView", c.prototype.tagName = "ul", c.prototype.setup = function(a, b) {
                return this.options = _.extend(this.options || {}, b || {}), this.$el.addClass("dropdown-menu"), this.$el.attr("role", "menu"), this.$opener = $(a), this.$opener.data("bs.dropdown") || (this.$opener.addClass("dropdown-toggle"), this.$opener.attr("data-toggle", "dropdown"), this.$el.insertAfter(this.$opener), this.dropdown = this.$opener.dropdown(b).data("bs.dropdown"), this.$opener.parent().on("shown.bs.dropdown", function(a) {
                    return function() {
                        return a.refreshPosition()
                    }
                }(this)), this.onOpen(), this.$opener.click(function(a) {
                    return function() {
                        return a.onOpen()
                    }
                }(this))), this
            }, c.prototype.onOpen = function() {
                return this.$el.on("mousewheel", d.mousewheel), this.$el.handleClickOutside(function(a) {
                    return function() {
                        return a.onClose()
                    }
                }(this)), this
            }, c.prototype.onClose = function() {
                var a, b;
                return null != (b = this.$el) && b.off("mousewheel"), "function" == typeof (a = this.options).close && a.close(), this
            }, c.prototype.hide = function() {
                return this.$el.parent().hasClass("open") && (this.dropdown.toggle(), this.onClose()), this
            }, c.prototype.refreshPosition = function() {
                var a, b, c, d, e, f, g, h, i;
                return b = /\s?auto\s?/i, c = (null != (i = this.options) ? i.direction : void 0) || "auto bottom", a = b.test(c), this.$el.parent().hasClass("open") && (this.$el.attr("style", ""), g = function(a) {
                    return function() {
                        return a.$el.css({top: "bottom" === c ? "100%" : "auto",bottom: "top" === c ? "100%" : "auto"})
                    }
                }(this), a && (c = c.replace(b, "") || "bottom"), g(), a) ? (d = document.documentElement.scrollTop || document.body.scrollTop, h = window.innerHeight, e = this.$el[0].offsetHeight, f = this.$el.offset(), f.top < d && "top" === c ? c = "bottom" : f.top + e > d + h && "bottom" === c && (c = "top"), g()) : void 0
            }, c
        }(e)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/task/task-priority/index", ["require", "exports", "module", "./templates/basic", "lib/dropdown/index"], function(a) {
        var c, d, e, f;
        return c = a("./templates/basic"), d = a("lib/dropdown/index"), e = ["普通", "紧急", "非常紧急"], f = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "TaskPriorityView", d.prototype.className = "task-priority-setter", d.prototype.events = {"click li": "setPriority"}, d.prototype.initialize = function(a) {
                return a ? (this.options = a, this.currentPriority = a.currentPriority || 0, this.render()) : void 0
            }, d.prototype.render = function() {
                return this.$el.html(c({priorityLabels: e,currentPriority: this.currentPriority})), this
            }, d.prototype.setPriority = function(a) {
                var b;
                return b = $(a.currentTarget), b.addClass("selected").siblings().removeClass("selected"), this.currentPriority = b.data("priority"), this.options.select(this.currentPriority), this
            }, d
        }(d)
    }), define("views/board/task/task-repeat/templates/basic", [], function() {
        return function(a) {
            var b = '<li class="';
            return "NO" == a.repeat && (b += "selected"), b += '" data-value="NO"><a>不重复</a></li><li class="', "DAILY" == a.repeat && (b += "selected"), b += '" data-value="DAILY"><a>每天重复</a></li><li class="', "WEEKLY" == a.repeat && (b += "selected"), b += '" data-value="WEEKLY"><a>每周重复</a></li><li class="', "WEEKLY2" == a.repeat && (b += "selected"), b += '" data-value="WEEKLY2"><a>每2周重复</a></li><li class="', "MONTHLY" == a.repeat && (b += "selected"), b += '" data-value="MONTHLY"><a>每月重复</a></li>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/task/task-repeat/index", ["require", "exports", "module", "./templates/basic", "lib/dropdown/index"], function(a) {
        var c, d, e;
        return c = a("./templates/basic"), d = a("lib/dropdown/index"), e = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "TaskRepeatView", d.prototype.className = "task-repeat-setter", d.prototype.events = {"click li": "setRepeat"}, d.prototype.initialize = function(a) {
                return a ? (this.options = a, this.repeatLabel = a.repeatLabel, this.render(), this) : void 0
            }, d.prototype.render = function() {
                return this.$el.html(c({repeat: this.repeatLabel})), this
            }, d.prototype.setRepeat = function(a) {
                var b, c;
                return b = $(a.currentTarget), b.addClass("selected").siblings().removeClass("selected"), this.repeatLabel = b.data("value"), "function" == typeof (c = this.options).select && c.select(this.repeatLabel), this
            }, d
        }(d)
    }), define("views/board/task/task-creator/templates/basic", [], function() {
        return function() {
            var a = '<textarea class="task-content-input form-control" placeholder="任务内容"></textarea><div class="handler-wrap"> <a class="executor-handler"> <span class="avatar img-circle img-24"></span> <span class="creator-handler-text name"></span> </a></div><div class="involve-wrap clearfix"></div><div class="handler-wrap more-handler-wrap"> <a class="more-handler"> <span class="icon icon-more"></span> <span class="creator-handler-text">更多</span> </a></div><div class="handler-wrap more-set"> <a class="duedate-handler"> <span class="icon icon-calendar-bold"></span> <span class="creator-handler-text due-text">选择截止日期</span> </a></div><div class="handler-wrap more-set"> <a class="priority-handler"> <span class="icon icon-circle-bold priority-label"></span> <span class="creator-handler-text priority-text">选择优先级</span> </a></div><div class="handler-wrap more-set"> <a class="repeat-handler"> <span class="icon icon-repeat"></span> <span class="creator-handler-text repeat-text">选择重复周期</span> </a></div><div class="tags-wrap clearfix more-set"></div><div class="submit-set clearfix"> <div class="btn-group dropup"> <button class="btn btn-default dropdown-toggle" data-toggle="dropdown"> <span class="visible-title">所有成员可见</span> <span class="icon icon-chevron-up"></span> </button> <ul class="dropdown-menu" role="menu"> <li><a class="visible-handler" data-type="members">所有成员可见</a></li> <li><a class="visible-handler" data-type="involves">仅参与者可见</a></li> </ul> </div> <button class="btn btn-primary submit-handler">创建</button></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/task/task-creator/index", ["require", "exports", "module", "teambition", "essage", "rrule", "store", "thenjs", "util", "view", "models/task", "collections/members", "collections/projects", "views/member/member-involve/index", "views/member/member-menu/index", "views/core/popover-confirm/index", "views/tag/tag-picker/index", "views/board/task/task-priority/index", "views/board/task/task-repeat/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x;
        return x = a("teambition"), f = a("essage"), m = a("rrule"), n = a("store"), t = a("thenjs"), u = a("util"), v = a("view"), q = a("models/task"), h = a("collections/members"), l = a("collections/projects"), i = a("views/member/member-involve/index"), j = a("views/member/member-menu/index"), k = a("views/core/popover-confirm/index"), o = a("views/tag/tag-picker/index"), r = a("views/board/task/task-priority/index"), s = a("views/board/task/task-repeat/index"), e = a("./templates/basic"), d = $(document), c = $("body"), w = null, g = "ZH", p = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "TaskCreatorView", c.prototype.tagName = "form", c.prototype.className = "task-creator fade", c.prototype.hotkeys = {esc: "remove"}, c.prototype.events = {"keydown .task-content-input": "quickSubmit","change .task-content-input": "cacheTask","click .submit-handler": "submit","click .visible-handler": "switchVisible","click .more-handler": "toggleMore"}, c.prototype.initialize = function(a) {
                return (null != w ? w.$el : void 0) && w.remove(), a._projectId || a._tasklistId || a._stageId || a.tasksCollection ? (w = this, this.options = a, this._projectId = a._projectId, this._tasklistId = a._tasklistId, this._stageId = a._stageId, this.projectModel = l.getOne(0, this._projectId), this.tasksCollection = a.tasksCollection, this.membersCollection = h.get(this._projectId), this.localCache = n.namespace("temp").namespace("tasks_board"), this.localCacheId = "" + a._projectId + "_" + x.user.id, this.render().reset().initExecutor().initDatePicker().initInvolve().initPriority().initRepeat().initTagPicker().renderDueDate().renderExecutor().renderPriority().renderRepeat().focus().cacheTask(), this.handleClickOutside(), this.switchVisible(this.$(".visible-handler[data-type=members]")), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this) : !1
            }, c.prototype.reset = function() {
                var a, b, c;
                return a = this.localCache(this.localCacheId) || {}, null == this._executorId && (this._executorId = a._executorId || x.user.id), this.taskModel ? (this.stopListening(this.taskModel), this.taskModel.set("content", ""), u.removeItem(this.taskModel.get("involveMembers"), a._executorId)) : this.taskModel = new q({_creatorId: x.user.id,_executorId: this._executorId,_projectId: this._projectId,_tasklistId: this._tasklistId,_stageId: this._stageId,priority: a.priority || 0,dueDate: a.dueDate || null,content: a.content || "",involveMembers: a.involveMembers || [x.user.id]}), this.rrule = new m({freq: m.WEEKLY,dtstart: new Date}), this.hasRecurrence = !1, null != (b = this.executorView) && b.hide(), null != (c = this.involveView) && c.hideMemberMenu(), this.$input.val(this.taskModel.get("content")), this.listenTo(this.taskModel, "change:_executorId", this.renderExecutor), this.listenTo(this.taskModel, "change:dueDate", this.renderDueDate), this.listenTo(this.taskModel, "change", this.cacheTask), this
            }, c.prototype.handleClickOutside = function() {
                return this.$el.handleClickOutside(function(a) {
                    return function() {
                        var b;
                        return (null != (b = a.$input) ? b.val().trim() : void 0) ? a.handleClickOutside() : a.remove()
                    }
                }(this), "click", ".member-menu-view, .popover-menu-view"), this
            }, c.prototype.render = function() {
                return this.$el.html(e()), this.$input = this.$(".task-content-input"), this.$executorHandler = this.$(".executor-handler"), this.$duedateHandler = this.$(".duedate-handler"), this.$submit = this.$(".submit-handler"), this.$visibleTitle = this.$(".visible-title"), this
            }, c.prototype.toggleMore = function() {
                return this.$el.toggleClass("show-more"), this
            }, c.prototype.focus = function() {
                return _.delay(function(a) {
                    return function() {
                        var b;
                        return null != (b = a.$input) ? b.focusAtEnd() : void 0
                    }
                }(this), 100), this
            }, c.prototype.initExecutor = function() {
                return this.executorView = this.requestSubView(j, {$toggler: this.$executorHandler,noAssign: !0,membersCollection: this.membersCollection,selected: [this._executorId],select: function(a) {
                    return function(b) {
                        var c;
                        return a._executorId = b, a.taskModel.set({_executorId: b}), c = a.taskModel.get("involveMembers"), b && a.taskModel.set("involveMembers", _.union(c, [b])), a.focus()
                    }
                }(this)}), this
            }, c.prototype.initDatePicker = function() {
                var a, b;
                return a = this.$(".duedate-handler"), b = !1, a.data("datepicker") || a.datepicker({format: "mm-dd-yyyy",placement: "bottom" === this.options.direction ? "left" : "top",language: "ZH" === g ? "zh-CN" : g.toLowerCase(),todayHighlight: !0,todayBtn: "linked",tomorrowBtn: "linked",somedayBtn: "linked"}).on("changeDate", function(b) {
                    return function(c) {
                        return b.$el ? (b.taskModel.set({dueDate: c.date}), a.datepicker("hide"), b.focus()) : void 0
                    }
                }(this)).on("click", function() {
                    return function() {
                        return b = !b, a.data("datepicker").picker.toggle(b)
                    }
                }(this)).on("hide", function() {
                    return function() {
                        return b = !1
                    }
                }(this)), this
            }, c.prototype.initInvolve = function() {
                return this.$(".involve-view").remove(), this.involveView = this.requestSubView(i, {_projectId: this._projectId,objectModel: this.taskModel,membersCollection: this.membersCollection,resident: [x.user.id]}), this.involveView.$el.prependTo(this.$(".involve-wrap")), this
            }, c.prototype.initTagPicker = function() {
                return this.$(".tag-picker-view").remove(), this.tagPickerView = this.requestSubView(o, {_projectId: this._projectId,objectModel: this.taskModel}), this.tagPickerView.$el.prependTo(this.$(".tags-wrap")), this
            }, c.prototype.initRepeat = function() {
                return this.requestSubView(s, {repeatLabel: u.freq2Label(this.hasRecurrence ? this.rrule : null).label,select: function(a) {
                    return function(b) {
                        var c;
                        return c = u.label2Freq(b), a.hasRecurrence = !!c, c && a.updateRecurrence(c), a.renderRepeat()
                    }
                }(this)}).setup(this.$(".repeat-handler")), this
            }, c.prototype.initPriority = function() {
                return this.requestSubView(r, {currentPriority: this.taskModel.get("priority"),select: function(a) {
                    return function(b) {
                        return a.taskModel.set({priority: b}), a.renderPriority()
                    }
                }(this)}).setup(this.$(".priority-handler")), this
            }, c.prototype.switchVisible = function(a) {
                var b;
                return b = a.currentTarget ? $(a.currentTarget) : a, b.parent().addClass("selected").siblings().removeClass("selected"), this.$visibleTitle.text(b.text()), this.taskModel.set("visiable", b.data("type")), this
            }, c.prototype.renderExecutor = function() {
                var a, b;
                return a = null != (b = this.membersCollection.get(this._executorId)) ? b.toJSON() : void 0, a || (a = {name: "待认领"}), a.avatarUrl ? this.$executorHandler.find(".avatar").css({"background-image": "url(" + a.avatarUrl + ")"}) : this.$executorHandler.find(".avatar").css({"background-image": ""}).addClass("no-avatar"), this.$executorHandler.find(".name").text("" + a.name + " 执行"), this
            }, c.prototype.renderDueDate = function() {
                var a, b;
                return a = this.taskModel.get("dueDate"), b = a ? u.formatDate(a).dateString : "选择截止日期", this.$(".due-text").text(b), this
            }, c.prototype.renderRepeat = function() {
                var a;
                return a = this.hasRecurrence ? u.freq2Label(this.rrule).string : "选择重复周期", this.$(".repeat-text").text(a), this
            }, c.prototype.renderPriority = function() {
                var a, b;
                return a = this.taskModel.get("priority"), b = a ? u.getPriorityDisplay(a) : "选择优先级", this.$(".priority-label").removeClass("task-priority-0 task-priority-1 task-priority-2").addClass("task-priority-" + a), this.$(".priority-text").text(b), this
            }, c.prototype.updateRecurrence = function(a) {
                return this.rrule = new m(_.extend(this.rrule.origOptions, a)), this
            }, c.prototype.quickSubmit = function(a) {
                return 13 === a.keyCode && (a.preventDefault(), this.submit()), this
            }, c.prototype.cacheTask = function() {
                var a;
                return a = this.taskModel.toJSON(), a.content = this.$input.val().trim(), this.localCache(this.localCacheId, a.content ? a : null), this
            }, c.prototype.submit = function(a) {
                var b, c;
                return null != a && a.preventDefault(), this.$submit.prop("disabled") ? void 0 : (b = this.$input.val().trim(), c = _.compact(b.split(/\r\n|\r|\n/)), c.length > 1 ? this.createMultipleTasks(c, b) : 1 === c.length ? this.createTask([b]) : this.focus(), this)
            }, c.prototype.createTask = function(a) {
                var b;
                return this.disableSubmit(!0), this.hasRecurrence && this.taskModel.set({recurrence: this.taskModel.genRecurrence(this.rrule)}), b = this.taskModel.toJSON(), t.eachSeries(a, function(a) {
                    return function(c, d) {
                        return b.content = d, a.tasksCollection.create(_.clone(b), {wait: !0,error: function(a, b) {
                            return c(b)
                        },success: function() {
                            return c()
                        }})
                    }
                }(this)).then(function(b) {
                    return function() {
                        return b.localCache.remove(b.localCacheId), b.reset(), b.disableSubmit(!1), b.focus(), x.gta.event(null, "click", "add tasks success", a.length)
                    }
                }(this)).fail(function(a) {
                    return function(b, c) {
                        return a.disableSubmit(!1), f.show({message: c,status: "error"}, 2e3)
                    }
                }(this))
            }, c.prototype.createMultipleTasks = function(a, b) {
                var c;
                return c = 20, a.length > c ? this.requestSubView(k, {$toggler: this.$submit,title: "内容行数太多了",description: "内容最多为 " + c + " 行，你当前输入了 " + a.length + " 行。",cancelStr: "好吧，我知道了",onCancel: function(a) {
                    return function() {
                        return a.focus()
                    }
                }(this)}).show() : this.requestSubView(k, {$toggler: this.$submit,title: "创建多条任务",description: "系统检测到你输入了 " + a.length + " 行内容，你是想创建多条任务吗？",cancelStr: "创建一条",confirmStr: "创建 " + a.length + " 条",onCancel: function(a) {
                    return function() {
                        return a.createTask([b])
                    }
                }(this),onConfirm: function(b) {
                    return function() {
                        return b.createTask(a)
                    }
                }(this)}).show()
            }, c.prototype.disableSubmit = function(a) {
                return this.$submit.prop("disabled", a), this.$submit[a ? "addClass" : "removeClass"]("disabled"), this
            }, c.prototype.remove = function() {
                var a;
                return "function" == typeof (a = this.options).beforeClose && a.beforeClose(), c.__super__.remove.apply(this, arguments)
            }, c
        }(v)
    }), define("views/board/task/task/templates/card-basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="task-priority task-priority-' + a.priority + '"> <div class="task-priority-hint"></div></div>';
            if (a.hasRight > 0 ? c += " <div class=\"check-box\" data-gta='event' data-label='task|check task'> <span class=\"icon icon-tick\"></span> </div>" : (c += ' <div class="check-box non-checkable hinted" data-title="', a.executorData && (c += "由执行者" + a.executorData.name + "设置任务是否完成"), c += '"> <span class="icon icon-tick"></span> </div>'), c += '<div class="task-content-set open-detail" data-type="task" data-id="' + a._id + "\" data-gta='event' data-label='open task detail'> ", a.executorData && (c += " ", c += a.executorData.avatarUrl ? ' <div class="avatar img-circle img-24" style="background-image:url(' + a.executorData.avatarUrl + ')"></div> ' : ' <div class="avatar img-circle img-24 no-avatar"></div> ', c += " "), c += ' <div class="task-content-wrapper"> <div class="task-content">' + b(a.content) + "</div> ", "involves" == a.visiable && (c += ' <span class="icon icon-lock2 hinted" data-title="仅参与者可见"></span> '), c += " </div> ", a.tags.length || a.accomplished || a.dueDate || a.freqString || a.subtaskCount && a.subtaskCount.total || a.commentsCount || a.attachmentsCount || a.objectlinksCount || a.likesCount || a.tasklist && a.tasklist.title) {
                c += ' <div class="task-info-wrapper clearfix"> ', a.isDone && a.accomplished ? c += ' <span class="label label-inverse"> <span class="icon icon-calendar-bold"></span> ' + a.accomplished.dateString + " </span> " : (c += " ", a.freqString && (c += ' <span class="label label-info"><span class="icon icon-repeat-bold"></span> ' + a.freqString + " </span> "), c += " ", a.dueDate && a.dueDate.dateClass && (c += ' <span class="label ', "overdue" === a.dueDate.dateClass ? c += "label-important" : "today" === a.dueDate.dateClass ? c += "label-warning" : "upcoming" === a.dueDate.dateClass && (c += "label-info"), c += '"> <span class="icon icon-calendar-bold ', "normal" !== a.dueDate.dateClass && (c += "icon-white"), c += '"></span> ' + a.dueDate.dateString + " </span> "), c += " ", a.subtaskCount && a.subtaskCount.total && (c += ' <span class="label"><span class="icon icon-sub-task"></span> ' + a.subtaskCount.done + "/" + a.subtaskCount.total + " </span> "), c += " ", a.commentsCount && (c += ' <span class="label"><span class="icon ', c += a.commentsCount > 10 ? "icon-comments" : "icon-comment", c += '"></span> </span> '), c += " ", a.attachmentsCount && (c += ' <span class="label"><span class="icon icon-paperclip"></span> </span> '), c += " ", a.objectlinksCount && (c += ' <span class="label"><span class="icon icon-link2"></span> </span> '), c += " ", a.likesCount && (c += ' <span class="label"><span class="icon icon-heart"></span> ' + a.likesCount + " </span> "), c += " "), c += " ";
                var d = a.tags;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; )
                        e = d[f += 1], c += ' <span class="label tag"> <span class="tag-label tag-label-' + e.color + '"></span> <span class="tag-name">' + b(e.name) + "</span> </span> ";
                c += " </div> "
            }
            return c += "</div>"
        }
    }), define("views/board/task/task/templates/list-basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="task-priority task-priority-' + a.priority + '"> <div class="task-priority-hint"></div></div>';
            if (a.hasRight > 0 ? c += " <div class=\"check-box\" data-gta='event' data-label='task|check task'> <span class=\"icon icon-tick\"></span> </div>" : (c += ' <div class="check-box non-checkable hinted" data-title="', a.executorData && (c += "由执行者" + a.executorData.name + "设置任务是否完成"), c += '"> <span class="icon icon-tick"></span> </div>'), c += '<div class="task-content-set" data-id="' + a._id + "\" data-gta='event' data-label='task|open task detail'> ", a.executorData && (c += " ", c += a.executorData.avatarUrl ? ' <div class="avatar img-circle img-24" style="background-image:url(' + a.executorData.avatarUrl + ')"></div> ' : ' <div class="avatar img-circle img-24 no-avatar"></div> ', c += " "), c += ' <div class="task-content-wrapper', (a.isDone || a.dueDate) && (c += " shorten"), c += '"> <div class="task-content"> ' + b(a.content) + " ", a.tasklist && a.tasklist.title && a.tasklist._id && (c += ' <a class="task-tag" data-tag="tasklist" data-gta="event" data-label="task|go to tasks"> #' + b(a.tasklist.title) + " </a> "), c += " ", a.tags && a.tags.length) {
                c += " ";
                var d = a.tags;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; )
                        e = d[f += 1], c += ' <span class="label tag"> <span class="tag-label tag-label-' + e.color + '"></span> <span class="tag-name">' + b(e.name) + "</span> </span> ";
                c += " "
            }
            return c += " </div> ", !a.isDone && a.dueDate ? (c += ' <time class="task-duedate label ', "overdue" === a.dueDate.dateClass ? c += "label-important" : "today" === a.dueDate.dateClass ? c += "label-warning" : "upcoming" === a.dueDate.dateClass && (c += "label-info"), c += '"> <span class="icon icon-calendar-bold ', "normal" !== a.dueDate.dateClass && (c += "icon-white"), c += '"></span> ' + a.dueDate.dateString + " </time> ") : a.isDone && a.accomplished && (c += ' <time class="task-accomplished-date"> ' + a.accomplished.dateString + " </time> "), c += " </div></div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/task/task/index", ["require", "exports", "module", "teambition", "rrule", "util", "view", "collections/members", "collections/tags", "views/board/task/task-priority/index", "./templates/card-basic", "./templates/list-basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l;
        return l = a("teambition"), f = a("rrule"), j = a("util"), k = a("view"), e = a("collections/members"), g = a("collections/tags"), h = a("views/board/task/task-priority/index"), c = a("./templates/card-basic"), d = a("./templates/list-basic"), i = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "TaskView", f.prototype.tagName = "li", f.prototype.className = "task", f.prototype.events = {"click .check-box": "toggleTaskStatus","click .task-priority-hint": "openTaskPrioritySetter","click .task-tag": "onClickTaskTag"}, f.prototype.initialize = function(a) {
                return (null != a ? a.model : void 0) ? (this.options = a, this.taskModel = a.model, this.tagsCollection = g.get(this.taskModel.get("_projectId")), this.render().initDropHandler().listen(), this.taskModel.hasRight() >= 0 || this.$el.addClass("no-right"), this) : void 0
            }, f.prototype.listen = function() {
                return this.listenTo(this.taskModel, "remove destroy", this.remove), this.listenTo(this.taskModel, "change", this.render), this
            }, f.prototype.render = function() {
                var a, b, f, g;
                return a = this.taskModel.toJSON(), this.options.noExecutor || (a.executorData = a.executor || (null != (f = e.findOne(a._projectId, a._executorId)) ? f.toJSON() : void 0) || {}), a.content = j.escape(_.unescape(a.content)), a.dueDate && (a.dueDate = j.formatDate(a.dueDate)), a.accomplished && (a.accomplished = j.formatDate(a.accomplished)), (null != (g = a.subtaskCount) ? g.total : void 0) <= 0 && (a.subtaskCount = null), a.commentsCount > 99 && (a.commentsCount = "99+"), a.likesCount > 999 && (a.likesCount = "999+"), a.hidePriority = !!this.options.hidePriority, a.priority = a.priority || 0, a.hasRight = this.taskModel.hasRight(), a.hasRight < 1 && a._executorId === l.user.id && (a.hasRight = 1), this.$el.toggleClass("done", this.taskModel.get("isDone")), this.$el.attr("data-id", this.taskModel.id), (b = this.taskModel.getRRule()) && (a.freqString = j.freq2Label(b).string), "list" === this.options.viewType ? this.$el.html(d(a)) : (a.tags = this.tagsCollection.getTagsbyIds(a.tagIds), this.$el.html(c(a))), this
            }, f.prototype.renderExecutor = function(a) {
                var b, c;
                return c = this.taskModel.get("_projectId"), a || (a = this.taskModel.get("_executorId")), b = e.getOne(c, a), this.$(".avatar").css({"background-image": "url(" + b.get("avatarUrl") + ")"}), this
            }, f.prototype.toggleTaskStatus = function() {
                return this.taskModel.hasEditRight() && (this.$el.hasClass("done") ? (this.$el.removeClass("done"), this.taskModel.markUndo()) : (this.$el.addClass("done"), this.taskModel.markDone())), l.gta.event(null, "click", "task|check task"), !1
            }, f.prototype.popOutAvatar = function() {
                return _.delay(function(a) {
                    return function() {
                        return a.$(".avatar").addClass("pop-out")
                    }
                }(this)), this
            }, f.prototype.popBackAvatar = function() {
                return _.delay(function(a) {
                    return function() {
                        return a.$(".avatar").removeClass("pop-out")
                    }
                }(this)), this
            }, f.prototype.initDropHandler = function() {
                var a;
                return this.taskModel.hasRight() >= 0 ? (a = null, this.$el.droppable({hoverClass: "hover",accept: ".member",addClasses: !1,tolerance: "pointer",drop: function(b) {
                    return function() {
                        var c, d;
                        if (b.taskModel.get("isDone"))
                            return !1;
                        if (a) {
                            c = {_executorId: a}, b.taskModel.save(c, {attrs: c}), b.popBackAvatar(), a = null;
                            try {
                                return l.gta.event(null, "drop", "task card|drop member")
                            } catch (e) {
                                d = e
                            }
                        }
                    }
                }(this),over: function(b) {
                    return function(c, d) {
                        return b.taskModel.get("isDone") ? !1 : b.taskModel.get("_executorId") === d.helper.data("id") ? !1 : (b.popOutAvatar(), a = d.helper.data("id"), b.renderExecutor(a))
                    }
                }(this),out: function(b) {
                    return function() {
                        return a && (b.renderExecutor(), a = null), b.popBackAvatar()
                    }
                }(this)}), this) : this
            }, f.prototype.openTaskPrioritySetter = function(a) {
                return this.taskModel.hasRight() >= 0 ? (this.requestSubView(h, {currentPriority: this.taskModel.get("priority"),select: function(a) {
                    return function(b) {
                        return a.taskModel.save(null, {attrs: {priority: b}})
                    }
                }(this)}).setup($(a.currentTarget)), this) : this
            }, f.prototype.onClickTaskTag = function(a) {
                var b, c, d;
                switch (a.stopPropagation(), b = $(a.currentTarget).data("tag"), c = this.taskModel.get("_projectId"), b) {
                    case "project":
                        l.router.navigate("project/" + c + "/tasks", {trigger: !0});
                        break;
                    case "tasklist":
                        d = this.taskModel.get("_tasklistId"), l.gta.event(null, "click", "go to tasks"), l.router.navigate("project/" + c + "/tasks/scrum/" + d, {trigger: !0})
                }
                return this
            }, f
        }(k)
    }), define("views/board/stage/stage/templates/basic", [], function() {
        return function(a) {
            var b = '<header class="scrum-stage-header"></header><div class="scrum-stage-wrap hidden-creator"> <section class="scrum-stage-content thin-scroll"> <ul class="scrum-stage-tasks"></ul> <div class="task-creator-wrap" data-stage="' + a._id + '"></div> <ul class="scrum-stage-tasks-done"></ul> ';
            return a.hasRight >= 0 && (b += ' <div class="task-creator-handler-wrap"> <a class="task-creator-handler link-add-handler" data-gta="event" data-label="add task"> <span class="icon icon-plus-sign"></span>添加任务 </a> </div> '), b += " </section></div>"
        }
    }), define("views/board/stage/stage/templates/header", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="stage-name"> <span class="icon icon-tick"></span>' + b(a.name) + " ";
            return a.totalCount && (c += ' <span class="task-count"> · ' + a.totalCount + "</span> "), c += ' <span class="icon icon-chevron-right"></span></div>', a.hasRight >= 0 && (c += '<a class="stage-menu-toggler icon icon-chevron-down hinted', 1 == a.index && (c += ' guide-handler" data-guide="tasksStage'), c += '" data-title="添加或编辑任务阶段" data-gta="event" data-label="show stage menu"></a>'), c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/stage/stage/index", ["require", "exports", "module", "teambition", "lib/guide-point/index", "lib/scrollable", "view", "collections/projects", "collections/tasks", "views/board/stage/stage-menu/index", "views/board/task/task-creator/index", "views/board/task/task/index", "./templates/basic", "./templates/header"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n;
        return n = a("teambition"), d = a("lib/guide-point/index"), g = a("lib/scrollable"), m = a("view"), f = a("collections/projects"), l = a("collections/tasks"), h = a("views/board/stage/stage-menu/index"), j = a("views/board/task/task-creator/index"), k = a("views/board/task/task/index"), c = a("./templates/basic"), e = a("./templates/header"), i = function(a) {
            function g() {
                return g.__super__.constructor.apply(this, arguments)
            }
            return b(g, a), g.prototype.viewName = "StageView", g.prototype.className = "scrum-stage toggler-parent", g.prototype.tagName = "li", g.prototype.events = {"click .stage-menu-toggler": "toggleStageMenu","click .task-content-set": "openTaskDetail","click .task-creator-handler": "openTaskCreator"}, g.prototype.initialize = function(a) {
                return a._projectId || a._tasklistId || a.stageModel ? (this.options = a, this._projectId = a._projectId, this._tasklistId = a.tasklistModel.id, this.projectModel = f.getOne(0, this._projectId), this.tasklistModel = a.tasklistModel, this.stageModel = a.stageModel, this.stages = a.stageModel.collection, this.renderBasic(), this.showLoadingIndicator(this.$content), l.fetch(this.stageModel.id, {attrs: {all: !0,isDone: !1},success: function(b) {
                    return function(c) {
                        return b.tasksCollection = c, b.tasksCollection.updateSort(n.PREFERENCE.tasksSortInStage(b.stageModel.id)), b.renderHeader().renderTasks().listen(), d.initialize(b), b.setupTaskSortable(), b.setupScroll(b.$content), b.registerAsResponsive(), b.setupLoadMore(10), b.tasksCollection.fetch({silent: !0,remove: !1,attrs: {isDone: !0},success: function(c, d) {
                            return b.$el ? (b.hideLoadingIndicator({animated: !1}), _.each(d, function(a) {
                                return b.renderTask(b.tasksCollection.get(a._id))
                            }), b.tasksCollection.get(a._taskId) && b.openTaskDetail(a._taskId), b.layout()) : void 0
                        }})
                    }
                }(this)}), this) : !1
            }, g.prototype.listen = function() {
                return this.stopListening(), this.listenTo(this.tasksCollection, "add", this.checkAddTask), this.listenTo(this.tasksCollection, "remove", this.checkRemoveTask), this.listenTo(this.tasksCollection, "change:_stageId", function(a) {
                    return function(b, c) {
                        return c !== a.stageModel.id ? a.tasksCollection.remove(b) : void 0
                    }
                }(this)), this.listenTo(this.tasksCollection, "change:isDone", function(a) {
                    return function(b) {
                        return b.get("_stageId") !== a.stageModel.id ? a.tasksCollection.remove(b) : a.checkTaskDone(b)
                    }
                }(this)), this.listenTo(this.tasksCollection, "add remove change", this.checkLayout), this.listenTo(this.stageModel, "change", this.renderHeader), this.listenTo(this.stageModel, "destroy", this.remove), this.listenTo(this.stageModel, "change:isLocked", function(a) {
                    return function(b, c) {
                        return a.$el[c ? "addClass" : "removeClass"]("locked-stage"), a.$el.closest(".board-scrum-content")[c ? "addClass" : "removeClass"]("workflow-mode")
                    }
                }(this)), _.delay(function(a) {
                    return function() {
                        return a.listenTo(a.parentView, "filtering", function(b) {
                            return a.renderHeader(b), a.checkLayout()
                        })
                    }
                }(this)), this
            }, g.prototype.layout = function() {
                return this.$content ? (this.distance = this.$content[0].scrollHeight - this.$content[0].offsetHeight, this.$el[this.distance > 0 ? "addClass" : "removeClass"]("fixed-creator"), this) : void 0
            }, g.prototype.loadMore = function(a) {
                var b;
                return null != (b = this.tasksCollection) && b.loadMore({silent: !0,attrs: {isDone: !0},beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$content)
                    }
                }(this),success: function(b) {
                    return function(c, d) {
                        var e;
                        if (b.$el)
                            return b.hideLoadingIndicator({animated: !0}), _.each(d, function(a) {
                                return b.renderTask(b.tasksCollection.get(a._id))
                            }), "function" == typeof (e = b.options).loadMore && e.loadMore(), b.tasksCollection.hasMore ? "function" == typeof a ? a() : void 0 : b.showEndPoint(b.$content)
                    }
                }(this)}), this
            }, g.prototype.renderBasic = function() {
                var a;
                return a = this.stageModel.toJSON(), a.isLast = this.stageModel.isLast(), a.hasRight = this.projectModel.hasRight(), this.$el.html(c(a)), this.$el.attr("data-id", this.stageModel.id), this.$wrap = this.$el.find(".scrum-stage-wrap"), this.$header = this.$el.find(".scrum-stage-header"), this.$content = this.$el.find(".scrum-stage-content"), this.$tasks = this.$el.find(".scrum-stage-tasks"), this.$tasksDone = this.$el.find(".scrum-stage-tasks-done"), this.$creatorWrap = this.$(".task-creator-wrap"), this.stageModel.get("isLocked") && _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("locked-stage"), a.$el.closest(".board-scrum-content").addClass("workflow-mode")
                    }
                }(this), 100), this
            }, g.prototype.renderHeader = function(a) {
                var b;
                return b = this.stageModel.toJSON(), b.index = this.stageModel.collection.indexOf(this.stageModel), a && (b.totalCount = this.$("li.task").filter(function() {
                    return $(this).isVisible()
                }).length), b.hasRight = this.projectModel.hasRight(), this.$header.html(e(b)), this
            }, g.prototype.renderTasks = function() {
                return this.tasksCollection.each(function(a) {
                    return function(b) {
                        return a.renderTask(b)
                    }
                }(this)), this
            }, g.prototype.renderTask = function(a, b) {
                var c, d, e, f;
                return f = this.$content.find(".task[data-id=" + a.id + "]"), d = a.get("isDone"), e = b ? "prependTo" : "appendTo", c = this.requestSubView(k, {model: a,viewType: "scrum"}).$el, c.data("model", a), f.length && d !== !!f.closest(".scrum-stage-tasks-done").length && (f.remove(), f = null), (null != f ? f.length : void 0) ? f.replaceWith(c) : c[e](d ? this.$tasksDone : this.$tasks), c
            }, g.prototype.setupTaskSortable = function() {
                var a, b, c;
                return this.projectModel.hasRight() >= 0 ? (a = null, c = null, b = function(b) {
                    return function(c) {
                        var d;
                        if (a || (a = b.$el.closest(".board-scrum-stages")[0]), a && c[0]) {
                            if (d = c[0].getBoundingClientRect(), d.left < 30) {
                                if (a.scrollLeft < 5)
                                    return;
                                return a.scrollLeft -= 15
                            }
                            if (d.right + 30 > a.offsetWidth) {
                                if (a.scrollLeft + a.offsetWidth > a.scrollWidth - 5)
                                    return;
                                return a.scrollLeft += 15
                            }
                        }
                    }
                }(this), this.$content.sortable({items: ".task",connectWith: ".scrum-stage-content",helper: "clone",placeholder: "scrum-drag-placeholder",tolerance: "pointer",zIndex: 2001,scroll: !0,scrollSensitivity: 30,start: function() {
                    return function(a, b) {
                        return c = b.item.data("model"), b.placeholder.height(b.helper.height())
                    }
                }(this),sort: function() {
                    return function(a, d) {
                        var e;
                        if (b(d.helper), e = d.placeholder.parent(), null != c ? c.get("isDone") : void 0) {
                            if (!e.hasClass("scrum-stage-tasks-done"))
                                return d.placeholder.prependTo(e.parent().find(".scrum-stage-tasks-done"))
                        } else if (!e.hasClass("scrum-stage-tasks"))
                            return d.placeholder.appendTo(e.parent().find(".scrum-stage-tasks"))
                    }
                }(this),receive: function(a) {
                    return function(b, d) {
                        var e;
                        return c = d.item.data("model"), (null != c ? c.hasEditRight() : void 0) ? c.get("isDone") && c.get("_stageId") === a.stageModel.id ? !1 : (e = {_stageId: a.stageModel.id}, _.delay(function() {
                            var b;
                            return b = a.$content.find(".task[data-id=" + c.id + "]"), b.replaceWith(b.clone()), c.save(e, {attrs: e})
                        })) : (Essage.show({message: "您不能修改这项任务",status: "error"}, 2e3), !1)
                    }
                }(this),update: function(a) {
                    return function(b, d) {
                        var e;
                        return c = d.item.data("model"), (null != c ? c.hasEditRight() : void 0) ? c.get("isDone") && c.get("_stageId") === a.stageModel.id ? !1 : (e = a.$tasks.find(".task").map(function(a, b) {
                            return $(b).data("id")
                        }).toArray(), n.PREFERENCE.tasksSortInStage(a.stageModel.id, e)) : !1
                    }
                }(this)}), this) : this
            }, g.prototype.openTaskCreator = function() {
                return this.projectModel.hasRight() < 0 || this.stageModel.get("isLocked") ? this : (this.requestSubView(j, {_projectId: this._projectId,_tasklistId: this._tasklistId,_stageId: this.stageModel.id,tasksCollection: this.tasksCollection,beforeClose: function(a) {
                    return function() {
                        return a.$wrap.addClass("hidden-creator"), _.delay(function() {
                            return a.layout()
                        }, 10)
                    }
                }(this)}).$el.appendTo(this.$creatorWrap), this.$wrap.removeClass("hidden-creator"), _.delay(function(a) {
                    return function() {
                        return a.slideTo(a.$creatorWrap)
                    }
                }(this)), this)
            }, g.prototype.checkAddTask = function(a) {
                return this.renderTask(a, a.get("isDone")), this.stageModel.set("totalCount", this.stageModel.get("totalCount") + 1), this
            }, g.prototype.checkRemoveTask = function() {
                var a;
                return a = Math.max(this.stageModel.get("totalCount") - 1, this.tasksCollection.length), this.stageModel.set("totalCount", a), this
            }, g.prototype.checkTaskDone = function(a) {
                var b;
                return b = this.$content.find(".task[data-id=" + a.id + "]"), a.get("isDone") ? b.prependTo(this.$tasksDone) : b.appendTo(this.$tasks), this
            }, g.prototype.checkLayout = function() {
                return _.delay(function(a) {
                    return function() {
                        return a.layout()
                    }
                }(this)), this
            }, g.prototype.toggleStageMenu = function(a) {
                var b;
                return this.projectModel.hasRight() >= 0 ? (0 === (null != (b = this.stageMenuView) ? b.$toggler.closest("body").length : void 0) && (this.stageMenuView.remove(), this.stageMenuView = null), this.stageMenuView || (this.stageMenuView = this.requestSubView(h, {$toggler: $(a.currentTarget),_projectId: this._projectId,stageModel: this.stageModel,tasksCollection: this.tasksCollection,tasklistModel: this.tasklistModel}).show()), this) : this
            }, g.prototype.openTaskDetail = function(a) {
                var b, c;
                return c = a.target ? $(a.target).closest(".task").data("id") : a, b = this.tasksCollection.get(c), n.APP.currentView.renderTaskDetail(b), n.APP.currentView.updateUrl({_taskId: c,_tasklistId: b.get("_tasklistId")}, {trigger: !1,replace: !a.target}), this
            }, g.prototype.scrollToBottom = function() {
                return _.delay(function(a) {
                    return function() {
                        return a.slideTo()
                    }
                }(this)), this
            }, g
        }(m), _.extend(i.prototype, g), i
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("lib/panel/index", ["require", "exports", "module", "teambition", "util", "view"], function(a) {
        var c, d, e, f, g, h, i, j;
        return j = a("teambition"), g = a("util"), h = a("view"), d = $(document), c = $("body"), i = function() {
            return "full" === j.PREFERENCE.get("memberBarMode")
        }, e = function(a) {
            return "<div class='panel-layer panel-layer-" + a.depth + "'\n     data-depth='" + a.depth + "'></div>"
        }, f = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "PanelView", c.prototype.className = "panel-view", c.prototype.panelWidth = 580, c.prototype.isIn = !1, c.prototype.$layers = [], c.prototype.useTransformAnimation = !0, c.prototype.appendTo = "body", c.prototype.direction = "right-to-left", c.prototype.excludeSelectors = [".delete-handler", ".datepicker", ".popover", ".activity-destroyer", ".subtask-check-box", ".check-box", ".modal", ".pen-menu", "#atwho-container"], c.prototype.isSame = function() {
                return !0
            }, c.prototype.initialize = function(a) {
                return this.options = _.extend({holdon: !1,shown: function(a) {
                    return function() {
                        return a
                    }
                }(this),hidden: function(a) {
                    return function() {
                        return a
                    }
                }(this),entered: function(a) {
                    return function() {
                        return a
                    }
                }(this),backed: function(a) {
                    return function() {
                        return a
                    }
                }(this)}, a), this.$el.width(this.panelWidth), this
            }, c.prototype.getHiddenStatus = function() {
                return _.isNumber(this.rightOffset) ? {right: this.rightOffset - this.panelWidth} : i() ? {right: 200 - this.panelWidth} : {right: 60 - this.panelWidth}
            }, c.prototype.getShownStatus = function() {
                return _.isNumber(this.rightOffset) ? {right: this.rightOffset} : i() ? {right: 200} : {right: 60}
            }, c.prototype.renderLayer = function() {
                var a, b, c, d, f, g;
                return 2 !== arguments.length && "object" != typeof arguments[1] ? !1 : (this.options.holdon ? a = $(e({depth: 0})).appendTo(this.$el) : (a = $(e({depth: this.$layers.length + 1})).appendTo(this.$el), this.$layers.push(a)), arguments[0].prototype.viewName ? (d = arguments[0], b = arguments[1], f = _.extend({inPanel: !0,success: function(b) {
                    return function(c) {
                        var d, e, f, g;
                        return c.activityTimelineView && c.$activityCreator ? (d = c.$activityCreator, d.addClass("scrollable").appendTo(b.$el), e = .5 * a.height(), f = !0, g = function(c) {
                            return b.$el ? a.css("bottom", c) : void 0
                        }, c.activityTimelineView.renderCreator(d, e), d.find(".flex-text-wrap").css("max-height", e), d.on("slideHide.activity", function() {
                            return g(0)
                        }).on("slideShow.activity changeHeight.activity", function(a, b) {
                            return g(b - 1)
                        }).slideShow()) : void 0
                    }
                }(this)}, b), c = this.requestSubView(d, f), c.$el.appendTo(a)) : (g = arguments[0], g.apply(this, [a])), a)
            }, c.prototype.show = function(a) {
                var b, c, d;
                return this.isIn ? this : (this.isIn = !0, c = this.getHiddenStatus(), d = this.getShownStatus(), this.$el.css(c).appendTo(this.appendTo), this.renderLayer(this.defaultLayer, this.options), this.useTransformAnimation && (null != d.right ? (d.x = c.right - d.right, delete d.right) : null != d.left && (d.x = d.left - c.left, delete d.left)), b = this.options.holdon ? 0 : 400, this.$el.transition(d, b, "ease", function(b) {
                    return function() {
                        return b.options.holdon || b.$el.handleClickOutside(function() {
                            return b.hide()
                        }, "click.panel", b.excludeSelectors.join(",")), b.options.shown(), "function" == typeof a ? a() : void 0
                    }
                }(this)), this)
            }, c.prototype.hide = function(a) {
                var b, c;
                if (this.$el)
                    return b = this.getHiddenStatus(), c = this.getShownStatus(), this.useTransformAnimation && (b.x = 0), null == b.opacity && (b.opacity = 0), this.$el.transition(b, 300, "ease", function(b) {
                        return function() {
                            if (b.$el) {
                                if (b.isIn = !1, !b.options.holdon)
                                    for (; b.$layers.length > 0; )
                                        b.$layers.pop().remove();
                                return b.options.hidden(), b.remove(), "function" == typeof a ? a() : void 0
                            }
                        }
                    }(this)), this
            }, c.prototype.enter = function(a, b) {
                var c, d, e;
                return e = _.last(this.subViews), "function" == typeof e.undelegateEvents && e.undelegateEvents(), d = _.last(this.$layers), c = this.renderLayer(a, b), d.transition({x: -30,opacity: 0}, 300, "ease"), c.css({right: -this.panelWidth}).transition({x: -this.panelWidth}, 400, "ease", function(a) {
                    return function() {
                        return a.options.entered(), "function" == typeof b.entered ? b.entered() : void 0
                    }
                }(this)), this
            }, c.prototype.back = function(a) {
                var b, c;
                return this.$layers.length <= 1 ? this.hide(a) : (b = this.$layers.pop(), c = _.last(this.$layers), b.transition({x: 0}, 300, "ease"), c.transition({x: 0,opacity: 1}, 400, "ease", function(c) {
                    return function() {
                        var d;
                        return b.remove(), c.subViews.pop().remove(), d = _.last(c.subViews), null != d && "function" == typeof d.delegateEvents && d.delegateEvents(), c.options.backed(), "function" == typeof a ? a() : void 0
                    }
                }(this))), this
            }, c
        }(h)
    }), define("views/board/tasklist/tasklist-creator/templates/basic", [], function() {
        return function() {
            var a = '<ul class="nav nav-tabs"> <li class="active"> <a class="tab-handler" data-id="#tasklist-create-new" data-gta="event" data-label="create tasklist-new">新建</a> </li> <li> <a class="tab-handler" data-id="#tasklist-create-temps" data-gta="event" data-label="create tasklist-template">模板</a> </li></ul><form class="tasklist-create-form"> <div class="tab-content"> <div class="tab-pane active" id="tasklist-create-new"> <div class="tasklist-create-new"> <input class="form-control" type="text" data-gta="event" data-label="enter tasklist title" placeholder="任务分组名称"/> <textarea class="form-control" data-gta="event" data-label="enter tasklist description" placeholder="任务分组描述"></textarea> </div> </div> <div class="tab-pane" id="tasklist-create-temps"> <ul class="tasklist-create-temps list"></ul> </div> </div> <div class="submit-button-wrapper"> <button class="submit-button btn btn-primary" type="submit">创建</button> </div></form>';
            return a
        }
    }), define("views/board/tasklist/tasklist-creator/templates/templates", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.templates;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; ) {
                    e = d[f += 1], c += '<li class="temp-handler ', a._selectId == e._id && (c += "active"), c += '" data-id="' + e._id + '"> <div class="temp-icon ' + e["class"] + ' pull-left"></div> <span class="icon icon-tick temp-selected pull-right"></span> ', "tasklist_custom" == e["class"] && (c += ' <a class="icon icon-remove temp-delete pull-right"></a> '), c += ' <div class="temp-info"> <strong class="temp-title">' + b(e.title) + '</strong> <div class="temp-stages"> <span class="stage-name">' + b(e.stages[0]) + "</span> ";
                    var h = e.stages.slice(1);
                    if (h)
                        for (var i, j = -1, k = h.length - 1; k > j; )
                            i = h[j += 1], c += ' <span class="stage-name">&gt; ' + b(i) + "</span> ";
                    c += " </div> </div></li>"
                }
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/tasklist/tasklist-creator/index", ["require", "exports", "module", "./templates/basic", "collections/stage-templates", "./templates/templates", "view"], function(a) {
        var c, d, e, f, g, h;
        return c = a("./templates/basic"), d = a("collections/stage-templates"), f = a("./templates/templates"), g = a("view"), h = [{_id: "tasklist0",title: "设计","class": "tasklist_design",stages: ["策划", "原型图", "效果图", "审核中", "完成"]}, {_id: "tasklist1",title: "研发","class": "tasklist_develope",stages: ["需求点", "设计中", "研发中", "测试中", "已发布"]}, {_id: "tasklist2",title: "用户支持","class": "tasklist_support",stages: ["用户问题", "解决中", "已解决", "反馈用户&问题解决"]}], e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "TasklistCreatorView", e.prototype.className = "tasklist-creator", e.prototype.options = {title: "创建任务分组"}, e.prototype.events = {"submit .tasklist-create-form": "submitCreateForm","click .tab-handler": "switchTabs","click .temp-handler": "getCreateTemp","click .temp-delete": "deleteTemp"}, e.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) && a.tasklistsCollection ? (this.options = a, this.renderBasic().focus(), d.fetch(0, {success: function(a) {
                    return function(b) {
                        return a.stageTemplatesCollection = b, b.add(h), a._selectId = b.at(0).id, a.renderTemplates().listen()
                    }
                }(this)}), this) : !1
            }, e.prototype.listen = function() {
                return this.listenTo(this.stageTemplatesCollection, "add", this.renderTemplates), this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$temps = this.$(".tasklist-create-temps"), this
            }, e.prototype.renderTemplates = function() {
                return this.stageTemplatesCollection.sort(), this.$temps.html(f({templates: this.stageTemplatesCollection.toJSON(),_selectId: this._selectId})), this
            }, e.prototype.focus = function() {
                return this.$("input").focusAtEnd(), this
            }, e.prototype.switchTabs = function(a) {
                var b;
                return b = $(a.currentTarget), b.parent().hasClass("active") || (this.$(".tab-pane.active, .nav >li.active").removeClass("active"), b.parent().addClass("active"), this.$("" + b.data("id")).addClass("active")), this
            }, e.prototype.getCreateTemp = function(a) {
                var b;
                return b = $(a.currentTarget), b.hasClass("active") || (this.$(".temp-handler.active").removeClass("active"), b.addClass("active"), this._selectId = b.data("id")), this
            }, e.prototype.deleteTemp = function(a) {
                var b, c;
                return a.preventDefault(), b = $(a.currentTarget).parent(), c = b.data("id"), this.$(".temp-handler[data-id=" + c + "]").remove(), this.stageTemplatesCollection.get(c).destroy(), this
            }, e.prototype.submitCreateForm = function(a) {
                var b, c, d, e, f;
                return a.preventDefault(), b = $(a.currentTarget), "tasklist-create-new" === this.$(".tab-pane.active").attr("id") ? (f = b.find("input").val(), c = b.find("textarea").val()) : (d = this.stageTemplatesCollection.get(this._selectId), f = d.get("title"), c = f, e = d.get("stages")), f = f.trim(), f ? this.options.tasklistsCollection.create({title: f,description: c || "",_projectId: this.options._projectId,stages: e || []}, {wait: !0,success: function(a) {
                    return function(c) {
                        var d;
                        return b.find("input").val(""), b.find("textarea").val(""), "function" == typeof (d = a.options).success ? d.success(c) : void 0
                    }
                }(this)}) : this.focus(), this
            }, e
        }(g)
    }), define("views/board/tasklist/tasklist-tab/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<h4 class="tasklist-title"> <strong>' + b(a.title) + '</strong><span class="muted"> · ' + (a.doneCount || 0) + "/" + (a.totalCount || 0) + '</span></h4><p class="tasklist-description muted">' + b(a.description) + "</p>";
            return a.totalCount > 0 && (c += ' <div class="tasklist-strip-wrap" style="width:' + a.tasksPercent + '%"> <div class="tasklist-strip"> <div class="strip-part done-part hinted" style="width:' + a.doneCount / a.totalCount * 100 + '%;" data-title="已完成 ' + a.doneCount + '"> <div class="strip-part-bar"></div> </div> <div class="strip-part undone-part hinted" style="width:' + (a.undoneCount - a.recentCount - a.expiredCount) / a.totalCount * 100 + '%;" data-title="近期任务 ' + (a.undoneCount - a.recentCount - a.expiredCount) + '"> <div class="strip-part-bar"></div> </div> <div class="strip-part recent-part hinted" style="width:' + a.recentCount / a.totalCount * 100 + '%;" data-title="将到期 ' + a.recentCount + '"> <div class="strip-part-bar"></div> </div> <div class="strip-part expire-part hinted" style="width:' + a.expiredCount / a.totalCount * 100 + '%;" data-title="已逾期 ' + a.expiredCount + '"> <div class="strip-part-bar"></div> </div> </div> </div>'), c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/tasklist/tasklist-tab/index", ["require", "exports", "module", "./templates/basic", "view"], function(a) {
        var c, d, e, f;
        return c = a("./templates/basic"), f = a("view"), d = "change:title\nchange:description\nchange:totalCount\nchange:undoneCount\nchange:recentCount\nchange:expiredCount\nchange:doneCount", e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "tasklistTab", e.prototype.tagName = "li", e.prototype.className = "tasklist-tab", e.prototype.initialize = function(a) {
                return (null != a ? a.tasklistModel : void 0) ? (this.options = a, this._projectId = a.tasklistModel.get("_projectId"), this.tasklistModel = a.tasklistModel, this.tasklistsCollection = a.tasklistsCollection, this.renderBasic().listen(), this) : !1
            }, e.prototype.listen = function() {
                return this.listenTo(this.tasklistModel, d, this.renderBasic), this.listenTo(this.tasklistModel, "destroy remove", this.remove), this
            }, e.prototype.renderBasic = function() {
                var a;
                return a = this.tasklistModel.toJSON(), a.tasksPercent = this.tasklistsCollection.getTasksPercent(a.totalCount), this.$el.attr("data-id", this.tasklistModel.id), this.$el.html(c(a)), this.$el.attr({"data-gta": "event","data-label": "switch task group"}), this
            }, e
        }(f)
    }), define("views/board/tasklist/tasklist-bar/templates/basic", [], function() {
        return function(a) {
            var b = '<section class="tasklist-bar-content thin-scroll"> <div class="tasklist-bar-header clearfix"> ';
            return b += a.hasRight >= 0 ? ' <a class="tasklist-creator-toggler" data-gta="event" data-label="create tasklist"> <strong>任务分组</strong> <span class="icon icon-plus pull-right"></span> </a> ' : ' <div class="tasklist-creator-toggler"> <strong>任务分组</strong> </div> ', b += ' <a class="tasklist-bar-pin ', a.pinTasklistBar && (b += "pin"), b += '" data-gta="event" data-label="pin task group menu"> <span class="icon icon-pin hinted" data-title="', b += a.pinTasklistBar ? " 取消固定任务分组栏 " : " 固定任务分组栏 ", b += '"></span> </a> </div> <div class="tasklist-creator-wrap"></div> <ul class="tasklist-bar-tasklists"></ul> <ul class="tasklist-smart-group"> <li class="smart-group"> <p class="tasklist-smart-title">智能分组</p> </li> <li class="smart-group"> <a class="tasklist-smart-today" data-gta="event" data-label="smart group today">今天的任务</a> </li> <li class="smart-group"> <a class="tasklist-smart-total" data-gta="event" data-label="smart group total">未完成的任务</a> </li> <li class="smart-group"> <a class="tasklist-smart-done" data-gta="event" data-label="smart group done">已完成的任务</a> </li> <li class="smart-group"> <a class="tasklist-smart-member" data-gta="event" data-label="smart group member">成员的任务 <span class="caret"></span> </a> </li> </ul></section>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/tasklist/tasklist-bar/index", ["require", "exports", "module", "teambition", "util", "collections/members", "collections/projects", "views/member/member-menu/index", "lib/panel/index", "views/board/tasklist/tasklist-creator/index", "views/board/tasklist/tasklist-tab/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l;
        return l = a("teambition"), k = a("util"), d = a("collections/members"), g = a("collections/projects"), e = a("views/member/member-menu/index"), f = a("lib/panel/index"), i = a("views/board/tasklist/tasklist-creator/index"), j = a("views/board/tasklist/tasklist-tab/index"), c = a("./templates/basic"), h = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "tasklistBar", f.prototype.className = "tasklist-bar hack-render-bug", f.prototype.appendTo = ".board-scrum-view", f.prototype.panelWidth = 300, f.prototype.useTransformAnimation = !0, f.prototype.events = {"click .tasklist-creator-toggler": "toggleTasklistCreator","click .tasklist-bar-pin": "pinTasklistBar"}, f.prototype.initialize = function(a) {
                return (null != a ? a.tasklistsCollection : void 0) && (null != a ? a._projectId : void 0) && (null != a ? a._tasklistId : void 0) ? (this.options = a, this.isTasklistBar = !0, this._projectId = a._projectId, this.projectModel = g.getOne(0, this._projectId), this._tasklistId = a._tasklistId, this.tasklistsCollection = a.tasklistsCollection, this.membersCollection = d.get(this._projectId), f.__super__.initialize.apply(this, arguments)) : !1
            }, f.prototype.isSame = function(a) {
                return a.isTasklistBar === this.isTasklistBar
            }, f.prototype.getHiddenStatus = function() {
                return {left: -this.panelWidth}
            }, f.prototype.getShownStatus = function() {
                return {left: 0}
            }, f.prototype.defaultLayer = function(a) {
                return this.renderBasic(a).renderTasklistCreator().renderTasklists().renderMemberMenu().listen(), this
            }, f.prototype.listen = function() {
                return this.listenTo(this.tasklistsCollection, "add", this.renderTasklists), this
            }, f.prototype.renderBasic = function(a) {
                return a.html(c({hasRight: this.projectModel.hasRight(),pinTasklistBar: l.PREFERENCE.toggleTasklistBar()})), this.$content = this.$(".tasklist-bar-content"), this.$tasklists = this.$(".tasklist-bar-tasklists"), this.$tasklistCreator = this.$(".tasklist-creator-wrap"), this.$tasklistSmartMember = this.$(".tasklist-smart-member"), this
            }, f.prototype.renderTasklists = function() {
                return this.$tasklists.empty(), this.tasklistsCollection.updateSort(l.PREFERENCE.tasklistSortInProject(this._projectId), !0), this.tasklistsCollection.each(function(a) {
                    return function(b) {
                        return a.renderTasklist(b)
                    }
                }(this)), this.setupSortable(), this
            }, f.prototype.renderTasklist = function(a) {
                return this.requestSubView(j, {tasklistModel: a,tasklistsCollection: this.tasklistsCollection}).$el.appendTo(this.$tasklists), this
            }, f.prototype.renderTasklistCreator = function() {
                return this.projectModel.hasRight() >= 0 ? (this.tasklistCreator = this.requestSubView(i, {_projectId: this._projectId,tasklistsCollection: this.tasklistsCollection,success: function(a) {
                    return function(b) {
                        return _.delay(function() {
                            return a.$el ? (a.$content.removeClass("creator-on"), a.$("[data-id=" + b.id + "]").trigger("click")) : void 0
                        }, 100)
                    }
                }(this)}), this.tasklistCreator.$el.appendTo(this.$tasklistCreator), this) : this
            }, f.prototype.renderMemberMenu = function() {
                return this.requestSubView(e, {$toggler: this.$tasklistSmartMember,multi: !1,select: function(a) {
                    return function(b) {
                        return a.$tasklistSmartMember.trigger("selectMember", [b])
                    }
                }(this),membersCollection: this.membersCollection}), this
            }, f.prototype.toggleTasklistCreator = function() {
                return this.projectModel.hasRight() >= 0 ? (this.$content.toggleClass("creator-on"), this.$content.hasClass("creator-on") ? this.$(".tasklist-create-new input").focusAtEnd() : void 0) : this
            }, f.prototype.pinTasklistBar = function(a) {
                var b;
                return b = !l.PREFERENCE.toggleTasklistBar(), l.PREFERENCE.toggleTasklistBar(b), $(a.currentTarget)[b ? "addClass" : "removeClass"]("pin"), b || this.hide(), this
            }, f.prototype.setupSortable = function() {
                return this.projectModel.hasRight() >= 0 ? (this.$tasklists.disableSelection(), this.$tasklists.sortable({axis: "y",items: ".tasklist-tab",stop: function(a) {
                    return function(b) {
                        var c, d;
                        return c = $(b.target), d = c.sortable("toArray", {attribute: "data-id"}), l.PREFERENCE.tasklistSortInProject(a._projectId, d)
                    }
                }(this)}), this) : this
            }, f
        }(f)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/subtask", ["require", "exports", "module", "model", "lib/socket"], function(a) {
        var c, d, e;
        return c = a("model"), d = a("lib/socket"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "subtask", c.prototype.urlRoot = "subtasks", c.prototype.defaults = {isDone: !1,content: ""}, c.prototype.transform = function(a) {
                return a || (a = {}), a.url = "" + this.url() + "/transform", a.success = function(a) {
                    return function(b) {
                        var c;
                        return null != (c = a.collection) && c.remove(a), d.trigger(":new:tasks/" + b._stageId, b)
                    }
                }(this), this.sync("update", this, a)
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/subtasks", ["require", "exports", "module", "collection", "lib/socket", "models/subtask"], function(a) {
        var c, d, e, f;
        return c = a("collection"), d = a("lib/socket"), f = a("models/subtask"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "subtasks", c.prototype.model = f, c.prototype.boundToObjectType = "task", c.prototype.orderBy = "earliest-created", c.prototype.initialize = function() {
                return this.on("add destroy remove change:isDone", function() {
                    return d.trigger(":change:task/" + this._boundToObjectId, {subtaskCount: {total: this.length,done: this.getDoneSubTaskCount()}})
                }), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.getDoneSubTaskCount = function() {
                return this.where({isDone: !0}).length
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/collection", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return d = a("model"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "collection", c.prototype.urlRoot = "collections", c.prototype.defaults = {objectType: "collection",_projectId: "",_creatorId: "",_teamId: "",created: "",updated: "",title: "",color: "inverse",description: "",workCount: 0,collectionType: "",involveMembers: [],recentWorks: []}, c.prototype.parse = function(a) {
                return a = _.extend(this.toJSON(), a), "default" === a.collectionType && (a.title = "讨论的附件"), "root" === a.collectionType && (a.title = "文件库"), a.subCount = a.workCount + (a.collectionCount || 0), a
            }, c.prototype.getParent = function(a) {
                var b;
                return b = this.get("_parentId"), b || b !== this.get("_projectId") ? c.fetch(b, {success: a,error: function() {
                    return function() {
                        return a(null)
                    }
                }(this)}) : a(null)
            }, c.prototype.moveToCollection = function(a, b) {
                var c;
                return c = this.collection, this.save(null, {attrs: {_parentId: a._boundToObjectId},beforeSend: function() {
                    return function() {
                        return null != b && "function" == typeof b.beforeSend ? b.beforeSend() : void 0
                    }
                }(this),success: function(d) {
                    return function() {
                        return null != c && c.remove(d), a.add(d), null != b && "function" == typeof b.success ? b.success() : void 0
                    }
                }(this),error: function() {
                    return function() {
                        return null != b && "function" == typeof b.error ? b.error() : void 0
                    }
                }(this)})
            }, c
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/work", ["require", "exports", "module", "models/collection", "model", "util", "lib/socket"], function(a) {
        var c, d, e, f, g;
        return c = a("models/collection"), d = a("model"), f = a("util"), e = a("lib/socket"), g = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.name = "work", d.prototype.urlRoot = "works", d.prototype.defaults = {objectType: "work",activitiesCount: 0,description: "",involveMembers: []}, d.prototype.parse = function(a) {
                return a = _.extend(this.toJSON(), a), a.fileSize || (a.fileSize = a.size), a.thumbnail || (a.thumbnail = a.thumbnailUrl), a.thumbnailUrl || (a.thumbnailUrl = a.thumbnail), a.fileName = f.escape(a.fileName), delete a.size, delete a.code, delete a.message, a
            }, d.prototype.moveToCollection = function(a, b) {
                var c;
                return c = this.get("_parentId"), this.save(null, {attrs: {_parentId: a._boundToObjectId},beforeSend: function() {
                    return function() {
                        return null != b && "function" == typeof b.beforeSend ? b.beforeSend() : void 0
                    }
                }(this),success: function(d) {
                    return function() {
                        return e.trigger(":change:collection/" + c + "/work", d.toJSON()), a.add(d), null != b && "function" == typeof b.success ? b.success() : void 0
                    }
                }(this),error: function() {
                    return function() {
                        return null != b && "function" == typeof b.error ? b.error() : void 0
                    }
                }(this)})
            }, d.prototype.getParent = function(a) {
                var b;
                return b = this.get("_parentId"), b ? c.fetch(b, {success: a,error: function() {
                    return function() {
                        return a(null)
                    }
                }(this)}) : a(null)
            }, d
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/activity", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return d = a("model"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "activity", c.prototype.urlRoot = "activities", c.prototype.defaults = {objectType: "activitiy",action: "",_boundToObjectId: "",boundToObjectType: "",_creatorId: "",created: "",updated: "",content: "",attachments: [],involveMembers: []}, c
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/activities", ["require", "exports", "module", "models/activity", "collection"], function(a) {
        var c, d, e;
        return d = a("models/activity"), e = a("collection"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "activities", c.prototype.model = d, c.prototype.comparator = function(a) {
                return new Date(a.get("created")).getTime()
            }, c.prototype.getParams = function(a) {
                var b;
                return "read" === a ? b = {boundToObjectType: this.boundToObjectType,_boundToObjectId: this._boundToObjectId} : void 0
            }, c
        }(e)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/objectlink", ["require", "exports", "module", "model", "models/task"], function(a) {
        var c, d, e;
        return c = a("model"), e = a("models/task"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "objectlink", c.prototype.urlRoot = "objectlinks", c.prototype.initialize = function() {
                return _.delay(function(a) {
                    return function() {
                        var b;
                        if ("task" === a.get("linkedType") && (b = e.find(a.get("_linkedId"))))
                            return a.stopListening(b), a.listenTo(b, "change:isDone", function(b, c) {
                                return a.set("isDone", c)
                            })
                    }
                }(this)), c.__super__.initialize.apply(this, arguments)
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/objectlinks", ["require", "exports", "module", "collection", "models/objectlink"], function(a) {
        var c, d, e;
        return c = a("collection"), d = a("models/objectlink"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "objectlinks", c.prototype.model = d, c.prototype.orderBy = "latest-updated", c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/works", ["require", "exports", "module", "collection", "lib/socket", "models/work"], function(a) {
        var c, d, e, f;
        return c = a("collection"), d = a("lib/socket"), f = a("models/work"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "works", c.prototype.boundToObjectType = "parent", c.prototype.model = f, c.prototype.pageNum = 20, c.prototype.orderBy = "latest-updated", c.prototype.initialize = function(a, b) {
                return _.delay(function(a) {
                    return function() {
                        return d.on(":change:collection/" + a._boundToObjectId + "/work", function(c) {
                            return b.isRemoveAfterMove !== !1 && c._parentId !== a._boundToObjectId ? a.remove(c) : void 0
                        })
                    }
                }(this)), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.sync = function(a, b, d) {
                var e;
                switch (a) {
                    case "create":
                        d.remove = !1, e = d.success || function() {
                        }, d.success = function(a) {
                            return function(b) {
                                var d, f, g;
                                return _.each(b, function(b) {
                                    var c;
                                    return c = a.findWhere(b.fileKey ? {fileKey: b.fileKey} : {downloadUrl: b.downloadUrl}), c && !c.get("_id") ? c.set("_id", b._id) : void 0
                                }), d = null != (f = b[0]) ? f._parentId : void 0, d && d !== a._boundToObjectId ? null != (g = c.find(d)) && g.add(b, {remove: !1}) : a.set(b, {remove: !1}), e(b)
                            }
                        }(this)
                }
                return c.__super__.sync.apply(this, arguments)
            }, c.prototype.addWorks = function(a, b) {
                var c;
                return b || (b = {}), c = [], _.each(a, function(a) {
                    return function(d) {
                        return a.get(d._id) ? void 0 : (d._parentId = b._parentId || a._boundToObjectId, c.push(d))
                    }
                }(this)), c.length ? (b.attrs = {works: c}, b.attrs._parentId = b._parentId || this._boundToObjectId, b.attrs._projectId = b._projectId || a[0]._projectId, this.sync("create", this, b)) : "function" == typeof b.success ? b.success(a) : void 0
            }, c.prototype.getUploadingCount = function() {
                return this.where({completed: !1}).length
            }, c.prototype.getSelected = function() {
                return this.where({_selected_: !0})
            }, c
        }(c)
    }), define("lib/at/templates/basic", [], function() {
        return function() {
            var a = '<ul class="at-list list-unstyled thin-scroll"></ul>';
            return a
        }
    }), define("lib/at/templates/item", [], function() {
        return function(a) {
            var b = '<li class="at-item" data-id="' + a._id + '" data-gta="event" data-label="at item"> <a> ';
            return a.avatarUrl && (b += ' <div class="avatar img-circle" style="background-image:url(' + a.avatarUrl + ');"></div> '), b += " " + a.name + " </a></li>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("lib/at/index", ["require", "exports", "module", "caretjs", "underscore", "./templates/basic", "./templates/item", "lib/popover/index", "lib/scrollable", "util", "view"], function(a) {
        var c, e, f, g, h, i, j, k, l, m;
        return l = a("caretjs"), m = a("underscore"), e = a("./templates/basic"), f = a("./templates/item"), h = a("lib/popover/index"), i = a("lib/scrollable"), j = a("util"), k = a("view"), g = {DOWN: 40,UP: 38,ESC: 27,TAB: 9,ENTER: 13}, c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "AtView", c.prototype.className = "at-view", c.prototype.popoverTitle = "Menu", c.prototype.width = 200, c.prototype.events = {"click .at-item": "select","mouseenter .at-item": "activate",mousewheel: j.mousewheel}, c.prototype.initialize = function(a) {
                if (!((null != a ? a.$inputor : void 0) && a.dataList))
                    throw new Error("options should have $inputor and datas");
                return a = _.extend({at: "@"}, a, {trigger: "manual",$toggler: a.$inputor}), this.options = a, this.$inputor = a.$inputor, this.dataList = a.dataList, this.listen(), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.listen = function() {
                return this.$inputor.on("keydown.atView", function(a) {
                    return function(b) {
                        return a.onKeydown(b)
                    }
                }(this)), this.$inputor.on("keyup.atView", function(a) {
                    return function(b) {
                        return a.filter(b)
                    }
                }(this)), this.$inputor.on("blur.atView", function(a) {
                    return function(b) {
                        return _.delay(function() {
                            return a.hide(b)
                        }, 300)
                    }
                }(this)), this
            }, c.prototype.render = function() {
                return this.$el.html(e()), this.$list = this.$(".at-list"), this.renderItems(), this.setupScroll(this.$list), this
            }, c.prototype.renderItems = function() {
                return _.each(this.dataList, function(a) {
                    return function(b) {
                        return a.renderItem(b)
                    }
                }(this)), this
            }, c.prototype.renderItem = function(a) {
                var b;
                return b = this.options.ItemTemplate || f, this.$list.append(b(a)), this
            }, c.prototype.filter = function() {
                var a, b;
                return a = this.filterDataList(), a.length ? (this.isShowing || this.show(), b = _.map(a, "_id"), this.$list.children().each(function() {
                    var a, c;
                    return a = $(this), c = a.data("id"), d.call(b, c) >= 0 ? a.show() : a.hide()
                }), this.rePosition(), this.activateFirst(), this.slideTo(this.$(".at-item.active")), this) : this.hide()
            }, c.prototype.filterDataList = function() {
                var a, b;
                return b = this.getQuery(), "" === b ? this.dataList : b ? (a = function(a) {
                    return function(c, d, e) {
                        var f, g, h;
                        if (a.options.filter)
                            return a.options.filter(c, b);
                        for (e = [], e.push(c.name.toLowerCase()), e.push(c.pinyin.toLowerCase()), e.push(c.py.toLowerCase()), g = 0, h = e.length; h > g; g++)
                            if (f = e[g], f.indexOf(b) >= 0)
                                return !0;
                        return !1
                    }
                }(this), _.filter(this.dataList, a)) : []
            }, c.prototype.activateFirst = function() {
                var a;
                return a = this.$(".at-item:visible"), a.filter(".active").length || (this.$(".at-item.active").removeClass("active"), a.first().addClass("active")), this
            }, c.prototype.getRegExp = function(a, b) {
                var c;
                return null == a && (a = this.options.at), null == b && (b = !0), a = a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&"), b && (a = "(?:^|\\s)" + a), c = new RegExp("" + a + "([A-Za-zÀ-ÿ0-9_+-]*)$|" + a + "([^\\x00-\\xff]*)$", "gi")
            }, c.prototype.getQuery = function() {
                var a, b;
                return a = this.$inputor.val(), b = this.getRegExp().exec(a), b ? b[2] || b[1] : null
            }, c.prototype.onKeydown = function(a) {
                if (this.isShowing) {
                    switch (a.keyCode) {
                        case g.UP:
                            a.preventDefault(), this["switch"]("up");
                            break;
                        case g.DOWN:
                            a.preventDefault(), this["switch"]("down");
                            break;
                        case g.ESC:
                            a.preventDefault(), this.hide(a);
                            break;
                        case g.TAB:
                        case g.ENTER:
                            a.preventDefault(), a.stopPropagation(), this.select();
                            break;
                        default:
                            $.noop()
                    }
                    return this
                }
            }, c.prototype.onShown = function() {
                return this.isShowing = !0, c.__super__.onShown.apply(this, arguments)
            }, c.prototype.onHidden = function() {
                return this.isShowing = !1, c.__super__.onHidden.apply(this, arguments)
            }, c.prototype.select = function(a) {
                var b, c, d, e;
                return b = $(null != a ? a.currentTarget : void 0), b.length || (b = this.$(".at-item.active")), d = b.data("id"), d && (c = _.find(this.dataList, function(a) {
                    return a._id === d
                })) && (this.insert(d, c, b), "function" == typeof (e = this.options).select && e.select(d, c, b), this.hide(), this.$inputor.focusAtEnd()), this
            }, c.prototype.insert = function(a, b) {
                var c, d;
                return b ? (c = this.$inputor.val(), d = c.replace(this.getRegExp(), " @" + b.name + " ").trimLeft(), this.$inputor.val(d), this.$inputor.is(":focus") || this.$inputor.focus(), this.$inputor.change(), this) : this
            }, c.prototype.activate = function(a) {
                var b;
                return b = $(a.currentTarget), b.length && !b.hasClass("active") ? (b.addClass("active").siblings().removeClass("active"), this) : void 0
            }, c.prototype["switch"] = function(a) {
                var b, c, d, e, f, g;
                return f = (new Date).getTime(), f - this.lastSwitchTime < 100 ? void 0 : (this.lastSwitchTime = f, d = this.$(".at-item:visible"), b = d.filter(".active"), e = d.index(b), "down" === a ? (g = e + 1, g >= d.length && (g = 0)) : (g = e - 1, 0 > g && (g = d.length - 1)), c = d.eq(g), d.removeClass("active"), c.addClass("active"), this.slideTo(c), this)
            }, c.prototype.rePosition = function() {
                var a, b, c, d, e, f;
                if ((null != (f = this.$popover) ? f.hasClass("in") : 0) && this.$popover.parent()[0] === document.body)
                    return b = this.$inputor.val().length, c = this.getQuery(), null !== c && (b = b - c.length - 1), d = this.$inputor.caret("offset", b), a = 20, d.top = d.top + this.$popover.height() - $(window).scrollTop() + a > $(window).height() ? d.top - this.$popover.height() : d.top + d.height, d.left + this.$popover.width() + a > $(window).width() && (d.left = d.left - this.$popover.width()), this.$popover.offset({left: d.left,top: d.top}), this.options.fixed ? (e = this.$popover[0].getBoundingClientRect(), this.$popover.css({position: "fixed",top: e.top,left: e.left})) : void 0
            }, c.prototype.remove = function() {
                return this.$inputor.off("keydown.atView").off("keyup.atView").off("blur.atView"), c.__super__.remove.apply(this, arguments)
            }, c
        }(h), _.extend(c.prototype, i), c
    }), define("views/library/works-picker/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="list works-picker"> <li> <a class="uploader-handler" data-gta="event" data-label="Choose file from computer"> <span class="icon icon-upload"></span>直接上传 </a> </li> <li class="list-divider"></li> <li> <a class="library-picker-handler" data-gta="event" data-label="Choose file from library"> <span class="icon icon-folder-bold"></span>从文件库选择 </a> </li> ';
            return a.dropbox && (b += ' <li> <a class="dropbox-picker-handler" data-gta="event" data-label="Choose file from dropbox"> <span class="icon icon-dropbox"></span>从Dropbox选择 </a> </li> '), b += ' <li class="list-divider"></li> <li class="remote-input-wrap"> <input type="text" placeholder="粘贴下载链接..." class="form-control pull-left"/> <span class="btn btn-default remote-picker-handler pull-right">添加</span> </li></ul>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/collections", ["require", "exports", "module", "collection", "models/collection"], function(a) {
        var c, d, e;
        return c = a("collection"), e = a("models/collection"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.model = e, c.prototype.boundToObjectType = "parent", c.prototype.name = "collections", c.prototype.orderBy = "latest-updated", c.prototype.getColor = function() {
                var a;
                return a = ["orange", "blue", "inverse", "red", "green"], a[parseInt(4 * Math.random())]
            }, c.prototype.getSelected = function() {
                return this.where({_selected_: !0})
            }, c.prototype.getDefault = function() {
                return this.find(function() {
                    return function(a) {
                        return "default" === a.get("collectionType")
                    }
                }(this))
            }, c
        }(c)
    }), define("views/library/collection-picker/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="modal-content"> <div class="modal-header"> <h4 class="modal-title">' + a.title + '</h4> </div> <div class="modal-body"> <ul class="picker-column horizontal-scroll"></ul> </div> <div class="modal-footer"> <button class="cancel-handler btn btn-link">取消</button> <button class="confirm-handler btn btn-primary" disabled="';
            return b += (a.selected, "false"), b += '">确定</button> </div></div>'
        }
    }), define("views/library/collection-picker/templates/column", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="column thin-scroll" data-id="' + a._id + '"> <ul class="column-wrap"> ';
            a.folders.length && (c += ' <li class="group-name"> <p>文件夹</p> </li> '), c += " ";
            var d = a.folders;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <li class="picker-handler clearfix collection hinted ', e._id == a.selectedId && (c += "selected"), c += " ", e.disabled && (c += "disabled"), c += '" data-title="' + e.title + '" data-id="' + e._id + '"> <span class="icon icon-folder-bold collection-thumbnail ' + e.color + ' pull-left"></span> <span class="collection-title">' + b(e.title) + "</span> </li> ";
            c += " ", a.files.length && (c += ' <li class="group-name"> <p>文件</p> </li> '), c += " ";
            var h = a.files;
            if (h)
                for (var e, i = -1, j = h.length - 1; j > i; )
                    e = h[i += 1], c += ' <li class="picker-handler clearfix work hinted ', e._id == a.selectedId && (c += "selected"), c += " ", e.disabled && (c += "disabled"), c += '" data-title="' + e.fileName + '" data-id="' + e._id + '"> ', c += e.thumbnail ? ' <div class="work-thumbnail pull-left" style="background-image: url(' + e.thumbnail + ');"> </div> ' : ' <div class="work-thumbnail ' + e.fileType + ' pull-left">' + e.fileType + "</div> ", c += ' <span class="work-title">' + b(e.fileName) + "</span> </li> ";
            return c += " </ul></li>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/library/collection-picker/index", ["require", "exports", "module", "thenjs", "util", "view", "models/collection", "collections/collections", "collections/projects", "collections/works", "./templates/basic", "./templates/column", "essage"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n;
        return j = a("thenjs"), k = a("util"), l = a("view"), e = a("models/collection"), g = a("collections/collections"), i = a("collections/projects"), m = a("collections/works"), c = a("./templates/basic"), h = a("./templates/column"), n = a("essage"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "CollectionPickerView", f.prototype.className = "collections-picker modal-dialog", f.prototype.events = {"click .picker-handler": "selectCollectionsOrWorks","click .cancel-handler": "close","click .confirm-handler": "ensureSelected","click .column": "unselect"}, f.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this.projectModel = i.getOne(0, a._projectId), this._defaultCollectionId = this.projectModel.get("_defaultCollectionId"), this._rootCollectionId = this.projectModel.get("_rootCollectionId"), a.onlyWorks = a.multiple || a.onlyWorks, a.onlyWorks && a.onlyCollections && (a.onlyCollections = !1), a.onlyWorks && a.noWorks && (a.noWorks = !1), a.onlyCollections && (a.noWorks = !0), this.options = _.extend({multiple: !1,noWorks: !1,onlyWorks: !1,onlyCollections: !1,exclude: [],select: function() {
                }}, a), this._projectId = a._projectId, this.selectedId = a._parentId || this._rootCollectionId, a.multiple && (this.selectedIds = []), this.cache = {}, this.renderBasic().retrievalParent(this.selectedId), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this) : void 0
            }, f.prototype.renderBasic = function() {
                return this.$el.html(c({title: this.options.title || "library",selected: this.options.multiple ? null : this.selectedId})), this.$confirmHandler = this.$(".confirm-handler"), this.$column = this.$(".picker-column"), this
            }, f.prototype.retrievalParent = function(a) {
                var b, c;
                return c = [a], b = function(a) {
                    return function(d) {
                        return d ? e.fetch(d, {success: function(e) {
                            return a.$el ? (d = e.get("_parentId"), a.cache[e.id] = e, d && c.unshift(d), b(d)) : void 0
                        },error: function() {
                            return a.renderColumns(c)
                        }}) : a.renderColumns(c)
                    }
                }(this), b(a), this
            }, f.prototype.loadCollection = function(a, b) {
                return this.showLoadingIndicator(this.$column), j.series([function(b) {
                    return function(c) {
                        return g.fetch(a, {attrs: {all: !0,_parentId: a,_projectId: b._projectId},success: function(a) {
                            return a.each(function(a) {
                                return b.cache[a.id] = a
                            }), c(null, a)
                        },error: function(a, b) {
                            return c(b, null)
                        }})
                    }
                }(this), function(b) {
                    return function(c) {
                        return b.options.noWorks ? c(null) : m.fetch(a, {attrs: {all: !0,_parentId: a,_projectId: b._projectId},success: function(a) {
                            return a.each(function(a) {
                                return b.cache[a.id] = a
                            }), c(null, a)
                        },error: function(a, b) {
                            return c(b, null)
                        }})
                    }
                }(this)]).fin(function(a) {
                    return function(c, d, e) {
                        var f, g, h;
                        if (a.$el)
                            return a.hideLoadingIndicator({animated: !0}), d && Essage.show({message: d.message || d,status: "error"}, 2e3), f = null != (g = e[0]) ? g.models : void 0, f && (f = f.concat((null != (h = e[1]) ? h.models : void 0) || [])), b(d, f)
                    }
                }(this)), this
            }, f.prototype.resetView = function(a) {
                return a ? a.nextAll().remove() : this.$column.html(""), this
            }, f.prototype.renderColumns = function(a) {
                return this.resetView(), this.renderColumn([{_id: this._rootCollectionId,objectType: "collection",title: "" + this.projectModel.get("name")}]), j.eachSeries(a, function(a) {
                    return function(b, c) {
                        return a.loadCollection(c, b)
                    }
                }(this)).fin(function(a) {
                    return function(b, c, d) {
                        return _.each(d, function(b) {
                            return a.renderColumn(b)
                        }), a.$confirmHandler.prop("disabled", !a.selectedId)
                    }
                }(this)), this
            }, f.prototype.renderColumn = function(a, b) {
                var c, e, f;
                return f = [], e = [], _.each(a, function(a) {
                    return function(c) {
                        var g, h;
                        return g = ("function" == typeof c.toJSON ? c.toJSON() : void 0) || c, g._id !== a._defaultCollectionId ? (b || (b = g._parentId), g.disabled = (h = c.id, d.call(a.options.exclude, h) >= 0), "collection" === g.objectType ? f.push(g) : e.push(g)) : void 0
                    }
                }(this)), c = this.$column.children(".column:last"), c.find(".picker-handler[data-id=" + b + "]").addClass("active").siblings().removeClass("active"), this.$column.append(h({_id: b,folders: f,files: e,selectedId: this.options.onlyWorks ? null : this.selectedId})), this.$column.animate({scrollLeft: 200 * this.$column.children().length - this.$column.width()}), this
            }, f.prototype.selectCollectionsOrWorks = function(a) {
                var b, c, e, f, g;
                if (c = a.currentTarget ? $(a.currentTarget) : a, f = c.data("id"), c.hasClass("collection")) {
                    if (d.call(this.options.exclude, f) >= 0)
                        return;
                    this.options.onlyWorks || (g = f), c.hasClass("selected") ? this.$("li.column[data-id=" + f + "]").remove() : this.loadCollection(f, function(a) {
                        return function(b, d) {
                            return a.resetView(c.closest("li.column")), a.renderColumn(d, f)
                        }
                    }(this))
                } else
                    this.options.onlyCollections || (g = f);
                return this.selectedId = null, g && c.toggleClass("selected"), this.options.multiple ? (b = c.closest("li.column"), this.$column.find("li.column").not(b).find(".picker-handler.selected").removeClass("selected"), this.selectedIds = [], b.find(".picker-handler.selected").each(function(a) {
                    return function(b, c) {
                        return a.selectedIds.push($(c).data("id"))
                    }
                }(this)), e = !this.selectedIds.length) : (this.$column.find(".picker-handler.selected").not(c).removeClass("selected"), c.hasClass("selected") && (this.selectedId = g), e = !this.selectedId), this.$confirmHandler.prop("disabled", e), this
            }, f.prototype.unselect = function(a) {
                var b;
                if (!$(a.target).closest(".picker-handler").length)
                    return b = $(a.currentTarget).data("id"), this.selectCollectionsOrWorks(this.$(".picker-handler[data-id=" + b + "]")), this
            }, f.prototype.ensureSelected = function() {
                var a;
                return this.options.multiple ? (a = [], _.each(this.selectedIds, function(b) {
                    return function(c) {
                        var d;
                        return d = b.cache[c], d ? a.push(d) : void 0
                    }
                }(this)), a.length || (a = null)) : a = this.cache[this.selectedId] || null, a && this.options.select(a), this.close(), this
            }, f.prototype.close = function() {
                var a, b;
                return "WindowView" === (null != (b = this.parentView) ? b.viewName : void 0) ? "function" == typeof (a = this.parentView).remove && a.remove() : this.remove(), this
            }, f
        }(l)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/work/work-uploader/index", ["require", "exports", "module", "essage", "teambition", "lib/uploader/index", "view", "collections/works"], function(a) {
        var c, d, e, f, g, h;
        return h = a("essage"), g = a("teambition"), c = a("lib/uploader/index"), d = a("view"), f = a("collections/works"), e = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "WorkUploaderView", d.prototype.initialize = function(a) {
                return (null != a ? a._projectId : 0) && (a._parentId || a.collection) ? (a.collection || (a.collection = new f([], {_boundToObjectId: a._parentId})), this.collection = a.collection, this.options = _.extend({accept: null,onCreate: function(b) {
                    return function(c) {
                        var d;
                        return b.options.isBackground && !b.collection.inWorksBgUploader && g.APP.worksBgUploader.addWorks(b.collection, a), c.progress = 0, c.completed = !1, d = b.collection.add(c), d.set("completed", !1), d
                    }
                }(this),onProgress: function() {
                    return function(a, b) {
                        return b.set("progress", a)
                    }
                }(this),onComplete: function() {
                    return function(a, b) {
                        return a.thumbnailUrl && (a.thumbnail = a.thumbnailUrl), b.set(a), b.set("completed", !0)
                    }
                }(this),onError: function(a) {
                    return function(b, c) {
                        return a.options.isBackground && Essage.show({message: "文件上传失败",status: "error"}, 2e3), a.collection.remove(c)
                    }
                }(this)}, a), this.uploader = new c(this.options).uploader, this) : void 0
            }, d.prototype.getData = function() {
                return this.collection.toJSON()
            }, d.prototype.remove = function() {
                var a;
                return null != (a = this.uploader) && a.destroy(), d.__super__.remove.apply(this, arguments)
            }, d
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/library/works-picker/index", ["require", "exports", "module", "teambition", "./templates/basic", "views/library/collection-picker/index", "lib/http", "lib/popover/index", "util", "lib/window/index", "views/work/work-uploader/index"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m;
        return m = a("teambition"), c = a("./templates/basic"), d = a("views/library/collection-picker/index"), e = a("lib/http"), f = a("lib/popover/index"), g = a("util"), h = a("lib/window/index"), i = a("views/work/work-uploader/index"), k = window.Dropbox, l = function(a, b, c) {
            switch (a) {
                case "remote":
                    b = JSON.stringify({downloadUrl: b,source: a});
                    break;
                case "dropbox":
                    b = JSON.stringify({files: _.isArray(b) ? b : [b],source: a})
            }
            return e.ajax({url: "" + m.uploadUrl + "/forremote",type: "POST",contentType: "application/json",dataType: "json",data: b,success: c})
        }, j = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "WorksPickerView", e.prototype.popoverTitle = "添加附件", e.prototype.events = {"click .library-picker-handler": "attachFromLibrary","click .dropbox-picker-handler": "attachFromDropbox","click .uploader-handler": "hide","click .remote-picker-handler": "attachFromRemote"}, e.prototype.render = function() {
                return this.options._projectId || this.options.collection ? (this.$el.html(c({dropbox: !!k})), this.initUploader(), this) : void 0
            }, e.prototype.initUploader = function() {
                var a;
                return null != (a = this.uploaderView) && a.remove(), this.uploaderView = this.requestSubView(i, {_projectId: this.options._projectId,collection: this.options.collection,pick: {id: this.$(".uploader-handler"),multiple: !0},onStart: function(a) {
                    return function() {
                        return a.hide()
                    }
                }(this)}), this
            }, e.prototype.attachFromLibrary = function() {
                var a;
                return this.hide(), null != (a = this.picker) && a.remove(), this.picker = this.requestSubView(h).open(d, {_projectId: this.options._projectId,multiple: !0,onlyWorks: !0,title: "从文件库选择",select: function(a) {
                    return function(b) {
                        var c;
                        return a.options.collection.add(b, {parse: !0}), a.options.collection.trigger("change:completed"), "function" == typeof (c = a.options).success ? c.success(b) : void 0
                    }
                }(this)})
            }, e.prototype.attachFromDropbox = function() {
                var a;
                if (k)
                    return this.hide(), a = {success: function(a) {
                        return function(b) {
                            return l("dropbox", b, function(b) {
                                var c, d;
                                return b.works ? (a.options.collection.add(b.works, {parse: !0}), a.options.collection.trigger("change:completed"), "function" == typeof (d = a.options).success ? d.success(b.works) : void 0) : "function" == typeof (c = a.options).error ? c.error(b.message) : void 0
                            })
                        }
                    }(this),cancel: function() {
                        return function() {
                        }
                    }(this),linkType: "preview",multiselect: !0}, k.choose(a), this
            }, e.prototype.attachFromRemote = function() {
                var a, b, c;
                return this.hide(), a = this.$(".remote-input-wrap input"), (b = a.val().trim()) ? (c = this.options.collection.add({downloadUrl: b,progress: 0}, {parse: !0}), l("remote", b, function(a) {
                    return function(b) {
                        var d, e;
                        return b.message ? "function" == typeof (d = a.options).error ? d.error(b.message) : void 0 : (b.progress = 1, b.completed = !0, c.set(c.parse(b)), "function" == typeof (e = a.options).success ? e.success(b) : void 0)
                    }
                }(this)), this) : void 0
            }, e
        }(f)
    }), define("views/work/work/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="work-content"> <div class="work-title"> ';
            return c += a.thumbnail ? ' <div class="work-thumbnail image" style="background-image: url(' + a.thumbnail + ');"></div> ' : ' <div class="work-thumbnail ' + a.fileType + '">' + a.thumbnailText + "</div> ", c += ' <div class="work-filename">' + b(a.fileName || a.downloadUrl) + '</div> <div class="work-upload-to"></div> </div> <a class="delete-work-handler icon icon-remove"></a></div><div class="progress-bar"></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/work/work/index", ["require", "exports", "module", "./templates/basic", "models/collection", "collections/projects", "view"], function(a) {
        var c, d, e, f, g;
        return c = a("./templates/basic"), d = a("models/collection"), e = a("collections/projects"), f = a("view"), g = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "WorkNewView", f.prototype.tagName = "li", f.prototype.className = "work creating", f.prototype.events = {"click .delete-work-handler": "deleteWork"}, f.prototype.initialize = function(a) {
                return (null != a ? a.workModel : void 0) ? (this.options = a, this.workModel = a.workModel, this.renderBasic().listen(), this) : void 0
            }, f.prototype.listen = function() {
                return this.listenTo(this.workModel, "change:_id", this.renderId), this.listenTo(this.workModel, "change:thumbnail", this.renderImage), this.listenTo(this.workModel, "change:progress", this.onProgress), this.listenTo(this.workModel, "change:completed", this.onComplete), this.listenTo(this.workModel, "remove destroy", this.remove), this.listenTo(this.workModel, "change:filename change:downloadUrl", this.renderTitle), this
            }, f.prototype.renderBasic = function() {
                var a, b;
                return a = this.workModel.toJSON(), a.thumbnailText = a.fileType, /link/.test(a.fileCategory) && (a.thumbnailText = "link"), this.$el.html(c(a)).attr("data-cid", this.workModel.cid), this.$progressBar = this.$(".progress-bar"), this.workModel.id ? this.renderId() : this.workModel.get("progress") || (this.$progressBar.animate({width: "10%"}, 500), this.$el.css("opacity", .7)), this.options.isBackground && (b = this.workModel.collection._boundToObjectId, d.fetch(b, {success: function(a) {
                    return function(b) {
                        var c, d;
                        return d = b.get("title"), "root" === b.get("collectionType") && (c = e.getOne(0, b.get("_projectId")), d = c.get("name")), a.$(".work-upload-to").text(d)
                    }
                }(this)})), this
            }, f.prototype.renderId = function() {
                return this.$el.data("id", this.workModel.id), this
            }, f.prototype.renderImage = function() {
                var a, b, c;
                return (b = this.workModel.get("thumbnail")) ? this.$(".work-thumbnail").attr("class", "work-thumbnail image").css("background-image", "url(" + b + ")").empty() : (a = this.workModel.get("fileType"), c = a, /link/.test(this.workModel.get("fileCategory")) && (c = "link"), this.$(".work-thumbnail").attr("class", "work-thumbnail #{fileType}").text(c)), this
            }, f.prototype.renderTitle = function() {
                var a;
                return a = this.workModel.get("fileName") || this.workModel.get("downloadUrl"), this.$(".work-filename").text(a), this
            }, f.prototype.onProgress = function() {
                var a, b, c;
                return c = this.workModel.get("progress") || 0, a = this.$progressBar, a.stop(!0, !1), c > .9 ? (b = function() {
                    return function(c) {
                        return a.animate({width: "100%"}, {duration: c,progress: function(d, e) {
                            return e > .5 ? (a.stop(), b(1.2 * c)) : void 0
                        }})
                    }
                }(this))(2e3) : a.animate({width: "" + 100 * c + "%"}, 500), this
            }, f.prototype.onComplete = function() {
                return this.$el.css("opacity", ""), this.$progressBar.stop(!0, !0).remove(), this.options.isBackground && this.$(".delete-work-handler").attr("class", "icon icon-tick"), this
            }, f.prototype.deleteWork = function(a) {
                var b, c;
                return a.stopPropagation(), "function" == typeof (b = this.workModel).removeFile && b.removeFile(), null != (c = this.workModel.collection) && c.remove(this.workModel), this
            }, f
        }(f)
    }), define("views/activity/activity-creator/templates/basic", [], function() {
        return function(a) {
            var b = "";
            return b += a.isGhost ? " <a class='login-handler'>登录</a>或<a class='register-handler'>注册</a>后可参与讨论" : '<div class="like-handler hinted" data-gta="event" data-label="click like"> <span class="icon icon-heart"></span> <span class="icon icon-heart"></span></div><div class="comment-box-wrap"> <textarea type="text" placeholder="参与讨论" class="form-control comment-input"></textarea> <ul class="attachments-list scrollable thin-scroll clearfix"></ul></div><div class="activity-handler clearfix"> <a class="add-work-handler pull-left" data-gta="event" data-label="activity add works"> <span class="icon icon-paperclip"></span> 添加附件</a> <a class="btn btn-primary reply-handler pull-right">回复</a> <label class="checkbox pull-right quick-create-label"> <input type="checkbox" class="quick-create"> 回车快速回复 </label></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/activity/activity-creator/index", ["require", "exports", "module", "teambition", "store", "thenjs", "util", "view", "models/work", "collections/members", "collections/objectlinks", "collections/projects", "collections/works", "lib/at/index", "views/library/works-picker/index", "views/work/work-uploader/index", "views/work/work/index", "./templates/basic", "essage"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v;
        return u = a("teambition"), k = a("store"), l = a("thenjs"), m = a("util"), n = a("view"), o = a("models/work"), g = a("collections/members"), h = a("collections/objectlinks"), i = a("collections/projects"), r = a("collections/works"), d = a("lib/at/index"), s = a("views/library/works-picker/index"), p = a("views/work/work-uploader/index"), q = a("views/work/work/index"), e = a("./templates/basic"), v = a("essage"), t = /https?:\/\/[^\s<]{3,}?\/(task|post|event|work)\/([0-9a-z]{24})\/?/, j = "按 Ctrl+Enter 快速回复", f = "参与讨论", c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "ActivityCreatorView", c.prototype.tagName = "div", c.prototype.className = "activity-creator", c.prototype.events = {"click .reply-handler": "submit","focusin .comment-input": "focusAttachment","focusout .comment-input": "blurAttachment","keydown .comment-input": "quickSubmit","change .quick-create": "changeQuickCreateMode","click .add-work-handler": "toggleWorksPicker","click .like-handler": "toggleLike","click .login-handler": "loginHandler","click .register-handler": "registerHandler","mousewheel .scrollable": m.mousewheel}, c.prototype.initialize = function(a) {
                var b, c, d;
                return this.options = a, this._projectId = a._projectId, this.resizeHandler = a.resizeHandler || function() {
                }, this.projectModel = i.findOne(0, this._projectId), this.projectRight = null != (d = this.projectModel) ? d.getRight() : void 0, this.objectModel = a.objectModel, this.collection = a.collection, this.localCache = k.namespace("temp").namespace("activities_" + a.boundToObjectType), this.localCacheId = "" + a._projectId + "_" + u.user.id, b = this.localCache(this.localCacheId) || {}, this.projectRight >= 0 && (this._defaultCollectionId = this.projectModel.get("_defaultCollectionId"), c = _.filter(b.attachments, function(a) {
                    return a.completed !== !1
                })), this.attachments = new r(c, {boundToObjectType: "collection",_boundToObjectId: this._defaultCollectionId}), this.mentions = b.mentions || {}, this.renderBasic().getLike().checkQuickCreateMode().initUploader().initSortable().listen(), this.$textareaset.val(b.content).flexText(function(a) {
                    return function() {
                        var b;
                        return a.cacheActivity(), b = a.$el.height(), b !== a._$elHeight ? (a._$elHeight = b, _.delay(function() {
                            return a.resizeHandler()
                        })) : void 0
                    }
                }(this)), this.projectRight >= 0 && g.fetch(this._projectId, {boundToObjectType: "project",success: function(a) {
                    return function(b) {
                        return a.initAt(b)
                    }
                }(this)}), this
            }, c.prototype.renderBasic = function() {
                var a;
                return a = u.user.toJSON(), a.isGhost && this.$el.addClass("ghost"), this.$el.html(e(a)), this.$textareaset = this.$(".comment-input"), this.$attachmentsList = this.$(".attachments-list"), this.$quickCreate = this.$(".quick-create"), this.$submit = this.$(".reply-handler"), this.$likeHandler = this.$(".like-handler"), this.attachments.each(function(a) {
                    return function(b) {
                        return a.renderAttachment(b)
                    }
                }(this)), this
            }, c.prototype.renderLike = function() {
                var a;
                return this.$likeHandler && this.likeData ? (this.$likeHandler[this.likeData.isLike ? "addClass" : "removeClass"]("active"), a = this.likeData.isLike ? "取消点赞" : "点赞", this.$likeHandler.data("title", a), this) : this
            }, c.prototype.getLike = function() {
                return this.objectModel.getLike({attrs: {_objectlinkId: this.options._objectlinkId},success: function(a) {
                    return function(b) {
                        return a.likeData = b, a.renderLike()
                    }
                }(this)}), this
            }, c.prototype.submit = function() {
                var a, b, c, d, e;
                if (!this.$submit.prop("disabled"))
                    return c = this.$textareaset.val().trim(), a = this.attachments.getUploadingCount(), b = null, d = null, a ? Essage.show({message: "" + a + "个文件正在上传...",status: "warning"}, 2e3) : c || this.attachments.length ? (this.disableSubmit(!0), l(function(a) {
                        return function(b) {
                            var c;
                            return a.projectRight >= 0 ? (c = a.$attachmentsList.find(".work").map(function() {
                                return $(this).data("cid")
                            }).toArray(), a.attachments.comparator = function(a, b) {
                                return c.indexOf(a.cid) - c.indexOf(b.cid)
                            }, a.attachments.sort(), a.attachments.addWorks(a.attachments.toJSON(), {_parentId: a._defaultCollectionId,_projectId: a._projectId,success: function() {
                                return b()
                            },error: function(a, c) {
                                return b(c)
                            }})) : b()
                        }
                    }(this)).then(function(a) {
                        return function(e) {
                            var f, g;
                            return a.projectRight >= 0 && (f = c.match(t), f && f[2] && f[2] !== a.collection._boundToObjectId && (b = f[1], d = f[2], a.objectlinksCollection || (a.objectlinksCollection = h.get(a.collection._boundToObjectId, {boundToObjectType: a.options.boundToObjectType})), g = a.objectlinksCollection.where({_linkedId: d}), f[0] !== c || g.length || (c = ""))), c || a.attachments.length ? a.collection.create({action: "comment",_creatorId: u.user.id,content: c,mentions: a.mentions,attachments: a.attachments.pluck("_id"),_boundToObjectId: a.collection._boundToObjectId,boundToObjectType: a.collection.boundToObjectType}, {wait: !0,success: function(a) {
                                return e(null, a)
                            },error: function(a, b) {
                                return e(b)
                            }}) : e()
                        }
                    }(this)).then(function(a) {
                        return function() {
                            return a.$el ? (a.$textareaset.val(""), a.$attachmentsList.empty(), a.attachments.reset(), a.disableSubmit(!1), a.deactiveAttachment(), a.$textareaset.focusAtEnd(), a.mentions = {}, a.localCache.remove(a.localCacheId), b && d && a.autoLinkObject(b, d), u.gta.event(null, "submit", "add comment")) : void 0
                        }
                    }(this)).fail(function(a) {
                        return function(b, c) {
                            return a.$el ? (a.disableSubmit(!1), Essage.show({message: c,status: "error"}, 2e3), a.$textareaset.focusAtEnd(), u.gta.event(null, "submit", "add comment failed")) : void 0
                        }
                    }(this))) : null != (e = this.$textareaset) && e.focusAtEnd(), this
            }, c.prototype.disableSubmit = function(a) {
                return this.$submit.prop("disabled", a), this.$submit[a ? "addClass" : "removeClass"]("disabled"), this
            }, c.prototype.quickSubmit = function(a) {
                return 13 === a.keyCode && (a.ctrlKey || a.metaKey || a.shiftKey || u.PREFERENCE.quickReply()) && (a.preventDefault(), this.submit()), this
            }, c.prototype.checkQuickCreateMode = function() {
                return this.$quickCreate.prop("checked", u.PREFERENCE.quickReply()), this
            }, c.prototype.changeQuickCreateMode = function() {
                return u.PREFERENCE.quickReply(this.$quickCreate.prop("checked")) || (this.$textareaset.attr("placeholder", j), _.delay(function(a) {
                    return function() {
                        var b;
                        return null != (b = a.$textareaset) ? b.attr("placeholder", f) : void 0
                    }
                }(this), 1e3)), this.$textareaset.focusAtEnd(), this
            }, c.prototype.autoLinkObject = function(a, b) {
                return this.projectRight >= 0 ? (this.objectlinksCollection.create({_parentId: this.collection._boundToObjectId,parentType: this.collection.boundToObjectType,_linkedId: b,linkedType: a}, {wait: !0}), this) : this
            }, c.prototype.listen = function() {
                return this.listenTo(this.attachments, "add", this.renderAttachment), this.listenTo(this.attachments, "add change remove", this.cacheActivity), this.listenTo(this.attachments, "add remove reset", function(a) {
                    return function() {
                        return a.attachments.length ? a.$attachmentsList.css("max-height", Math.max(50 * a.attachments.length, 100)) : a.deactiveAttachment()
                    }
                }(this)), this
            }, c.prototype.initUploader = function() {
                var a, b;
                return this.projectRight >= 0 ? (null != (b = this.workuploaderView) && b.remove(), a = {_projectId: this._projectId,collection: this.attachments,pick: null,dnd: this.$el,paste: this.$textareaset}, this.workuploaderView = this.requestSubView(p, a), this) : this
            }, c.prototype.initSortable = function() {
                return this.projectRight >= 0 ? (this.$attachmentsList.sortable({items: ".work",helper: "clone",placeholder: "work-drag-placeholder",tolerance: "pointer",zIndex: 2001,axis: "y",scroll: !1,start: function(a, b) {
                    return b.placeholder.height(b.helper.innerHeight())
                }}), this) : this
            }, c.prototype.initAt = function(a) {
                return this.projectRight >= 0 ? (this.atView = this.requestSubView(d, {$inputor: this.$textareaset,at: "@",fixed: !0,dataList: a.toJSON(),select: function(a) {
                    return function(b, c) {
                        return a.mentions[b] = c.name
                    }
                }(this)}), this) : this
            }, c.prototype.toggleWorksPicker = function(a) {
                var b;
                return this.projectRight >= 0 ? (b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(s, {_projectId: this._projectId,collection: this.attachments,$toggler: b,placement: "auto top"}).show(), this) : this
            }, c.prototype.toggleLike = function() {
                var a;
                return this.likeData ? (a = this.likeData.isLike, this.objectModel[a ? "unLike" : "doLike"]({success: function(a) {
                    return function(b) {
                        var c;
                        return a.likeData = b, a.likeData.isLike ? _.find(a.likeData.likesGroup, function(a) {
                            return a._id === u.user.id
                        }) || a.likeData.likesGroup.unshift({_id: u.user.id,avatarUrl: u.user.get("avatarUrl"),name: u.user.get("name")}) : (c = _.find(a.likeData.likesGroup, function(a) {
                            return a._id === u.user.id
                        }), c && m.removeItem(a.likeData.likesGroup, c)), a.renderLike()
                    }
                }(this)}), this) : this
            }, c.prototype.loginHandler = function() {
                return u.router.gotoLogin(), this
            }, c.prototype.registerHandler = function() {
                return u.router.gotoRegister(), this
            }, c.prototype.renderAttachment = function(a) {
                return this.requestSubView(q, {workModel: a}).$el.appendTo(this.$attachmentsList), this.$attachmentsList.scrollTop(999), this.$(".comment-input").focusAtEnd(), this
            }, c.prototype.cacheActivity = function() {
                var a, b, c, d;
                a = this.$textareaset.val().trim(), d = this.mentions;
                for (b in d)
                    c = d[b], a.indexOf(c) < 0 && delete this.mentions[b];
                return this.localCache(this.localCacheId, {content: a,attachments: this.attachments.toJSON(),mentions: this.mentions}), this
            }, c.prototype.focusAttachment = function() {
                return this.checkQuickCreateMode(), this.$el.addClass("focus"), this.$el.addClass("active"), this.$el.handleClickOutside(function(a) {
                    return function() {
                        return a.deactiveAttachment()
                    }
                }(this), "click", ".works-picker, #atwho-container"), _.delay(function(a) {
                    return function() {
                        return "function" == typeof a.resizeHandler ? a.resizeHandler() : void 0
                    }
                }(this), 300), this
            }, c.prototype.blurAttachment = function() {
                return this.$el.removeClass("focus"), _.delay(function(a) {
                    return function() {
                        return "function" == typeof a.resizeHandler ? a.resizeHandler() : void 0
                    }
                }(this), 300), this
            }, c.prototype.deactiveAttachment = function() {
                return this.attachments.length || this.$textareaset.val().trim() || (this.$textareaset.val(""), this.$textareaset.trigger("change"), this.$el.removeClass("active")), _.delay(function(a) {
                    return function() {
                        return "function" == typeof a.resizeHandler ? a.resizeHandler() : void 0
                    }
                }(this), 300), this
            }, c.prototype.remove = function() {
                var a;
                return null != (a = this.atwho) && a.shutdown(), c.__super__.remove.apply(this, arguments)
            }, c
        }(n)
    }), define("views/activity/activity-uploader/templates/basic", [], function() {
        return function() {
            var a = '<div class="activity-uploader"> <a class="add-work-handler" data-gta="event" data-label="activity add works"> <span class="icon icon-paperclip"></span> 添加附件</a> <span> 或把文件拖到这里</span></div><ul class="activities-attachments-list"></ul>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/activity/activity-uploader/index", ["require", "exports", "module", "teambition", "thenjs", "util", "view", "models/work", "collections/collections", "collections/projects", "collections/works", "views/library/works-picker/index", "views/work/work-uploader/index", "views/work/work/index", "./templates/basic", "essage"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p;
        return o = a("teambition"), g = a("thenjs"), h = a("util"), i = a("view"), j = a("models/work"), e = a("collections/collections"), f = a("collections/projects"), m = a("collections/works"), n = a("views/library/works-picker/index"), k = a("views/work/work-uploader/index"), l = a("views/work/work/index"), d = a("./templates/basic"), p = a("essage"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "ActivityUploaderView", c.prototype.className = "activity-uploader-view", c.prototype.events = {"click .add-work-handler": "toggerWorksPicker"}, c.prototype.initialize = function(a) {
                return this.options = a, this._projectId = a._projectId, this.projectModel = f.fetchOne(0, this._projectId, {success: function(b) {
                    return function(c) {
                        var d;
                        return b.projectModel = c, b._defaultCollectionId = null != (d = b.projectModel) ? d.get("_defaultCollectionId") : void 0, b.collection = a.collection, b.attachments = new m(null, {boundToObjectType: "collection",_boundToObjectId: b._defaultCollectionId}), b.renderBasic().initUploader().listen()
                    }
                }(this)}), this
            }, c.prototype.renderBasic = function() {
                return this.$el.html(d()), this.$dropArea = this.$(".activity-uploader"), this.$attachmentsList = this.$(".activities-attachments-list"), this
            }, c.prototype.initUploader = function() {
                var a, b;
                return null != (b = this.workuploaderView) && b.remove(), a = {_projectId: this._projectId,collection: this.attachments,pick: null,dnd: this.$dropArea}, this.workuploaderView = this.requestSubView(k, a), this
            }, c.prototype.listen = function() {
                return this.listenTo(this.attachments, "add", this.renderAttachment), this.listenTo(this.attachments, "change:completed remove reset", function(a) {
                    return function() {
                        return a.attachments.getUploadingCount() ? void 0 : a.submit()
                    }
                }(this)), this
            }, c.prototype.toggerWorksPicker = function(a) {
                var b;
                return b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(n, {_projectId: this._projectId,collection: this.attachments,$toggler: b,placement: "top"}).show(), this
            }, c.prototype.renderAttachment = function(a) {
                return this.requestSubView(l, {workModel: a}).$el.prependTo(this.$attachmentsList), this
            }, c.prototype.submit = function() {
                var a;
                return a = this.attachments.getUploadingCount(), a ? Essage.show({message: "" + a + "个文件正在上传...",status: "warning"}, 2e3) : this.attachments.length && g(function(a) {
                    return function(b) {
                        return a.attachments.addWorks(a.attachments.toJSON(), {_parentId: a._defaultCollectionId,_projectId: a._projectId,success: function() {
                            return b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return a.collection.create({action: "comment",_creatorId: o.user.id,attachments: a.attachments.pluck("_id"),_boundToObjectId: a.collection._boundToObjectId,boundToObjectType: a.collection.boundToObjectType}, {wait: !0,success: function() {
                            return a.$el ? (a.$attachmentsList.empty(), a.attachments.reset()) : void 0
                        },error: function(c, d) {
                            return a.$el ? b(d) : void 0
                        }})
                    }
                }(this)).fail(function() {
                    return function(a, b) {
                        return Essage.show({message: b,status: "error"}, 2e3)
                    }
                }(this)), this
            }, c
        }(i)
    }), define("views/library/previewer/templates/basic", [], function() {
        return function() {
            var a = '<div class="previewer-content"> <div class="previewer-content-image-wapper"> <div class="img-previewer"></div> <div class="pdf-previewer"></div> <div class="video-previewer"></div> <div class="audio-previewer"></div> <div class="text-previewer thin-scroll"></div> <ul class="thumbnails-previewer"></ul> <div class="work-previewer work"></div> </div> <div class="activities-container thin-scroll"> <div class="previewer-header"></div> <div class="previewer-handler-set clearfix"></div> <div class="tags-set"></div> <div class="involve-set"></div> </div> <div class="activity-creator-wrapper"></div></div><div class="prev-handler"></div><div class="next-handler"></div><div class="previewer-map map"></div><a class="modal-close close-previewer-handler icon icon-remove icon-white" data-dismiss="modal" data-gta="event" data-label="close previewer"></a>';
            return a
        }
    }), define("views/library/previewer/templates/empty", [], function() {
        return function() {
            var a = '<div class="previewer-overlay modal-backdrop"> <div class="empty">原文件已删除</div></div>';
            return a
        }
    }), define("views/library/previewer/templates/handler", [], function() {
        return function(a) {
            var b = '<a class="download-image-handler" data-gta="event" data-label="download work"> <span class="icon icon-download"></span><br /> 下载</a>';
            return a.projectRight >= 0 && (b += '<a class="update-work-handler" data-gta="event" data-label="update work"> <span class="icon icon-download"></span><br /> 更新</a><a class="move-image-handler" data-gta="event" data-label="move work"> <span class="icon icon-share"></span><br /> 移动</a>', b += a.isArchived ? '<a class="unarchive-handler" data-gta="event" data-label="unarchive work"> <span class="icon icon-archive"></span><br /> 取消归档</a>' : '<a class="archive-handler" data-gta="event" data-label="archive work"> <span class="icon icon-archive"></span><br /> 归档</a>', b += '<a class="delete-handler" data-gta="event" data-label="delete work"> <span class="icon icon-trash"></span><br /> 删除</a>'), b
        }
    }), define("views/library/previewer/templates/header", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "<h4>" + b(a.fileName) + '</h4><p class="muted">' + a.fileSize + "</p>";
            return c
        }
    }), define("views/library/previewer/templates/map", [], function() {
        return function(a) {
            var b = '<ol class="map-indicators"> ', c = a.maps;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += ' <li class="previewer-map-btn ', a.index == d && (b += "active"), b += " ", -1 == d && (b += "thumbnail-map-btn"), b += '" data-map-to="' + d + '"></li> ';
            return b += "</ol>", a._parentId && (b += '<a class="enter-collection-handler" data-id="' + a._parentId + '" data-gta="event" data-label="enter collection"> <span class="icon icon-upload"></span><span>前往文件夹</span></a>'), b
        }
    }), define("views/library/previewer/templates/work", [], function() {
        return function() {
            var a = '<div class="work-thumbnail"><p class="work-name"></p></div><p class="work-title"></p><a class="previewer-download-link" target="_blank"></a><p class="deleted-info">原文件已删除</p>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/library/previewer/index", ["require", "exports", "module", "teambition", "exports", "highlight", "lib/http", "thenjs", "lib/uploader/index", "util", "view", "models/collection", "models/work", "collections/members", "collections/projects", "collections/works", "views/activity/activity-timeline/index", "views/library/collection-picker/index", "lib/confirm/index", "views/member/member-involve/index", "views/tag/tag-picker/index", "lib/window/index", "./templates/basic", "./templates/empty", "./templates/handler", "./templates/header", "./templates/map", "./templates/work", "essage", "pdf"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F;
        return D = a("teambition"), j = a("exports"), m = a("highlight"), n = a("lib/http"), u = a("thenjs"), v = a("lib/uploader/index"), w = a("util"), x = a("view"), f = a("models/collection"), z = a("models/work"), q = a("collections/members"), s = a("collections/projects"), B = a("collections/works"), d = a("views/activity/activity-timeline/index"), g = a("views/library/collection-picker/index"), h = a("lib/confirm/index"), p = a("views/member/member-involve/index"), t = a("views/tag/tag-picker/index"), y = a("lib/window/index"), e = a("./templates/basic"), i = a("./templates/empty"), k = a("./templates/handler"), l = a("./templates/header"), o = a("./templates/map"), A = a("./templates/work"), E = a("essage"), F = a("pdf"), c = $(window), C = function(a, b, c, d) {
            var e, f, g, h, i, j, k;
            for (d || (d = 1), c = 4 * ~~c || 4, g = c + 1, e = 1, h = 0, k = a * b, f = a * a * c / d; k > h && g >= 1; )
                g -= 1, h = f / (g * g || 1);
            return g += 1, g = ~~(g / 2), e = Math.ceil(c / 4 / g), j = Math.floor(a / g), j * g === a && (j -= 1), i = Math.floor(b / e), {rows: g,columns: e,width: j,height: i}
        }, r = function(a) {
            function i() {
                return i.__super__.constructor.apply(this, arguments)
            }
            return b(i, a), i.prototype.viewName = "PreviewerView", i.prototype.tagName = "div", i.prototype.className = "previewer modal-dialog", i.prototype.hotkeys = {right: "goNext",left: "goPrev",esc: function(a) {
                return a.preventDefault(), this.close()
            }}, i.prototype.preventHotkeys = ["i", "n", "h"], i.prototype.events = {"click .prev-handler": "goPrev","click .next-handler": "goNext","click .previewer-overlay": "close","click .download-image-handler": "openImageInNewWindow","click .move-image-handler": "moveWork","click .archive-handler": "archiveWork","click .unarchive-handler": "unarchiveWork","click .delete-handler": "deleteWork","click .previewer-map-btn": "goToIndex","click .download-collection-handler": "downloadCollection","click .enter-collection-handler": "enterCollection","click .img-previewer img": "showNaturalImage"}, i.prototype.initialize = function(a) {
                return a._workId || a.workModels || a.workModel ? (this.options = a, a.workModels && (this.workModels = a.workModels), a.workModel && !this.workModels && (this.workModels = [a.workModel]), this.showLoadingIndicator(), u(function(b) {
                    return function(c) {
                        return b.workModels ? u.eachSeries(b.workModels, function(a, b) {
                            return b.fetch({attrs: {_objectlinkId: b.get("_objectlinkId")},success: function() {
                                return a()
                            },error: function(b, c) {
                                return a(c)
                            }})
                        }).fin(c) : (a = {success: function(a) {
                            return b.workModels = [a], c()
                        },error: function(a, b) {
                            return c(b)
                        }}, b.options._objectlinkId && (a.attrs = {_objectlinkId: b.options._objectlinkId}), z.fetch(b.options._workId, a))
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return a._projectId = a.workModels[0].get("_projectId"), a.projectModel = s.getOne(0, a._projectId), a.projectRight = a.projectModel.hasRight(), a.projectRight < 0 && a.$el.addClass("guest"), a.projectRight >= 0 || a.projectModel.get("isPublic") ? q.fetch(a._projectId, {success: function(c) {
                            return a.membersCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }}) : (a.membersCollection = q.get(a._projectId), b())
                    }
                }(this)).then(function(b) {
                    return function() {
                        return b.$el ? (b.workModels.length > 1 && (b.workModels[-1] = b.options.collectionModel || new f), b._imgForComputeList = [], b._videoForComputeList = [], b._audioForComputeList = [], b.index = 0, b.renderBasic(), b.options.workModel ? b.index = _.indexOf(_.pluck(b.workModels, "id"), a.workModel.id) : b.workModels[-1] && (b.index = -1), b.doSwitch()) : void 0
                    }
                }(this)).fail(function(a) {
                    return function() {
                        return a.close()
                    }
                }(this)), this) : void 0
            }, i.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, i.prototype.renderBasic = function() {
                return this.$el.html(e()), this.$thumbnails = this.$(".thumbnails-previewer").hide(), this.$lastView = this.$img = this.$(".img-previewer").hide(), this.$pdfViewer = this.$(".pdf-previewer").hide(), this.$textViewer = this.$(".text-previewer").hide(), this.$videoViewer = this.$(".video-previewer").hide(), this.$audioViewer = this.$(".audio-previewer").hide(), this.$fileViewer = this.$(".work-previewer").hide(), this.$previewerHandlerSet = this.$(".previewer-handler-set"), this.$imgset = this.$(".previewer-content-image-wapper"), this.$activityContainer = this.$(".activities-container"), this.$activityCreator = this.$(".activity-creator-wrapper"), this.$name = this.$(".file-name"), this.$prev = this.$(".prev-handler"), this.$next = this.$(".next-handler"), this.$previewerMap = this.$(".previewer-map"), this.$(".close-previewer-handler").appendTo(this.$el.parent()), this
            }, i.prototype.reset = function() {
                return this.stopListening(), this.workModel = this.workModels[this.index], this.workModel ? (this.index >= 0 && (this.listenTo(this.workModel, "change:downloadUrl", this.renderContent), this.listenTo(this.workModel, "change:fileName", this.renderHeader), this.listenTo(this.workModel, "remove destroy", this.close)), this) : this
            }, i.prototype.doSwitch = function() {
                return this.mediaOffLoad(), this.$fileViewer.html(""), this.reset(), this.checkHideOrShow(), this.renderContent(), this.refreshMap(), this.refreshPreviewerUrl(), -1 === this.index ? this.$el.addClass("disable-activity") : (this.$el.removeClass("disable-activity"), this.renderHeader(), this.renderHandler(), this.renderActivities(), this.initUploader(), this.initInvolve(), this.initTagPicker()), this
            }, i.prototype.renderHeader = function() {
                var a;
                return a = this.workModel.toJSON(), this.$(".previewer-header").html(l({fileName: a.fileName,fileSize: w.formatFileSize(a.fileSize || 0)})), this
            }, i.prototype.renderHandler = function() {
                return this.$previewerHandlerSet.html(k({projectRight: this.projectRight,isArchived: this.workModel.get("isArchived")})), this
            }, i.prototype.refreshMap = function() {
                var a, b, c, d, e;
                if (a = this.workModels[-1] ? -1 : 0, b = this.workModels.length, c = [a++], 32 >= b)
                    for (; b > a; )
                        c.push(a++);
                else
                    this.index !== c[0] && c.push(this.index);
                return this.projectRight >= 0 && (d = this.workModel.get("_parentId")), (null != (e = this.projectModel) ? e.get("_defaultCollectionId") : void 0) === d && (d = null), this.$previewerMap.html(o({maps: c,index: this.index,_parentId: d})), this
            }, i.prototype.renderContent = function() {
                var a, b;
                return this.index < 0 ? this.$imgset.addClass("thumbnail-mode") : (this.$imgset.removeClass("thumbnail-mode"), a = this.workModel.toJSON(), this.$previewerHandlerSet[("function" == typeof (b = this.workModel).hasRight ? b.hasRight() : void 0) > 0 ? "removeClass" : "addClass"]("no-right")), this.$lastView.data("videoOrAudio") && this.$lastView.data("videoOrAudio").pause(), this.$lastView.stop().animate({opacity: 0}, function(b) {
                    return function() {
                        return b.$el ? (b.$lastView.hide(), (b.index < 0 || "image" !== a.fileCategory || !a.downloadUrl) && b.removeNaturalImage(), b.$lastView = b.index < 0 ? (b.renderThumbnails(), b.$thumbnails.css({opacity: 1}).show()) : "image" === a.fileCategory ? (b.renderImage(), b.$img.show()) : "text" === a.fileCategory ? (b.renderText(a, b.workModel), b.$textViewer.show().animate({opacity: 1})) : a.previewUrl ? (b.renderPDF(a), b.$pdfViewer.show().animate({opacity: 1})) : "video" === a.fileCategory ? (b.renderVideo(a), b.$videoViewer.show().animate({opacity: 1})) : "audio" === a.fileCategory ? (b.renderAudio(a), b.$audioViewer.show().animate({opacity: 1})) : (b.renderFile(a), b.$fileViewer.show().animate({opacity: 1}))) : void 0
                    }
                }(this)), this
            }, i.prototype.renderPDF = function(a) {
                return this.$pdfViewer.html(""), this.onLoaded(), new PDFObject({url: a.previewUrl}).embed(this.$pdfViewer[0]), this
            }, i.prototype.renderText = function(a, b) {
                var c;
                return this.$textViewer.html(""), this.onLoading(), c = function(a) {
                    return function(c) {
                        var d;
                        return a.onLoaded(), b[b.get("downloadUrl")] = c, d = $("<code></code>").text(c), m.highlightBlock(d[0]), $("<pre></pre>").append(d).appendTo(a.$textViewer)
                    }
                }(this), b[b.get("downloadUrl")] ? c(b[b.get("downloadUrl")]) : n.ajax({url: a.previewUrl || a.downloadUrl,converters: {"text script": !0,"text json": !0,"text xml": !0},success: c}), this
            }, i.prototype.renderImage = function() {
                var a, b, c, d;
                return this.$img.html(""), a = this.workModels[this.index], a = "function" == typeof a.toJSON ? a.toJSON() : void 0, (null != a ? a.downloadUrl : void 0) && (this.onLoading(), c = "striker" === (d = a.source) || "teambition" === d ? a.downloadUrl : a.thumbnail, b = w.loadImage(c, function(a) {
                    return function(c, d, e) {
                        var f, g, h, i;
                        return a.onLoaded(), w.removeItem(a._imgForComputeList, b), c ? a.removeNaturalImage() : (f = $(b), i = a.$imgset.width(), h = a.$imgset.height(), g = d > i || e > h ? d / e > i / h ? {width: i,height: e * i / d} : {width: d * h / e,height: h} : {width: d,height: e}, f.css(g), a.$img.attr("style", "").css(g).html(f), a.updateNaturalImage(b))
                    }
                }(this)), this._imgForComputeList.push(b)), this
            }, i.prototype.renderVideo = function() {
                var a, b, c;
                return this.$videoViewer.html(""), a = this.workModels[this.index], a = "function" == typeof a.toJSON ? a.toJSON() : void 0, (null != a ? a.downloadUrl : void 0) && (this.onLoading(), b = a.downloadUrl, c = w.loadVideo(b, function(a) {
                    return function(b, d, e) {
                        var f, g, h, i;
                        return a.onLoaded(), d || (d = 640), e || (e = 360), w.removeItem(a._videoForComputeList, c), f = $(c), i = a.$imgset.width(), h = a.$imgset.height(), g = d > i || e > h ? d / e > i / h ? {width: i,height: e * i / d} : {width: d * h / e,height: h} : {width: d,height: e}, c.width = g.width, c.height = g.height, a.$videoViewer.attr("style", "").css(g).html(f).data("videoOrAudio", c)
                    }
                }(this)), this._videoForComputeList.push(c)), this
            }, i.prototype.renderAudio = function() {
                var a, b, c;
                return this.$audioViewer.html(""), b = this.workModels[this.index], b = "function" == typeof b.toJSON ? b.toJSON() : void 0, (null != b ? b.downloadUrl : void 0) && (this.onLoading(), c = b.downloadUrl, a = w.loadAudio(c, function(b) {
                    return function() {
                        return b.onLoaded(), w.removeItem(b._audioForComputeList, a), b.$audioViewer.attr("style", "").html($(a)).data("videoOrAudio", a)
                    }
                }(this)), this._audioForComputeList.push(a)), this
            }, i.prototype.renderThumbnails = function() {
                var a, b, c;
                return this.onLoading(), this.$thumbnails.children().remove(), this.$thumbnails.show(), c = this.workModels.length, b = C(this.$thumbnails.width(), this.$thumbnails.height(), c, 1.618), a = '<li style="width: ' + b.width + "px; height: " + b.height + 'px;">', c <= b.rows && this.$thumbnails.width(b.width * c), u.each(this.workModels, function(b) {
                    return function(c, d, e) {
                        var f, g, h, i;
                        return f = $("<div>"), g = $('<div class="previewer-map-btn work" data-map-to="' + e + '">'), i = d.get("thumbnail") || d.thumbnail || "", h = !i, $(a).append(g).appendTo(b.$thumbnails), b.getImageProp(i, f, g, !0, function() {
                            var a;
                            return h && f.addClass("work-thumbnail").text(d.get("fileName")), g.append(f), a = d.get("fileType"), /link/.test(d.get("fileCategory")) && (a = "link"), h && g.append('<p class="work-title ' + d.get("fileType") + '">' + a + "</p>"), f.css("line-height", f.height() + "px").animate({opacity: 1}), c()
                        })
                    }
                }(this)).fin(function(a) {
                    return function() {
                        return a.onLoaded()
                    }
                }(this)), this
            }, i.prototype.getImageProp = function(a, b, c, d, e) {
                var f;
                return a ? (f = w.loadImage(a, function(g) {
                    return function(h, i, j) {
                        var k, l, m;
                        return w.removeItem(g._imgForComputeList, f), h ? g.onFailed(h) : (b.css({"background-image": "url(" + a + ")",opacity: 0}), l = c.width(), k = c.height(), i > l || j > k ? (m = i / j > l / k ? "" + l + "px auto" : "auto " + k + "px", d || b.css({backgroundSize: m,width: "",height: ""})) : b.css({width: i,height: j}), e())
                    }
                }(this)), this._imgForComputeList.push(f), this) : e("url err!")
            }, i.prototype.mediaOffLoad = function() {
                return _.each(this._imgForComputeList, function(a) {
                    return "function" == typeof a.abort ? a.abort() : void 0
                }), this._imgForComputeList = [], _.each(this._videoForComputeList, function(a) {
                    return "function" == typeof a.abort ? a.abort() : void 0
                }), this._videoForComputeList = [], _.each(this._audioForComputeList, function(a) {
                    return "function" == typeof a.abort ? a.abort() : void 0
                }), this._audioForComputeList = [], this
            }, i.prototype.renderFile = function(a) {
                var b, c, d, e, f, g, h;
                return this.$fileViewer.html(A()), f = a.fileName, b = this.$fileViewer.find(".deleted-info").hide(), d = this.$fileViewer.find(".work-thumbnail"), e = this.$fileViewer.find(".work-title"), a.isDeleted ? (b.show(), c.hide(), d.hide(), void e.hide()) : (h = a.fileType, /link/.test(a.fileCategory) && (h = "link"), this.$fileViewer.find(".work-title").html(h).addClass(a.fileType), this.$fileViewer.find(".work-name").html(f), c = this.$fileViewer.find(".previewer-download-link"), g = "link" === h ? "打开链接" : "下载文件 <span>(" + w.formatFileSize(a.fileSize || 0) + ")</span>", c.html(g).attr("href", a.downloadUrl), this.onLoaded(), this)
            }, i.prototype.initInvolve = function() {
                var a;
                return null != (a = this.involveView) && a.remove(), this.involveView = this.requestSubView(p, {_projectId: this._projectId,objectModel: this.workModel,membersCollection: this.membersCollection,dropArea: this.$el,undeletable: !1}), this.involveView.$el.appendTo(this.$(".involve-set")), this
            }, i.prototype.initTagPicker = function() {
                var a;
                return null != (a = this.tagPickerView) && a.remove(), this.tagPickerView = this.requestSubView(t, {_projectId: this._projectId,objectModel: this.workModel}), this.tagPickerView.$el.prependTo(this.$(".tags-set")), this
            }, i.prototype.renderActivities = function() {
                var a, b;
                return (null != (a = this.workModel) ? a.id : void 0) && (null != (b = this.activityTimeline) && b.remove(), this.$activityCreator.off(".activity"), this.resizeActivity(0), this.activityTimeline = this.requestSubView(d, {boundToObjectType: this.workModel.get("objectType"),_objectlinkId: this.workModel.get("_objectlinkId"),_projectId: this._projectId,objectModel: this.workModel,$scrollFrame: this.$activityContainer}), this.activityTimeline.$el.appendTo(this.$activityContainer), this.activityTimeline.renderCreator(this.$activityCreator, 100), this.$activityCreator.on("slideHide.activity", function(a) {
                    return function() {
                        return a.resizeActivity(0)
                    }
                }(this)).on("slideShow.activity changeHeight.activity", function(a) {
                    return function(b, c) {
                        return a.resizeActivity(c - 1)
                    }
                }(this)).slideShow()), this
            }, i.prototype.resizeActivity = function(a) {
                return this.$el && this.$activityContainer.css("bottom", a), this
            }, i.prototype.onLoading = function() {
                return this.showLoadingIndicator(this.$imgset, {isPrepend: !0}), this
            }, i.prototype.onLoaded = function() {
                return this.hideLoadingIndicator({animated: !0}), this
            }, i.prototype.onFailed = function(a) {
                return Essage.show({message: a.message || a,status: "error"}, 2e3), this
            }, i.prototype.checkHideOrShow = function() {
                return this.$next.css(this.workModels[this.index + 1] ? {visibility: "visible"} : {visibility: "hidden"}), this.$prev.css(this.workModels[this.index - 1] ? {visibility: "visible"} : {visibility: "hidden"}), this
            }, i.prototype.goPrev = function() {
                return this.$prev ? (this.workModels[this.index - 1] && (this.index--, this.doSwitch()), this) : void 0
            }, i.prototype.goNext = function() {
                return this.$next ? (this.workModels[this.index + 1] && (this.index++, this.doSwitch()), this) : void 0
            }, i.prototype.goToIndex = function(a) {
                var b;
                return b = $(a.currentTarget), b.hasClass("active") ? void 0 : (this.index = +b.data("map-to"), this.doSwitch(), this)
            }, i.prototype.openImageInNewWindow = function() {
                var a;
                return a = this.workModels[this.index].get("downloadUrl"), window.open("" + a), this
            }, i.prototype.moveWork = function() {
                var a, b, c;
                if (this.workModel.hasRight() > 0)
                    return null != (c = this.picker) && c.remove(), b = this.workModels[this.index], a = b.get("fileName"), this.picker = this.requestSubView(y).open(g, {_projectId: b.get("_projectId"),_parentId: b.get("_parentId"),onlyCollections: !0,title: "移动文件 " + a + " 至",select: function(a) {
                        return function(c) {
                            var d;
                            if (c.id !== b.get("_parentId"))
                                return d = B.get(c.id), b.moveToCollection(d, {success: function() {
                                    return a.close()
                                }})
                        }
                    }(this)}), this
            }, i.prototype.archiveWork = function() {
                return this.workModel.hasRight() > 0 ? (this.workModel.archive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功归档了文件",status: "success"}, 2e3), a.close()
                    }
                }(this)}), this) : void 0
            }, i.prototype.unarchiveWork = function() {
                return this.workModel.hasRight() > 0 ? (this.workModel.unarchive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功解档了文件",status: "success"}, 2e3), a.close()
                    }
                }(this)}), this) : void 0
            }, i.prototype.deleteWork = function() {
                return this.workModel.hasRight() > 0 ? (this.requestSubView(h, {title: "删除文件",description: "确定要永远删除这个文件吗？",onConfirm: function(a) {
                    return function() {
                        return a.workModel.destroy({success: function() {
                            return Essage.show({message: "删除成功",status: "success"}, 2e3), a.close()
                        }})
                    }
                }(this)}), this) : void 0
            }, i.prototype.initUploader = function() {
                var a;
                return this.projectRight >= 0 && this.index >= 0 && this.workModel.hasRight() > 0 ? (null != (a = this.uploader) && a.destroy(), this.uploader = new v({accept: null,model: this.workModel,pick: {id: this.$(".update-work-handler"),multiple: !1},onCreate: function(a) {
                    return function() {
                        return a.workModel
                    }
                }(this),onStart: function(a) {
                    return function() {
                        return a.onLoading()
                    }
                }(this),onComplete: function(a) {
                    return function(b, c) {
                        return b.version = !0, delete b._id, b.thumbnailUrl || (b.thumbnailUrl = null), b.thumbnail = b.thumbnailUrl, b.previewUrl || (b.previewUrl = null), c.save(b, {attrs: b}), a.onLoaded()
                    }
                }(this)}), this) : this
            }, i.prototype.downloadCollection = function() {
                return this
            }, i.prototype.enterCollection = function(a) {
                var b, c;
                return c = $(a.currentTarget).data("id"), b = "project/" + this._projectId + "/files/" + c, this.close(), D.router.navigate(b, {trigger: !0}), this
            }, i.prototype.refreshPreviewerUrl = function() {
                var a, b;
                return b = this.options.parentUrl || D.router.getUrl(), a = "/work/" + (this.index > -1 ? this.workModel.id : "thumbnails"), ~b.indexOf(a) || (b = b.replace(/\/work\/.+/, ""), b += a, D.router.navigate(b, {trigger: !1})), this
            }, i.prototype.showNaturalImage = function(a) {
                return this.$naturalImageWrap = $("<div>").addClass("natural-image"), this.$naturalImageWrap.appendTo(this.$el), this.updateNaturalImage(a.currentTarget), this
            }, i.prototype.updateNaturalImage = function(a) {
                var b, d, e;
                return this.$naturalImageWrap ? (b = $("<img>").attr({src: a.src,height: a.naturalHeight,width: a.naturalWidth}), d = a.naturalHeight < c.height() ? "auto" : 0, e = a.naturalWidth < c.width() ? "auto" : 0, b.css("margin", "" + d + " " + e), this.$naturalImageWrap.find("img").off(), this.$naturalImageWrap.html(b), b.one("click", function(a) {
                    return function(b) {
                        return b.stopPropagation(), a.removeNaturalImage()
                    }
                }(this)), this) : this
            }, i.prototype.removeNaturalImage = function() {
                var a;
                return null != (a = this.$naturalImageWrap) && a.remove(), this.$naturalImageWrap = null, this
            }, i.prototype.remove = function() {
                var a, b;
                return null != (b = this.uploader) && b.destroy(), "function" == typeof this.mediaOffLoad && this.mediaOffLoad(), a = D.router.getUrl().replace(/\/work\/.+/, ""), D.router.navigate(a, {trigger: !1}), i.__super__.remove.apply(this, arguments)
            }, i
        }(x), j.Constructor = r
    }), define("views/activity/activity/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            if (a.lastActivityAction && ("comment" === a.action && "comment" !== a.lastActivityAction || "comment" !== a.action && "comment" === a.lastActivityAction) && (c += " <hr>"), "comment" === a.action) {
                if (c += ' <div class="avatar img-36 img-circle pull-left ', a.creator.avatarUrl || (c += "no-avatar"), c += '" data-id="' + a.creator._id + '" ', a.creator.avatarUrl && (c += ' style="background-image: url(' + a.creator.avatarUrl + ');"'), c += '> </div> <div class="activity-body"> <div class="activity-header clearfix"> <span class="activity-creator-name">' + b(a.creator.name) + '</span> <time class="time-stamp muted pull-right ', a.hasRight > 0 && (c += "removeable"), c += '" datetime="' + a.created + '"></time> </div> ', a.hasRight > 0 && (c += ' <div class="activity-handler-set"> <a class="btn btn-link btn-mini delete-activity-handler">删除</a> </div> '), c += ' <div class="activity-content readable">' + b(a.content, "MD") + "</div> ", a.attachments.length > 0) {
                    c += ' <ul class="activity-attachments"> ';
                    var d = a.attachments;
                    if (d)
                        for (var e, f = -1, g = d.length - 1; g > f; )
                            e = d[f += 1], c += ' <li class="work previewer-handler" data-id="' + e.id + '"> ', c += e.thumbnail ? ' <div class="work-thumbnail image pull-left" style="background-image: url(' + e.thumbnail + ');"> </div> ' : ' <div class="work-thumbnail ' + e.fileType + ' pull-left"> ' + e.thumbnailText + " </div> ", c += ' <div class="attachment-content clearfix"> <p class="attachment-title hinted" data-title="' + e.fileName + '"> ' + b(e.fileName) + ' <span class="attachment-size">(' + e.fileSizeFix + ")</span> </p> </div> </li> ";
                    c += " </ul> "
                }
                c += " </div>"
            } else {
                if (c += ' <span class="icon ' + a.iconName + ' activity-type-icon pull-left muted"></span> <time class="time-stamp muted pull-right" datetime="' + a.created + '"></time> <div class="activity-body-coyness readable muted"> <span class="actor">' + b(a.creator.name) + "</span> <span>" + (a.title || "") + "</span> ", "set_content" === a.action ? c += ' <div class="activity-content overflow"> <blockquote class="activity-description">' + b(a.description) + '</blockquote> <blockquote class="activity-content-detail">' + b(a.content) + "</blockquote> </div> " : "set_filename" === a.action ? c += ' <div class="activity-content overflow"> <blockquote class="activity-description">' + b(a.fileName) + '</blockquote> <blockquote class="activity-content-detail">' + b(a.fileName) + "</blockquote> </div> " : "set_note" === a.action && a.note && a.note.trim() && (c += ' <div class="activity-content overflow"> <blockquote class="activity-description">' + b(a.description) + '</blockquote> <blockquote class="activity-content-detail">' + b(a.note) + "</blockquote> </div> "), c += " ", a.subtasks) {
                    c += ' <ul class="subtask-list"> ';
                    var h = a.subtasks;
                    if (h)
                        for (var i, f = -1, j = h.length - 1; j > f; )
                            i = h[f += 1], c += " <li>" + b(i.content) + "</li> ";
                    c += " </ul> "
                } else
                    "update_task_subtask_status" == a.action && a.subtask && (c += ' <ul class="subtask-list"> <li>' + b(a.subtask.content) + "</li> </ul> ");
                c += " </div>"
            }
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/activity/activity/index", ["require", "exports", "module", "teambition", "highlight", "thenjs", "util", "view", "models/work", "collections/works", "lib/confirm/index", "views/library/previewer/index", "lib/window/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o;
        return o = a("teambition"), f = a("highlight"), h = a("thenjs"), i = a("util"), j = a("view"), l = a("models/work"), m = a("collections/works"), e = a("lib/confirm/index"), g = a("views/library/previewer/index"), k = a("lib/window/index"), c = a("./templates/basic"), n = {involve: "icon-add-user",linked: "icon-link2",set_stage: "icon-stage",set_duedate: "icon-calendar2",set_priority: "icon-circle",set_executor: "icon-user",set_note: "icon-book",set_content: "icon-pencil",add_task_subtasks: "icon-sub-task",update_task_subtask_status: "icon-sub-task",update_task_subtask_content: "icon-sub-task",remove_task_subtask: "icon-sub-task",transform_task_subtask: "icon-convert",set_tasklist: "icon-th-list",create: "icon-plus",set_done: "icon-tick",set_redo: "icon-checkbox",set_version: "icon-file",set_collection: "icon-file",set_filename: "icon-pencil",change_event: "icon-pencil",update_entry: "icon-bookkeeping"}, d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "ActivityView", d.prototype.tagName = "li", d.prototype.className = "activity", d.prototype.events = {"click .delete-activity-handler": "showDeleteConfirmModal","click .previewer-handler": "enterPreviewer","click .activity-content": "toggleOverflow"}, d.prototype.initialize = function(a) {
                return (null != a ? a.activityModel : void 0) ? (this.options = a, this.projectRight = a.projectRight, this.activityModel = a.activityModel, this.lastActivityModel = a.lastActivityModel, this.worksCollection = m.get("activity_" + this.activityModel.id, {isRemoveAfterMove: !1}), this.worksCollection.set(this.activityModel.get("attachments"), {sort: !1}), this.render().listen(), "comment" === this.activityModel.get("action") && this.$el.addClass("comment"), this.projectRight >= 0 || this.$el.addClass("guest"), this) : void 0
            }, d.prototype.listen = function() {
                return this.listenTo(this.activityModel, "remove destroy", this.remove), this.listenTo(this.activityModel, "change", this.render), this.listenTo(this.worksCollection, "destroy", this.removeAttach), this
            }, d.prototype.render = function() {
                var a, b, d;
                return a = this.activityModel.toJSON(), a.hasRight = this.projectRight, 2 === this.activityModel.hasRight() && (a.hasRight = 2), a.lastActivityAction = null != (d = this.lastActivityModel) ? d.get("action") : void 0, a.title || (a.title = ""), a.creator || (a.creator = {_id: "",name: ""}), a.note = i.escape(a.note), a.description = i.escape($("<div>" + a.content + "</div>").text()) || a.note, a.description = i.cutString(a.description, 100, "..."), a.iconName = (b = n[a.action]) ? b : "", _.isObject(a.attachments[0]) || (a.attachments = []), _.each(a.attachments, function() {
                    return function(a) {
                        var b;
                        return a.fileSizeFix = i.formatFileSize(a.fileSize || 0), a.fileNameFix = (null != (b = a.fileName) ? b.replace(/\.[^.]*$/, "") : void 0) || "", a.thumbnail || (a.thumbnail = a.thumbnailUrl), a.thumbnailText = a.fileType, /link/.test(a.fileCategory) && (a.thumbnailText = "link"), a.fileName = i.escape(a.fileName)
                    }
                }(this)), this.$el.html(c(a)).attr("data-id", this.activityModel.id), this.$("time").timesince(), this.$("pre code").each(function() {
                    return f.highlightBlock(this)
                }), this
            }, d.prototype.showDeleteConfirmModal = function() {
                return this.requestSubView(e, {title: "删除动态",description: "确认希望永久删除这条动态？",onConfirm: function(a) {
                    return function() {
                        return a.activityModel.destroy({success: function() {
                            return Essage.show({message: "删除成功",status: "success"}, 2e3)
                        },error: function() {
                            return Essage.show({message: "删除失败，请重试",status: "error"})
                        }})
                    }
                }(this)}), this
            }, d.prototype.enterPreviewer = function(a) {
                return this.projectRight >= 0 ? (this.requestSubView(k).open(g, {_projectId: this.options._projectId,workModel: this.worksCollection.get($(a.currentTarget).data("id")),workModels: this.worksCollection.models.slice()}), this) : void 0
            }, d.prototype.toggleOverflow = function(a) {
                return $(a.currentTarget).toggleClass("overflow"), this
            }, d.prototype.removeAttach = function(a) {
                var b, c, d, e;
                for (c = this.activityModel.get("attachments"), d = e = c.length - 1; e >= 0; d = e += -1)
                    b = c[d], b._id === a.id && c.splice(d, 1);
                return this.$(".work[data-id=" + a.id + "]").remove(), this
            }, d.prototype.remove = function() {
                var a;
                return null != (a = this.$clone) && a.remove(), d.__super__.remove.apply(this, arguments)
            }, d
        }(j)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/event", ["require", "exports", "module", "teambition", "model", "moment", "rrule", "util"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), d = a("model"), e = a("moment"), f = a("rrule"), g = a("util"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "event", c.prototype.urlRoot = "events", c.prototype.defaults = {involveMembers: [],content: null}, c.prototype.initialize = function() {
                return this.on("change:involveMembers", function(a) {
                    return function(b, c) {
                        var d;
                        if (d = a.isRecurrenceDelegate())
                            return d.save(null, {attrs: {involveMembers: c},success: function() {
                                return d.createFromRecurrence(d.getRecurrenceAfter(a.get("startDate")), {success: function(b) {
                                    var c;
                                    return null != (c = a.collection) ? c.add(b) : void 0
                                }})
                            }})
                    }
                }(this)), this.on("change:tagIds", function(a) {
                    return function(b, c) {
                        var d;
                        if (d = a.isRecurrenceDelegate())
                            return d.save(null, {attrs: {tagIds: c},success: function() {
                                return d.createFromRecurrence(d.getRecurrenceAfter(a.get("startDate")), {success: function(b) {
                                    var c;
                                    return null != (c = a.collection) ? c.add(b) : void 0
                                }})
                            }})
                    }
                }(this)), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.parse = function(a) {
                var b;
                return null == a && (a = {}), b = this.toJSON(), b = _.extend(b, a), b._projectId && (b.acanoUrl = "" + h.apiHost + "/projects/" + b._projectId + "/acano"), b
            }, c.prototype.getScope = function() {
                var a, b, c, d;
                return b = e(this.get("startDate")).valueOf(), a = e(this.get("endDate") || null).valueOf(), c = e().endOf("day").valueOf(), d = e().subtract(1, "days").endOf("day").valueOf(), b > c ? "future" : b > d || a > d ? "today" : "past"
            }, c.prototype.getOnDate = function() {
                var a, b, c;
                return b = e(this.get("startDate")), a = e(this.get("endDate") || null).valueOf(), c = e().subtract(1, "days").endOf("day").valueOf(), b.valueOf() <= c && a > c ? e().format("YYYYMMDD") : b.format("YYYYMMDD")
            }, c.prototype.getRRule = function() {
                var a;
                return a = this.get("recurrence"), a && (a = _.find(a, function(a) {
                    return -1 !== a.indexOf("RRULE:")
                })), a && (a = a.replace("RRULE:", "")), a && (a = f.fromString(a)), a
            }, c.prototype.genRecurrence = function(a) {
                var b;
                return a = "RRULE:" + a.toString(), b = this.get("recurrence") || [], b = _.map(b, function(b) {
                    return -1 !== b.indexOf("RRULE:") ? a : b
                }), b.length || b.push(a), b
            }, c.prototype.createFromRecurrence = function(a, b) {
                return b = _.extend({url: this.urlRoot,attrs: {_sourceId: this.id,mode: "single",startDate: new Date(a).toISOString()},success: function() {
                },error: function() {
                }}, b), a && this.getRRule() ? this.sync("create", this, b) : b.error("Error!")
            }, c.prototype.stopRecurrence = function(a) {
                var b, c;
                if (b = null != (c = this.getRRule()) ? c.origOptions : void 0)
                    return b.until = new Date(a), b.until.valueOf() <= b.dtstart.valueOf() ? this.destroy() : this.save(null, {attrs: {recurrence: this.genRecurrence(new f(b))}})
            }, c.prototype.getRecurrenceAfter = function(a) {
                var b;
                return a = a ? new Date(a) : new Date, null != (b = this.getRRule()) ? b.after(a) : void 0
            }, c.prototype.isRecurrenceDelegate = function() {
                var a, b;
                return a = null != (b = this.collection) ? b.getRecurrence(this.get("_sourceId")) : void 0, a && this.get("created") === this.get("updated") && a.getRecurrenceAfter(this.get("startDate")) ? a : null
            }, c.prototype.destroyRecurrence = function() {
                var a, b;
                return null != (a = this.collection) && null != (b = a.getRecurrence(this.get("_sourceId"))) ? b.destroy() : void 0
            }, c
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/events", ["require", "exports", "module", "collection", "models/event", "moment", "rrule", "thenjs"], function(a) {
        var c, d, e, f, g, h;
        return c = a("collection"), e = a("models/event"), f = a("moment"), g = a("rrule"), h = a("thenjs"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "events", c.prototype.model = e, c.prototype.boundToObjectType = "project", c.prototype.initialize = function(a, b) {
                return this._recurrence = {}, this.fromDate = b.fromDate || f().startOf("day").toISOString(), b.toDate && (this.toDate = b.toDate), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.parse = function(a) {
                var b;
                if (a)
                    return b = [], _.isArray(a) || (a = [a]), _.each(a, function(a) {
                        return function(c) {
                            return ("function" == typeof c.get ? c.get("recurrence") : void 0) || c.recurrence ? a.setRecurrence(c) : b.push(c)
                        }
                    }(this)), b
            }, c.prototype.comparator = function(a, b) {
                return new Date(b.get("startDate")) - new Date(a.get("startDate"))
            }, c.prototype.getParams = function(a, b) {
                var c;
                return "read" === a ? c = {boundToObjectType: b.boundToObjectType || this.boundToObjectType,_boundToObjectId: this._boundToObjectId} : void 0
            }, c.prototype.getRecurrence = function(a) {
                return this._recurrence[a]
            }, c.prototype.setRecurrence = function(a, b) {
                var c, d, f;
                if (a = ("function" == typeof a.toJSON ? a.toJSON() : void 0) || a, a._id && a.recurrence) {
                    if (b = _.extend({check: !0}, b), c = this._recurrence[a._id])
                        c.set(a, b);
                    else {
                        if (c = new e(a, b), d = c.getRRule(), !((null != d ? d.origOptions.freq : void 0) <= 3 && d.origOptions.dtstart))
                            return c.destroy();
                        if ((null != d && null != (f = d.options.until) ? f.valueOf() : void 0) < Date.now())
                            return c.destroy();
                        if (this._recurrence[a._id] = c, c.on("remove destroy", function(a) {
                            return function() {
                                return a.removeRecurrence(c.id)
                            }
                        }(this)), c.on("change remove destroy", function(a) {
                            return function() {
                                return a.each(function(a) {
                                    return a.get("_sourceId") === c.id ? a.trigger("change:_sourceId", a, c.id) : void 0
                                })
                            }
                        }(this)), !(c.hasRight() >= 0))
                            return c;
                        _.delay(function(a) {
                            return function() {
                                var b, e, f, g;
                                return g = c.id, a.fromDate && a.toDate ? (e = d.between(new Date(a.fromDate), new Date(a.toDate), !0), h.eachSeries(e, function(b, d) {
                                    return d = d.toISOString(), a.findInstanceBySource(g, d) ? b() : c.createFromRecurrence(d, {error: function() {
                                        return b()
                                    },success: function(c) {
                                        return a.add(c), b()
                                    }})
                                })) : (b = null != (f = d.after(new Date(a.fromDate), !0)) ? f.toISOString() : void 0, b && !a.findInstanceBySource(g, b) ? c.createFromRecurrence(b, {success: function(b) {
                                    return a.add(b)
                                }}) : void 0)
                            }
                        }(this))
                    }
                    return c
                }
            }, c.prototype.removeRecurrence = function(a) {
                return delete this._recurrence[a]
            }, c.prototype.findInstanceBySource = function(a, b) {
                return this.find(function(c) {
                    return c.get("_sourceId") === a && c.get("sourceDate") === b
                })
            }, c.prototype.remove = function(a) {
                return _.isString(a) && this.removeRecurrence(a), c.__super__.remove.apply(this, arguments)
            }, c
        }(c)
    }), define("views/object/object-picker-events/templates/basic", [], function() {
        return function() {
            var a = '<ul class="events-list thin-scroll"></ul>';
            return a
        }
    }), define("views/object/object-picker-events/templates/event", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="group-name"> <p>待参加的日程</p></li>', d = a.events;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="event ', e.disabled && (c += "disabled"), c += '" data-id="' + e._id + '"> <div class="event-time muted"> <time>' + e.startDateString + "</time> ", e.endDateString && (c += " <time>" + e.endDateString + "</time> "), c += ' </div> <div class="event-content-wrapper"> <span class="event-title">' + b(e.title) + "</span> </div></li>";
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/object/object-picker-events/index", ["require", "exports", "module", "teambition", "moment", "lib/scrollable", "thenjs", "util", "view", "collections/events", "./templates/basic", "./templates/event", "essage"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n;
        return m = a("teambition"), g = a("moment"), i = a("lib/scrollable"), j = a("thenjs"), k = a("util"), l = a("view"), f = a("collections/events"), c = a("./templates/basic"), e = a("./templates/event"), n = a("essage"), h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "ObjectPickerEventsView", h.prototype.className = "object-picker-events-view", h.prototype.events = {"click .event": "toggleEvent"}, h.prototype.initialize = function(a) {
                return a._projectId ? (this.options = a, this._projectId = a._projectId, this.selected = [], this.renderBasic(), this.showLoadingIndicator(this.$list), j(function(a) {
                    return function(b) {
                        return f.fetch(a._projectId, {attrs: {today: g().startOf("day").toISOString()},success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b, c) {
                        return a.$el ? (a.hideLoadingIndicator({animated: !1}), a.eventsCollection = c, a.renderEvents(a.eventsCollection.models), a.setupScroll(a.$list)) : void 0
                    }
                }(this)).fail(function() {
                    return function(a, b) {
                        return Essage.show({message: String(b),status: "error"}, 2e3)
                    }
                }(this)), this) : void 0
            }, h.prototype.loadMore = function(a) {
                var b, c;
                return c = b = 0, this.eventsCollection.loadMore({silent: !0,beforeSend: function(a) {
                    return function() {
                        return c = (new Date).getTime(), a.showLoadingIndicator(a.$list)
                    }
                }(this),success: function(d) {
                    return function(e, f) {
                        var g, h;
                        if (d.$el)
                            return b = (new Date).getTime(), h = b - c, g = 1e3 > h ? 1e3 - h : 0, _.delay(function() {
                                return d.$el ? (d.hideLoadingIndicator({animated: !0}), d.renderEvents(f.map(function(a) {
                                    return d.eventsCollection.get(a._id)
                                })), d.eventsCollection.hasMore ? "function" == typeof a ? a() : void 0 : d.showEndPoint(d.$list)) : void 0
                            }, g)
                    }
                }(this)}), this
            }, h.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$list = this.$(".events-list"), this
            }, h.prototype.renderEvents = function(a) {
                var b;
                return b = $(e({events: _.map(a, function(a) {
                    return function(b) {
                        var c, e, f, h, i;
                        return c = b.toJSON(), f = "HH:mm", c.startDateString = g(c.startDate).format(f), h = k.formatDate(new Date(c.startDate)).dateString, c.startDateString = h + " " + c.startDateString, c.disabled = (i = b.id, d.call(a.options.exclude, i) >= 0), null != c.endDate && (e = k.formatDate(new Date(c.endDate)).dateString, c.endDateString = g(c.endDate).format(f), c.startDateString += " - ", e !== h ? c.endDateString = h + " " + c.endDateString : (c.startDateString += c.endDateString, c.endDateString = "")), c
                    }
                }(this))})), this.$list.append(b), this
            }, h.prototype.toggleEvent = function(a) {
                var b, c;
                return b = $(a.currentTarget), b.hasClass("disabled") ? void 0 : !b.hasClass("selected") && this.selected.length >= 10 ? Essage.show({message: "一次最多选择 10 个关联对象！",status: "error"}, 2e3) : (b.toggleClass("selected"), c = b.data("id"), b.hasClass("selected") ? this.selected.push(c) : k.removeItem(this.selected, c), this.options.select(this.selected.map(function(a) {
                    return {_id: a,type: "event"}
                })), this)
            }, h
        }(l), _.extend(h.prototype, i), h
    }), define("views/object/object-picker-files/templates/basic", [], function() {
        return function() {
            var a = '<ul class="files-column horizontal-scroll"></ul>';
            return a
        }
    }), define("views/object/object-picker-files/templates/column", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="column thin-scroll" data-id="' + a._id + '"> <ul class="column-wrap"> ';
            a.folders.length && (c += ' <li class="group-name"> <p>文件夹</p> </li> '), c += " ";
            var d = a.folders;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <li class="file-handler clearfix collection hinted ', e.disabled && (c += "disabled"), c += '" data-title="' + e.title + '" data-id="' + e._id + '"> <span class="icon icon-folder-bold collection-thumbnail ' + e.color + ' pull-left"></span> <span class="collection-title">' + b(e.title) + "</span> </li> ";
            c += " ", a.files.length && (c += ' <li class="group-name"> <p>文件</p> </li> '), c += " ";
            var h = a.files;
            if (h)
                for (var e, i = -1, j = h.length - 1; j > i; )
                    e = h[i += 1], c += ' <li class="file-handler clearfix work hinted ', e.disabled && (c += "disabled"), c += '" data-title="' + e.fileName + '" data-id="' + e._id + '"> ', c += e.thumbnail ? ' <div class="work-thumbnail pull-left" style="background-image: url(' + e.thumbnail + ');"> </div> ' : ' <div class="work-thumbnail ' + e.fileType + ' pull-left">' + e.fileType + "</div> ", c += ' <span class="work-title">' + b(e.fileName) + "</span> </li> ";
            return c += " </ul></li>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/object/object-picker-files/index", ["require", "exports", "module", "teambition", "thenjs", "util", "view", "collections/collections", "collections/projects", "collections/works", "./templates/basic", "./templates/column", "essage"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n;
        return m = a("teambition"), i = a("thenjs"), j = a("util"), k = a("view"), e = a("collections/collections"), h = a("collections/projects"), l = a("collections/works"), c = a("./templates/basic"), f = a("./templates/column"), n = a("essage"), g = function(a) {
            function g() {
                return g.__super__.constructor.apply(this, arguments)
            }
            return b(g, a), g.prototype.viewName = "ObjectPickerFilesView", g.prototype.className = "object-picker-files-view", g.prototype.events = {"click .file-handler.collection": "showContent","click .file-handler.work": "toggleWork","click .column": "unselect"}, g.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this.projectModel = h.getOne(0, a._projectId), this._defaultCollectionId = this.projectModel.get("_defaultCollectionId"), this._rootCollectionId = this.projectModel.get("_rootCollectionId"), this.selected = [], this.options = _.extend({select: function() {
                },unselect: function() {
                }}, a), this.cache = {}, this.renderBasic().renderRoot(), this) : void 0
            }, g.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$column = this.$(".files-column"), this
            }, g.prototype.loadCollection = function(a, b) {
                return i.series([function(b) {
                    return function(c) {
                        return e.fetch(a, {attrs: {all: !0,_parentId: a,_projectId: b._projectId},success: function(a) {
                            return a.each(function(a) {
                                return b.cache[a.id] = a
                            }), c(null, a)
                        },error: function(a, b) {
                            return c(b, null)
                        }})
                    }
                }(this), function(b) {
                    return function(c) {
                        return b.options.noWorks ? c(null) : l.fetch(a, {attrs: {all: !0,_parentId: a,_projectId: b._projectId},success: function(a) {
                            return a.each(function(a) {
                                return b.cache[a.id] = a
                            }), c(null, a)
                        },error: function(a, b) {
                            return c(b, null)
                        }})
                    }
                }(this)]).fin(function(a) {
                    return function(c, d, e) {
                        var f, g, h;
                        if (a.$el)
                            return d && Essage.show({message: d.message || d,status: "error"}, 2e3), f = null != (g = e[0]) ? g.models : void 0, f && (f = f.concat((null != (h = e[1]) ? h.models : void 0) || [])), b(d, f)
                    }
                }(this)), this
            }, g.prototype.resetView = function(a) {
                return a ? a.nextAll().remove() : this.$column.empty(), this
            }, g.prototype.renderRoot = function() {
                return this.resetView(), this.loadCollection(this._rootCollectionId, function(a) {
                    return function(b, c) {
                        return a.renderColumn(c, a._rootCollectionId)
                    }
                }(this)), this
            }, g.prototype.renderColumn = function(a, b) {
                var c, e, g;
                return g = [], e = [], _.each(a, function(a) {
                    return function(c) {
                        var f, h;
                        return f = ("function" == typeof c.toJSON ? c.toJSON() : void 0) || c, f._id !== a._defaultCollectionId ? (b || (b = f._parentId), f.disabled = (h = c.id, d.call(a.options.exclude, h) >= 0), "collection" === f.objectType ? g.push(f) : e.push(f)) : void 0
                    }
                }(this)), c = this.$column.children(".column:last"), c.find(".file-handler[data-id=" + b + "]").addClass("active").siblings().removeClass("active"), this.$column.append(f({_id: b,folders: g,files: e})), this.$column.animate({scrollLeft: 200 * this.$column.children().length - this.$column.width()}), this
            }, g.prototype.showContent = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = b.data("id"), b.hasClass("active") || this.loadCollection(c, function(a) {
                    return function(d, e) {
                        return a.resetView(b.closest("li.column")), a.renderColumn(e, c)
                    }
                }(this)), this
            }, g.prototype.toggleWork = function(a) {
                var b, c;
                return b = $(a.currentTarget), b.hasClass("disabled") ? void 0 : !b.hasClass("selected") && this.selected.length >= 10 ? Essage.show({message: "一次最多选择 10 个关联对象！",status: "error"}, 2e3) : (b.toggleClass("selected"), c = b.data("id"), b.hasClass("selected") ? this.selected.push(c) : j.removeItem(this.selected, c), this.options.select(this.selected.map(function(a) {
                    return {_id: a,type: "work"}
                })), this)
            }, g
        }(k)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/post", ["require", "exports", "module", "model", "util"], function(a) {
        var c, d, e;
        return c = a("model"), e = a("util"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "post", c.prototype.urlRoot = "posts", c.prototype.defaults = {objectType: "post",involveMembers: [],links: []}, c.prototype.parse = function(a) {
                return a = _.extend(this.toJSON(), a), e.parsePost(a)
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("collections/posts", ["require", "exports", "module", "collection", "models/post"], function(a) {
        var c, e, f;
        return c = a("collection"), f = a("models/post"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "posts", c.prototype.model = f, c.prototype.pageNum = 20, c.prototype.boundToObjectType = "project", c.prototype.order = -1, c.prototype.orderBy = "updated", c.prototype.getType = function(a) {
                var b;
                return b = ["all", "my"], d.call(b, a) >= 0 ? a : b[0]
            }, c.prototype.getParams = function(a, b) {
                return {type: "read" === a && null != b ? b.section : void 0}
            }, c.prototype.comparator = function(a, b) {
                var c;
                return (c = (b.get("pin") || 0) - (a.get("pin") || 0)) ? c : (c = new Date(a.get(this.orderBy)) - new Date(b.get(this.orderBy)), c = this.order * c)
            }, c
        }(c)
    }), define("views/object/object-picker-posts/templates/basic", [], function() {
        return function() {
            var a = '<ul class="posts-list thin-scroll"></ul>';
            return a
        }
    }), define("views/object/object-picker-posts/templates/post", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.posts;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="post ', e.disabled && (c += "disabled"), c += '" data-id="' + e._id + '"> <div class="post-content-wrapper"> <span class="post-title" >' + b(e.description) + "</span> </div></li>";
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/object/object-picker-posts/index", ["require", "exports", "module", "teambition", "lib/scrollable", "thenjs", "util", "view", "collections/members", "collections/posts", "./templates/basic", "./templates/post", "essage"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n;
        return m = a("teambition"), i = a("lib/scrollable"), j = a("thenjs"), k = a("util"), l = a("view"), e = a("collections/members"), h = a("collections/posts"), c = a("./templates/basic"), g = a("./templates/post"), n = a("essage"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "ObjectPickerPostsView", f.prototype.className = "object-picker-posts-view", f.prototype.events = {"click .post": "togglePost"}, f.prototype.initialize = function(a) {
                return a._projectId ? (this.options = a, this._projectId = a._projectId, this.selected = [], this.renderBasic(), this.showLoadingIndicator(this.$list), j.parallel([function(a) {
                    return function(b) {
                        return e.fetch(a._projectId, {success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this), function(a) {
                    return function(b) {
                        return h.fetch(a._projectId, {success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this)]).then(function(a) {
                    return function(b, c) {
                        return a.$el ? (a.hideLoadingIndicator({animated: !1}), a.membersCollection = c[0], a.postsCollection = c[1], a.renderPosts(a.postsCollection.models), a.setupScroll(a.$list)) : void 0
                    }
                }(this)).fail(function() {
                    return function(a, b) {
                        return Essage.show({message: String(b),status: "error"}, 2e3)
                    }
                }(this)), this) : void 0
            }, f.prototype.loadMore = function(a) {
                var b, c;
                return c = b = 0, this.postsCollection.loadMore({silent: !0,section: "all",beforeSend: function(a) {
                    return function() {
                        return c = (new Date).getTime(), a.showLoadingIndicator(a.$list)
                    }
                }(this),success: function(d) {
                    return function(e, f) {
                        var g, h;
                        if (d.$el)
                            return b = (new Date).getTime(), h = b - c, g = 1e3 > h ? 1e3 - h : 0, _.delay(function() {
                                return d.$el ? (d.hideLoadingIndicator({animated: !0}), d.renderPosts(f.map(function(a) {
                                    return d.postsCollection.get(a._id)
                                })), d.postsCollection.hasMore ? "function" == typeof a ? a() : void 0 : d.showEndPoint(d.$list)) : void 0
                            }, g)
                    }
                }(this)}), this
            }, f.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$list = this.$(".posts-list"), this
            }, f.prototype.renderPosts = function(a) {
                var b;
                return b = $(g({posts: _.map(a, function(a) {
                    return function(b) {
                        var c, e;
                        return c = b.toJSON(), c.disabled = (e = b.id, d.call(a.options.exclude, e) >= 0), c
                    }
                }(this))})), this.$list.append(b), this
            }, f.prototype.togglePost = function(a) {
                var b, c;
                return b = $(a.currentTarget), b.hasClass("disabled") ? void 0 : !b.hasClass("selected") && this.selected.length >= 10 ? Essage.show({message: "一次最多选择 10 个关联对象！",status: "error"}, 2e3) : (b.toggleClass("selected"), c = b.data("id"), b.hasClass("selected") ? this.selected.push(c) : k.removeItem(this.selected, c), this.options.select(this.selected.map(function(a) {
                    return {_id: a,type: "post"}
                })), this)
            }, f
        }(l), _.extend(f.prototype, i), f
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/search", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return c = a("model"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "search", c.prototype.urlRoot = "search", c.prototype.initialize = function(a, b) {
                return b || (b = {}), b.bindByMatrix = !1, c.__super__.initialize.apply(this, arguments)
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/searches", ["require", "exports", "module", "collection", "models/search"], function(a) {
        var c, d, e;
        return c = a("collection"), d = a("models/search"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "search", c.prototype.model = d, c.prototype.pageNum = 20, c
        }(c)
    }), define("views/object/object-picker-search/templates/noresult", [], function() {
        return function() {
            var a = '<div class="search-placeholder-wrap muted"> <div> <p> <span class="icon icon-search-warning"></span> </p> <p class="search-placeholder-content">快速搜索，查找你所需的内容</p> </div></div>';
            return a
        }
    }), define("views/object/object-picker-search/templates/result", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            if (a.tasks.length) {
                c += '<li class="search-result card"> ';
                var d = a.tasks;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; ) {
                        if (e = d[f += 1], c += ' <a class="result-handler task" data-id="' + e._id + '" data-type="task"> <div class="result-thumbnail"> <span class="icon icon-checkbox"></span> </div> <div class="result-content"> <p> <span>' + e.title + "</span> ", e.tag && (c += ' <span class="label"> <span class="tag-label tag-label-' + e.tag.color + '"></span> <span class="tag-name">' + b(e.tag.name) + "</span> </span> "), c += " </p> ", e.subtasks && e.subtasks.length > 0) {
                            c += " <ul> ";
                            var h = e.subtasks;
                            if (h)
                                for (var i, j = -1, k = h.length - 1; k > j; )
                                    i = h[j += 1], c += ' <li class="subtask"> <span class="icon icon-checkbox"></span> ' + (i.content || i.highlight) + " </li> ";
                            c += " </ul> "
                        }
                        c += " </div> </a> "
                    }
                c += "</li>"
            }
            if (a.posts.length) {
                c += '<li class="search-result card"> ';
                var l = a.posts;
                if (l)
                    for (var e, m = -1, n = l.length - 1; n > m; )
                        e = l[m += 1], c += ' <a class="result-handler post" data-id="' + e._id + '" data-type="post"> <div class="result-thumbnail"> <div class="avatar img-24 img-circle pull-left" style="background-image: url(' + e.avatarUrl + ');"></div> </div> <div class="result-content"> <p> <span>' + e.title + "</span> ", e.tag && (c += ' <span class="label"> <span class="tag-label tag-label-' + e.tag.color + '"></span> <span class="tag-name">' + b(e.tag.name) + "</span> </span> "), c += " </p> </div> </a> ";
                c += "</li>"
            }
            if (a.files.length) {
                c += '<li class="search-result card"> ';
                var o = a.files;
                if (o)
                    for (var e, p = -1, q = o.length - 1; q > p; )
                        e = o[p += 1], c += ' <a class="result-handler work" data-id="' + e._id + '" data-type="work"> <div class="result-thumbnail"> ', c += e.thumbnailUrl ? ' <div class="work-thumbnail ' + e.fileType + ' pull-left" style="background-image: url(' + e.thumbnailUrl + ');"></div> ' : ' <span class="icon icon-file-bold"></span> ', c += ' </div> <div class="result-content"> <p> <span>' + e.title + "</span> ", e.tag && (c += ' <span class="label"> <span class="tag-label tag-label-' + e.tag.color + '"></span> <span class="tag-name">' + b(e.tag.name) + "</span> </span> "), c += " </p> </div> </a> ";
                c += "</li>"
            }
            if (a.events.length) {
                c += '<li class="search-result card"> ';
                var r = a.events;
                if (r)
                    for (var e, s = -1, t = r.length - 1; t > s; )
                        e = r[s += 1], c += ' <a class="result-handler event" data-id="' + e._id + '" data-type="event"> <div class="result-content"> <p> <time class="event-date">' + e.eventDateString + "</time> <span>" + e.title + "</span> ", e.tag && (c += ' <span class="label"> <span class="tag-label tag-label-' + e.tag.color + '"></span> <span class="tag-name">' + b(e.tag.name) + "</span> </span> "), c += " </p> </div> </a> ";
                c += "</li>"
            }
            return c
        }
    }), define("views/object/object-picker-search/templates/basic", [], function() {
        return function() {
            var a = '<div class="search-form clearfix"> <input type="search" placeholder="可以搜索任务、分享、日程、文件..." maxlength="100" class="form-control search-input pull-left"> <button class="search-btn btn btn-primary pull-left"> <span class="icon icon-search"></span> </button></div><ul class="search-list thin-scroll"></ul>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/object/object-picker-search/index", ["require", "exports", "module", "teambition", "moment", "lib/scrollable", "util", "view", "collections/projects", "collections/searches", "lib/window/index", "./templates/noresult", "./templates/result", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n;
        return n = a("teambition"), c = a("moment"), h = a("lib/scrollable"), k = a("util"), l = a("view"), f = a("collections/projects"), j = a("collections/searches"), m = a("lib/window/index"), d = a("./templates/noresult"), g = a("./templates/result"), i = a("./templates/basic"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "ObjectPickerSearchView", e.prototype.className = "object-picker-search-view", e.prototype.events = {"click .search-btn": "startSearch","keydown .search-input": "quickSearch","click .result-handler": "toggleResult"}, e.prototype.initialize = function(a) {
                return this.options = a || {}, this.collection = j.get(0), this.renderBasic().listen(), this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(i()), this.$noresult = $(d()), this.$input = this.$(".search-input"), this.$list = this.$(".search-list"), this
            }, e.prototype.listen = function() {
                return this.listenTo(this.collection, "reset", function(a) {
                    return function() {
                        return a.$list.empty()
                    }
                }(this)), this
            }, e.prototype.renderResult = function(a) {
                var b;
                return b = {tasks: [],posts: [],files: [],events: []}, _.each(a, function(a) {
                    return function(c) {
                        switch (c = a.getHighlight(c), c = a.getDateString(c), c.type) {
                            case "task":
                                return b.tasks.push(c);
                            case "post":
                                return b.posts.push(c);
                            case "work":
                                return b.files.push(c);
                            case "event":
                                return b.events.push(c)
                        }
                    }
                }(this)), this.$list.append(g(b)), this
            }, e.prototype.getHighlight = function(a) {
                return a.title = _.escape(a.title || a.highlight), a.title = a.title.replace(/\&lt;em\&gt;([^\s]+?)\&lt;\/em\&gt;/g, "<em>$1</em>"), a
            }, e.prototype.getDateString = function(a) {
                var b, d;
                return a.startDate && (d = k.formatDate(new Date(a.startDate)).dateString, a.eventDateString = d + " " + c(a.startDate).format("LT"), a.endDate && (a.eventDateString += " ~", b = k.formatDate(new Date(a.endDate)).dateString, b !== d && (a.eventDateString += " " + b), a.eventDateString += " " + c(a.endDate).format("LT"))), a.dateString = k.formatDate(new Date(a.date)).dateString, a
            }, e.prototype.startSearch = function() {
                var a;
                return a = this.$input.val().trim(), this.collection.reset(), this.text = a, this.text ? this.load({silent: !0,attrs: {q: this.text},beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$list)
                    }
                }(this),success: function(a) {
                    return function(b, c) {
                        return a.$el ? (a.renderResult(c), a.hideLoadingIndicator(), a.checkPlaceholder(), a.collection.hasMore ? a.setupScroll(a.$list) : a.collection.length && a.showEndPoint(a.$list), n.gta.event(null, "view", "search result|start search", a.text.length)) : void 0
                    }
                }(this)}) : this.checkPlaceholder(), this
            }, e.prototype.quickSearch = function(a) {
                return 13 === a.keyCode && (a.preventDefault(), this.startSearch()), this
            }, e.prototype.load = function(a) {
                return this.collection.resetSoft(), this.collection.fetch(a), this
            }, e.prototype.loadMore = function(a) {
                return this.collection.loadMore({silent: !0,attrs: {q: this.text},beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$list)
                    }
                }(this),success: function(b) {
                    return function(c, d) {
                        return b.$el ? (b.hideLoadingIndicator({animated: !0}), _.each(d, function(a) {
                            return b.collection.add(a)
                        }), b.renderResult(d), b.collection.hasMore ? "function" == typeof a && a() : b.showEndPoint(b.$list), n.gta.event(null, "view", "search result|load more", b.pageIndex + 1)) : void 0
                    }
                }(this)}), this
            }, e.prototype.checkPlaceholder = function() {
                var a;
                return this.collection.length ? this.$noresult.remove() : this.text.length > 0 && (a = this.text, this.$noresult.find(".search-placeholder-content").text("抱歉，没有找到与 “" + a + "” 相关的内容"), this.$list.html(this.$noresult)), this
            }, e.prototype.toggleResult = function(a) {
                var b, c;
                return c = [], b = $(a.currentTarget), b.hasClass("disabled") ? void 0 : (b.toggleClass("selected"), b.parent().siblings().find(".selected").removeClass("selected"), b.siblings().removeClass("selected"), b.hasClass("selected") && c.push({_id: b.data("id"),type: b.data("type")}), this.options.select(c), this)
            }, e
        }(l), _.extend(e.prototype, h), e
    }), define("views/object/object-picker-tasks/templates/basic", [], function() {
        return function() {
            var a = '<ul class="tasklists-list thin-scroll"></ul><ul class="tasks-list thin-scroll"></ul>';
            return a
        }
    }), define("views/object/object-picker-tasks/templates/tasklist", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="group-name"> <p>任务分组</p></li>', d = a.tasklists;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li> <a class="tasklist-item" data-id="' + e._id + '">' + b(e.title) + "</a></li>";
            return c
        }
    }), define("views/object/object-picker-tasks/templates/task", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.tasks;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="task ', e.disabled && (c += "disabled"), c += '" data-id="' + e._id + '"> ', c += e.executor && e.executor.avatarUrl ? ' <div class="avatar img-circle img-24" style="background-image:url(' + e.executor.avatarUrl + ')"></div> ' : ' <div class="avatar img-circle img-24 no-avatar"></div> ', c += ' <div class="task-content-wrapper"> <span class="task-content">' + b(e.content) + "</span> </div></li>";
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/object/object-picker-tasks/index", ["require", "exports", "module", "teambition", "thenjs", "util", "view", "collections/members", "collections/stages", "collections/tasklists", "collections/tasks", "views/core/popover-menu/index", "./templates/basic", "./templates/tasklist", "./templates/task", "essage"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n, o, p, q;
        return p = a("teambition"), m = a("thenjs"), n = a("util"), o = a("view"), e = a("collections/members"), h = a("collections/stages"), k = a("collections/tasklists"), l = a("collections/tasks"), g = a("views/core/popover-menu/index"), c = a("./templates/basic"), j = a("./templates/tasklist"), i = a("./templates/task"), q = a("essage"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "ObjectPickerTasksView", f.prototype.className = "object-picker-tasks-view", f.prototype.events = {"click .tasklist-item": "switchTasklist","click .task": "toggleTask"}, f.prototype.initialize = function(a) {
                return a._projectId ? (this.options = a, this._projectId = a._projectId, this.tasksCache = {}, this.selected = [], this.renderBasic(), this.showLoadingIndicator(this.$list), m.parallel([function(a) {
                    return function(b) {
                        return k.fetch(a._projectId, {success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this), function(a) {
                    return function(b) {
                        return e.fetch(a._projectId, {success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this)]).then(function(a) {
                    return function(b, c) {
                        return a.$el ? (a.hideLoadingIndicator({animated: !1}), a.tasklistsCollection = c[0], a.membersCollection = c[1], a.tasklistsCollection.updateSort(p.PREFERENCE.tasklistSortInProject(a._projectId), !0), a.renderTasklist()) : void 0
                    }
                }(this)).fail(function() {
                    return function(a, b) {
                        return Essage.show({message: String(b),status: "error"}, 2e3)
                    }
                }(this)), this) : void 0
            }, f.prototype.loadTasks = function() {
                return m(function(a) {
                    return function(b) {
                        return a.showLoadingIndicator(a.$list), h.fetch(a.tasklistModel.id, {success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b, c) {
                        return a.stagesCollection = c, m.eachSeries(a.stagesCollection.pluck("_id"), function(a, b) {
                            return l.fetch(b, {attrs: {all: !0,isDone: !1},error: function(b) {
                                return a(b, null)
                            },success: function(b) {
                                return a(null, b)
                            }})
                        }).fin(b)
                    }
                }(this)).then(function(a) {
                    return function(b, c) {
                        var d;
                        if (a.$el)
                            return a.hideLoadingIndicator({animated: !1}), d = [], _.each(c, function(a) {
                                return a.each(function(a) {
                                    return d.push(a)
                                })
                            }), a.renderTasks(d)
                    }
                }(this)).fail(function() {
                    return function(a, b) {
                        return Essage.show({message: String(b),status: "error"}, 2e3)
                    }
                }(this)), this
            }, f.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$list = this.$(".tasks-list"), this.$taskgroup = this.$(".tasklists-list"), this
            }, f.prototype.renderTasklist = function() {
                return this.$taskgroup.html(j({tasklists: this.tasklistsCollection.map(function(a) {
                    return a.toJSON()
                })})), this
            }, f.prototype.renderTasks = function(a) {
                return this.$list.append(i({tasks: _.map(a, function(a) {
                    return function(b) {
                        var c, e, f;
                        return a.tasksCache[b.id] = b, c = b.toJSON(), c.executor = c.executor || (null != (e = a.membersCollection.get(c._executorId)) ? e.toJSON() : void 0) || {}, c.content = n.escape(_.unescape(c.content)), c.dueDate && (c.dueDate = n.formatDate(c.dueDate)), c.accomplished && (c.accomplished = n.formatDate(c.accomplished)), c.disabled = (f = b.id, d.call(a.options.exclude, f) >= 0), c
                    }
                }(this))})), this
            }, f.prototype.toggleTask = function(a) {
                var b, c;
                return b = $(a.currentTarget), b.hasClass("disabled") ? void 0 : !b.hasClass("selected") && this.selected.length >= 10 ? Essage.show({message: "一次最多选择 10 个关联对象！",status: "error"}, 2e3) : (b.toggleClass("selected"), c = b.data("id"), b.hasClass("selected") ? this.selected.push(c) : n.removeItem(this.selected, c), this.options.select(this.selected.map(function(a) {
                    return {_id: a,type: "task"}
                })), this)
            }, f.prototype.switchTasklist = function(a) {
                var b, c, d;
                return (null != a ? a.currentTarget : void 0) ? (b = $(a.currentTarget), d = b.data("id")) : (d = a, b = this.$taskgroup.find(".tasklist-item[data-id=" + d + "]")), d === (null != (c = this.tasklistModel) ? c.id : void 0) ? this : (this.tasklistModel = this.tasklistsCollection.get(d), b.parent().addClass("active").siblings().removeClass("active"), this.tasksCache = {}, this.$list.empty(), this.selected = [], this.options.select([]), this.loadTasks(), this)
            }, f
        }(o)
    }), define("views/object/object-picker/templates/basic", [], function() {
        return function() {
            var a = '<div class="modal-content"> <div class="modal-header sub-nav"> <ul class="nav nav-underscore"> <li> <a class="object-nav" data-type="task"> <span class="icon icon-board"></span><br /> <span class="object-nav-title">任务板</span> </a> </li> <li> <a class="object-nav" data-type="post"> <span class="icon icon-wall"></span><br /> <span class="object-nav-title">分享墙</span> </a> </li> <li> <a class="object-nav" data-type="file"> <span class="icon icon-library"></span><br /> <span class="object-nav-title">文件库</span> </a> </li> <li> <a class="object-nav" data-type="event"> <span class="icon icon-calendar"></span><br /> <span class="object-nav-title">日程表</span> </a> </li> <li> <a class="object-nav" data-type="search"> <span class="icon icon-search"></span><br /> <span class="object-nav-title">搜索</span> </a> </li> </ul> </div> <div class="modal-body"> <ul class="projects-nav thin-scroll scrollable"></ul> <div class="picker-content"></div> </div> <div class="modal-footer"> <button class="cancel-handler btn btn-link">取消</button> <button class="confirm-handler btn btn-primary">确定</button> </div></div>';
            return a
        }
    }), define("views/object/object-picker/templates/project", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.projects;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += "<li ", "groupBy" == e.type && (c += 'class="group-name"'), c += "> ", c += "groupBy" == e.type ? " <p>" + b(e.groupName) + "</p> " : ' <a class="project-item" data-id="' + e._id + '">' + b(e.name) + "</a> ", c += "</li>";
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/object/object-picker/index", ["require", "exports", "module", "lib/scrollable", "thenjs", "util", "view", "collections/organizations", "collections/projects", "views/object/object-picker-events/index", "views/object/object-picker-files/index", "views/object/object-picker-posts/index", "views/object/object-picker-search/index", "views/object/object-picker-tasks/index", "./templates/basic", "./templates/project"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p;
        return m = a("lib/scrollable"), n = a("thenjs"), o = a("util"), p = a("view"), j = a("collections/organizations"), l = a("collections/projects"), d = a("views/object/object-picker-events/index"), e = a("views/object/object-picker-files/index"), f = a("views/object/object-picker-posts/index"), g = a("views/object/object-picker-search/index"), h = a("views/object/object-picker-tasks/index"), c = a("./templates/basic"), k = a("./templates/project"), i = function(a) {
            function i() {
                return i.__super__.constructor.apply(this, arguments)
            }
            return b(i, a), i.prototype.viewName = "ObjectPickerView", i.prototype.className = "object-picker-view modal-dialog", i.prototype.events = {"click .cancel-handler": "close","click .confirm-handler": "ensureSelected","click .object-nav": "switchObjectType","click .project-item": "switchProject"}, i.prototype.initialize = function(a) {
                return this.options = a, this.projectsCollection = l.get(0), this.organizationsCollection = j.get(0), this.renderBasic(), this.renderProjects(), this.listen(), this.switchObjectType(a.objectType || "task", !0), this.switchProject(a._projectId || this.projectsCollection.at(0).id), this.disableSubmit(!0), this.setupScroll(this.$(".projects-nav")), this
            }, i.prototype.listen = function() {
                return this.listenTo(this.projectsCollection, "add remove change", this.renderProjects), this
            }, i.prototype.onOpen = function() {
                var a;
                return a = this.$(".projects-nav .active"), a.length && this.slideTo(a), this
            }, i.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$content = this.$(".picker-content"), this.$submit = this.$(".confirm-handler"), this
            }, i.prototype.switchObjectType = function(a, b) {
                var c, d;
                return (null != a ? a.currentTarget : void 0) ? (c = $(a.currentTarget), d = c.data("type")) : (d = a, c = this.$(".object-nav[data-type=" + d + "]")), d === this.objectType ? this : (this.objectType = d, c.parent().addClass("active").siblings().removeClass("active"), b || this.renderContent(), this)
            }, i.prototype.switchProject = function(a) {
                var b, c;
                return (null != a ? a.currentTarget : void 0) ? (b = $(a.currentTarget), c = b.data("id")) : (c = a, b = this.$(".project-item[data-id=" + c + "]:first")), c === this._projectId ? this : (this._projectId = c, b.parent().addClass("active").siblings().removeClass("active"), this.renderContent(), this)
            }, i.prototype.renderProjects = function() {
                var a;
                return a = this.projectsCollection.groupByOrganization(this.organizationsCollection), this.$(".projects-nav").html(k({projects: a})), this
            }, i.prototype.renderContent = function() {
                var a, b, c;
                return null != (c = this.currentTypeView) && c.remove(), this.$el["search" === this.objectType ? "addClass" : "removeClass"]("full-view"), a = {_projectId: this._projectId,exclude: this.options.exclude || [],select: function(a) {
                    return function(b) {
                        return a.selected = b, a.disableSubmit(0 === b.length)
                    }
                }(this)}, b = function() {
                    switch (this.objectType) {
                        case "task":
                            return h;
                        case "post":
                            return f;
                        case "file":
                            return e;
                        case "event":
                            return d;
                        case "search":
                            return g
                    }
                }.call(this), this.currentTypeView = this.requestSubView(b, a), this.$content.empty(), this.currentTypeView.$el.appendTo(this.$content), a.select([]), this
            }, i.prototype.ensureSelected = function() {
                var a;
                if (null != (a = this.selected) ? a.length : void 0)
                    return this.options.select(this.selected), this.close(), this
            }, i.prototype.disableSubmit = function(a) {
                return this.$submit.prop("disabled", a), this.$submit[a ? "addClass" : "removeClass"]("disabled"), this
            }, i.prototype.close = function() {
                var a, b;
                return "WindowView" === (null != (b = this.parentView) ? b.viewName : void 0) ? "function" == typeof (a = this.parentView).remove && a.remove() : this.remove(), this
            }, i
        }(p), _.extend(i.prototype, m), i
    }), define("views/events/event-menu/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="list event-menu-list"> <li> <a class="edit-event-handler" data-gta="event" data-label="event detail|edit event"> <span class="icon icon-pencil"></span>编辑日程 </a> </li> <li> ';
            return b += a.isArchived ? ' <a class="unarchive-event-handler" data-gta="event" data-label="event detail|unarchive event"> <span class="icon icon-archive"></span>取消归档 </a> ' : ' <a class="archive-event-handler" data-gta="event" data-label="event detail|archive event"> <span class="icon icon-archive"></span>归档日程 </a> ', b += ' </li> <li> <a class="delete-event-handler" data-gta="event" data-label="event detail|delete event"> <span class="icon icon-trash"></span>删除日程 </a> </li> <li class="divider"></li> <li> ', "members" == a.visiable || "all" == a.visiable ? b += ' <a class="switch-visible-handler" data-type="involves" data-gta="event" data-label="task detail|switch visible"> <span class="icon icon-lock2"></span>转换为参与者可见 </a> ' : "involves" == a.visiable && (b += ' <a class="switch-visible-handler" data-type="members" data-gta="event" data-label="task detail|switch visible"> <span class="icon icon-users-bold"></span>转换为所有成员可见 </a> '), b += " </li></ul>"
        }
    }), define("views/events/event-menu/templates/delete", [], function() {
        return function() {
            var a = '<form class="delete-form"> <p>确认删除日程？</p> <button class="btn btn-danger" type="submit">删除</button></form>';
            return a
        }
    }), define("lib/multi-modal/templates/basic", [], function() {
        return function() {
            var a = '<div class="modal-content"> <header class="modal-header"> <a class="modal-back-handler icon icon-chevron-left"></a> <h4 class="modal-title">Modal Title</h4> <a class="modal-close pull-right icon icon-remove" data-dismiss="modal"></a> </header> <div class="modal-body"></div></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("lib/multi-modal/index", ["require", "exports", "module", "./templates/basic", "view"], function(a) {
        var c, d, e;
        return c = a("./templates/basic"), e = a("view"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "MultiModalView", d.prototype.initialize = function(a) {
                return this.renderMain && this.modalTitle ? (a.title && (this.modalTitle = a.title), this.$el.html(c()), this.$el.addClass("multi-modal-view modal-dialog modal-padding"), this.$modalBody = this.$(".modal-body"), this.$modalTitle = this.$(".modal-title"), this.returnMainView(), this) : void 0
            }, d.prototype.enterSubView = function(a, b) {
                return this.$el.addClass("in-subview"), this.$modalTitle.text(a.trim()), this.$(".modal-back-handler").one("click", function(a) {
                    return function() {
                        return a.returnMainView()
                    }
                }(this)), this.$modalBody.empty(), b(this.$modalBody), this
            }, d.prototype.returnMainView = function() {
                return this.$el.removeClass("in-subview"), this.$modalTitle.text(this.modalTitle.trim()), this.$modalBody.empty(), this.renderMain(this.$modalBody), this
            }, d
        }(e)
    }), define("views/events/event-creator/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<form class="event-create-form"> <input class="form-control event-title" type="text" placeholder="日程标题" value="' + a.title + '"/> <input class="form-control event-location" value="' + a.location + '" placeholder="地点" /> <div class="form-group event-start-time-group clearfix"> <label class="start-date-label">开始</label> <label class="btn btn-default start-date-picker-toggler"></label> <label class="form-control-select"> <select class="btn btn-default start-hour-select hour-select" data-type="start"></select> </label> <label class="form-control-select"> <select class="btn btn-default start-min-select min-select" data-type="start"></select> </label> </div> <div class="form-group event-end-time-setter clearfix"> <label class="end-date-label">结束</label> <label class="btn btn-default end-date-picker-toggler"></label> <label class="form-control-select"> <select class="btn btn-default end-hour-select hour-select" data-type="end"></select> </label> <label class="form-control-select"> <select class="btn btn-default end-min-select min-select" data-type="end"></select> </label> </div> ';
            return a.noRecurrence || (c += ' <div class="event-recurrence-wrap clearfix"> <span class="event-recurrence-label">重复日程</span> <a class="event-recurrence-setter"> <span class="recurrence-content">' + a.recurrenceLabel + '</span> <span class="icon icon-chevron-right"></span> </a> </div> '), c += ' <div class="event-content-wrap clearfix"> <span class="event-content-label">日程备忘</span> <a class="event-content-setter"> <span class="event-note-status">', a.content || (c += "未添加"), c += '</span> <span class="icon icon-chevron-right"></span> </a> <div class="event-content readable">' + b(a.content, "MD") + "</div> </div> ", c += a.isEdit ? ' <button class="btn btn-primary event-update-submit" data-gta="event" data-label="update event"> 更新日程 </button> ' : ' <div class="tags-set"></div> <div class="involve-set"></div> <div class="event-creator-set clearfix"> <button class="btn btn-primary pull-right event-creator-submit" data-gta="event" data-label="create event"> 添加日程 </button> <div class="btn-group dropup pull-right"> <button class="btn btn-default dropdown-toggle" data-toggle="dropdown"> <span class="visible-title">所有成员可见</span> <span class="icon icon-chevron-up"></span> </button> <ul class="dropdown-menu" role="menu"> <li><a class="visible-handler" data-type="members">所有成员可见</a></li> <li><a class="visible-handler" data-type="involves">仅参与者可见</a></li> </ul> </div> </div> ', c += "</form>"
        }
    }), define("views/events/event-creator/templates/hours", [], function() {
        return function(a) {
            var b = "", c = a.hours;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += ' <option value="' + d.value + '" ', d.value === a.selectedHour && (b += "selected"), b += ">" + d.label + "</option>";
            return b
        }
    }), define("views/events/event-creator/templates/minutes", [], function() {
        return function(a) {
            var b = "", c = a.mins;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += ' <option value="' + d.value + '" ', d.value === a.selectedMin && (b += "selected"), b += ">" + d.label + "</option>";
            return b
        }
    }), define("views/events/event-creator/templates/note", [], function() {
        return function(a) {
            var b = '<textarea class="form-control event-content-textarea" placeholder="日程备忘">' + a.content + '</textarea><button class="btn btn-primary btn-largest event-update-content" data-gta="event" data-label="add event note">确定</button>';
            return b
        }
    }), define("views/events/event-creator/templates/recurrence-save", [], function() {
        return function() {
            var a = '<button class="btn btn-default recurrence-update" data-type="single" data-gta="event" data-label="event recurrence|update single" type="submit">仅此日程，该系列中的其他所有日程都将保持不变</button><button class="btn btn-default recurrence-update" data-type="after" data-gta="event" data-label="event recurrence|update after" type="submit">后续日程，此日程及其相关的所有后续日程均会发生更改</button><button class="btn btn-default recurrence-cancel" data-gta="event" data-label="delete event" type="submit">取消</button>';
            return a
        }
    }), define("views/events/event-creator/templates/recurrence", [], function() {
        return function() {
            var a = '<ul class="event-recurrence-options"> <li><a data-value="NO">不重复</a><span class="icon icon-tick"></span></li> <li><a data-value="DAILY">每天重复</a><span class="icon icon-tick"></span></li> <li><a data-value="WEEKLY">每周重复</a><span class="icon icon-tick"></span></li> <li><a data-value="WEEKLY2">每2周重复</a><span class="icon icon-tick"></span></li> <li><a data-value="MONTHLY">每月重复</a><span class="icon icon-tick"></span></li></ul><button class="btn btn-primary btn-largest event-update-recurrence" data-gta="event" data-label="update event recurrence">确定</button>';
            return a
        }
    });
    var e = function(a, b) {
        return function() {
            return a.apply(b, arguments)
        }
    }, a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/events/event-creator/index", ["require", "exports", "module", "teambition", "moment", "rrule", "store", "util", "models/event", "collections/members", "collections/projects", "views/member/member-involve/index", "lib/multi-modal/index", "views/tag/tag-picker/index", "./templates/basic", "./templates/hours", "./templates/minutes", "./templates/note", "./templates/recurrence-save", "./templates/recurrence"], function(a) {
        var c, d, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v;
        return v = a("teambition"), l = a("moment"), p = a("rrule"), s = a("store"), u = a("util"), f = a("models/event"), j = a("collections/members"), o = a("collections/projects"), i = a("views/member/member-involve/index"), m = a("lib/multi-modal/index"), t = a("views/tag/tag-picker/index"), c = a("./templates/basic"), g = a("./templates/hours"), k = a("./templates/minutes"), n = a("./templates/note"), q = a("./templates/recurrence-save"), r = a("./templates/recurrence"), h = "ZH", d = function(a) {
            function d() {
                return this.onMinChange = e(this.onMinChange, this), this.onHourChange = e(this.onHourChange, this), d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "EventCreatorView", d.prototype.className = "event-creator-view", d.prototype.modalTitle = "添加日程", d.prototype.events = {"click .end-time-toggler": "toggleEndTimeSetter","click .recurrence-toggler": "toggleRecurrenceSetter","click .note-toggler": "toggleNoteEditor","click .event-creator-submit": "onSubmit","change .hour-select": "onHourChange","change .min-select": "onMinChange","change .event-title": "updateTitle","change .event-location": "updateLocation","click .event-recurrence-setter": "enterRecurrenceSubMenu","click .event-recurrence-options a": "selectRecurrence","click .event-update-recurrence": "confirmRecurrence","click .event-content-setter": "enterNoteSubMenu","click .event-update-content": "confirmNote","click .event-update-submit": "enterRecurrenceSaveSubMenu","click .recurrence-update": "saveRecurrence","click .recurrence-cancel": "returnMainView","click .visible-handler": "switchVisible"}, d.prototype.initialize = function(a) {
                return (null != a ? a._projectId : 0) && (a.eventsCollection || a.eventModel) ? (this.options = a, this._projectId = a._projectId, this.projectModel = o.getOne(0, this._projectId), this.localCache = s.namespace("temp").namespace("events"), this.hasRecurrence = !1, this.membersCollection = j.get(this._projectId), this.reset(), d.__super__.initialize.apply(this, arguments)) : !1
            }, d.prototype.reset = function() {
                var a, b, c, d, e;
                return this.eventModel && this.stopListening(this.eventModel), this.options.eventModel ? (this.isEdit = !0, this.eventModel = this.options.eventModel.clone(), this.noRecurrence = this.options.noRecurrence !== !1, this.eventModel.get("endDate") || this.eventModel.set("endDate", l(this.eventModel.get("startDate")).add(1, "hours").toISOString()), (d = this.options.eventModel.isRecurrenceDelegate()) && (this.hasRecurrence = !0, this.recurrence = d)) : (this.localCacheId = "" + this.options._projectId + "_" + v.user.id, a = this.localCache(this.localCacheId), a && a.title || (a = {}), a = {_creatorId: v.user.id,_projectId: this._projectId,title: a.title || "",location: a.location || "",content: a.content || "",startDate: a.startDate,involveMembers: a.involveMembers || [v.user.id]}, a.startDate || (c = l().add(1, "hours").second(0).millisecond(0), b = c.minute(), a.startDate = c.minute(b - b % 5).toISOString()), a.endDate && l(a.startDate).isBefore(a.endDate) || (a.endDate = l(a.startDate).add(1, "hours").toISOString()), this.eventModel = new f(a)), this.rrule = (null != (e = this.recurrence) ? e.getRRule() : void 0) || new p({freq: p.WEEKLY,dtstart: new Date(this.eventModel.get("startDate"))}), this.listen()
            }, d.prototype.listen = function() {
                return this.listenTo(this.eventModel, "change:startDate", this.onStartDateChange), this.listenTo(this.eventModel, "change:endDate", this.onEndDateChange), this.localCacheId && this.listenTo(this.eventModel, "change", this.cacheEvent), this
            }, d.prototype.onOpen = function() {
                return this.$eventTitle.focusAtEnd(), this
            }, d.prototype.onStartDateChange = function() {
                var a;
                return a = l(this.eventModel.get("startDate")), l(this.eventModel.get("endDate")).isAfter(a) || this.eventModel.set("endDate", a.add(1, "hours").toISOString()), this.renderTime("start"), this.renderTime("end"), this.updateRecurrence({dtstart: new Date(this.eventModel.get("startDate"))}), _.delay(function(a) {
                    return function() {
                        return a.checkRecurrence()
                    }
                }(this)), this
            }, d.prototype.onEndDateChange = function() {
                var a;
                return a = l(this.eventModel.get("endDate")), a.isAfter(this.eventModel.get("startDate")) || this.eventModel.set("endDate", a.add(1, "hours").toISOString()), this.$endDatePickerToggler.datepicker("update", new Date(this.eventModel.get("endDate"))), this.renderTime("end"), _.delay(function(a) {
                    return function() {
                        return a.checkRecurrence()
                    }
                }(this)), this
            }, d.prototype.renderMain = function(a) {
                var b;
                return b = this.eventModel.toJSON(), b.isEdit = this.isEdit, b.recurrenceLabel = u.freq2Label(this.hasRecurrence ? this.rrule : null).string, b.noRecurrence = this.noRecurrence, a.html(c(b)), this.$eventTitle = this.$(".event-title"), this.$startDatePickerToggler = this.$(".start-date-picker-toggler"), this.$endDatePickerToggler = this.$(".end-date-picker-toggler"), this.$submit = this.$(".event-creator-submit"), this.$visibleTitle = this.$(".visible-title"), this.renderTime("start"), this.renderTime("end"), this.checkRecurrence(), this.initDatePicker(), this.isEdit || (this.initInvolve(), this.initTagPicker(), this.switchVisible(this.$(".visible-handler[data-type=members]"))), this.$eventTitle.focusAtEnd(), this
            }, d.prototype.renderTime = function(a) {
                return this.renderDate(a), this.renderHourOptions(a), this.renderMinuteOptions(a), this
            }, d.prototype.renderDate = function(a) {
                var b;
                return b = u.formatDate(this.eventModel.get("" + a + "Date")).dateString, this.$("." + a + "-date-picker-toggler").text(b), this
            }, d.prototype.renderHourOptions = function(a) {
                var b, c, d, e, f, h, i;
                return b = this.eventModel.get("" + a + "Date"), d = l(this.eventModel.get("startDate")), c = "end" === a && d.isSame(b, "day") ? function() {
                    h = [];
                    for (var a = f = d.get("hour"); 24 >= f ? 24 > a : a > 24; 24 >= f ? a++ : a--)
                        h.push(a);
                    return h
                }.apply(this) : function() {
                    for (i = [], e = 0; 24 > e; e++)
                        i.push(e);
                    return i
                }.apply(this), this.$("." + a + "-hour-select").html(g({hours: this._generateHours(c),selectedHour: l(b).get("hour")})), this
            }, d.prototype.renderMinuteOptions = function(a) {
                var b;
                return b = l(this.eventModel.get("" + a + "Date")).get("minute"), b -= b % 5, this.$("." + a + "-min-select").html(k({mins: this._generateMins([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]),selectedMin: b})), this
            }, d.prototype.renderRecurrence = function() {
                return this.$("recurrence-content").text(u.freq2Label(this.hasRecurrence ? this.rrule : null).string), this
            }, d.prototype.initDatePicker = function() {
                return this.$startDatePickerToggler.datepicker({language: "ZH" === h ? "zh-CN" : h.toLowerCase(),placement: "left",autoclose: !0}).on("changeDate", function(a) {
                    return function(b) {
                        var c, d;
                        return d = b.date, c = new Date(a.eventModel.get("startDate")), c.setFullYear(d.getFullYear()), c.setDate(1), c.setMonth(d.getMonth()), c.setDate(d.getDate()), a.eventModel.set("startDate", c.toISOString())
                    }
                }(this)), this.$endDatePickerToggler.datepicker({language: "ZH" === h ? "zh-CN" : h.toLowerCase(),placement: "left",autoclose: !0}).on("changeDate", function(a) {
                    return function(b) {
                        var c, d;
                        return d = b.date, c = new Date(a.eventModel.get("endDate")), c.setFullYear(d.getFullYear()), c.setDate(1), c.setMonth(d.getMonth()), c.setDate(d.getDate()), a.eventModel.set("endDate", c.toISOString())
                    }
                }(this)), this
            }, d.prototype.initInvolve = function() {
                return this.requestSubView(i, {_projectId: this._projectId,objectModel: this.eventModel,membersCollection: this.membersCollection,resident: [v.user.id],direction: "top"}).$el.prependTo(this.$(".involve-set")), this
            }, d.prototype.initTagPicker = function() {
                return this.requestSubView(t, {_projectId: this._projectId,objectModel: this.eventModel}).$el.prependTo(this.$(".tags-set")), this
            }, d.prototype.switchVisible = function(a) {
                var b;
                return b = a.currentTarget ? $(a.currentTarget) : a, b.parent().addClass("selected").siblings().removeClass("selected"), this.$visibleTitle.text(b.text()), this.eventModel.set("visiable", b.data("type")), this
            }, d.prototype._generateHours = function(a) {
                var b, c, d, e;
                for (c = [], d = 0, e = a.length; e > d; d++)
                    b = a[d], c.push({label: this._generateHourLabel(b),value: b});
                return c
            }, d.prototype._generateHourLabel = function(a) {
                switch (h) {
                    case "ZH":
                        return 12 > a ? "上午" + a + "点" : 12 === a ? "中午" + a + "点" : "下午" + (a - 12) + "点";
                    default:
                        return 12 > a ? "" + a + " AM" : 12 === a ? "" + a + " PM" : "" + (a - 12) + " PM"
                }
            }, d.prototype._generateMins = function(a) {
                var b, c, d, e;
                for (c = [], d = 0, e = a.length; e > d; d++)
                    b = a[d], c.push({label: this._generateMinLabel(b),value: 5 * b});
                return c
            }, d.prototype._generateMinLabel = function(a) {
                return a = "" + 5 * a, 1 === a.length && (a = "0" + a), a
            }, d.prototype.onHourChange = function(a) {
                var b, c, d;
                return b = $(a.target), d = b.attr("data-type"), c = new Date(this.eventModel.get("" + d + "Date")), c.setHours(b.val()), this.eventModel.set("" + d + "Date", c.toISOString())
            }, d.prototype.onMinChange = function(a) {
                var b, c, d;
                return b = $(a.target), d = b.attr("data-type"), c = new Date(this.eventModel.get("" + d + "Date")), c.setMinutes(b.val()), this.eventModel.set("" + d + "Date", c.toISOString())
            }, d.prototype.updateTitle = function(a) {
                return this.eventModel.set("title", $(a.currentTarget).val().trim()), this
            }, d.prototype.updateLocation = function(a) {
                return this.eventModel.set("location", $(a.currentTarget).val().trim()), this
            }, d.prototype.updateRecurrence = function(a) {
                return this.rrule = new p(_.extend(this.rrule.origOptions, a)), this
            }, d.prototype.fromFreqLabel = function(a) {
                var b;
                return this.hasRecurrence = !0, b = u.label2Freq(a), b ? (this.updateRecurrence(b), this.checkRecurrence()) : this.hasRecurrence = !1
            }, d.prototype.checkRecurrence = function() {
                var a, b, c;
                return c = l(this.eventModel.get("startDate")), a = l(this.eventModel.get("endDate")), b = this.rrule.options.freq, 3 === b && a.diff(c, "hours", !0) >= 24 && (b = 2), 2 === b && a.diff(c, "days", !0) >= 7 && (b = 1), 1 === b && a.diff(c, "months", !0) >= 1 && (b = 0), b !== this.rrule.options.freq && (this.updateRecurrence({freq: b}), this.renderRecurrence()), this
            }, d.prototype.enterRecurrenceSubMenu = function() {
                var a;
                return this.enterSubView("设置重复日程", function() {
                    return function(a) {
                        return a.html(r())
                    }
                }(this)), a = u.freq2Label(this.hasRecurrence ? this.rrule : null).label, this.$(".event-recurrence-options a[data-value=" + a + "]").parent().addClass("active")
            }, d.prototype.selectRecurrence = function(a) {
                var b;
                return b = $(a.currentTarget), b.parent().addClass("active").siblings().removeClass("active")
            }, d.prototype.confirmRecurrence = function() {
                var a;
                return a = this.$(".event-recurrence-options li.active a").data("value"), this.fromFreqLabel(a), this.returnMainView()
            }, d.prototype.enterNoteSubMenu = function() {
                return this.enterSubView("添加日程备忘", function(a) {
                    return function(b) {
                        return b.html(n({content: a.eventModel.get("content")})), b.find("textarea").focusAtEnd()
                    }
                }(this))
            }, d.prototype.confirmNote = function() {
                return this.eventModel.set("content", this.$(".event-content-textarea").val().trim()), this.returnMainView()
            }, d.prototype.enterRecurrenceSaveSubMenu = function(a) {
                return a.preventDefault(), this.hasRecurrence && this.recurrence ? this.noRecurrence ? (this.recurrenceMode = "single", this.onSubmit()) : this.enterSubView("更新重复日程", function() {
                    return function(a) {
                        return a.html(q())
                    }
                }(this)) : this.onSubmit()
            }, d.prototype.saveRecurrence = function(a) {
                return this.recurrenceMode = $(a.currentTarget).data("type"), this.onSubmit()
            }, d.prototype.onSubmit = function(a) {
                return null != a && a.preventDefault(), this.$submit.prop("disabled") ? void 0 : _.delay(function(b) {
                    return function() {
                        var c, d, e, g, h, i;
                        if (!b.eventModel.get("title"))
                            return b.$eventTitle.focusAtEnd();
                        if (b.disableSubmit(!0), c = b.eventModel.toJSON(), delete c._id, !b.hasRecurrence)
                            return b.isEdit ? (b.recurrence && "single" !== b.recurrenceMode && b.recurrence.stopRecurrence(b.eventModel.get("startDate")), b.options.eventModel.get("endDate") || c.endDate || delete c.endDate, b.updateEvent(c)) : b.createEvent(c);
                        d = b.options.eventsCollection || b.options.eventModel.collection, "single" === b.recurrenceMode ? b.recurrence.createFromRecurrence(b.recurrence.getRecurrenceAfter(b.options.eventModel.get("startDate")), {success: function(a) {
                            return d.add(a), b.updateEvent(c)
                        }}) : (h = new f({}), h.set(_.extend({}, c, {recurrence: h.genRecurrence(b.rrule)})), i = h.changed, b.isEdit && (g = h.getRecurrenceAfter(c.startDate), b.updateRecurrence({dtstart: g}), c.endDate && (e = new Date(c.endDate).valueOf() - new Date(c.startDate).valueOf()), i.startDate = g.toISOString(), e && (i.endDate = new Date(g.valueOf() + e).toISOString()), i.recurrence = h.genRecurrence(b.rrule), b.recurrence ? (i._sourceId = b.recurrence.id, i = b.recurrence.clone().set(i).changed, i.mode = "after") : (delete i._sourceId, delete i.sourceDate)), h.save(i, {attrs: i,success: function(a) {
                            return d.setRecurrence(a), b.isEdit ? b.updateEvent(c) : (b.localCache.remove(b.localCacheId), b.disableSubmit(!1), b.close())
                        }}));
                        try {
                            return v.gta.event(null, "create", "events|create recurrence event")
                        } catch (j) {
                            a = j
                        }
                    }
                }(this))
            }, d.prototype.updateEvent = function(a) {
                return this.options.eventModel.set(a), this.options.eventModel.save(null, {attrs: this.options.eventModel.changed,success: function(a) {
                    return function() {
                        return a.disableSubmit(!1), a.close()
                    }
                }(this),error: function(a) {
                    return function() {
                        return a.disableSubmit(!1)
                    }
                }(this)})
            }, d.prototype.createEvent = function(a) {
                return this.options.eventsCollection.create(a, {wait: !0,success: function(a) {
                    return function(b) {
                        var c;
                        return a.localCache.remove(a.localCacheId), a.disableSubmit(!1), "function" == typeof (c = a.options).success && c.success(b), a.close()
                    }
                }(this),error: function(a) {
                    return function() {
                        return a.disableSubmit(!1)
                    }
                }(this)})
            }, d.prototype.disableSubmit = function(a) {
                return this.$submit.prop("disabled", a), this.$submit[a ? "addClass" : "removeClass"]("disabled"), this
            }, d.prototype.cacheEvent = function() {
                return _.delay(function(a) {
                    return function() {
                        return a.localCache(a.localCacheId, a.eventModel.toJSON())
                    }
                }(this)), this
            }, d.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, d
        }(m)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/events/event-menu/index", ["require", "exports", "module", "essage", "teambition", "./templates/basic", "./templates/delete", "views/events/event-creator/index", "lib/popover/index", "lib/window/index"], function(a) {
        var c, d, e, f, g, h, i, j;
        return j = a("essage"), i = a("teambition"), c = a("./templates/basic"), d = a("./templates/delete"), e = a("views/events/event-creator/index"), g = a("lib/popover/index"), h = a("lib/window/index"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "EventMenuView", f.prototype.popoverTitle = "日程菜单", f.prototype.events = {"click .edit-event-handler": "editEvent","click .archive-event-handler": "archiveEvent","click .unarchive-event-handler": "unarchiveEvent","click .delete-event-handler": "enterDeleteSubMenu","click .switch-visible-handler": "switchVisible","submit .delete-form": "submitDeleteForm"}, f.prototype.render = function() {
                var a;
                return a = this.options.eventModel.toJSON(), this.$el.html(c(a)), this
            }, f.prototype.editEvent = function() {
                return this.parentView.requestSubView(h).open(e, {eventModel: this.options.eventModel,_projectId: this.options._projectId,title: "编辑日程",noRecurrence: this.options.noRecurrence}), this.remove(), this
            }, f.prototype.archiveEvent = function() {
                return this.options.eventModel.archive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功归档了日程",status: "success"}, 2e3), a.remove()
                    }
                }(this)}), this
            }, f.prototype.unarchiveEvent = function() {
                return this.options.eventModel.unarchive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功解档了日程",status: "success"}, 2e3), a.remove()
                    }
                }(this)}), this
            }, f.prototype.enterDeleteSubMenu = function() {
                return this.enterSubMenu("删除日程", function(a) {
                    return function() {
                        return a.$el.html(d())
                    }
                }(this)), this
            }, f.prototype.submitDeleteForm = function(a) {
                var b;
                return a.preventDefault(), b = this.options.eventModel, b.destroyRecurrence(), b.destroy({wait: !0,success: function(a) {
                    return function() {
                        return Essage.show({message: "删除成功",status: "success"}, 2e3), a.remove(), i.APP.hidePanel()
                    }
                }(this)}), this
            }, f.prototype.switchVisible = function(a) {
                var b;
                return b = $(a.currentTarget), this.options.eventModel.saveAttr("visiable", b.data("type"), {success: function(a) {
                    return function() {
                        return Essage.show({message: "设置成功",status: "success"}, 2e3), a.remove()
                    }
                }(this)}), this
            }, f
        }(g)
    }), define("views/events/event-detail/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="event-detail-content"> <div class="event-detail-info-container"></div> <div class="event-detail-tags-set"></div> ';
            return b += a.hasRight >= 0 && a.acanoUrl ? ' <div class="event-detail-involve-set with-acano"> <div class="event-detail-acano guide-handler" data-guide="eventAcano"> <a class="icon icon-video hinted" data-title="进入 Acano 视频会议" data-gta="event" data-label="video conference" href="' + a.acanoUrl + '" target="_blank"></a> </div> </div> ' : ' <div class="event-detail-involve-set"></div> ', b += '</div><div class="activity-creator-wrapper"></div>', a.hasRight > 0 && (b += ' <a class="menu-handler" data-toggle="popover" data-gta="event" data-label="event menu"> <span class="icon icon-chevron-down"></span> </a>'), b
        }
    }), define("views/events/event-detail/templates/info", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="event-detail-info ';
            return a.hour > 4 && a.hour <= 11 ? c += " morning " : a.hour > 11 && a.hour <= 17 ? c += " afternoon " : a.hour > 17 && a.hour <= 20 ? c += " evening " : (a.hour > 20 || a.hour <= 4) && (c += " night "), c += '"> ', a.hour > 20 || a.hour <= 4 ? c += ' <div class="twinkle-star"></div> ' : a.hour > 17 && a.hour <= 20 && (c += ' <div class="sun-light"></div> <div class="sunset"></div> '), c += ' <h3 class="event-title">' + b(a.title) + '</h3> <div class="event-content readable">' + b(a.content, "MD") + "</div> ", a.location && (c += ' <p class="event-location"> <span class="icon-location icon"></span> <span class="event-location">' + b(a.location) + "</span> </p> "), c += ' <p class="event-date"> <span class="icon-clock icon"></span> <span class="event-start-date">' + a.startDateString + "</span> ", a.endDateString && (c += ' ~ <span class="event-end-date">' + a.endDateString + "</span> "), c += " </p></div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/events/event-detail/index", ["require", "exports", "module", "teambition", "views/activity/activity-timeline/index", "lib/guide-point/index", "views/member/member-involve/index", "moment", "thenjs", "util", "view", "models/event", "collections/members", "collections/projects", "views/events/event-menu/index", "views/tag/tag-picker/index", "./templates/basic", "./templates/info", "flexText"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t;
        return s = a("teambition"), c = a("views/activity/activity-timeline/index"), h = a("lib/guide-point/index"), k = a("views/member/member-involve/index"), m = a("moment"), p = a("thenjs"), q = a("util"), r = a("view"), g = a("models/event"), l = a("collections/members"), n = a("collections/projects"), f = a("views/events/event-menu/index"), o = a("views/tag/tag-picker/index"), d = a("./templates/basic"), i = a("./templates/info"), t = a("flexText"), j = "ZH", e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "EventDetailView", e.prototype.tagName = "div", e.prototype.className = "event-detail toggler-parent fade thin-scroll event-detail-loading", e.prototype.events = {"click .menu-handler": "toggleEventMenu",mousewheel: q.mousewheel}, e.prototype.initialize = function(a) {
                return a._eventId || a.eventModel ? (this.options = a, this._eventId = a._eventId, this.eventModel = a.eventModel, this.showLoadingIndicator(), p(function(b) {
                    return function(c) {
                        return b.eventModel ? (b._eventId = b.eventModel.id, c()) : (a = {success: function(a) {
                            return b.eventModel = a, c()
                        },error: function(a, b) {
                            return c(b)
                        }}, b.options._objectlinkId && (a.attrs = {_objectlinkId: b.options._objectlinkId}), g.fetch(b._eventId, a))
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return a._projectId = a.eventModel.get("_projectId"), a.projectRight = a.eventModel.getRight(), a.projectModel = n.getOne(0, a._projectId), a.projectRight < 0 && a.$el.addClass("guest"), a.projectRight >= 0 || a.projectModel.get("isPublic") ? l.fetch(a._projectId, {success: function(c) {
                            return a.membersCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }}) : (a.membersCollection = l.get(a._projectId), b())
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        var c;
                        if (a.$el)
                            return a.hideLoadingIndicator(), a.$el.removeClass("event-detail-loading"), a.renderBasic(), a.renderInfo(), a.initInvolve().initTagPicker().renderActivities().listen(), "function" == typeof (c = a.options).success && c.success(a), b()
                    }
                }(this)).then(function(a) {
                    return function() {
                        return h.initialize(a)
                    }
                }(this)).fail(function(a) {
                    return function(b, c) {
                        return console.log(c), a.close()
                    }
                }(this)), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this) : void 0
            }, e.prototype.listen = function() {
                return this.listenTo(this.eventModel, "destroy remove", function(a) {
                    return function() {
                        var b;
                        return "function" == typeof (b = a.options).onEventDelete && b.onEventDelete(a.eventModel), a.close()
                    }
                }(this)), this.listenTo(this.eventModel, "change", function(a) {
                    return function() {
                        var b;
                        return "function" == typeof (b = a.options).onEventChange ? b.onEventChange(a.eventModel) : void 0
                    }
                }(this)), this.listenTo(this.eventModel, "change:title change:startDate change:location change:content", this.renderInfo), this
            }, e.prototype.renderInfo = function() {
                var a;
                return a = this.eventModel.toJSON(), a.title = q.escape(a.title), a.location = q.escape(a.location), a.hour = new Date(a.startDate).getHours(), a.startDateString = q.formatDate(new Date(a.startDate)).dateString + " " + m(a.startDate).format("LT"), a.endDateString = null != a.endDate ? "" + q.formatDate(new Date(a.endDate)).dateString + " " + m(a.endDate).format("LT") : "", this.$eventDetailInfoContainer.html(i(a)), this.$eventTitle = this.$(".event-title"), this
            }, e.prototype.renderBasic = function() {
                var a;
                return a = this.eventModel.toJSON(), a.hasRight = this.eventModel.hasRight(), this.$el.html(d(a)), this.$eventDetailInfoContainer = this.$(".event-detail-info-container"), this.$involveSet = this.$(".involve-set"), this.$activityCreator = this.$(".activity-creator-wrapper"), this
            }, e.prototype.initInvolve = function() {
                return this.requestSubView(k, {_projectId: this._projectId,objectModel: this.eventModel,membersCollection: this.membersCollection,dropArea: this.$el,undeletable: !1}).$el.prependTo(this.$(".event-detail-involve-set")), this
            }, e.prototype.initTagPicker = function() {
                return this.requestSubView(o, {_projectId: this._projectId,objectModel: this.eventModel}).$el.prependTo(this.$(".event-detail-tags-set")), this
            }, e.prototype.renderActivities = function() {
                return this.activityTimelineView = this.requestSubView(c, {_objectlinkId: this.options._objectlinkId,boundToObjectType: "event",_projectId: this._projectId,objectModel: this.eventModel,$scrollFrame: this.$el}), this.activityTimelineView.$el.appendTo(this.$(".event-detail-content")), this
            }, e.prototype.toggleEventMenu = function(a) {
                var b;
                if (this.eventModel.hasRight() > 0)
                    return b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(f, {fixed: this.$el.closest(".panel-view").length,$toggler: b,_projectId: this._projectId,eventModel: this.eventModel,noRecurrence: this.options.noRecurrence}).show(), this
            }, e.prototype.close = function() {
                var a, b;
                return "EventDetailPanel" === (null != (b = this.parentView) ? b.viewName : void 0) ? "function" == typeof (a = this.parentView).back && a.back() : this.remove(), this
            }, e.prototype.remove = function() {
                var a, b;
                return null != (b = this.$activityCreator) && b.remove(), this.eventModel && (a = s.router.getUrl().replace("/event/" + this.eventModel.id, ""), s.router.navigate(a, {trigger: !1})), e.__super__.remove.apply(this, arguments)
            }, e
        }(r)
    }), define("views/core/markdown-helper/templates/basic", [], function() {
        return function() {
            var a = '<header class="markdown-header card-header"> <a class="modal-close pull-right icon icon-remove icon-white" data-dismiss="modal"></a> <p class="markdown-title card-title pull-left">Markdown</h4></header><div class="markdown-content"> <h4 class="title">语法 <small>· 更多语法请参考：<a href="http://wowubuntu.com/markdown/" target="_blank">Markdown语法说明</a></small></h4> <div class="syntax-content clearfix"> <div class="span4"> <p><span class="syntax">#</span>一级标题</p> <p><span class="syntax">##</span>二级标题</p> <p><span class="syntax">###</span>三级标题</p> <p><span class="syntax">####</span>四级标题</p> <p><span class="syntax">*</span>斜体<span class="syntax">*</span></p> <p><span class="syntax">**</span>粗体<span class="syntax">**</span></p> </div> <div class="span4"> <p><span class="syntax">___</span>分割线</p> <p><span class="syntax">+ </span>无序列标记1</p> <p><span class="syntax">+ </span>无序列标记2</p> <p><span class="syntax">1. </span>有序列标记1</p> <p><span class="syntax">2. </span>有序列标记2</p> <p><span class="syntax">3. </span>有序列标记3</p> </div> <div class="span4"> <p><span class="syntax">&gt; </span>区块引用</p> <p><span class="syntax">&gt; </span>区块引用</p> <p><span class="syntax">[</span>链接<span class="syntax">](</span>url.cn<span class="syntax">)</span></p> <p><span class="syntax">![</span>图片<span class="syntax">](</span>url.cn/img.png<span class="syntax">)</span></p> <p><span class="syntax">`</span>行内代码<span class="syntax">`</span></p> <p>缩进<span class="syntax">4个空格</span>形成代码区块</p> </div> </div> <h4 class="title">预览 <small> · 试一试 Markdown！</small></h4> <div class="preview-content clearfix"> <div class="span6"> <div class="markdown-try"> <textarea class="markdown-textarea" data-gta="event" data-label="try markdown" placeholder="输入Markdown文档..."></textarea> </div> </div> <div class="span6"> <div class="markdown-preview"></div> </div> </div> </div></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/core/markdown-helper/index", ["require", "exports", "module", "./templates/basic", "markdown", "view"], function(a) {
        var c, d, e, f;
        return c = a("./templates/basic"), d = a("markdown"), f = a("view"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "markdownHelperView", e.prototype.className = "markdown-helper modal-dialog card", e.prototype.initialize = function() {
                return this.renderBasic(), this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$markdown = this.$(".markdown-textarea").flexText(), this.$preview = this.$(".markdown-preview"), this.$markdown.on("input", function(a) {
                    return function() {
                        var b;
                        return b = d(a.$markdown[0].value || ""), a.$preview.html(b)
                    }
                }(this)), this
            }, e
        }(f)
    }), define("views/wall/post-editor/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="post-editor-content readable" data-placeholder="' + a.name + '，和你的伙伴分享些什么？ (Ctrl+回车快速发布)">' + a.content + '</div><ul class="attachments-list thin-scroll clearfix"></ul>';
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/wall/post-editor/index", ["require", "exports", "module", "essage", "teambition", "./templates/basic", "pen", "view", "views/work/work/index"], function(a) {
        var c, d, e, f, g, h, i;
        return i = a("essage"), h = a("teambition"), c = a("./templates/basic"), d = a("pen"), f = a("view"), g = a("views/work/work/index"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "PostEditorView", e.prototype.className = "post-editor", e.prototype.events = {"click li.work": "clickToInsertImage"}, e.prototype.initialize = function(a) {
                return this.options = _.extend({onchange: function() {
                },oncancel: function() {
                }}, a), this.attachments = a.attachments, this.renderBasic(), this.initEditor(), this.attachments && (this.renderAttachments(), this.listen()), this.focus(), this
            }, e.prototype.listen = function() {
                return this.listenTo(this.attachments, "add", function(a) {
                    return function(b) {
                        return b.get("thumbnailUrl") && a.insertImage(b), a.renderAttachment(b)
                    }
                }(this)), this.listenTo(this.attachments, "change:completed", function(a) {
                    return function(b, c) {
                        return c ? a.$(".work[data-cid=" + b.cid + "]").appendTo(a.$attachmentsList) : void 0
                    }
                }(this)), this.listenTo(this.attachments, "change:thumbnailUrl", this.refreshImage), this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(c({name: h.user.get("name"),content: this.options.content || ""})), this.$editorContent = this.$(".post-editor-content"), this.$attachmentsList = this.$(".attachments-list"), this
            }, e.prototype.renderAttachments = function() {
                return this.attachments.each(function(a) {
                    return function(b) {
                        return a.renderAttachment(b)
                    }
                }(this))
            }, e.prototype.renderAttachment = function(a) {
                return this.requestSubView(g, {workModel: a}).$el.prependTo(this.$attachmentsList), this
            }, e.prototype.initEditor = function() {
                return this.editor = new d({stay: !1,editor: this.$editorContent[0],list: ["bold", "italic", "underline", "h3", "blockquote", "pre", "insertunorderedlist", "insertorderedlist", "createlink"]}).on("change", function(a) {
                    return function(b) {
                        return a.options.onchange(b.trim())
                    }
                }(this)), this
            }, e.prototype.insertImage = function(a) {
                var b, c;
                if (c = this.getPreviewUrl(a))
                    return this.editor.execCommand("insertImage", c), (b = a.get("fileName")) && this.$editorContent.find("img").each(function() {
                        return this.src === c ? $(this).attr({alt: b,title: b}) : void 0
                    }), this
            }, e.prototype.refreshImage = function(a) {
                var b, c, d;
                return b = a.get("fileName"), c = a.previous("thumbnailUrl"), d = this.getPreviewUrl(a), c && this.editor && d && this.$editorContent.find("img").each(function() {
                    return this.src === c ? $(this).attr({src: d,alt: b,title: b}) : void 0
                }), this
            }, e.prototype.getPreviewUrl = function(a) {
                var b, c;
                if (a)
                    return c = a.get("thumbnailUrl") || "", b = a.get("imageWidth") || 800, b > 800 && (b = 800), c = c.replace("w/200/h/200", "w/" + b + "/h/" + b)
            }, e.prototype.clickToInsertImage = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = b.data("id") || b.data("cid"), this.insertImage(this.attachments.get(c)), this
            }, e.prototype.focus = function() {
                return _.delay(function(a) {
                    return function() {
                        return a.editor.focus()
                    }
                }(this), 100)
            }, e.prototype.getContent = function() {
                return this.editor.autoLink().trim()
            }, e.prototype.setContent = function(a) {
                return this.editor.setContent(a), this
            }, e.prototype.remove = function() {
                return this.editor.destroy(), this.options.oncancel(), e.__super__.remove.apply(this, arguments)
            }, e
        }(f)
    }), define("views/wall/post-md-editor/templates/basic", [], function() {
        return function(a) {
            var b = '<textarea class="post-editor-content" placeholder="' + a.name + '，和你的伙伴分享些什么？ (Ctrl+回车快速发布)"></textarea><ul class="attachments-list thin-scroll clearfix"></ul>';
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/wall/post-md-editor/index", ["require", "exports", "module", "teambition", "./templates/basic", "view", "views/work/work/index"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("./templates/basic"), e = a("view"), f = a("views/work/work/index"), g = function(a, b) {
            if (a === b)
                return !0;
            for (b = b.parentNode; b; ) {
                if (a === b)
                    return !0;
                b = b.parentNode
            }
            return !1
        }, d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "PostMdEditorView", d.prototype.className = "post-md-editor", d.prototype.events = {"keyup .post-editor-content": "saveCaretPos","click .post-editor-content": "saveCaretPos","click li.work": "clickToInsertImage"}, d.prototype.initialize = function(a) {
                return this.options = _.extend({onchange: function() {
                },oncancel: function() {
                }}, a), this.attachments = a.attachments, this.renderBasic().initEditor(), this.attachments && (this.renderAttachments(), this.listen()), this.focus(), this
            }, d.prototype.listen = function() {
                return this.listenTo(this.attachments, "add", function(a) {
                    return function(b) {
                        return a.insertImage(b), a.renderAttachment(b)
                    }
                }(this)), this.listenTo(this.attachments, "change:completed", function(a) {
                    return function(b, c) {
                        return c ? a.$(".work[data-cid=" + b.cid + "]").appendTo(a.$attachmentsList) : void 0
                    }
                }(this)), this.listenTo(this.attachments, "change:thumbnailUrl", this.insertImage), this
            }, d.prototype.renderBasic = function() {
                return this.$el.html(c({name: h.user.get("name")})), this.$textareaset = this.$(".post-editor-content"), this.$attachmentsList = this.$(".attachments-list"), this
            }, d.prototype.renderAttachments = function() {
                return this.attachments.each(function(a) {
                    return function(b) {
                        return a.renderAttachment(b)
                    }
                }(this))
            }, d.prototype.renderAttachment = function(a) {
                return this.requestSubView(f, {workModel: a}).$el.prependTo(this.$attachmentsList), this
            }, d.prototype.initEditor = function() {
                return this.$textareaset.val(this.options.content || "").flexText(function(a) {
                    return function() {
                        return a.options.onchange(a.$textareaset.val().trim())
                    }
                }(this)), this.caretPos = this.$textareaset.val().length, this
            }, d.prototype.saveCaretPos = function() {
                return this.caretPos = this.$textareaset[0].selectionStart, this
            }, d.prototype.insertImage = function(a) {
                var b, c, d, e;
                if (e = this.getPreviewUrl(a))
                    return d = a.get("fileName") || e, c = " ![" + d + "](" + e + ") ", b = this.$textareaset.val(), b = b.slice(0, this.caretPos) + c + b.slice(this.caretPos), this.caretPos += c.length, this.$textareaset[0].selectionStart = this.caretPos, this.$textareaset.val(b), this
            }, d.prototype.getPreviewUrl = function(a) {
                var b, c;
                if (a && (c = a.get("thumbnailUrl") || "", 0 !== c.indexOf("data:")))
                    return b = a.get("imageWidth") || 800, b > 800 && (b = 800), c = c.replace("w/200/h/200", "w/" + b + "/h/" + b)
            }, d.prototype.clickToInsertImage = function(a) {
                var b;
                return b = $(a.currentTarget), this.insertImage(this.attachments.get(b.data("id"))), this
            }, d.prototype.focus = function() {
                return _.delay(function(a) {
                    return function() {
                        return a.$textareaset.focusAtEnd()
                    }
                }(this), 100)
            }, d.prototype.getContent = function() {
                return this.$textareaset.val().trim()
            }, d.prototype.setContent = function(a) {
                return this.$textareaset.val(a), this
            }, d.prototype.remove = function() {
                return this.options.oncancel(), d.__super__.remove.apply(this, arguments)
            }, d
        }(e)
    }), define("views/wall/post-creator/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="post-creator-content thin-scroll"> <div class="post-creator-header"> <input class="form-control post-title-input" type="text" placeholder="标题..." value="' + a.title + '"/> <a class="modal-close icon icon-remove" data-dismiss="modal"></a> </div> <div class="tags-set"></div> <div class="involve-set"></div> <div class="post-editor-wrapper"></div></div><div class="post-creator-footer clearfix"> <a class="add-work-handler link-add-handler pull-left" data-gta="event" data-label="activity add works"> <span class="icon icon-paperclip"></span> 添加附件</a> <div class="pull-right"> ';
            return a.isEdit || (b += ' <div class="btn-group dropup"> <button class="btn btn-default dropdown-toggle" data-toggle="dropdown"> <span class="visible-title">所有成员可见</span> <span class="icon icon-chevron-up"></span> </button> <ul class="dropdown-menu" role="menu"> <li><a class="visible-handler" data-type="members">所有成员可见</a></li> <li><a class="visible-handler" data-type="involves">仅参与者可见</a></li> </ul> </div> '), b += ' <button class="btn btn-primary submit-handler" data-gta="event" data-label="submit post"> ', b += a.isEdit ? "更新分享" : "立即发布", b += ' </button> </div> <div class="post-editor-info muted">该文档使用 Markdown，<a class="md-help-handler">语法帮助</a></div></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/wall/post-creator/index", ["require", "exports", "module", "teambition", "markdown", "store", "thenjs", "util", "view", "models/post", "collections/members", "collections/projects", "collections/works", "views/core/markdown-helper/index", "views/member/member-involve/index", "views/wall/post-editor/index", "views/wall/post-md-editor/index", "views/tag/tag-picker/index", "lib/window/index", "views/library/works-picker/index", "views/work/work-uploader/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v;
        return v = a("teambition"), d = a("markdown"), m = a("store"), o = a("thenjs"), p = a("util"), q = a("view"), k = a("models/post"), g = a("collections/members"), l = a("collections/projects"), t = a("collections/works"), e = a("views/core/markdown-helper/index"), f = a("views/member/member-involve/index"), i = a("views/wall/post-editor/index"), j = a("views/wall/post-md-editor/index"), n = a("views/tag/tag-picker/index"), r = a("lib/window/index"), u = a("views/library/works-picker/index"), s = a("views/work/work-uploader/index"), c = a("./templates/basic"), h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.className = "post-creator thin-scroll modal-dialog", h.prototype.events = {"click .add-work-handler": "toggerWorksPicker","click .submit-handler": "submit","change .post-title-input": "checkTitle","click .visible-handler": "switchVisible","keydown .post-editor-content": "quickSubmit","click .post-editor-info": "openMdHelper"}, h.prototype.initialize = function(a) {
                var b, c, d;
                return (null != a ? a._projectId : void 0) ? (this.options = _.extend({onsave: function() {
                },oncancel: function() {
                }}, a), this._projectId = a._projectId, this.postMode = a.postMode || (null != (c = a.postModel) ? c.get("postMode") : void 0), "md" !== this.postMode && (this.postMode = "html"), this.projectModel = l.getOne(0, this._projectId), this._defaultCollectionId = this.projectModel.get("_defaultCollectionId"), this.isEdit = !!a.postModel, this.localCache = m.namespace("temp").namespace("posts_wall"), this.isEdit || (this.localCacheId = v.user.id), b = this.localCache(this.localCacheId) || {title: "",content: "",attachments: []}, b.postMode && b.postMode !== this.postMode && (b.content = ""), this.postModel = (null != (d = a.postModel) ? d.clone() : void 0) || new k({_creatorId: v.user.id,_projectId: this._projectId,title: b.title,content: b.content,attachments: b.attachments,involveMembers: [v.user.id],postMode: this.postMode}), this.attachments = new t(this.postModel.get("attachments"), {boundToObjectType: "collection",_boundToObjectId: this._defaultCollectionId}), this.postsCollection = a.postsCollection, this.membersCollection = g.get(this._projectId), this.renderBasic().initInvolve().initTagPicker().initEditor().initUploader().listen(), this.switchVisible(this.$(".visible-handler[data-type=" + (this.postModel.get("visiable") || "members") + "]")), "md" === this.postMode && this.$el.addClass("markdown-mode"), this) : !1
            }, h.prototype.listen = function() {
                return this.listenTo(this.attachments, "add change remove", this.cachePost), this.listenTo(this.postModel, "change:content change:title", this.cachePost), this
            }, h.prototype.renderBasic = function() {
                return this.$el.html(c({title: this.postModel.get("title") || "",isEdit: this.isEdit})), this.$submit = this.$(".submit-handler"), this.$postTitleInput = this.$(".post-title-input"), this.$visibleTitle = this.$(".visible-title"), this
            }, h.prototype.onOpen = function() {
                return this.$postTitleInput.focusAtEnd(), this
            }, h.prototype.initEditor = function() {
                var a, b;
                return a = "md" === this.postMode ? j : i, null != (b = this.postEditorView) && b.remove(), this.postEditorView = this.requestSubView(a, {content: this.postModel.get("content"),attachments: this.attachments,onchange: function(a) {
                    return function(b) {
                        return a.postModel.set("content", b)
                    }
                }(this)}), this.$(".post-editor-wrapper").html(this.postEditorView.$el), this
            }, h.prototype.initInvolve = function() {
                return this.requestSubView(f, {_projectId: this._projectId,objectModel: this.postModel,membersCollection: this.membersCollection,resident: [v.user.id]}).$el.prependTo(this.$(".involve-set")), this
            }, h.prototype.initTagPicker = function() {
                return this.requestSubView(n, {_projectId: this._projectId,objectModel: this.postModel}).$el.prependTo(this.$(".tags-set")), this
            }, h.prototype.initUploader = function() {
                return this.requestSubView(s, {_projectId: this._projectId,collection: this.attachments,pick: null,dnd: this.$(".post-editor-content"),paste: this.$(".post-editor-content")}), this
            }, h.prototype.switchVisible = function(a) {
                var b;
                if (!this.isEdit)
                    return b = a.currentTarget ? $(a.currentTarget) : a, b.parent().addClass("selected").siblings().removeClass("selected"), this.$visibleTitle.text(b.text()), this.postModel.set("visiable", b.data("type")), this
            }, h.prototype.toggerWorksPicker = function(a) {
                var b;
                return b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(u, {container: this.$el,_projectId: this._projectId,collection: this.attachments,$toggler: b,placement: "auto top"}).show(), this
            }, h.prototype.parsePostTitle = function(a) {
                var b, c;
                return a.title || (c = "html" === this.postMode ? _.unescape(a.content) : d(a.content), b = $("<div>" + c + "</div>"), c = b.text().trim(), c || (b = b.find("img:first"), c = b.attr("alt") || b.attr("title") || b.attr("src")), a.title = p.cutString(c, 120, "...") || "无标题"), a
            }, h.prototype.checkTitle = function() {
                var a;
                return a = this.$postTitleInput.val().trim(), a = p.cutString(a, 120, "..."), this.$postTitleInput.val(a), this.cachePost(), this
            }, h.prototype.cachePost = function() {
                return this.isEdit ? void 0 : (this.localCache(this.localCacheId, {title: this.$postTitleInput.val().trim(),content: this.postModel.get("content"),attachments: this.attachments.toJSON(),postMode: this.postMode}), this)
            }, h.prototype.getContent = function(a) {
                var b, c, d;
                return (c = this.postEditorView.getContent()) ? (d = this.attachments.getUploadingCount(), d || !c ? (Essage.show({message: d ? "" + d + "个文件正在上传..." : "请输入分享内容",status: "warning"}, 2e3), a()) : (b = {title: this.$postTitleInput.val().trim(),content: c}, b.title || (b = this.parsePostTitle(b)), o(function(a) {
                    return function(b) {
                        return a.attachments.addWorks(a.attachments.toJSON(), {_parentId: a._defaultCollectionId,_projectId: a._projectId,success: function() {
                            return b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).fin(function(c) {
                    return function() {
                        return b.attachments = c.attachments.pluck("_id"), a(b)
                    }
                }(this)))) : a()
            }, h.prototype.quickSubmit = function(a) {
                return 13 === a.keyCode && (a.ctrlKey || a.shiftKey || a.metaKey) && (a.preventDefault(), this.submit()), this
            }, h.prototype.submit = function() {
                return this.$submit.prop("disabled") ? void 0 : (this.getContent(function(a) {
                    return function(b) {
                        return b ? (a.disableSubmit(!0), b = _.extend(a.postModel.toJSON(), b), a.isEdit ? (a.options.postModel.set(b), _.isEmpty(a.options.postModel.changed) ? a.close() : a.options.postModel.save(null, {attrs: a.options.postModel.changed,success: function(b) {
                            return a.disableSubmit(!1), a.options.onsave(b), a.close()
                        }})) : a.postModel.save(b, {wait: !0,error: function() {
                            return a.disableSubmit(!1), a.postEditorView.focus()
                        },success: function(b) {
                            return a.disableSubmit(!1), a.localCache.remove(a.localCacheId), a.options.onsave(b), a.close()
                        }})) : a.postEditorView.focus()
                    }
                }(this)), this)
            }, h.prototype.disableSubmit = function(a) {
                return this.$submit.prop("disabled", a), this.$submit[a ? "addClass" : "removeClass"]("disabled"), this
            }, h.prototype.openMdHelper = function() {
                var a;
                return null != (a = this.markdownHelperView) && a.remove(), this.markdownHelperView = this.requestSubView(r).open(e), this
            }, h.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, h.prototype.remove = function() {
                return this.options.oncancel(), h.__super__.remove.apply(this, arguments)
            }, h
        }(q)
    }), define("views/wall/post-menu/templates/basic", [], function() {
        return function(a) {
            var b = "";
            return a.hasRight > 0 ? (b += ' <ul class="list"> ', a.isAdmin && (b += ' <li> <a class="pin-handler ', a.pin || (b += "unpin"), b += '" data-gta="event" data-label="pin post"> <span class="icon icon-pin"></span>', b += a.pin ? "取消置顶" : "置顶分享", b += " </a> </li> "), b += " <li> ", b += a.isArchived ? ' <a class="unarchive-handler" data-gta="event" data-label="unarchive post"> <span class="icon icon-archive"></span>取消归档 </a> ' : ' <a class="archive-handler" data-gta="event" data-label="archive post"> <span class="icon icon-archive"></span>归档分享 </a> ', b += ' </li> <li> <a class="delete-handler" data-gta="event" data-label="delete post"> <span class="icon icon-trash"></span>删除分享 </a> </li> <li class="divider"></li> <li> ', "members" == a.visiable || "all" == a.visiable ? b += ' <a class="switch-visible-handler" data-type="involves" data-gta="event" data-label="task detail|switch visible"> <span class="icon icon-lock2"></span>转换为参与者可见 </a> ' : "involves" == a.visiable && (b += ' <a class="switch-visible-handler" data-type="members" data-gta="event" data-label="task detail|switch visible"> <span class="icon icon-users-bold"></span>转换为所有成员可见 </a> '), b += " </li> </ul>") : (b += ' <p class="muted"> 您不能修改这条分享. ', a.hasRightMembers && (b += "仅" + a.hasRightMembers + "可以修改."), b += " </p>"), b
        }
    }), define("views/wall/post-menu/templates/delete", [], function() {
        return function() {
            var a = '<form class="delete-form"> <p>确认删除分享？</p> <button class="btn btn-danger" type="submit">删除</button></form>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/wall/post-menu/index", ["require", "exports", "module", "./templates/basic", "./templates/delete", "lib/popover/index"], function(a) {
        var c, d, e, f;
        return c = a("./templates/basic"), d = a("./templates/delete"), e = a("lib/popover/index"), f = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "PostMenuView", e.prototype.popoverTitle = "分享菜单", e.prototype.events = {"click .pin-handler": "pinPost","click .archive-handler": "archivePost","click .unarchive-handler": "unarchivePost","click .delete-handler": "enterDeleteSubMenu","click .switch-visible-handler": "switchVisible","submit .delete-form": "submitDeleteForm"}, e.prototype.render = function() {
                var a;
                return a = this.options.postModel.toJSON(), a.hasRight = this.options.postModel.hasRight(), a.isAdmin = this.options.postModel.isAdmin(), this.$el.html(c(a)), this
            }, e.prototype.pinPost = function() {
                var a;
                return a = this.options.postModel.get("pin"), this.options.postModel.save(null, {attrs: {pin: !a}}), this.render(), this.remove(), this
            }, e.prototype.archivePost = function() {
                return this.options.postModel.archive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功归档了分享",status: "success"}, 2e3), a.remove()
                    }
                }(this)}), this
            }, e.prototype.unarchivePost = function() {
                return this.options.postModel.unarchive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功解档了分享",status: "success"}, 2e3), a.remove()
                    }
                }(this)}), this
            }, e.prototype.enterDeleteSubMenu = function() {
                return this.enterSubMenu("删除分享", function(a) {
                    return function() {
                        return a.$el.html(d())
                    }
                }(this)), this
            }, e.prototype.submitDeleteForm = function(a) {
                return a.preventDefault(), this.options.postModel.destroy({success: function(a) {
                    return function() {
                        return a.remove()
                    }
                }(this)}), this
            }, e.prototype.switchVisible = function(a) {
                var b;
                return b = $(a.currentTarget), this.options.postModel.saveAttr("visiable", b.data("type"), {success: function(a) {
                    return function() {
                        return Essage.show({message: "设置成功",status: "success"}, 2e3), a.remove()
                    }
                }(this)}), this
            }, e
        }(e)
    }), define("views/wall/post-detail/templates/attachments", [], function() {
        return function(a) {
            var b = '<ul class="attachments-list clearfix"> ', c = a.attachments;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += ' <li class="work work-previewer-handler" data-id="' + d._id + '"> ', b += d.thumbnail ? ' <div class="work-thumbnail image" style="background-image: url(' + d.thumbnail + ');"></div> ' : ' <div class="work-thumbnail ' + d.fileType + '">' + d.thumbnailText + "</div> ", b += ' <div class="attachment-content clearfix"> <p class="attachment-title hinted" data-title="' + d.fileName + '"> ' + d.fileNameFix + ' <span class="attachment-size">(' + d.fileSizeFix + ")</span> </p> </div> </li> ";
            return b += "</ul>"
        }
    }), define("views/wall/post-detail/templates/basic", [], function() {
        return function() {
            var a = '<div class="post-detail-header"></div><div class="post-detail-content scrollable thin-scroll"> <div class="post-content readable"></div> <div class="post-attachments"></div> <div class="tags-set"></div> <div class="involve-set"></div></div><div class="activity-creator-wrapper clearfix"></div>';
            return a
        }
    }), define("views/wall/post-detail/templates/content", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            if (c += "md" == a.postMode ? " " + b(a.content, "MD") : " " + a.content, a.links.length > 0) {
                c += " <ul> ";
                var d = a.links;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; )
                        e = d[f += 1], c += ' <li> <a href="' + e.shortUrl + '" target="_blank" title="' + e.title + '"> ' + e.shortUrl + " </a> </li> ";
                c += " </ul>"
            }
            return c
        }
    }), define("views/wall/post-detail/templates/header", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            return a.hasRight > 0 && (c += '<div class="pull-right"> <a class="post-edit-handler hinted" data-title="编辑" data-gta="event" data-label="edit post"> <span class="icon icon-pencil"></span> </a> <a class="post-menu-toggler guide-handler hinted" data-title="更多"  data-guide="postsMore" data-gta="event" data-label="open post menu"> <span class="icon icon-chevron-down"></span> </a></div>'), c += a.title ? ' <h4 class="post-title hinted" data-title="' + a.title + '">' + b(a.title) + "</h4>" : ' <h4 class="post-title">无标题</h4>'
        }
    });
    var e = function(a, b) {
        return function() {
            return a.apply(b, arguments)
        }
    }, a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/wall/post-detail/index", ["require", "exports", "module", "teambition", "lib/guide-point/index", "highlight", "thenjs", "util", "view", "models/activity", "models/post", "models/work", "collections/members", "collections/projects", "collections/works", "views/activity/activity-timeline/index", "views/member/member-involve/index", "views/wall/post-creator/index", "views/wall/post-menu/index", "views/library/previewer/index", "views/tag/tag-picker/index", "lib/window/index", "./templates/attachments", "./templates/basic", "./templates/content", "./templates/header"], function(a) {
        var c, d, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A;
        return A = a("teambition"), i = a("lib/guide-point/index"), k = a("highlight"), u = a("thenjs"), v = a("util"), w = a("view"), c = a("models/activity"), p = a("models/post"), y = a("models/work"), m = a("collections/members"), s = a("collections/projects"), z = a("collections/works"), d = a("views/activity/activity-timeline/index"), l = a("views/member/member-involve/index"), n = a("views/wall/post-creator/index"), o = a("views/wall/post-menu/index"), r = a("views/library/previewer/index"), t = a("views/tag/tag-picker/index"), x = a("lib/window/index"), f = a("./templates/attachments"), g = a("./templates/basic"), h = a("./templates/content"), j = a("./templates/header"), q = function(a) {
            function c() {
                return this.refreshAttach = e(this.refreshAttach, this), c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "PostView", c.prototype.tagName = "article", c.prototype.className = "post-detail-view toggler-parent fade", c.prototype.events = {"click .post-menu-toggler": "togglePostMenu","click .post-edit-handler": "openPostCreator","click .work-previewer-handler": "openPreviewer"}, c.prototype.initialize = function(a) {
                return a._postId || a.postModel ? (this.options = a, this._postId = a._postId, this.postModel = a.postModel, this.showLoadingIndicator(), u(function(b) {
                    return function(c) {
                        return b.postModel ? (b._postId = b.postModel.id, c()) : (a = {success: function(a) {
                            return b.postModel = a, c()
                        },error: function(a, b) {
                            return c(b)
                        }}, b.options._objectlinkId && (a.attrs = {_objectlinkId: b.options._objectlinkId}), p.fetch(b._postId, a))
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return a._projectId = a.postModel.get("_projectId"), a.projectModel = s.getOne(0, a._projectId), a.projectRight = a.projectModel.hasRight(), a.projectRight < 0 && a.$el.addClass("guest"), a.projectRight >= 0 || a.projectModel.get("isPublic") ? m.fetch(a._projectId, {success: function(c) {
                            return a.membersCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }}) : (a.membersCollection = m.get(a._projectId), b())
                    }
                }(this)).then(function(a) {
                    return function() {
                        var b;
                        if (a.$el)
                            return a.hideLoadingIndicator(), a.worksCollection = new z(a.postModel.get("attachments")), a.$el.removeClass("post-detail-loading"), a.renderBasic().renderPost().renderActivities(), a.initInvolve().initTagPicker(), a.listen(), i.initialize(a), "function" == typeof (b = a.options).success && b.success(a), a.options.inPanel ? void 0 : _.delay(function() {
                                var b;
                                return b = .5 * a.$el.height(), a.activityTimelineView.renderCreator(a.$activityCreator, b), a.$activityCreator.find(".flex-text-wrap").css("max-height", b), a.$activityCreator.on("slideHide.activity", function() {
                                    return a.resizeView(0)
                                }).on("slideShow.activity changeHeight.activity", function(b, c) {
                                    return a.resizeView(c - 1)
                                }).slideShow()
                            })
                    }
                }(this)).fail(function(a) {
                    return function() {
                        return a.close()
                    }
                }(this)), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this) : void 0
            }, c.prototype.listen = function() {
                return this.listenTo(this.postModel, "destroy remove", this.close), this.listenTo(this.postModel, "change", this.renderPost), this.listenTo(this.worksCollection, "change:downloadUrl", this.refreshAttach), this.listenTo(this.worksCollection, "remove", this.removeAttach), this
            }, c.prototype.resizeView = function(a) {
                return this.$el && this.$postDetail.css("bottom", a), this
            }, c.prototype.renderBasic = function() {
                return this.$el.html(g()), this.$el.attr("id", this.postModel.id), this.$header = this.$(".post-detail-header"), this.$postDetail = this.$(".post-detail-content"), this.$activityCreator = this.$(".activity-creator-wrapper"), this.$content = this.$(".post-content"), this.$attachments = this.$(".post-attachments"), this.$involveSet = this.$(".involve-set"), this
            }, c.prototype.renderPost = function() {
                var a, b;
                return b = this.postModel.toJSON(), b.title = v.escape(this.postModel.get("title")), b.hasRight = this.postModel.hasRight(), this.$header.html(j(b)), this.$header.find(".time-stamp").timesince(), this.$content.html(h(b)), this.worksCollection.length ? (a = this.worksCollection.toJSON(), _.each(a, function() {
                    return function(a) {
                        var b;
                        return a.fileSizeFix = v.formatFileSize(a.fileSize || 0), a.fileNameFix = null != (b = a.fileName) ? b.replace(/\.[^.]*$/, "") : void 0, a.thumbnail || (a.thumbnail = a.thumbnailUrl), a.thumbnailText = a.fileType, /link/.test(a.fileCategory) && (a.thumbnailText = "link"), a.fileName = v.escape(a.fileName)
                    }
                }(this)), this.$attachments.html(f({attachments: a}))) : this.$attachments.html(""), this.$content.find("pre code").each(function() {
                    return k.highlightBlock(this)
                }), this
            }, c.prototype.initInvolve = function() {
                return this.requestSubView(l, {_projectId: this._projectId,objectModel: this.postModel,membersCollection: this.membersCollection,dropArea: this.$el,undeletable: !1,type: "post"}).$el.prependTo(this.$involveSet), this
            }, c.prototype.initTagPicker = function() {
                return this.requestSubView(t, {_projectId: this._projectId,objectModel: this.postModel}).$el.prependTo(this.$(".tags-set")), this
            }, c.prototype.renderActivities = function() {
                return this.activityTimelineView = this.requestSubView(d, {boundToObjectType: "post",_objectlinkId: this.options._objectlinkId,_projectId: this._projectId,objectModel: this.postModel,$scrollFrame: this.$postDetail}), this.activityTimelineView.$el.appendTo(this.$postDetail), this
            }, c.prototype.openPostCreator = function() {
                return this.projectRight >= 0 ? (this.requestSubView(x).open(n, {backdrop: "static",_projectId: this._projectId,postModel: this.postModel,created: function() {
                    return function() {
                    }
                }(this)}), this) : this
            }, c.prototype.togglePostMenu = function(a) {
                var b;
                return this.projectRight >= 0 ? (b = $(a.currentTarget), b.data("bs.popover") ? this : (this.requestSubView(o, {fixed: this.$el.closest(".panel-view").length,$toggler: b,_projectId: this._projectId,postModel: this.postModel,permission: this.postModel.get("_creatorId") === A.user.id}).show(), this)) : this
            }, c.prototype.openPreviewer = function(a) {
                return this.worksCollection.length ? (this.requestSubView(x).open(r, {_projectId: this.postModel.get("_projectId"),thumbnailModel: this.postModel,workModels: this.worksCollection.models,workModel: this.worksCollection.get($(a.currentTarget).data("id"))}), this) : this
            }, c.prototype.getPreviewUrl = function(a) {
                var b, c;
                return c = a.get("thumbnail") || "", b = a.get("imageWidth") || 800, b > 800 && (b = 800), c = c.replace("w/200/h/200", "w/" + b + "/h/" + b)
            }, c.prototype.refreshAttach = function(a) {
                var b, c, d, e, f;
                if (this.postModel.set("attachments", this.worksCollection.toJSON()), a.get("thumbnail") && a.previous("thumbnail") && a.get("thumbnail") !== a.previous("thumbnail")) {
                    if (e = a.previous("thumbnail").replace("/w/200/h/200", ""), d = this.getPreviewUrl(a), f = a.get("fileName"), b = $("<div>" + this.postModel.get("content") + "</div>"), c = b.find("img[src^='" + e + "']"), !c.length)
                        return;
                    c.attr({src: d,alt: f,title: f}), this.postModel.save(null, {wait: !0,attrs: {content: b.html().trim()}})
                }
                return this
            }, c.prototype.removeAttach = function(a) {
                var b, c, d, e;
                for (c = this.postModel.get("attachments"), d = e = c.length - 1; e >= 0; d = e += -1)
                    b = c[d], b._id === a.id && c.splice(d, 1);
                return this.$attachments.find(".work[data-id=" + a.id + "]").remove(), this.postModel.save(null, {attrs: {attachments: this.worksCollection.pluck("_id")}}), this
            }, c.prototype.close = function() {
                var a, b;
                return "PostPanelView" === (null != (b = this.parentView) ? b.viewName : void 0) ? "function" == typeof (a = this.parentView).back && a.back() : this.remove(), this
            }, c.prototype.remove = function() {
                var a, b;
                return null != (b = this.$activityCreator) && b.remove(), this.postModel && (a = A.router.getUrl().replace("/post/" + this.postModel.id, ""), A.router.navigate(a, {trigger: !1})), c.__super__.remove.apply(this, arguments)
            }, c
        }(w)
    }), define("views/object/object-previewer/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="modal-content"> <div class="modal-header"> <h4 class="modal-title">' + a.title + '</h4> <a class="cancel-handler icon icon-remove"></a> </div> <div class="modal-body"> <ul class="objectlink-nav thin-scroll scrollable"></ul> <div class="objectlink-detail hack-render-bug"></div> </div></div>';
            return b
        }
    }), define("views/object/object-previewer/templates/link", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.objectlinks;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="link" data-id="' + e._id + '"> <a class="link-handler"> ', "task" == e.linkedType ? (c += ' <span class="icon ', c += e.isDone ? "icon-checkbox-checked" : "icon-checkbox", c += '"></span> ') : "post" == e.linkedType ? c += ' <span class="icon icon-wall-bold"></span> ' : "event" == e.linkedType && (c += ' <span class="icon icon-calendar-bold"></span> '), c += " <span>" + b(e.title) + "</span> </a></li>";
            return a.worksCount && (c += '<li class="link"> <a class="objectlink-works-handler"> <span class="icon icon icon-search-file"></span> <span>预览关联的 ' + a.worksCount + " 个文件</span> </a></li>"), c += '<li class="link"> <a class="objectlink-add-handler"> <span class="icon icon icon-plus-sign"></span> <span>关联新的对象</span> </a></li>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/object/object-previewer/index", ["require", "exports", "module", "exports", "lib/scrollable", "thenjs", "util", "view", "models/work", "views/events/event-detail/index", "views/object/object-picker/index", "views/wall/post-detail/index", "views/library/previewer/index", "views/board/task/task-detail/index", "lib/window/index", "./templates/basic", "./templates/link"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q;
        return e = a("exports"), k = a("lib/scrollable"), m = a("thenjs"), n = a("util"), o = a("view"), q = a("models/work"), d = a("views/events/event-detail/index"), g = a("views/object/object-picker/index"), i = a("views/wall/post-detail/index"), j = a("views/library/previewer/index"), l = a("views/board/task/task-detail/index"), p = a("lib/window/index"), c = a("./templates/basic"), f = a("./templates/link"), h = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "ObjectPreviewerView", e.prototype.className = "object-previewer-view modal-dialog", e.prototype.events = {"click .cancel-handler": "close","click .link-handler": "showObjectDetail","click .objectlink-works-handler": "showWorksPreviewer","click .objectlink-add-handler": "showObjectPicker"}, e.prototype.initialize = function(a) {
                return null == a && (a = {}), this.options = a, this.objectModel = a.objectModel, this._projectId = this.objectModel.get("_projectId"), this._objectId = this.objectModel.id, this.boundToObjectType = a.boundToObjectType, this.objectlinksCollection = a.objectlinksCollection, this.renderBasic(), this.renderObjectlinks(), this.listen(), this.showObjectDetail(a._objectlinkId), this.setupScroll(this.$(".objectlink-nav")), this
            }, e.prototype.listen = function() {
                return this.listenTo(this.objectlinksCollection, "add remove change", this.renderObjectlinks), this
            }, e.prototype.onOpen = function() {
                var a;
                return a = this.$(".objectlink-nav .active"), a.length && this.slideTo(a), this
            }, e.prototype.renderBasic = function() {
                var a;
                return a = function() {
                    switch (this.boundToObjectType) {
                        case "task":
                            return this.objectModel.get("content");
                        case "post":
                            return this.objectModel.get("description");
                        case "work":
                            return this.objectModel.get("fileName");
                        case "event":
                            return this.objectModel.get("title")
                    }
                }.call(this), this.$el.html(c({title: a})), this.$detailPanel = this.$(".objectlink-detail"), this.$objectlinkNav = this.$(".objectlink-nav"), this
            }, e.prototype.renderObjectlinks = function() {
                var a;
                return this.objectlinkWorks = [], a = [], this.objectlinksCollection.each(function(b) {
                    return function(c) {
                        return "work" === c.get("linkedType") ? b.objectlinkWorks.push(c.toJSON()) : a.push(c.toJSON())
                    }
                }(this)), this.$objectlinkNav.html(f({objectlinks: a,worksCount: this.objectlinkWorks.length})), this._objectlinkId && this.$objectlinkNav.find(".link[data-id=" + this._objectlinkId + "]").addClass("active"), this
            }, e.prototype.showObjectDetail = function(a) {
                var b, c, e, f, g, h, j;
                if ((null != a ? a.currentTarget : void 0) ? (b = $(a.currentTarget).parent(), f = b.data("id")) : (f = a, b = this.$objectlinkNav.find(".link[data-id=" + f + "]")), f === this._objectlinkId)
                    return this;
                if (c = this.objectlinksCollection.get(f), "work" === c.get("linkedType"))
                    return _.delay(function(a) {
                        return function() {
                            return a.showWorksPreviewer(c.get("_linkedId"))
                        }
                    }(this), 500);
                switch (this._objectlinkId = f, b.addClass("active").siblings().removeClass("active"), e = function(a) {
                    return function(b) {
                        var c, d, e;
                        return (c = b.$activityCreator) ? (d = .5 * a.$detailPanel.height(), e = function(a) {
                            return b.$el.css("bottom", a)
                        }, c.appendTo(a.$detailPanel), b.activityTimelineView.renderCreator(c, d), c.find(".flex-text-wrap").css("max-height", d), c.on("slideHide.activity", function() {
                            return e(0)
                        }).on("slideShow.activity changeHeight.activity", function(a, b) {
                            return e(b - 1)
                        }).slideShow()) : void 0
                    }
                }(this), null != (g = this.detailView) && null != (h = g.currentView) && "function" == typeof h.close && h.close(), null != (j = this.detailView) && j.remove(), this.$detailPanel.empty(), c.get("linkedType")) {
                    case "event":
                        this.detailView = this.requestSubView(d, {_eventId: c.get("_linkedId"),_objectlinkId: c.id,inPanel: !0,success: function() {
                            return function(a) {
                                return e(a, !0)
                            }
                        }(this)}), this.detailView.$el.addClass("detail-card").appendTo(this.$detailPanel);
                        break;
                    case "task":
                        this.detailView = this.requestSubView(l, {_taskId: c.get("_linkedId"),_objectlinkId: c.id,inPanel: !0,success: function() {
                            return function(a) {
                                return e(a, !0)
                            }
                        }(this)}), this.detailView.$el.addClass("detail-card").appendTo(this.$detailPanel);
                        break;
                    case "post":
                        this.detailView = this.requestSubView(i, {_postId: c.get("_linkedId"),_objectlinkId: c.id,inPanel: !0,success: function() {
                            return function(a) {
                                return e(a, !0)
                            }
                        }(this)}), this.detailView.$el.addClass("detail-card").appendTo(this.$detailPanel)
                }
                return this
            }, e.prototype.showWorksPreviewer = function(a) {
                var b, c;
                return a.currentTarget || (c = a), b = null, m.each(this.objectlinkWorks, function() {
                    return function(a, d) {
                        return q.fetch(d._linkedId, {attrs: {_objectlinkId: d._id},success: function(d) {
                            return d.id === c && (b = d), a(null, d)
                        },error: function() {
                            return a()
                        }})
                    }
                }(this)).fin(function(a) {
                    return function(c, d, e) {
                        var f;
                        return f = {_projectId: a._projectId,workModel: b}, f.workModels = _.compact(e), a.requestSubView(p).open(j, f)
                    }
                }(this)), this
            }, e.prototype.showObjectPicker = function() {
                return this.requestSubView(p).open(g, {_projectId: this._projectId,exclude: [this._objectId],select: function(a) {
                    return function(b) {
                        return a.createLinks(b)
                    }
                }(this)}), this
            }, e.prototype.createLinks = function(a) {
                return m.eachSeries(a, function(a) {
                    return function(b, c) {
                        return a.objectlinksCollection.create({_parentId: a._objectId,parentType: a.boundToObjectType,_linkedId: c._id,linkedType: c.type}, {wait: !0,error: function(a, c) {
                            return b(c)
                        },success: function() {
                            return b()
                        }})
                    }
                }(this)), this
            }, e.prototype.close = function() {
                var a, b;
                return "WindowView" === (null != (b = this.parentView) ? b.viewName : void 0) ? "function" == typeof (a = this.parentView).remove && a.remove() : this.remove(), this
            }, e
        }(o), _.extend(h.prototype, k), e.Constructor = h
    }), define("views/activity/object-link/templates/basic", [], function() {
        return function(a) {
            var b = "";
            return a.projectRight >= 0 && (b += '<div class="handler-wrap"> <a class="add-link-handler" data-gta="event" data-label="activity add links"> <span class="icon icon-link2"></span>添加关联</a></div>'), b += '<div class="links-list-header muted"> <span>关联内容</span> <span class="pull-right">更新时间</span></div><ul class="links-list"></ul><p class="placeholder muted"> ', b += a.projectRight >= 0 ? "关联任务、分享、文件或日程后，你就可以在页面内预览相关内容，并在动态内查看关联内容的重要更新信息。 " : " 你不在这个项目中，所以没有权限查看关联内容。 ", b += "</p>"
        }
    }), define("views/activity/object-link/templates/link", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="link clearfix" data-id="' + a._id + '"> <div class="link-icon"> ';
            return "task" == a.linkedType ? (c += ' <span class="icon ', c += a.isDone ? "icon-checkbox-checked" : "icon-checkbox", c += '"></span> ') : "post" == a.linkedType ? c += ' <span class="icon icon-wall-bold"></span> ' : "event" == a.linkedType ? c += ' <span class="icon icon-calendar-bold"></span> ' : "work" == a.linkedType && (c += ' <span class="icon icon-file-bold"></span> '), c += ' </div> <div class="link-content"> <p>' + b(a.title) + '</p> <p class="link-info muted"> <span>项目：' + b(a.project) + "</span> <span>关联人：" + b(a.creator.name || "未知") + '</span> </p> </div> <time class="', a.hasRight > 0 && (c += "has-right"), c += '" data-title="' + a.fullDateString + '">' + a.dateString + "</time> ", a.hasRight > 0 && (c += ' <a class="btn btn-link btn-mini link-delete-handler">删除</a> '), c += "</li>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/activity/object-link/index", ["require", "exports", "module", "teambition", "moment", "thenjs", "util", "view", "models/work", "collections/objectlinks", "lib/confirm/index", "views/object/object-picker/index", "views/object/object-previewer/index", "views/library/previewer/index", "lib/window/index", "./templates/basic", "./templates/link", "essage"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r;
        return q = a("teambition"), f = a("moment"), l = a("thenjs"), m = a("util"), n = a("view"), p = a("models/work"), j = a("collections/objectlinks"), d = a("lib/confirm/index"), h = a("views/object/object-picker/index"), i = a("views/object/object-previewer/index"), k = a("views/library/previewer/index"), o = a("lib/window/index"), c = a("./templates/basic"), e = a("./templates/link"), r = a("essage"), g = function(a) {
            function g() {
                return g.__super__.constructor.apply(this, arguments)
            }
            return b(g, a), g.prototype.viewName = "ObjectLinkView", g.prototype.className = "object-link-view empty", g.prototype.events = {"click .add-link-handler": "toggerObjectPicker","click .link-delete-handler": "showDeleteConfirmModal","click .link": "enterObjectPreviewer"}, g.prototype.initialize = function(a) {
                var b;
                return null == a && (a = {}), this.options = a, (b = this.options).countChange || (b.countChange = function() {
                }), this._projectId = a._projectId, this._objectId = a.objectModel.id, this.objectModel = a.objectModel, this.projectRight = this.objectModel.getRight(), this.boundToObjectType = a.boundToObjectType, this.renderBasic(), this.projectRight >= 0 ? j.fetch(this._objectId, {boundToObjectType: a.boundToObjectType,attrs: {_parentId: this._objectId,parentType: a.boundToObjectType},success: function(a) {
                    return function(b) {
                        return a.objectlinksCollection = b, a.checkPlaceholder(), a.renderLinks().listen()
                    }
                }(this)}) : (this.objectlinksCollection = j.get(this._objectId, {boundToObjectType: a.boundToObjectType}), this.$el.addClass("guest")), this
            }, g.prototype.renderBasic = function() {
                return this.$el.html(c({projectRight: this.projectRight})), this.$linksList = this.$(".links-list"), this
            }, g.prototype.listen = function() {
                return this.listenTo(this.objectlinksCollection, "add", function(a) {
                    return function(b) {
                        return a.checkPlaceholder(), a.renderLink(b, !0)
                    }
                }(this)), this.listenTo(this.objectlinksCollection, "remove", function(a) {
                    return function(b) {
                        return a.checkPlaceholder(), a.removeLink(b)
                    }
                }(this)), this.listenTo(this.objectlinksCollection, "change", this.renderLink), this
            }, g.prototype.toggerObjectPicker = function() {
                return this.projectRight >= 0 ? (this.requestSubView(o).open(h, {_projectId: this._projectId,exclude: [this._objectId],select: function(a) {
                    return function(b) {
                        return a.createLinks(b)
                    }
                }(this)}), this) : this
            }, g.prototype.renderLinks = function() {
                return this.objectlinksCollection.each(function(a) {
                    return function(b) {
                        return a.renderLink(b)
                    }
                }(this)), this
            }, g.prototype.renderLink = function(a, b) {
                var c, d, g, h;
                return g = a.toJSON(), h = g.updated, g.dateString = m.formatDate(g.updated).dateString, g.fullDateString = f(g.updated).format("YYYY-MM-DD HH:mm"), g.hasRight = g._creatorId === q.user.id ? 2 : this.options.hasRight, c = $(e(g)), d = this.$linksList.find("li[data-id=" + g._id + "]"), d.length ? d.replaceWith(c) : c[b === !0 ? "prependTo" : "appendTo"](this.$linksList), this
            }, g.prototype.removeLink = function(a) {
                return this.$linksList.find("li[data-id=" + a.id + "]").remove(), this
            }, g.prototype.checkPlaceholder = function() {
                var a;
                return a = this.objectlinksCollection.length, this.options.countChange(a), this.$el[a ? "removeClass" : "addClass"]("empty"), this
            }, g.prototype.createLinks = function(a) {
                return l.eachSeries(a, function(a) {
                    return function(b, c) {
                        return a.objectlinksCollection.create({_parentId: a._objectId,parentType: a.boundToObjectType,_linkedId: c._id,linkedType: c.type}, {wait: !0,error: function(a, c) {
                            return b(c)
                        },success: function() {
                            return b()
                        }})
                    }
                }(this)), this
            }, g.prototype.showDeleteConfirmModal = function(a) {
                var b, c;
                return this.projectRight >= 0 ? (a.stopPropagation(), b = $(a.currentTarget).closest(".link"), c = this.objectlinksCollection.get(b.data("id")), this.requestSubView(d, {title: "删除关联",description: "确认希望永久删除这个关联？",onConfirm: function() {
                    return function() {
                        return c.destroy({success: function() {
                            return Essage.show({message: "删除成功",status: "success"}, 2e3)
                        },error: function() {
                            return Essage.show({message: "删除失败，请重试",status: "error"})
                        }})
                    }
                }(this)}), this) : this
            }, g.prototype.enterObjectPreviewer = function(a) {
                var b, c;
                return this.projectRight >= 0 ? (c = $(a.currentTarget).data("id"), b = this.objectlinksCollection.get(c), "work" === b.get("linkedType") ? this.showWorksPreviewer(b.get("_linkedId")) : this.requestSubView(o).open(i, {boundToObjectType: this.boundToObjectType,_objectlinkId: $(a.currentTarget).data("id"),objectModel: this.objectModel,objectlinksCollection: this.objectlinksCollection}), this) : this
            }, g.prototype.showWorksPreviewer = function(a) {
                var b, c;
                return b = null, c = [], l.each(this.objectlinksCollection.where({linkedType: "work"}), function() {
                    return function(d, e) {
                        return p.fetch(e.get("_linkedId"), {attrs: {_objectlinkId: e.id},success: function(e) {
                            return c.push(e), e.id === a && (b = e), d()
                        },error: function() {
                            return d()
                        }})
                    }
                }(this)).fin(function(a) {
                    return function() {
                        var d;
                        return d = {_projectId: a._projectId,workModel: b}, d.workModels = c, a.requestSubView(o).open(k, d)
                    }
                }(this)), this
            }, g
        }(n)
    }), define("views/activity/activity-timeline/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="nav nav-tabs"> <li class="active tab-handler" data-toggle=".activities-pane" data-gta="event" data-label="open activities pane"> <a>动态<span class="activities-number"></span></a> </li> <li class="tab-handler" data-toggle=".links-pane" data-gta="event" data-label="open links pane"> <a>关联<span class="links-number"></span></a> </li> <li class="tab-handler" data-toggle=".attachments-pane" data-gta="event" data-label="open attachments pane"> <a>附件<span class="attachments-number"></span></a> </li></ul><div class="tab-content"> <div class="tab-pane active activities-pane"> <div class="activities-handler-wrap"> <div class="likes-handler';
            return a.likesCount > 0 && (b += " has-like"), b += '"> <span class="icon icon-heart"></span> <div class="likes-tips">点赞加载中...</div> <span class="icon icon-chevron-down" title="更多"></span> <div class="likes-list"></div> </div> <a class="comments-handler" data-gta="event" data-label="hide system activities"> <div class="check-box"> <span class="icon icon-tick"></span> </div> <span>只显示评论</span> </a> </div> <ul class="activities-list"></ul> </div> <div class="tab-pane links-pane"> </div> <div class="tab-pane attachments-pane"> <div class="attachments-handler"></div> <ul class="attachments-list"></ul> </div></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/activity/activity-timeline/index", ["require", "exports", "module", "teambition", "exports", "lib/scrollable", "thenjs", "view", "models/work", "collections/activities", "collections/objectlinks", "collections/projects", "views/activity/activity-creator/index", "views/activity/activity-uploader/index", "views/activity/activity/index", "views/activity/object-link/index", "views/object/object-previewer/index", "views/library/previewer/index", "lib/window/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t;
        return t = a("teambition"), i = a("exports"), o = a("lib/scrollable"), p = a("thenjs"), q = a("view"), s = a("models/work"), c = a("collections/activities"), l = a("collections/objectlinks"), n = a("collections/projects"), d = a("views/activity/activity-creator/index"), f = a("views/activity/activity-uploader/index"), g = a("views/activity/activity/index"), j = a("views/activity/object-link/index"), k = a("views/object/object-previewer/index"), m = a("views/library/previewer/index"), r = a("lib/window/index"), h = a("./templates/basic"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "ActivityTimelineView", e.prototype.tagName = "div", e.prototype.className = "activities-timeline", e.prototype.events = {"click .tab-handler": "switchTabs","click .activity-body-coyness a": "enterObjectPreviewer","click .likes-handler": "toggleLikes","click .comments-handler": "toggleComments"}, e.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) && a.objectModel && a.boundToObjectType ? (this.options = a, this._projectId = a._projectId, this.objectModel = a.objectModel, this.projectRight = this.objectModel.getRight(), this.projectModel = n.getOne(0, this._projectId), this.renderBasic().getLikes().renderLinksNum(this.objectModel.get("objectlinksCount")), this.collection = c.get(this.objectModel.id, {boundToObjectType: a.boundToObjectType}), c.fetch(this.objectModel.id, {beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$activitiesList, {isPrepend: !0})
                    }
                }(this),success: function(a) {
                    return function() {
                        return a.$el ? (a.hideLoadingIndicator(), a.renderActivities().renderObjectLink().renderUploader(), a.renderActivitiesNum().renderAttachmentsNum(), a.listen()) : void 0
                    }
                }(this)}), this.setupScroll(a.$scrollFrame || this.$activitiesList), this) : !1
            }, e.prototype.listen = function() {
                return this.listenTo(this.collection, "add", function(a) {
                    return function(b) {
                        return a.renderActivity(b, a.collection.at(a.collection.length - 2)), "comment" === b.get("action") && b.get("_creatorId") === t.user.id && a.scrollToBottom(), a.renderActivitiesNum().renderAttachmentsNum()
                    }
                }(this)), this.listenTo(this.collection, "remove", function(a) {
                    return function() {
                        return a.renderActivitiesNum().renderAttachmentsNum()
                    }
                }(this)), this.listenTo(this.objectModel, "change:likesCount", function(a) {
                    return function() {
                        return a.getLikes(), a.likesListData ? a.getLikesList() : void 0
                    }
                }(this)), this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(h({likesCount: this.objectModel.get("likesCount")})), this.$activitiesList = this.$(".activities-list"), this.$attachmentsList = this.$(".attachments-list"), this.$handlerWwrap = this.$(".activities-handler-wrap"), this.$likesHandler = this.$(".likes-handler"), this.$likesTips = this.$(".likes-tips"), this.$likesList = this.$(".likes-list"), this
            }, e.prototype.renderActivities = function() {
                var a, b, c, d, e, f;
                for (null != (e = this.$activitiesList) && e.empty(), f = this.collection.models, c = 0, d = f.length; d > c; c++)
                    a = f[c], this.renderActivity(a, b), b = a;
                return this
            }, e.prototype.renderActivity = function(a, b) {
                var c;
                return a ? (c = this.requestSubView(g, {activityModel: a,lastActivityModel: b,_projectId: this.options._projectId,projectRight: this.projectRight}), c.$el.appendTo(this.$activitiesList), a.get("attachments").length && (c.$clone = c.$el.clone(!0, !0), c.$clone.appendTo(this.$attachmentsList)), this) : this
            }, e.prototype.renderCreator = function(a, b) {
                return this.$activityCreator = a, this.creatorHidden = !1, a.slideHide = function(b) {
                    return function() {
                        var c;
                        return b.creatorHidden = !0, c = a.height(), a.transition({y: c + 5}, 218), a.triggerHandler("slideHide.activity", c)
                    }
                }(this), a.slideShow = function(b) {
                    return function() {
                        return b.creatorHidden = !1, a.transition({y: 0}, 400, function() {
                            return a.triggerHandler("slideShow.activity", a.height())
                        })
                    }
                }(this), (this.projectRight >= 0 || this.projectModel.get("isPublic")) && this.requestSubView(d, {_objectlinkId: this.options._objectlinkId,_projectId: this._projectId,objectModel: this.objectModel,boundToObjectType: this.options.boundToObjectType,collection: this.collection,resizeHandler: function(b) {
                    return function() {
                        return b.creatorHidden ? void 0 : a.triggerHandler("changeHeight.activity", a.height())
                    }
                }(this)}).$el.appendTo(a), b && (this.creatorHidden = !0, a.transition({y: a.height() || b}, 0)), this
            }, e.prototype.renderUploader = function() {
                return this.projectRight >= 0 ? (this.requestSubView(f, {_projectId: this._projectId,_objectId: this.objectModel.id,boundToObjectType: this.options.boundToObjectType,collection: this.collection}).$el.appendTo(this.$(".attachments-handler")), this) : this
            }, e.prototype.renderObjectLink = function() {
                return this.requestSubView(j, {_projectId: this._projectId,objectModel: this.objectModel,hasRight: this.objectModel.hasEditRight ? this.objectModel.hasEditRight() : this.objectModel.hasRight(),boundToObjectType: this.options.boundToObjectType,countChange: function(a) {
                    return function(b) {
                        return a.renderLinksNum(b)
                    }
                }(this)}).$el.appendTo(this.$(".links-pane")), this
            }, e.prototype.renderActivitiesNum = function() {
                var a;
                return a = this.collection.length, this.$(".activities-number").text(a > 0 ? " · " + a : ""), this
            }, e.prototype.renderLinksNum = function(a) {
                return this.$(".links-number").text(a > 0 ? " · " + a : ""), this
            }, e.prototype.renderAttachmentsNum = function() {
                var a;
                return a = this.collection.reduce(function(a, b) {
                    return b.get("attachments").length + a
                }, 0), this.$(".attachments-number").text(a > 0 ? " · " + a : "")
            }, e.prototype.renderLikes = function() {
                var a, b;
                return this.$likesHandler && this.likeData ? (b = this.buildLikesItems(this.likeData.likesGroup, this.prevLikeGroup), this.likeData.likesCount ? (this.$likesHandler.addClass("has-like"), this.likeData.likesCount < 6 ? (this.$likesHandler.removeClass("has-more"), b += " 点了赞") : (this.$likesHandler.addClass("has-more"), a = this.likeData.likesCount, b += " 等" + a + "人点了赞")) : this.$likesHandler.removeClass("has-like"), this.$likesHandler.hasClass("active") || this.$likesTips.html(b), this) : this
            }, e.prototype.renderLikesList = function() {
                var a;
                return this.$likesList && this.likesListData ? (a = this.buildLikesItems(this.likesListData.likesGroup, this.prevlikesListGroup), a += " 点了赞", this.$likesList.html(a), this) : this
            }, e.prototype.buildLikesItems = function(a, b) {
                var c;
                return this.likeData.isLike && (a = _.sortBy(a, function(a) {
                    return a._id !== t.user.id
                }), a[0] && a[0]._id === t.user.id || (a.unshift({_id: t.user.id,avatarUrl: t.user.get("avatarUrl"),name: t.user.get("name")}), this.likeFirstInit && b.push(t.user.id), this.likeFirstInit = !1)), c = "", _.each(a, function(a) {
                    var d;
                    return -1 === _.indexOf(b, a._id) ? (d = " active", b.push(a._id)) : d = "", c && (c += "，"), c += "<span class='name" + d + "'>" + a.name + "</span>"
                }), c
            }, e.prototype.getLikes = function() {
                return this.objectModel.getLike({attrs: {_objectlinkId: this.options._objectlinkId},success: function(a) {
                    return function(b) {
                        return a.likeData ? a.prevLikeGroup = _.pluck(a.likeData.likesGroup, "_id") : (a.prevLikeGroup = _.pluck(b.likesGroup, "_id"), a.likeFirstInit = !0), a.likeData = b, a.renderLikes()
                    }
                }(this)}), this
            }, e.prototype.getLikesList = function() {
                return this.objectModel.getLike({attrs: {all: 1},beforeSend: function(a) {
                    return function() {
                        return a.likesListData ? void 0 : a.showLoadingIndicator(a.$likesList)
                    }
                }(this),success: function(a) {
                    return function(b) {
                        return a.likesListData ? a.prevlikesListGroup = _.pluck(a.likesListData.likesGroup, "_id") : (a.prevlikesListGroup = _.pluck(b.likesGroup, "_id"), a.likeFirstInit = !0), a.likesListData = b, a.renderLikesList(), a.hideLoadingIndicator({animated: !0})
                    }
                }(this)}), this
            }, e.prototype.toggleLikes = function() {
                return this.likeData.likesCount > 5 ? (this.$likesHandler.hasClass("active") ? (this.$likesHandler.removeClass("active"), this.renderLikes()) : (this.$likesHandler.addClass("active"), this.$likesTips.html("点赞人员列表："), this.likesListData ? this.renderLikesList() : this.getLikesList()), this) : this
            }, e.prototype.scrollToBottom = function() {
                return _.delay(function(a) {
                    return function() {
                        return a.slideTo()
                    }
                }(this)), this
            }, e.prototype.switchTabs = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), b.hasClass("active") || (b.addClass("active").siblings().removeClass("active"), c = b.data("toggle"), this.$("" + c).addClass("active").siblings().removeClass("active"), null != (d = this.$activityCreator) && d[".activities-pane" === c ? "slideShow" : "slideHide"]()), this
            }, e.prototype.enterObjectPreviewer = function(a) {
                var b;
                return b = $(a.currentTarget), "objectlink" === b.data("type") && b.data("id") && this.projectRight >= 0 ? (l.fetch(this.objectModel.id, {boundToObjectType: this.options.boundToObjectType,attrs: {_parentId: this.objectModel.id,_objectlinkId: this.options._objectlinkId,parentType: this.options.boundToObjectType},success: function(a) {
                    return function(c) {
                        var d;
                        if (a.$el && (d = c.get(b.data("id"))))
                            return "work" === d.get("linkedType") ? a.showWorksPreviewer(c, d.get("_linkedId")) : a.requestSubView(r).open(k, {boundToObjectType: a.options.boundToObjectType,_objectlinkId: b.data("id"),objectModel: a.objectModel,objectlinksCollection: c})
                    }
                }(this)}), this) : void 0
            }, e.prototype.showWorksPreviewer = function(a, b) {
                var c, d;
                return c = null, d = [], p.each(a.where({linkedType: "work"}), function() {
                    return function(a, e) {
                        return s.fetch(e.get("_linkedId"), {attrs: {_objectlinkId: e.id},success: function(f) {
                            return f.set("_objectlinkId", e.id), d.push(f), f.id === b && (c = f), a()
                        },error: function() {
                            return a()
                        }})
                    }
                }(this)).fin(function(a) {
                    return function() {
                        var b;
                        return b = {_projectId: a._projectId,workModel: c}, b.workModels = d, a.requestSubView(r).open(m, b)
                    }
                }(this)), this
            }, e.prototype.toggleComments = function() {
                return this.$(".activities-pane").toggleClass("only-comments"), this
            }, e.prototype.remove = function() {
                var a;
                return null != (a = this.$activityCreator) && a.off(".activity"), e.__super__.remove.apply(this, arguments)
            }, e
        }(q), _.extend(e.prototype, o), i.Constructor = e
    }), define("views/board/subtask/subtask-card/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="subtasks-list"></ul>';
            return a.projectRight >= 0 && (b += '<div class="subtask-creator"> <a class="subtask-add-handler" data-gta="event" data-label="task detail|add subtask"> <span class="icon icon-plus-sign"></span>添加子任务 </a> <div class="check-box pull-left"> <span class="icon icon-tick"></span> </div> <div class="subtask-executor pull-left"> <a class="avatar img-24 img-circle no-avatar hinted" data-gta="event" data-label="subtask|change executor"></a> </div> <div class="subtask-edit-wrap"> <textarea class="subtask-input form-control" placeholder="输入子任务内容..."></textarea> <div class="subtask-handler-set clearfix"> <a class="save-subtask-handler btn btn-primary pull-right" data-gta="event" data-label="task detail|save subtask">保存</a> <a class="cancel-subtask-handler pull-right">取消</a> </div> </div></div>'), b
        }
    }), define("views/board/subtask/subtask/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="check-box pull-left"> <span class="icon icon-tick"></span></div><div class="subtask-executor pull-left"> <a class="avatar img-24 img-circle no-avatar hinted" data-gta="event" data-label="subtask|change executor"></a></div><div class="subtask-content readable"></div>';
            return a.projectRight >= 0 && (b += '<a class="subtask-menu-toggler toggler icon icon-chevron-down pull-right"></a><div class="subtask-edit-wrap"> <textarea class="subtask-input form-control"></textarea> <div class="subtask-handler-set clearfix"> <a class="save-subtask-handler btn btn-primary pull-right" data-gta="event" data-label="save note">保存</a> <a class="cancel-subtask-handler pull-right">取消</a> </div></div>'), b
        }
    }), define("views/board/subtask/subtask-menu/templates/basic", [], function() {
        return function() {
            var a = '<ul class="list"> <li> <a class="transform-handler" data-gta="event" data-label="task detail|transform subtask to task"> <span class="icon icon-convert"></span>转换为任务 </a> </li> <li> <a class="delete-handler" data-gta="event" data-label="task detail|delete subtask"> <span class="icon icon-trash"></span>删除子任务 </a> </li></ul>';
            return a
        }
    }), define("views/board/subtask/subtask-menu/templates/delete", [], function() {
        return function() {
            var a = '<form class="delete-form"> <p>确认删除该子任务?</p> <button class="btn btn-danger" type="submit">删除</button></form>';
            return a
        }
    }), define("views/board/subtask/subtask-menu/templates/transform", [], function() {
        return function() {
            var a = '<form class="transform-form"> <p class="transform-tips">确定转换该子任务为任务？</p> <div class="subtask-menu-check-set"> <div class="subtask-menu-check"> <a class="subtask-menu-check-handler" data-type="link"> <div class="check-box pull-left"> <span class="icon icon-tick"></span> </div> <span>原任务接收新任务的更新提醒</span> </a> </div> <div class="subtask-menu-check"> <a class="subtask-menu-check-handler"  data-type="linked"> <div class="check-box pull-left"> <span class="icon icon-tick"></span> </div> <span>新任务接收原任务的更新提醒</span> </a> </div> </div> <button class="btn btn-primary" type="submit">确定</button></form>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/subtask/subtask-menu/index", ["require", "exports", "module", "teambition", "./templates/basic", "./templates/delete", "lib/popover/index", "./templates/transform", "store"], function(a) {
        var c, d, e, f, g, h, i;
        return i = a("teambition"), c = a("./templates/basic"), d = a("./templates/delete"), e = a("lib/popover/index"), h = a("./templates/transform"), f = a("store"), g = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "SubtaskMenuView", e.prototype.className = "subtask-menu-view", e.prototype.popoverTitle = "子任务菜单", e.prototype.events = {"click .transform-handler": "enterTransformSubMenu","click .delete-handler": "enterDeleteSubMenu","submit .delete-form": "submitDeleteForm","submit .transform-form": "transformSubtask","click .subtask-menu-check-handler": "toggleLink"}, e.prototype.initialize = function() {
                var a;
                return this.localCache = f.namespace("temp").namespace("subtask_menu"), this.localCacheId = "" + i.user.id, a = this.localCache(this.localCacheId) || {}, this.isLink = a.isLink, this.isLinked = a.isLinked, e.__super__.initialize.apply(this, arguments)
            }, e.prototype.render = function() {
                return this.$el.html(c(this.options.subtaskModel.toJSON())), this
            }, e.prototype.transformSubtask = function(a) {
                return a.preventDefault(), this.options.subtaskModel.transform({attrs: {doLink: this.isLink,doLinked: this.isLinked}}), this.hide()
            }, e.prototype.enterDeleteSubMenu = function() {
                return this.enterSubMenu("删除子任务", function(a) {
                    return function() {
                        return a.$el.html(d())
                    }
                }(this)), this
            }, e.prototype.enterTransformSubMenu = function() {
                return this.enterSubMenu("转换为任务", function(a) {
                    return function() {
                        return a.$el.html(h())
                    }
                }(this)), this.checkStatus(), this
            }, e.prototype.submitDeleteForm = function(a) {
                return a.preventDefault(), this.options.subtaskModel.destroy({wait: !0,beforeSend: function(a) {
                    return function() {
                        return a.$el.find(".delete-form").html("正在删除...")
                    }
                }(this),success: function(a) {
                    return function() {
                        return a.hide()
                    }
                }(this),error: function(a) {
                    return function(b, c) {
                        return a.$el.find(".delete-form").html("error " + c)
                    }
                }(this)}), this
            }, e.prototype.checkStatus = function() {
                return this.$(".subtask-menu-check-handler[data-type=link]")[this.isLink ? "addClass" : "removeClass"]("active"), this.$(".subtask-menu-check-handler[data-type=linked]")[this.isLinked ? "addClass" : "removeClass"]("active"), this
            }, e.prototype.toggleLink = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = b.data("type"), "link" === c ? this.isLink = !this.isLink : "linked" === c && (this.isLinked = !this.isLinked), this.cacheData(), this.checkStatus(), this
            }, e.prototype.cacheData = function() {
                var a;
                return a = {isLink: this.isLink,isLinked: this.isLinked}, this.localCache(this.localCacheId, a), this
            }, e
        }(e)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/subtask/subtask/index", ["require", "exports", "module", "teambition", "./templates/basic", "views/member/member-menu/index", "views/board/subtask/subtask-menu/index", "util", "view"], function(a) {
        var c, d, e, f, g, h, i;
        return i = a("teambition"), c = a("./templates/basic"), d = a("views/member/member-menu/index"), e = a("views/board/subtask/subtask-menu/index"), g = a("util"), h = a("view"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "SubtaskView", f.prototype.tagName = "li", f.prototype.className = "subtask-view toggler-parent clearfix", f.prototype.events = {"click .check-box": "toggleSubtask","click .subtask-menu-toggler": "toggleSubtaskMenu","click .subtask-content": "editSubtask","blur .subtask-input": "cancelUpdateByContent","click .save-subtask-handler": "updateSubtask","click .cancel-subtask-handler": "cancelUpdate"}, f.prototype.initialize = function(a) {
                return (null != a ? a.subtaskModel : void 0) && (null != a ? a.membersCollection : void 0) ? (this.options = a, this.subtaskModel = a.subtaskModel, this.membersCollection = a.membersCollection, this.projectRight = a.projectRight, this.hasEditRight = a.hasEditRight || this.subtaskModel.get("_executorId") === i.user.id, this.renderBasic().initExecutor().renderExecutor().renderContent().renderStatus().listen(), this.$el.attr("data-id", this.subtaskModel.id), this.hasEditRight || this.$el.addClass("disable-edit"), this.projectRight >= 0 || this.$el.addClass("guest"), this) : !1
            }, f.prototype.listen = function() {
                return this.listenTo(this.subtaskModel, "remove", this.remove), this.listenTo(this.subtaskModel, "change:isDone", this.renderStatus), this.listenTo(this.subtaskModel, "change:content", this.renderContent), this.listenTo(this.subtaskModel, "change:_executorId", this.renderExecutor), this
            }, f.prototype.renderBasic = function() {
                return this.$el.html(c({projectRight: this.projectRight})), this.$subtaskInput = this.$(".subtask-input"), this.$executor = this.$(".avatar"), this.$content = this.$(".subtask-content"), this.$checkBox = this.$(".check-box"), this
            }, f.prototype.initExecutor = function() {
                return this.projectRight >= 0 ? (this.requestSubView(d, {$toggler: this.$executor,noAssign: !0,membersCollection: this.membersCollection,selected: [this.subtaskModel.get("_executorId")],select: function(a) {
                    return function(b) {
                        return a.subtaskModel.saveAttr("_executorId", b)
                    }
                }(this)}), this) : this
            }, f.prototype.renderExecutor = function() {
                var a, b, c;
                return b = this.subtaskModel.get("_executorId"), a = (null != (c = this.membersCollection.get(b)) ? c.toJSON() : void 0) || {}, a.avatarUrl && a.name ? this.$executor.data("title", a.name).removeClass("no-avatar").attr("style", "background-image:url(" + a.avatarUrl + ")") : this.$executor.data("title", "待认领").addClass("no-avatar").attr("style", ""), this
            }, f.prototype.renderContent = function() {
                var a;
                return a = _.unescape(this.subtaskModel.get("content").trim()), this.$content.text(a), this.$subtaskInput.val(a), this.$subtaskInput.flexText(), this
            }, f.prototype.renderStatus = function() {
                return this.$el[this.subtaskModel.get("isDone") ? "addClass" : "removeClass"]("done"), this
            }, f.prototype.editSubtask = function() {
                return this.projectRight >= 0 ? (this.$el.addClass("editing"), this.$subtaskInput.focusAtEnd(), this) : this
            }, f.prototype.updateSubtask = function() {
                var a, b;
                if (this.$el.hasClass("editing"))
                    return a = this.$subtaskInput.val().trim(), a = a.replace(/\s+/g, " ").trim(), b = this.subtaskModel.get("content"), a ? a !== b && this.subtaskModel.saveAttr("content", a) : this.$subtaskInput.val(b), this.$el.removeClass("editing"), this
            }, f.prototype.cancelUpdateByContent = function() {
                return this.$subtaskInput.val().trim() === this.subtaskModel.get("content") ? this.cancelUpdate() : void 0
            }, f.prototype.cancelUpdate = function() {
                return this.$el.hasClass("editing") ? (this.$subtaskInput.val(this.subtaskModel.get("content")), this.$el.removeClass("editing")) : void 0
            }, f.prototype.quickUpdate = function(a) {
                return 13 === a.keyCode && (a.preventDefault(), this.$subtaskInput.blur()), this
            }, f.prototype.toggleSubtask = function() {
                return this.projectRight >= 0 ? (this.subtaskModel.saveAttr("isDone", !this.subtaskModel.get("isDone")), this) : this
            }, f.prototype.toggleSubtaskMenu = function(a) {
                var b;
                if (this.hasEditRight)
                    return b = $(a.currentTarget), b.data("bs.popover") ? this : (this.requestSubView(e, {$toggler: b,subtaskModel: this.subtaskModel}).show(), this)
            }, f
        }(h)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/subtask/subtask-card/index", ["require", "exports", "module", "./templates/basic", "views/member/member-menu/index", "views/board/subtask/subtask/index", "util", "view"], function(a) {
        var c, d, e, f, g, h;
        return c = a("./templates/basic"), d = a("views/member/member-menu/index"), f = a("views/board/subtask/subtask/index"), g = a("util"), h = a("view"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "SubtaskCardView", e.prototype.className = "subtask-card", e.prototype.events = {"click .subtask-add-handler": "edit","keydown .subtask-creator .subtask-input": "quickSubmit","click .subtask-creator .cancel-subtask-handler": "cancel","click .subtask-creator .save-subtask-handler": "submit"}, e.prototype.creating = !1, e.prototype.initialize = function(a) {
                return (null != a ? a.subtasksCollection : void 0) && (null != a ? a.taskModel : void 0) && (null != a ? a.membersCollection : void 0) ? (this.options = a, this.taskModel = a.taskModel, this.projectRight = this.taskModel.getRight(), this.subtasksCollection = a.subtasksCollection, this.membersCollection = a.membersCollection, this.creating = !1, this.renderBasic(), this.renderSubtasks(), this.taskModel.hasEditRight() && this.setupSubtaskSortable(), this._executorId = this.taskModel.get("_executorId"), this.initExecutor(), this.renderExecutor(), this.listen(), this) : !1
            }, e.prototype.listen = function() {
                return this.listenTo(this.subtasksCollection, "add", this.renderSubtask), this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(c({projectRight: this.projectRight})), this.$list = this.$(".subtasks-list"), this.$creator = this.$(".subtask-creator"), this.$executor = this.$creator.find(".avatar"), this.$input = this.$(".subtask-input").flexText(), this
            }, e.prototype.initExecutor = function() {
                return this.projectRight >= 0 ? (this.requestSubView(d, {$toggler: this.$executor,noAssign: !0,membersCollection: this.membersCollection,selected: [this._executorId],select: function(a) {
                    return function(b) {
                        return a._executorId = b, a.renderExecutor()
                    }
                }(this)}), this) : this
            }, e.prototype.renderExecutor = function() {
                var a, b;
                return a = (null != (b = this.membersCollection.get(this._executorId)) ? b.toJSON() : void 0) || {}, a.avatarUrl && a.name ? this.$executor.data("title", a.name).removeClass("no-avatar").attr("style", "background-image:url(" + a.avatarUrl + ")") : this.$executor.data("title", "待认领").addClass("no-avatar").attr("style", ""), this
            }, e.prototype.renderSubtasks = function() {
                return this.subtasksCollection.updateSort(this.taskModel.get("subtaskIds")), this.subtasksCollection.each(function(a) {
                    return function(b) {
                        return a.renderSubtask(b)
                    }
                }(this)), this
            }, e.prototype.renderSubtask = function(a) {
                return this.requestSubView(f, {subtaskModel: a,membersCollection: this.membersCollection,projectRight: this.projectRight,hasEditRight: this.taskModel.hasEditRight()}).$el.appendTo(this.$list), this
            }, e.prototype.setupSubtaskSortable = function() {
                return this.projectRight >= 0 ? (this.$list.sortable({items: ".subtask-view",helper: "clone",placeholder: "subtask-drag-placeholder",tolerance: "pointer",zIndex: 2001,axis: "y",start: function() {
                    return function(a, b) {
                        return b.placeholder.height(b.helper.outerHeight())
                    }
                }(this),update: function(a) {
                    return function() {
                        var b;
                        return b = a.$list.find(".subtask-view").map(function(a, b) {
                            return $(b).data("id")
                        }).toArray(), a.taskModel.saveAttr("subtaskIds", b)
                    }
                }(this)}), this) : this
            }, e.prototype.edit = function() {
                return this.projectRight >= 0 ? (this.$creator.addClass("editing"), this.$input.focusAtEnd(), this.$creator.handleClickOutside(function(a) {
                    return function() {
                        return a.$input.val().trim() ? void 0 : a.cancel()
                    }
                }(this), "click", ".member-menu-view"), this) : this
            }, e.prototype.cancel = function() {
                return this.$creator.removeClass("editing"), this
            }, e.prototype.quickSubmit = function(a) {
                return 13 === a.keyCode && (a.preventDefault(), this.submit()), this
            }, e.prototype.submit = function() {
                var a;
                return this.projectRight >= 0 ? this.creating ? this : (a = this.$input.val().trim(), (a = a.replace(/\s+/g, " ").trim()) ? (this.creating = !0, this.subtasksCollection.create({_taskId: this.taskModel.id,_executorId: this._executorId,content: a}, {wait: !0,success: function(a) {
                    return function() {
                        return a.$input.val(""), a.$input.prev().remove(), a.creating = !1, a.$input.focusAtEnd()
                    }
                }(this),error: function(a) {
                    return function() {
                        return a.creating = !1, a.$input.focusAtEnd()
                    }
                }(this)}), this) : this) : this
            }, e
        }(h)
    }), define("views/board/task/task-menu/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="list task-menu-list"> <li> <a class="copy-task-handler" data-gta="event" data-label="task detail|copy task"> <span class="icon icon-copy-task"></span>复制任务 </a> </li> ';
            return a.hasRight > 0 && (b += ' <li> <a class="move-task-handler" data-gta="event" data-label="task detail|move task"> <span class="icon icon-move-task"></span>移动任务 </a> </li> <li> ', b += a.isArchived ? ' <a class="unarchive-task-handler" data-gta="event" data-label="task detail|unarchive task"> <span class="icon icon-archive"></span>取消归档 </a> ' : ' <a class="archive-task-handler" data-gta="event" data-label="task detail|archive task"> <span class="icon icon-archive"></span>归档任务 </a> ', b += ' </li> <li> <a class="delete-task-handler" data-gta="event" data-label="task detail|delete task"> <span class="icon icon-trash"></span>删除任务 </a> </li> <li class="divider"></li> <li> ', "members" == a.visiable || "all" == a.visiable ? b += ' <a class="switch-visible-handler" data-type="involves" data-gta="event" data-label="task detail|switch visible"> <span class="icon icon-lock2"></span>转换为参与者可见 </a> ' : "involves" == a.visiable && (b += ' <a class="switch-visible-handler" data-type="members" data-gta="event" data-label="task detail|switch visible"> <span class="icon icon-users-bold"></span>转换为所有成员可见 </a> '), b += " </li> "), b += "</ul>"
        }
    }), define("views/board/task/task-menu/templates/copy-or-move", [], function() {
        return function(a) {
            var b = '<div class="copy-or-move-task"> <p class="menu-title text-muted">' + a.title + '</p> <div class="task-select"> <span class="select-label">项目</span> <a class="select-project"> <span class="project-name">选择项目</span> <span class="icon icon-chevron-down"></span> </a> </div> <div class="task-select"> <span class="select-label">分组</span> <a class="select-tasklist"> <span class="tasklist-name">选择任务分组</span> <span class="icon icon-chevron-down"></span> </a> </div> <div class="task-select"> <span class="select-label">阶段</span> <a class="select-stage"> <span class="stage-name">选择阶段</span> <span class="icon icon-chevron-down"></span> </a> </div> ';
            return a.isCopy && a.hasRight >= 0 && (b += ' <div class="task-menu-check-set"> <div class="task-menu-check"> <a class="task-menu-check-handler" data-type="link"> <div class="check-box pull-left"> <span class="icon icon-tick"></span> </div> <span>原任务接收新任务的更新提醒</span> </a> </div> <div class="task-menu-check"> <a class="task-menu-check-handler"  data-type="linked"> <div class="check-box pull-left"> <span class="icon icon-tick"></span> </div> <span>新任务接收原任务的更新提醒</span> </a> </div> </div> '), b += ' <p class="menu-tips text-muted">' + a.tips + '</p> <button class="btn btn-primary" type="submit">确定</button></div>'
        }
    }), define("views/board/task/task-menu/templates/delete", [], function() {
        return function() {
            var a = '<form class="delete-form"> <p>确认删除任务？</p> <button class="btn btn-danger" type="submit">删除</button></form>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/task/task-menu/index", ["require", "exports", "module", "teambition", "store", "util", "models/project", "models/stage", "models/tasklist", "collections/projects", "collections/stages", "collections/tasklists", "collections/tasks", "views/core/popover-menu/index", "lib/popover/index", "./templates/basic", "./templates/copy-or-move", "./templates/delete", "essage"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s;
        return r = a("teambition"), l = a("store"), q = a("util"), h = a("models/project"), j = a("models/stage"), o = a("models/tasklist"), i = a("collections/projects"), k = a("collections/stages"), n = a("collections/tasklists"), p = a("collections/tasks"), f = a("views/core/popover-menu/index"), g = a("lib/popover/index"), c = a("./templates/basic"), d = a("./templates/copy-or-move"), e = a("./templates/delete"), s = a("essage"), m = function(a) {
            function g() {
                return g.__super__.constructor.apply(this, arguments)
            }
            return b(g, a), g.prototype.viewName = "TaskMenuView", g.prototype.className = "task-menu-view", g.prototype.popoverTitle = "任务菜单", g.prototype.events = {"click .copy-task-handler": "enterCopySubMenu","click .move-task-handler": "enterMoveSubMenu","click .archive-task-handler": "archiveTask","click .unarchive-task-handler": "unarchiveTask","click .delete-task-handler": "enterDeleteSubMenu","click .select-project": "selectProject","click .select-tasklist": "selectTasklist","click .select-stage": "selectStage","click .copy-or-move-task button": "submitCopyOrMove","click .switch-visible-handler": "switchVisible","click .task-menu-check-handler": "toggleLink","submit .delete-form": "submitDeleteForm"}, g.prototype.initialize = function(a) {
                if (!a._projectId)
                    throw new Error("task menu error:should has _projectId in options");
                return this.localCache = l.namespace("temp").namespace("task_menu"), this.localCacheId = "" + r.user.id, g.__super__.initialize.apply(this, arguments)
            }, g.prototype.render = function() {
                var a;
                return a = this.options.taskModel.toJSON(), a.hasRight = this.options.taskModel.hasRight(), this.$el.html(c(a)), this
            }, g.prototype.archiveTask = function() {
                return this.options.taskModel.archive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功归档了任务",status: "success"}, 2e3), a.remove()
                    }
                }(this)}), this
            }, g.prototype.unarchiveTask = function() {
                return this.options.taskModel.unarchive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功解档了任务",status: "success"}, 2e3), a.remove()
                    }
                }(this)}), this
            }, g.prototype.enterDeleteSubMenu = function() {
                return this.enterSubMenu("删除任务", function(a) {
                    return function() {
                        return a.$el.html(e())
                    }
                }(this)), this
            }, g.prototype.enterCopySubMenu = function() {
                return this.resetSelectMenu(), this.enterSubMenu("复制任务", function(a) {
                    return function() {
                        return a.$el.html(d({isCopy: !0,hasRight: a.options.taskModel.hasRight(),title: "复制到",tips: "标题、子任务、备忘将被复制"})), a.$projectName = a.$(".project-name"), a.$tasklistName = a.$(".tasklist-name"), a.$stageName = a.$(".stage-name"), a.$submit = a.$(".btn-primary"), a.checkStatus(), a.forkOrMove = "fork"
                    }
                }(this)), this
            }, g.prototype.enterMoveSubMenu = function() {
                return this.resetSelectMenu(), this.enterSubMenu("移动任务", function(a) {
                    return function() {
                        return a.$el.html(d({title: "移动到",tips: "跨项目移动时，任务附件、部分参与者信息不会保留"})), a.$projectName = a.$(".project-name"), a.$tasklistName = a.$(".tasklist-name"), a.$stageName = a.$(".stage-name"), a.$submit = a.$(".btn-primary"), a.checkStatus(), a.forkOrMove = "move"
                    }
                }(this)), this
            }, g.prototype.resetSelectMenu = function() {
                var a, b, c, d, e;
                return null != (c = this.tasklistMenuView) && c.remove(), this.tasklistMenuView = null, null != (d = this.stageMenuView) && d.remove(), this.stageMenuView = null, a = this.localCache(this.localCacheId) || {}, this.options.taskModel.hasRight() >= 0 && (this.isLink = a.isLink, this.isLinked = a.isLinked), this.stageModel = j.find(a._stageId), this.projectsCollection = i.get(0), b = a._projectId || this.options.taskModel.get("_projectId"), this.projectModel = h.find(b), this.tasklistsCollection = this.options.tasklistsCollection, e = a._tasklistId, e || b !== this.options.taskModel.get("_projectId") || (e = this.options.taskModel.get("_tasklistId")), this.tasklistModel = o.find(e), this
            }, g.prototype.selectProject = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), b.data("bs.popover") || (c = this.requestSubView(f, {container: this.$el,$toggler: b,searchPlaceholder: "查找项目",dataList: this.projectsCollection.filter(function(a) {
                    return a.hasRight() >= 0
                }).map(function(a) {
                    return {_id: a.get("_id"),title: a.get("name")}
                }),selected: (null != (d = this.projectModel) ? d.id : void 0) || "",select: function(a) {
                    return function(b) {
                        var c;
                        return b !== (null != (c = a.projectModel) ? c.id : void 0) && (a.projectModel = a.projectsCollection.get(b), a.tasklistModel = null, a.stageModel = null, a.cacheData()), a.checkStatus()
                    }
                }(this)}).show()), this
            }, g.prototype.selectTasklist = function(a) {
                var b;
                if (this.projectModel)
                    return this.tasklistMenuView || (this.tasklistMenuView = this.requestSubView(f, {container: this.$el,$toggler: $(a.currentTarget),dataList: [],selected: (null != (b = this.tasklistModel) ? b.id : void 0) || "",select: function(a) {
                        return function(b) {
                            var c;
                            return b !== (null != (c = a.tasklistModel) ? c.id : void 0) && (a.tasklistModel = a.tasklistsCollection.get(b), a.stageModel = null, a.cacheData()), a.checkStatus()
                        }
                    }(this)}).show()), this.tasklistMenuView.update([]), n.fetch(this.projectModel.id, {success: function(a) {
                        return function(b) {
                            return a.tasklistsCollection = b, a.tasklistMenuView.update(b.map(function(a) {
                                return {_id: a.get("_id"),title: a.get("title")}
                            }))
                        }
                    }(this)}), this
            }, g.prototype.selectStage = function(a) {
                return this.tasklistModel ? (this.stageMenuView || (this.stageMenuView = this.requestSubView(f, {container: this.$el,$toggler: $(a.currentTarget),dataList: [],selected: "",select: function(a) {
                    return function(b) {
                        var c;
                        return b !== (null != (c = a.stageModel) ? c.id : void 0) && (a.stageModel = a.stagesCollection.get(b), a.cacheData()), a.checkStatus()
                    }
                }(this)}).show()), this.stageMenuView.update([]), k.fetch(this.tasklistModel.id, {success: function(a) {
                    return function(b) {
                        return a.stagesCollection = b, a.stageMenuView.update(b.map(function(a) {
                            return {_id: a.get("_id"),title: a.get("name")}
                        }))
                    }
                }(this)}), this) : void 0
            }, g.prototype.switchVisible = function(a) {
                var b;
                return b = $(a.currentTarget), this.options.taskModel.saveAttr("visiable", b.data("type"), {success: function(a) {
                    return function() {
                        return Essage.show({message: "设置成功",status: "success"}, 2e3), a.remove()
                    }
                }(this)}), this
            }, g.prototype.toggleLink = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = b.data("type"), "link" === c ? this.isLink = !this.isLink : "linked" === c && (this.isLinked = !this.isLinked), this.cacheData(), this.checkStatus(), this
            }, g.prototype.checkStatus = function() {
                var a, b, c;
                return this.$projectName.text((null != (a = this.projectModel) ? a.get("name") : void 0) || "选择项目"), this.$tasklistName.text((null != (b = this.tasklistModel) ? b.get("title") : void 0) || "选择任务分组"), this.$stageName.text((null != (c = this.stageModel) ? c.get("name") : void 0) || "选择阶段"), this.$(".task-menu-check-handler[data-type=link]")[this.isLink ? "addClass" : "removeClass"]("active"), this.$(".task-menu-check-handler[data-type=linked]")[this.isLinked ? "addClass" : "removeClass"]("active"), this.disableSubmit(!(this.projectModel && this.tasklistModel && this.stageModel)), this
            }, g.prototype.disableSubmit = function(a) {
                return this.$submit.prop("disabled", a), this.$submit[a ? "addClass" : "removeClass"]("disabled"), this
            }, g.prototype.submitCopyOrMove = function() {
                return this.$submit.prop("disabled") ? void 0 : "move" === this.forkOrMove && this.stageModel.id === this.options.taskModel.get("_stageId") ? this.hide() : (this.disableSubmit(!0), this.options.taskModel.forkOrMove(this.forkOrMove, this.stageModel.id, {attrs: {doLink: this.isLink,doLinked: this.isLinked},success: function(a) {
                    return function(b) {
                        var c;
                        return null != (c = p.find(a.stageModel.id)) && c.add(b), q.message({tips: "fork" === a.forkOrMove ? "成功复制任务：" : "成功移动任务：",url: "/project/" + b._projectId + "/tasks/scrum/" + b._tasklistId + "/task/" + b._id,title: a.options.taskModel.get("content")}), a.remove()
                    }
                }(this),error: function(a) {
                    return function() {
                        return a.disableSubmit(!1), Essage.show({message: "fork" === a.forkOrMove ? "任务复制失败" : "任务移动失败",status: "error"}, 2e3)
                    }
                }(this)}))
            }, g.prototype.submitDeleteForm = function(a) {
                return a.preventDefault(), this.options.taskModel.destroy({success: function(a) {
                    return function() {
                        return Essage.show({message: "删除成功",status: "success"}, 2e3), a.remove(), r.APP.hidePanel()
                    }
                }(this)}), this
            }, g.prototype.cacheData = function() {
                var a, b, c, d;
                return a = {_projectId: null != (b = this.projectModel) ? b.get("_id") : void 0,_stageId: null != (c = this.stageModel) ? c.get("_id") : void 0,_tasklistId: null != (d = this.tasklistModel) ? d.get("_id") : void 0}, this.options.taskModel.hasRight() >= 0 && (a.isLink = this.isLink, a.isLinked = this.isLinked), this.localCache(this.localCacheId, a), this
            }, g
        }(g)
    }), define("views/board/task/task-detail/templates/basic", [], function() {
        return function(a) {
            var b = '<header class="task-detail-header clearfix"> <div class="task-tasklist-stage-wrap pull-left"> <span class="tasklist-title">任务分组</span> <a class="task-detail-tasklist" data-gta="event" data-label="task detail|move tasklist"></a> <span>，</span> <span class="stage-title">任务阶段</span> <a class="task-detail-stage" data-gta="event" data-label="task detail|move stage"></a> </div> ';
            return a.user.isGhost || (b += ' <div class="task-open-handler pull-right"> <a class="menu-handler" data-gta="event" data-label="task detail|task menu"> 更多 <span class="icon icon-chevron-down"></span> </a> </div> '), b += '</header><div class="task-detail-content hack-render-bug"> <div class="task-wrapper"></div> <div class="task-detail-note"> <h4 class="task-info-title">任务备忘</h4> <div class="task-note-content readable ', a.projectRight >= 0 && (b += "hinted"), b += '" data-title="点击即可编辑"></div> ', a.projectRight >= 0 && (b += ' <a class="note-add-handler"> <span class="icon icon-plus-sign"></span>添加任务备忘 </a> <div class="task-note-edit"> <textarea class="task-note-input form-control" data-gta="event" data-label="task detail|write note" placeholder="添加任务备忘..."></textarea> <div class="note-handler-set clearfix"> <a class="save-note-handler btn btn-primary pull-right" data-gta="event" data-label="save note"> 保存 </a> <a class="cancel-note-handler pull-right"> 取消 </a> </div> </div> '), b += ' </div> <div class="task-info clearfix"> <div class="task-detail-handler"> <h4 class="task-info-title">执行者</h4> <a class="task-detail-executor" data-gta="event" data-label="task detail|change executor"> </a> </div> <div class="task-detail-handler"> <h4 class="task-info-title">截止日期</h4> <a class="task-detail-due-date" data-gta="event" data-label="task detail|choose duedate"> <span class="icon icon-calendar2"></span> <span class="due-date-title"></span> </a> </div> <div class="task-detail-handler"> <h4 class="task-info-title">优先级</h4> <a class="task-detail-priority" data-gta="event" data-label="task|change priority"> <span class="icon icon-circle-bold priority-label"></span> <span class="priority-title"></span> </a> </div> <div class="task-detail-handler repeat-menu-wrap"> <h4 class="task-info-title">重复</h4> <a class="task-detail-repeat" data-gta="event" data-label="task|change repeat"> <span class="icon icon-repeat"></span> <span class="repeat-title"></span> </a> </div> </div> ', (a.projectRight >= 0 || a.subtasksCount > 0) && (b += ' <div class="task-detail-subtasks"> <h4 class="task-info-title">子任务</h4> </div> '), b += ' <div class="task-detail-tags-set"></div> <div class="task-detail-involve-set"></div></div><div class="activity-creator-wrapper"></div>'
        }
    }), define("views/board/task/task-detail/templates/content-title", [], function() {
        return function(a) {
            var b = "";
            return b += a.hasEditRight ? '<textarea class="task-content-input form-control hinted" data-title="点击即可编辑"></textarea>' : '<div class="flex-text-wrap"> <p class="task-content-input"></p></div>'
        }
    }), define("views/board/task/task-detail/templates/info-executor", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            return c += a.executor ? ' <div class="task-detail-handler-icon avatar img-24 img-circle" style="background-image: url(' + a.executor.avatarUrl + ')"></div> ' + b(a.executor.name) : ' <div class="task-detail-handler-icon avatar img-24 img-circle no-avatar"></div> 待认领'
        }
    }), define("views/board/task/task-detail/templates/task", [], function() {
        return function(a) {
            var b = '<div class="task ';
            return a.isDone && (b += "done"), b += " ", a.hasRight > 0 && (b += "task-has-right"), b += '"> ', a.hasEditRight ? (b += ' <div class="check-box hinted" data-title="', b += a.isDone ? "重做此任务" : "完成任务", b += '" data-gta="event" data-label="task detail|check task"> <span class="icon icon-tick"></span> </div> ') : b += ' <div class="check-box non-checkable" data-gta="event" data-label="task detail|check task"> <span class="icon icon-tick"></span> </div> ', b += ' <div class="task-content-wrapper"></div></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/task/task-detail/index", ["require", "exports", "module", "teambition", "exports", "store", "thenjs", "util", "view", "models/task", "collections/members", "collections/projects", "collections/stages", "collections/subtasks", "collections/tasklists", "views/activity/activity-timeline/index", "lib/confirm/index", "views/member/member-involve/index", "views/member/member-menu/index", "views/core/popover-menu/index", "views/board/subtask/subtask-card/index", "views/tag/tag-picker/index", "views/board/task/task-menu/index", "views/board/task/task-priority/index", "views/board/task/task-repeat/index", "./templates/basic", "./templates/content-title", "./templates/info-executor", "./templates/task", "flexText"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E;
        return D = a("teambition"), g = a("exports"), p = a("store"), A = a("thenjs"), B = a("util"), C = a("view"), v = a("models/task"), l = a("collections/members"), n = a("collections/projects"), o = a("collections/stages"), r = a("collections/subtasks"), z = a("collections/tasklists"), c = a("views/activity/activity-timeline/index"), e = a("lib/confirm/index"), j = a("views/member/member-involve/index"), k = a("views/member/member-menu/index"), m = a("views/core/popover-menu/index"), q = a("views/board/subtask/subtask-card/index"), s = a("views/tag/tag-picker/index"), u = a("views/board/task/task-menu/index"), w = a("views/board/task/task-priority/index"), x = a("views/board/task/task-repeat/index"), d = a("./templates/basic"), f = a("./templates/content-title"), h = a("./templates/info-executor"), y = a("./templates/task"), E = a("flexText"), i = "ZH", t = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "TaskDetailView", e.prototype.className = "task-detail fade thin-scroll task-detail-loading", e.prototype.events = {"click .task .check-box": "toggleDone","click .task-detail-stage": "toggleStageSwitcher","click .task-detail-tasklist": "toggleGroupSwitcher","click .task-detail-due-date": "showDueDatePickerInDetail","click .menu-handler": "toggleTaskMenu","focus .task-content-input": "enterEditContent","blur .task-content-input": "updateTaskContent","click .note-add-handler, .task-note-content": "enterNoteEdit","blur .task-note-input": "blurNote","click .save-note-handler": "updateNote","click .cancel-note-handler": "cancelNote","keydown .task-content-input": "quickUpdateTaskContent","keydown .task-note-input": "quickUpdateNote",mousewheel: B.mousewheel}, e.prototype.initialize = function(a) {
                return a._taskId || a.taskModel ? (this.options = a, this._taskId = a._taskId, this.taskModel = a.taskModel, this.showLoadingIndicator(), A(function(b) {
                    return function(c) {
                        return b.taskModel ? (b._taskId = b.taskModel.id, c()) : (a = {success: function(a) {
                            return b.taskModel = a, c()
                        },error: function(a, b) {
                            return c(b)
                        }}, b.options._objectlinkId && (a.attrs = {detailType: "complete",_objectlinkId: b.options._objectlinkId}), v.fetch(b._taskId, a))
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return a._projectId = a.taskModel.get("_projectId"), a._tasklistId = a.taskModel.get("_tasklistId"), a.projectRight = a.taskModel.getRight(), a.hasEditRight = a.taskModel.hasEditRight(), a.projectModel = n.getOne(0, a._projectId), a.projectRight < 0 && a.$el.addClass("guest"), a.projectRight >= 0 || a.projectModel.get("isPublic") ? A.parallel([function(b) {
                            return z.fetch(a._projectId, {success: function(c) {
                                return a.tasklistsCollection = c, a.tasklistModel = a.tasklistsCollection.get(a._tasklistId), b()
                            },error: function(a, c) {
                                return b(c)
                            }})
                        }, function(b) {
                            return o.fetch(a._tasklistId, {success: function(c) {
                                return a.stagesCollection = c, b()
                            },error: function(a, c) {
                                return b(c)
                            }})
                        }, function(b) {
                            return r.fetch(a._taskId, {success: function(c) {
                                return a.subtasksCollection = c, b()
                            },error: function(a, c) {
                                return b(c)
                            }})
                        }, function(b) {
                            return l.fetch(a._projectId, {success: function(c) {
                                return a.membersCollection = c, b()
                            },error: function(a, c) {
                                return b(c)
                            }})
                        }]).fin(b) : (a.subtasksCollection = r.get(a._taskId), a.subtasksCollection.add(a.taskModel.get("subtasks")), a.membersCollection = l.get(a._projectId), b())
                    }
                }(this)).then(function(a) {
                    return function() {
                        var b;
                        if (a.$el)
                            return a.hideLoadingIndicator(), a.$el.removeClass("task-detail-loading"), a.rrule = a.taskModel.getRRule(), a.hasRecurrence = !!a.rrule, a.rrule || (a.rrule = new RRule({freq: RRule.WEEKLY,dtstart: new Date})), a.localCache = p.namespace("temp").namespace("task_notes"), a.localCacheId = "" + a._taskId + "_" + D.user.id, a.renderBasic(), a.renderTask().renderTags().renderInvolve().renderActivities().renderInfo().listen(), "function" == typeof (b = a.options).success ? b.success(a) : void 0
                    }
                }(this)).fail(function(a) {
                    return function(b, c) {
                        return console.error(c), a.close()
                    }
                }(this)), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this) : void 0
            }, e.prototype.listen = function() {
                return this.listenTo(this.taskModel, "change:content change:isDone", this.renderTask), this.listenTo(this.taskModel, "change:_executorId", function(a) {
                    return function() {
                        return a.hasEditRight = a.taskModel.hasEditRight(), a.renderExecutor(), a.renderTask()
                    }
                }(this)), this.listenTo(this.taskModel, "change:dueDate", this.renderDuedate), this.listenTo(this.taskModel, "change:note", this.renderNote), this.listenTo(this.taskModel, "change:priority", this.renderPriority), this.listenTo(this.taskModel, "change:_stageId", this.renderStage), this.listenTo(this.taskModel, "change:_tasklistId", this.renderTasklist), this.listenTo(this.taskModel, "destroy remove", this.close), this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(d({projectRight: this.projectRight,subtasksCount: this.subtasksCollection.length,user: D.user.toJSON()})), this.$task = this.$(".task-wrapper"), this.$info = this.$(".task-detail-info"), this.$involveSet = this.$(".task-detail-involve-set"), this.$wrapper = this.$(".task-detail-wrapper"), this.$executor = this.$(".task-detail-executor"), this.$dueDate = this.$(".task-detail-due-date"), this.$note = this.$(".task-detail-note"), this.$noteEditContent = this.$(".task-note-input"), this.$repeat = this.$(".task-detail-repeat"), this.$priority = this.$(".task-detail-priority"), this.$stage = this.$(".task-detail-stage"), this.$tasklist = this.$(".task-detail-tasklist"), this.$subtasks = this.$(".task-detail-subtasks"), this.$activityCreator = this.$(".activity-creator-wrapper"), this.activeTaskCard(), this
            }, e.prototype.renderTask = function() {
                var a;
                return a = this.taskModel.toJSON(), a.hasRight = this.taskModel.hasRight(), a.hasEditRight = this.taskModel.hasEditRight(), this.$task.html(y(a)), this.$contentWrapper = this.$(".task-content-wrapper"), this.renderTitle(), this
            }, e.prototype.renderInfo = function() {
                return this.renderExecutor(), this.renderDuedate(), this.renderNote(), this.renderRepeat(), this.renderPriority(), this.renderStage(), this.renderTasklist(), this.renderSubtaskCard(), this.setupInfoWidgets(), this
            }, e.prototype.renderExecutor = function() {
                var a, b, c;
                return a = this.taskModel.get("executor") || (null != (b = this.membersCollection) && null != (c = b.get(this.taskModel.get("_executorId"))) ? c.toJSON() : void 0), this.$executor.html(h({executor: a})), this.$executor[(null != a ? a.name : void 0) ? "addClass" : "removeClass"]("dirty"), this
            }, e.prototype.renderTitle = function() {
                var a;
                return a = this.taskModel.toJSON(), a.hasEditRight = this.hasEditRight, a.content = _.unescape(a.content), this.$contentWrapper.html(f(a)), this.hasEditRight ? (this.$contentInput = this.$(".task-content-input").val(a.content), this.$contentInput.flexText()) : this.$contentInput = this.$(".task-content-input").text(a.content)
            }, e.prototype.renderDuedate = function() {
                var a, b, c;
                return b = this.taskModel.get("dueDate"), b && (a = null != (c = B.formatDate(b)) ? c.dateString : void 0), this.$dueDate.find(".due-date-title").text(a || "选择截止日期"), this.$dueDate[a ? "addClass" : "removeClass"]("dirty"), this
            }, e.prototype.renderStage = function() {
                var a, b, c, d;
                return a = null != (c = this.stagesCollection) ? c.get(this.taskModel.get("_stageId")) : void 0, b = (null != a ? a.get("name") : void 0) || (null != (d = this.taskModel.get("stage")) ? d.name : void 0) || "(未设置)", this.$stage.text(b), this
            }, e.prototype.renderTasklist = function() {
                var a, b, c;
                return a = (null != (b = this.tasklistModel) ? b.get("title") : void 0) || (null != (c = this.taskModel.get("tasklist")) ? c.title : void 0), this.$tasklist.text(a), this
            }, e.prototype.renderPriority = function() {
                var a, b;
                return a = this.taskModel.get("priority") || 0, b = B.getPriorityDisplay(a), this.$priority.find(".priority-title").text(b), this.$priority.find(".priority-label").removeClass("task-priority-0 task-priority-1 task-priority-2").addClass("task-priority-" + a), this.$priority[a ? "addClass" : "removeClass"]("dirty"), this
            }, e.prototype.renderRepeat = function() {
                return this.repeatRule = B.freq2Label(this.hasRecurrence ? this.rrule : null), this.$repeat.find(".repeat-title").text(this.repeatRule.string), this.$repeat[this.hasRecurrence ? "addClass" : "removeClass"]("dirty"), this
            }, e.prototype.enterNoteEdit = function() {
                var a, b;
                return this.projectRight >= 0 ? (this.$note.addClass("editing"), a = _.unescape(this.taskModel.get("note")) || (null != (b = this.localCache(this.localCacheId)) ? b.content : void 0), this.$noteEditContent.val(a).flexText(), this.focusNote(), this) : this
            }, e.prototype.exitNoteEdit = function() {
                return this.$note.removeClass("editing"), this
            }, e.prototype.renderNote = function() {
                var a;
                return a = this.taskModel.get("note"), this.$note[a ? "removeClass" : "addClass"]("is-empty"), this.$note.find(".task-note-content").html(window._encodeHTML(a, "md")), this.$noteEditContent.val(a), a || this.$noteEditContent.on("change", function(a) {
                    return function() {
                        return a.cacheNote()
                    }
                }(this)), this
            }, e.prototype.renderSubtaskCard = function() {
                return this.requestSubView(q, {taskModel: this.taskModel,subtasksCollection: this.subtasksCollection,membersCollection: this.membersCollection}).$el.appendTo(this.$subtasks), this
            }, e.prototype.renderActivities = function() {
                return this.activityTimelineView = this.requestSubView(c, {_objectlinkId: this.options._objectlinkId,_projectId: this._projectId,boundToObjectType: "task",objectModel: this.taskModel,$scrollFrame: this.$el}), this.activityTimelineView.$el.appendTo(this.$(".task-detail-content")), this
            }, e.prototype.renderInvolve = function() {
                return this.requestSubView(j, {_projectId: this._projectId,objectModel: this.taskModel,membersCollection: this.membersCollection,undeletable: !1,dropArea: this.$el}).$el.prependTo(this.$involveSet), this
            }, e.prototype.renderTags = function() {
                return this.requestSubView(s, {_projectId: this._projectId,objectModel: this.taskModel}).$el.prependTo(this.$(".task-detail-tags-set")), this
            }, e.prototype.setupInfoWidgets = function() {
                return this.projectRight >= 0 ? (this.initExecutorSwitcherInDetail(), this.initPrioritySetDetail(), this.initRepeat(), this) : this
            }, e.prototype.initExecutorSwitcherInDetail = function() {
                return this.projectRight >= 0 ? (this.requestSubView(k, {fixed: this.$el.closest(".panel-view").length,$toggler: this.$executor,noAssign: !0,membersCollection: this.membersCollection,selected: [this.taskModel.get("_executorId")],select: function(a) {
                    return function(b) {
                        return a.taskModel.save(null, {attrs: {_executorId: b}})
                    }
                }(this)}), this) : this
            }, e.prototype.toggleStageSwitcher = function(a) {
                var b;
                return this.projectRight >= 0 ? (null != (b = this.stageSwitcherView) && b.remove(), this.stageSwitcherView = this.requestSubView(m, {$toggler: $(a.currentTarget),dataList: this.stagesCollection.map(function(a) {
                    return {_id: a.get("_id"),title: a.get("name")}
                }),selected: this.taskModel.get("_stageId"),select: function(a) {
                    return function(b) {
                        return a.taskModel.hasEditRight() ? a.taskModel.save(null, {attrs: {_stageId: b}}) : Essage.show({message: "您不能修改这项任务",status: "error"}, 2e3)
                    }
                }(this)}).show(), this) : this
            }, e.prototype.freshStage = function() {
                return o.fetch(this._tasklistId, {success: function(a) {
                    return function(b) {
                        return a.stagesCollection = b, a.renderStage()
                    }
                }(this)}), this
            }, e.prototype.toggleGroupSwitcher = function(a) {
                var b;
                return this.projectRight >= 0 ? (null != (b = this.groupSwitcherView) && b.remove(), this.groupSwitcherView = this.requestSubView(m, {$toggler: $(a.currentTarget),dataList: this.tasklistsCollection.map(function(a) {
                    return {_id: a.get("_id"),title: a.get("title")}
                }),selected: this.taskModel.get("_tasklistId"),select: function(a) {
                    return function(b) {
                        return a.taskModel.hasEditRight() ? a.taskModel.save(null, {attrs: {_tasklistId: b},success: function() {
                            return a._tasklistId = b, a.freshStage()
                        }}) : Essage.show({message: "您不能修改这项任务",status: "error"}, 2e3)
                    }
                }(this)}).show(), this) : this
            }, e.prototype.initPrioritySetDetail = function() {
                return this.projectRight >= 0 ? (this.requestSubView(w, {currentPriority: this.taskModel.get("priority"),select: function(a) {
                    return function(b) {
                        return a.taskModel.save(null, {attrs: {priority: b}})
                    }
                }(this)}).setup(this.$priority), this.$priority.on("click.task-detail", function() {
                    return D.gta.event(null, "change", "task|change priority")
                }), this) : this
            }, e.prototype.initRepeat = function() {
                return this.projectRight >= 0 ? (this.requestSubView(x, {repeatLabel: B.freq2Label(this.hasRecurrence ? this.rrule : null).label,select: function(a) {
                    return function(b) {
                        var c, d, e;
                        if (a.repeatRule.label !== b)
                            return c = B.label2Freq(b), c && (e = new RRule(_.extend(a.rrule.origOptions, c))), d = e ? a.taskModel.genRecurrence(e) : null, a.taskModel.save(null, {attrs: {recurrence: d},success: function() {
                                return a.hasRecurrence = !!e, e && (a.rrule = e), a.renderRepeat()
                            }})
                    }
                }(this)}).setup(this.$repeat), this.$repeat.on("click.task-detail", function() {
                    return D.gta.event(null, "change", "task|change repeat")
                }), this) : this
            }, e.prototype.toggleDone = function() {
                var a;
                return this.projectRight >= 0 && this.hasEditRight ? (a = this.taskModel.get("isDone"), this.taskModel.save(null, {attrs: {isDone: !a,onStage: a ? 0 : null}}), this) : this
            }, e.prototype.showDueDatePickerInDetail = function() {
                var a, b;
                return this.projectRight >= 0 ? (this.$dueDate.data("datepicker") ? (b = !this.$dueDate.data("showDatepicker"), this.$dueDate.data("showDatepicker", b), this.$dueDate.data("datepicker").picker.toggle(b)) : (a = this.taskModel.get("dueDate") ? new Date(this.taskModel.get("dueDate")) : new Date, this.$dueDate.datepicker({format: "yyyy-mm-dd",language: "ZH" === i ? "zh-CN" : i.toLowerCase(),todayHighlight: !0,placement: "left",todayBtn: "linked",tomorrowBtn: "linked",somedayBtn: "linked"}).datepicker("update", a).datepicker("show").focus().on("changeDate", function(a) {
                    return function(b) {
                        return a.taskModel.editDueDate(b.date), a.$dueDate.datepicker("hide")
                    }
                }(this)).on("hide", function(a) {
                    return function() {
                        return a.$dueDate.data("showDatepicker", !1)
                    }
                }(this)), this.$dueDate.data("showDatepicker", !0)), !0) : this
            }, e.prototype.enterEditContent = function() {
                return this.projectRight >= 0 ? (this.$contentWrapper.addClass("editing"), this) : this
            }, e.prototype.quickUpdateTaskContent = function(a) {
                return this.projectRight >= 0 ? (13 === a.keyCode && (a.preventDefault(), this.$contentInput.blur()), this) : this
            }, e.prototype.updateTaskContent = function() {
                var a, b;
                if (this.$contentWrapper.hasClass("editing"))
                    return a = this.$contentInput.val().trim(), a = a.replace(/\s+/g, " ").trim(), b = this.taskModel.get("content"), a && a !== b ? (D.gta.event(null, "click", "task detail|save title"), this.taskModel.save(null, {attrs: {content: a}})) : this.$contentInput.val(b), this.$contentWrapper.removeClass("editing"), this
            }, e.prototype.focusNote = function() {
                return _.delay(function(a) {
                    return function() {
                        return a.$noteEditContent.focusAtEnd()
                    }
                }(this))
            }, e.prototype.blurNote = function() {
                var a;
                return a = this.$noteEditContent.val().trim(), a === this.taskModel.get("note") && (this.$note.removeClass("editing"), this.exitNoteEdit()), this
            }, e.prototype.updateNote = function() {
                var a;
                return this.projectRight >= 0 ? (a = this.$noteEditContent.val().trim(), a !== this.taskModel.get("note") ? this.taskModel.save(null, {attrs: {note: a},success: function(a) {
                    return function() {
                        return a.exitNoteEdit(), a.localCache.remove(a.localCacheId)
                    }
                }(this)}) : this.exitNoteEdit(), this) : this
            }, e.prototype.quickUpdateNote = function(a) {
                return 13 === a.keyCode && (a.ctrlKey || a.shiftKey || a.metaKey) && (a.preventDefault(), this.updateNote()), this
            }, e.prototype.cancelNote = function() {
                return this.$noteEditContent.val(this.taskModel.get("note")), this.exitNoteEdit(), this.localCache.remove(this.localCacheId), this
            }, e.prototype.cacheNote = function() {
                return this.localCache(this.localCacheId, {content: this.$noteEditContent.val().trim()}), this
            }, e.prototype.close = function() {
                var a, b;
                return "taskDetailPanel" === (null != (b = this.parentView) ? b.viewName : void 0) ? "function" == typeof (a = this.parentView).back && a.back() : this.remove(), this
            }, e.prototype.remove = function() {
                var a, b, c, d, f;
                return null != (b = this.$noteEditContent) && b.off("change"), null != (c = this.$priority) && c.off(".task-detail"), null != (d = this.$repeat) && d.off(".task-detail"), null != (f = this.$activityCreator) && f.remove(), this.unactiveTaskCard(), this.taskModel && (a = D.router.getUrl().replace("/task/" + this.taskModel.id, ""), D.router.navigate(a, {trigger: !1})), e.__super__.remove.apply(this, arguments)
            }, e.prototype.toggleTaskMenu = function(a) {
                var b;
                return b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(u, {fixed: this.$el.closest(".panel-view").length,$toggler: b,_projectId: this._projectId,taskModel: this.taskModel,tasklistsCollection: this.tasklistsCollection}).show(), this
            }, e.prototype.activeTaskCard = function() {
                return this.unactiveTaskCard(), $("li.task[data-id=" + this._taskId + "]").addClass("active-task-detail"), this
            }, e.prototype.unactiveTaskCard = function() {
                return $(".active-task-detail").removeClass("active-task-detail"), this
            }, e
        }(C), g.Constructor = t
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/task/task-detail-panel/index", ["require", "exports", "module", "lib/panel/index", "views/board/task/task-detail/index"], function(a) {
        var c, d, e;
        return c = a("lib/panel/index"), e = a("views/board/task/task-detail/index"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "taskDetailPanel", c.prototype.className = "task-detail-panel panel-view", c.prototype.defaultLayer = e, c.prototype.initialize = function(a) {
                return a && (a.taskModel || a._taskId) ? (this._taskId = a._taskId || a.taskModel.id, _.isNumber(a.rightOffset) && (this.rightOffset = a.rightOffset), c.__super__.initialize.apply(this, arguments)) : !1
            }, c.prototype.isSame = function(a) {
                var b, c;
                return c = a._taskId || (null != (b = a.taskModel) ? b.id : void 0), c === this._taskId
            }, c
        }(c)
    }), define("views/board/task/task-list/templates/group", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="task-group-by" data-id="' + a._id + '"> <span class="task-group-name">' + b(a.name) + "</span></li>";
            return c
        }
    }), define("views/board/task/task-list/templates/placeholder", [], function() {
        return function() {
            var a = '<div class="task-placeholder placeholder muted"> <span class="icon icon-board"></span> <br /> 目前还没有任务</div>';
            return a
        }
    }), define("views/board/task/task-list/templates/subtask", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a.subtasks;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<li class="task subtask" data-id="' + e._taskId + '" data-subtask="' + e._id + '"> <div class="check-box" data-gta=\'event\' data-label=\'subtask|check done\'> <span class="icon icon-tick"></span> </div> <div class="task-content-set" data-id="' + e._taskId + '" data-gta=\'event\' data-label=\'subtask|open task detail\'> <div class="task-content-wrapper"> <div class="task-content"> ' + b(e.content) + " </div> ", !e.isDone && e.dueDate && (c += ' <time class="task-duedate label ', "overdue" === e.dueDate.dateClass ? c += "label-important" : "today" === e.dueDate.dateClass ? c += "label-warning" : "upcoming" === e.dueDate.dateClass && (c += "label-info"), c += '"> <span class="icon icon-calendar-bold ', "normal" !== e.dueDate.dateClass && (c += "icon-white"), c += '"></span> ' + e.dueDate.dateString + " </time> "), c += ' </div> <div class="subtask-info muted">属于任务：' + e.parentTask + "</div> </div></li>";
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/task/task-list/index", ["require", "exports", "module", "teambition", "util", "view", "models/subtask", "views/board/task/task-detail-panel/index", "views/board/task/task/index", "./templates/group", "./templates/placeholder", "./templates/subtask"], function(a) {
        var c, d, e, f, g, h, i, j, k, l;
        return l = a("teambition"), j = a("util"), k = a("view"), e = a("models/subtask"), g = a("views/board/task/task-detail-panel/index"), i = a("views/board/task/task/index"), c = a("./templates/group"), d = a("./templates/placeholder"), f = a("./templates/subtask"), h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "TaskListView", h.prototype.className = "task-list", h.prototype.tagName = "ul", h.prototype.events = {"click .task-content-set": "openTaskDetail","click .subtask .check-box": "toggleSubtaskStatus"}, h.prototype.initialize = function(a) {
                return a.tasksCollection ? (this.options = a, this.tasksCollection = a.tasksCollection, this.tasklistModel = a.tasklistModel, this.$placeholder = $(d()), this.renderBasic().checkPlaceholder().listen(), this) : !1
            }, h.prototype.listen = function() {
                return this.listenTo(this.tasksCollection, "add", this.addTask), this.listenTo(this.tasksCollection, "remove destroy", this.checkGroupBy), this.listenTo(this.tasksCollection, "add remove destroy", this.checkPlaceholder), this
            }, h.prototype.listenSubtask = function(a) {
                return this.stopListening(a), this.listenTo(a, "change:isDone", function(a) {
                    return function(b, c) {
                        return a.$el.find(".subtask[data-subtask=" + b.id + "]")[c ? "hide" : "show"]()
                    }
                }(this)), this
            }, h.prototype.renderBasic = function() {
                return this.tasksCollection.each(function(a) {
                    return function(b) {
                        return a.renderTask(b)
                    }
                }(this)), this.options._taskId && this.openTaskDetail(this.options._taskId), this
            }, h.prototype.renderTask = function(a, b) {
                var c, d, g, h, k, l, m;
                return h = b ? "prependTo" : "appendTo", m = a.get("subtasks") || [], this.options.withSubtasks && m.length ? (a.get("dueDate") && (g = j.formatDate(a.get("dueDate"))), k = a.get("content"), c = $(f({subtasks: m.filter(function(a) {
                    var b;
                    return (b = e.find(a._id)) ? b.get("isDone") === !1 : a.isDone === !1
                }).map(function(a) {
                    return function(b) {
                        var c;
                        return c = e.get(b._id), c.set(b), a.listenSubtask(c), b = _.clone(b), b.dueDate = g, b.parentTask = k, b
                    }
                }(this))}))) : c = this.requestSubView(i, {model: a,viewType: "list",noExecutor: this.options.noExecutor}).$el, this.options.groupBy && (l = a.get("project")) ? (d = this.getOrRenderGroup(l), c.insertAfter(d)) : c[h](this.$el), this
            }, h.prototype.getOrRenderGroup = function(a) {
                var b, d, e;
                for (b = this.$("[data-id=" + a._id + "]"), b.length || (b = $(c(a)), b.appendTo(this.$el)), e = b, d = e.next(); d.length && !d.hasClass("task-group-by"); )
                    e = d, d = e.next();
                return e
            }, h.prototype.addTask = function(a) {
                return this.renderTask(a, null != this.options.isPrepend ? this.options.isPrepend : !0), this
            }, h.prototype.openTaskDetail = function(a) {
                var b, c, d;
                return a.target && (a = $(a.target).closest(".task").data("id")), (b = this.tasksCollection.get(a)) ? (this.options.isInBoard && (null != (c = l.APP.currentView) ? c.renderTaskDetail : void 0) ? (l.APP.currentView.renderTaskDetail(b), l.APP.currentView.updateUrl({_taskId: a,_tasklistId: (null != (d = this.tasklistModel) ? d.get("_id") : void 0) || b.get("_tasklistId")}, {trigger: !1})) : l.APP.showPanel(g, {_projectId: b.get("_projectId"),_tasklistId: b.get("_tasklistId"),taskModel: b,rightOffset: this.options.rightOffset}), this) : void 0
            }, h.prototype.toggleSubtaskStatus = function(a) {
                var b, c;
                return b = $(a.currentTarget).closest(".subtask"), c = e.find(b.data("subtask")), null != c && c.saveAttr("isDone", !0), b.hide(), this
            }, h.prototype.checkGroupBy = function(a) {
                var b, c, d;
                if (this.options.groupBy && (d = a.get("project")))
                    return b = this.$(".task-group-by[data-id=" + d._id + "]"), c = b.next(), (!c.length || c.hasClass("task-group-by")) && b.remove(), this
            }, h.prototype.checkPlaceholder = function() {
                return this.$placeholder.remove(), this.tasksCollection.length || this.$el.html(this.$placeholder), this
            }, h
        }(k)
    }), define("views/board/scrum/templates/basic", [], function() {
        return function() {
            var a = '<header class="board-scrum-header"></header><section class="board-scrum-content"> <ul class="board-scrum-stages horizontal-scroll"></ul></section>';
            return a
        }
    }), define("views/board/scrum/templates/header", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="tasklist-bar-toggler-wrap"> <a class="tasklist-bar-toggler guide-handler" data-guide="tasksGroup" data-gta="event" data-label="task board|toggler tasklist pannel"> <strong class="board-scrum-title">' + b(a.title) + "</strong> ";
            return a.description && (c += ' <span class="board-scrum-desc">' + b(a.description) + "</span> "), c += ' <span class="icon icon-chevron-down"></span> </a></div><a class="scrum-pannel-toggler" data-gta="event" data-label="task board|toggler scrum pannel"> <span class="filtering-state">（已筛选）</span> <span>', c += a.created ? "筛选和编辑" : "任务筛选", c += '</span> <span class="icon icon-chevron-down"></span></a>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/scrum/index", ["require", "exports", "module", "teambition", "thenjs", "lib/guide-point/index", "moment", "lib/scrollable", "view", "models/tasklist", "collections/members", "collections/projects", "collections/stages", "collections/tasklists", "collections/tasks", "views/board/scrum-pannel/index", "views/board/stage/stage/index", "views/board/tasklist/tasklist-bar/index", "views/board/task/task-list/index", "./templates/basic", "./templates/header"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u;
        return t = a("teambition"), u = a("thenjs"), d = a("lib/guide-point/index"), g = a("moment"), i = a("lib/scrollable"), s = a("view"), p = a("models/tasklist"), f = a("collections/members"), h = a("collections/projects"), m = a("collections/stages"), q = a("collections/tasklists"), r = a("collections/tasks"), j = a("views/board/scrum-pannel/index"), l = a("views/board/stage/stage/index"), o = a("views/board/tasklist/tasklist-bar/index"), n = a("views/board/task/task-list/index"), c = a("./templates/basic"), e = a("./templates/header"), k = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "ScrumView", h.prototype.className = "board-scrum-view fade", h.prototype.hotkeys = {c: "openTaskCreator",g: "toggleTasklistBar"}, h.prototype.events = {"click .tasklist-bar-toggler": "toggleTasklistBar","click .scrum-pannel-toggler": "toggleScrumPannel","click .tasklist-tab": "goToTasklist","click .tasklist-smart-today": "goToTodayTasks","click .tasklist-smart-total": "goToTotalTasks","click .tasklist-smart-done": "goToDoneTasks",selectMember: "goToMemberTasks","mousedown .board-scrum-stages": "dragStart"}, h.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this.options = a, this._projectId = a._projectId, this._tasklistId = a._tasklistId, this._taskId = a._taskId, this.membersCollection = f.get(this._projectId), this.currentViews = [], this.load({beforeSend: function(a) {
                    return function() {
                        return a.renderBasic(), a.showLoadingIndicator()
                    }
                }(this),success: function(a) {
                    return function(b, c) {
                        return a.$el ? (a.hideLoadingIndicator({animated: !0}), a.stagesCollection = c, t.PREFERENCE.toggleTasklistBar() && a.toggleTasklistBar(), a.renderHeader().renderStages().initScrumPannel().listen(), d.initialize(a)) : void 0
                    }
                }(this)}), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this) : !1
            }, h.prototype.load = function(a) {
                return "function" == typeof a.beforeSend && a.beforeSend(), q.fetch(this._projectId, {success: function(b) {
                    return function(c) {
                        return c.length ? (b.tasklistsCollection = c, b.tasklistsCollection.updateSort(t.PREFERENCE.tasklistSortInProject(b._projectId), !0), b._tasklistId || (b._tasklistId = c.at(0).id), b.tasklistModel = c.get(b._tasklistId), "todaytasks" === b._tasklistId ? b.goToTodayTasks().listenTaskListPinBar() : "totaltasks" === b._tasklistId ? b.goToTotalTasks().listenTaskListPinBar() : "donetasks" === b._tasklistId ? b.goToDoneTasks().listenTaskListPinBar() : b.tasklistModel ? (t.APP.currentView.updateUrl({_tasklistId: b._tasklistId}, {trigger: !1,replace: !0}), u(function(a) {
                            return m.fetch(b._tasklistId, {success: function(b) {
                                return a(null, b)
                            },error: function(b) {
                                return a(b, null)
                            }})
                        }).fin(function(d, e, f) {
                            return e ? ("function" == typeof a.onError && a.onError(e), t.APP.currentView.onRouteError(e)) : (f.updateSort(b.tasklistModel.get("stageIds"), !0), "function" == typeof a.success ? a.success(c, f) : void 0)
                        })) : b.parentView.onRouteError()) : b.parentView.onRouteError()
                    }
                }(this)}), this
            }, h.prototype.queryTasks = function(a) {
                var b, c;
                return "function" == typeof a.beforeSend && a.beforeSend(), b = Math.ceil(g().valueOf() / 1e3 / 60 / 10), c = "" + this._projectId + "_" + a.queryType + "_" + b, r.fetch(c, {pageNum: 20,boundToObjectType: "",attrs: a.attrs,success: function(b) {
                    return function(c) {
                        return b.$el && "function" == typeof a.success ? a.success(c) : void 0
                    }
                }(this)}), this
            }, h.prototype.listen = function() {
                return this.stopListening(), this.listenTo(this.tasklistModel, "remove", function(a) {
                    return function() {
                        return a.switchTasklist(a.tasklistsCollection.at(0).id)
                    }
                }(this)), this.listenTo(this.tasklistModel, "change", this.renderHeader), this.listenTo(this.tasklistModel, "change:stageIds", function(a) {
                    return function(b, c) {
                        var d;
                        if (!_.isEqual(c, b.previous("stageIds")))
                            return null != (d = a.stagesCollection) && d.updateSort(c, !0), a.updateStagesSort()
                    }
                }(this)), this.listenTo(this.stagesCollection, "add", function(a) {
                    return function(b) {
                        var c;
                        return c = a.tasklistModel.checkStageIds(b.id, b.get("_prevId")), a.addStage(b), a.stagesCollection.updateSort(c, !0)
                    }
                }(this)), this.listenTaskListPinBar(), this
            }, h.prototype.listenTaskListPinBar = function() {
                return this.stopListening(t.PREFERENCE), this.listenTo(t.PREFERENCE, "change:pinTasklistBar", this.checkPinTasklistBar), this
            }, h.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$header = this.$el.find(".board-scrum-header"), this.$content = this.$el.find(".board-scrum-content"), this.$stages = this.$el.find(".board-scrum-stages"), t.PREFERENCE.toggleTasklistBar() && this.$el.addClass("pin-tasklist-bar"), this
            }, h.prototype.renderHeader = function() {
                return this.$header.html(e(this.tasklistModel.toJSON())), this
            }, h.prototype.renderStages = function() {
                return this.$stages.removeClass("sortable").empty(), this.stagesCollection.each(function(a) {
                    return function(b, c) {
                        var d;
                        return d = a.renderStage(b), d.$el.appendTo(a.$stages), c ? void 0 : a.firstStage = d
                    }
                }(this)), this.tasklistModel.hasRight() > 0 && (this.setupStageSortable(), this.$stages.addClass("sortable")), this
            }, h.prototype.renderStage = function(a) {
                var b;
                return b = this.requestSubView(l, {_projectId: this._projectId,stageModel: a,tasklistModel: this.tasklistModel,_taskId: this._taskId,loadMore: function(a) {
                    return function() {
                        var b;
                        return null != (b = a.scrumPannel) ? b.genFilterList(!0) : void 0
                    }
                }(this)}), this.currentViews.push(b), b
            }, h.prototype.addStage = function(a) {
                var b, c;
                return b = this.renderStage(a), c = this.stagesCollection.getPreviousStage(a.id, this.tasklistModel.get("stageIds")), b.$el.insertAfter(this.$el.find(".scrum-stage[data-id=" + c.id + "]")), this
            }, h.prototype.updateStagesSort = function() {
                var a, b;
                return b = this.tasklistModel.get("stageIds"), a = this.$stages.children().map(function(a, b) {
                    return $(b).data("id")
                }), b.length !== a.length || _.isEqual(b, a) ? void 0 : _.each(b, function(a) {
                    return function(b) {
                        return a.$stages.find(".scrum-stage[data-id=" + b + "]").appendTo(a.$stages)
                    }
                }(this))
            }, h.prototype.setupStageSortable = function() {
                var a;
                return a = $(), this.$(".board-scrum-stages").sortable({items: ".scrum-stage",handle: ".scrum-stage-header",axis: "x",cancel: ".locked-stage",helper: "clone",placeholder: "scrum-stage sortable-placeholder",tolerance: "pointer",zIndex: 2001,scroll: !0,start: function(b) {
                    return function() {
                        return a = b.$(".scrum-stage.locked-stage")
                    }
                }(this),sort: function() {
                    return function(b, c) {
                        return a.length && a.nextAll(".sortable-placeholder").length ? c.placeholder.insertBefore(a) : void 0
                    }
                }(this),update: function(b) {
                    return function(c) {
                        var d, e;
                        return d = $(c.target), e = d.sortable("toArray", {attribute: "data-id"}), a.length && a.data("id") !== _.last(e) ? !1 : b.updateStages(e)
                    }
                }(this)}), this
            }, h.prototype.updateStages = function(a) {
                return this.tasklistModel.setStageIds(a), this
            }, h.prototype.dragStart = function(a) {
                var b, c;
                return 1 !== a.which || this.dragMove || $(a.target).closest(".scrum-stage-header, li.task, .task-creator-wrap", a.currentTarget).length || (this.dragMove = !0, b = $(a.currentTarget), c = a.pageX, b.one("mouseup.dragMove mouseleave.dragMove", function(a) {
                    return function() {
                        return a.dragMove = !1, b.off(".dragMove")
                    }
                }(this)), b.on("mousemove.dragMove", function() {
                    return function(a) {
                        return b.scrollLeft(c - a.pageX + b.scrollLeft()), c = a.pageX
                    }
                }(this))), this
            }, h.prototype.renderTaskDetail = function(a) {
                return t.APP.currentView.renderTaskDetail(a), this
            }, h.prototype.activeTaskCreator = function() {
                return this.taskCreatorView.focus(), this
            }, h.prototype.initScrumPannel = function() {
                var a;
                return null != (a = this.scrumPannel) && a.remove(), this.scrumPannel = this.requestSubView(j, {_projectId: this._projectId,tasklistModel: this.tasklistModel,tasksCollection: this.tasksCollection,stagesCollection: this.stagesCollection}), this.scrumPannel.$el.appendTo(this.$el), this
            }, h.prototype.toggleScrumPannel = function() {
                return this.scrumPannel.toggle(), this
            }, h.prototype.toggleTasklistBar = function() {
                var a, b;
                if (a = t.PREFERENCE.toggleTasklistBar()) {
                    if (null != (b = this.tasklistBarView) ? b.$el : void 0)
                        return;
                    this.tasklistBarView = this.requestSubView(o, {_tasklistId: this._tasklistId,_projectId: this._projectId,tasklistsCollection: this.tasklistsCollection,holdon: a}).show()
                } else
                    t.APP.showPanel(o, {isTasklistBar: !0,_tasklistId: this._tasklistId,_projectId: this._projectId,tasklistsCollection: this.tasklistsCollection,holdon: a});
                return this
            }, h.prototype.checkPinTasklistBar = function(a, b) {
                return this.$el[b ? "addClass" : "removeClass"]("pin-tasklist-bar"), b ? this.toggleTasklistBar() : this.tasklistBarView.hide(), this
            }, h.prototype.goToTasklist = function(a) {
                var b;
                return b = $(a.currentTarget).data("id"), this.switchTasklist(b), this
            }, h.prototype.switchTasklist = function(a) {
                return t.APP.hidePanel(), a !== this._tasklistId && (this.tasklistModel = this.tasklistsCollection.get(a), this._tasklistId = this.tasklistModel.id, this.tasksCollection = null, this.renderHeader(), this.removeCurrentViews(), this.$el.removeClass("smart-view"), this.setupLoadMore(!1), this.load({beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$stages)
                    }
                }(this),success: function(a) {
                    return function(b, c) {
                        return a.$el ? (a.stagesCollection = c, a.hideLoadingIndicator().renderStages().initScrumPannel().listen()) : void 0
                    }
                }(this)})), this
            }, h.prototype.goToMemberTasks = function(a, b) {
                var c, d;
                return c = null != (d = this.membersCollection.get(b)) ? d.toJSON() : void 0, this.queryAttrs = {_projectId: this._projectId,_executorId: b,withTasklist: !0,withTags: !0,isDone: !1,all: !0}, this.queryTasks({queryType: "" + b,attrs: this.queryAttrs,beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$content)
                    }
                }(this),success: function(a) {
                    return function(d) {
                        return a.tasklistModel = new p({_id: "membertasks",_creatorId: b,title: c ? "" + c.name + "的任务" : "成员的任务"}), a.tasksCollection = d, a.hideLoadingIndicator().switchSmartTasklist()
                    }
                }(this)}), this
            }, h.prototype.goToTodayTasks = function() {
                var a;
                return a = g().endOf("day").toISOString(), this.queryAttrs = {_projectId: this._projectId,isDone: !1,withTasklist: !0,withTags: !0,dueDate: a,all: !0}, this.queryTasks({queryType: "today",attrs: this.queryAttrs,beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$content)
                    }
                }(this),success: function(a) {
                    return function(b) {
                        return a.tasklistModel = new p({_id: "todaytasks",title: "今天的任务"}), a.tasksCollection = b, a.hideLoadingIndicator().switchSmartTasklist(), _.delay(function() {
                            return t.PREFERENCE.toggleTasklistBar() ? a.toggleTasklistBar() : void 0
                        })
                    }
                }(this)}), this
            }, h.prototype.goToTotalTasks = function() {
                return this.queryAttrs = {_projectId: this._projectId,isDone: !1,withTags: !0,withTasklist: !0,all: !0}, this.queryTasks({queryType: "total",attrs: this.queryAttrs,beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$content)
                    }
                }(this),success: function(a) {
                    return function(b) {
                        return a.tasklistModel = new p({_id: "totaltasks",title: "未完成的任务"}), a.tasksCollection = b, a.hideLoadingIndicator().switchSmartTasklist(), _.delay(function() {
                            return t.PREFERENCE.toggleTasklistBar() ? a.toggleTasklistBar() : void 0
                        })
                    }
                }(this)}), this
            }, h.prototype.goToDoneTasks = function() {
                return this.queryAttrs = {_projectId: this._projectId,isDone: !0,withTags: !0,withTasklist: !0}, this.queryTasks({queryType: "done",attrs: this.queryAttrs,beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$content)
                    }
                }(this),success: function(a) {
                    return function(b) {
                        return a.tasklistModel = new p({_id: "donetasks",title: "已完成的任务"}), a.tasksCollection = b, a.hideLoadingIndicator().switchSmartTasklist(), _.delay(function() {
                            return t.PREFERENCE.toggleTasklistBar() ? a.toggleTasklistBar() : void 0
                        })
                    }
                }(this)}), this
            }, h.prototype.switchSmartTasklist = function() {
                var a;
                return t.APP.hidePanel(), this.removeCurrentViews(), this.$el.addClass("smart-view"), t.APP.currentView.updateUrl({_tasklistId: this.tasklistModel.id}, {trigger: !1}), this.renderHeader(), this._tasklistId = this.tasklistModel.id, this.stagesCollection = null, a = this.requestSubView(n, {isInBoard: !0,isPrepend: !1,tasksCollection: this.tasksCollection,tasklistModel: this.tasklistModel}), this.$content.append(a.$el.addClass("board-smart-list")), this.initScrumPannel(), this.currentViews.push(a), this.setupScroll(this.$content), this.setupLoadMore(10), this
            }, h.prototype.loadMore = function(a) {
                var b;
                return null != (b = this.tasksCollection) && b.loadMore({attrs: this.queryAttrs,beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$content)
                    }
                }(this),success: function(b) {
                    return function() {
                        var c;
                        if (b.$el)
                            return b.hideLoadingIndicator({animated: !0}), null != (c = b.scrumPannel) && c.genFilterList(!0), b.tasksCollection.hasMore ? "function" == typeof a ? a() : void 0 : b.showEndPoint(b.$(".board-smart-list"))
                    }
                }(this)}), this
            }, h.prototype.removeCurrentViews = function() {
                for (var a; this.currentViews.length; )
                    "function" == typeof (a = this.currentViews.pop()).remove && a.remove();
                return this
            }, h.prototype.openTaskCreator = function() {
                return this.firstStage && this.firstStage.openTaskCreator(), this
            }, h
        }(s), _.extend(k.prototype, i), k
    }), define("lib/selectable", [], function() {
        var a;
        return a = function(a) {
            return {setActive: function(a) {
                return a.siblings().removeClass("active"), a.addClass("active"), this
            },getActive: function() {
                return this.$(a).filter(".active").first()
            },prev: function(b) {
                var c, d, e;
                return d = this.$(a), 0 !== d.length ? (c = d.filter(".active"), c.length ? (c.removeClass("active"), e = c.prev(), e.length || (e = c)) : e = d.first(), this.slideTo(e, !0, 0, function() {
                    return function() {
                        return e.addClass("active"), "function" == typeof b ? b() : void 0
                    }
                }(this)), this) : void 0
            },next: function(b) {
                var c, d, e;
                return d = this.$(a), 0 !== d.length ? (c = d.filter(".active"), c.length ? (c.removeClass("active"), e = c.next(a), e.length || (e = c)) : e = d.first(), this.slideTo(e, !0, 0, function() {
                    return function() {
                        return e.addClass("active"), "function" == typeof b ? b() : void 0
                    }
                }(this)), this) : void 0
            }}
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/board/board/index", ["require", "exports", "module", "teambition", "lib/scrollable", "views/board/scrum/index", "lib/selectable", "views/board/task/task-detail-panel/index", "view"], function(a) {
        var c, d, e, f, g, h, i;
        return i = a("teambition"), d = a("lib/scrollable"), e = a("views/board/scrum/index"), f = a("lib/selectable"), g = a("views/board/task/task-detail-panel/index"), h = a("view"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "BoardView", c.prototype.className = "board-view", c.prototype.routes = {"": "enterScrum","scrum(/:_tasklistId)": "enterScrum","scrum/:_tasklistId/task/:_taskId": "enterScrum","*paramString": "onRouteError"}, c.prototype.initialize = function(a) {
                return this._projectId = a._projectId, this
            }, c.prototype.onRouteError = function() {
                return i.router.home(), this
            }, c.prototype.enterScrum = function(a, b) {
                return this.requestSubView(e, {_projectId: this._projectId,_tasklistId: a,_taskId: b}).$el.appendTo(this.$el), this
            }, c.prototype.updateUrl = function(a, b) {
                var c, d, e, f;
                return b || (b = {}), f = a._tasklistId, e = a._taskId, d = a.viewType || "scrum", c = i.router.getPrefix() + "/tasks", f && (c += "/" + d + "/" + f, e && (c += "/task/" + e)), b.trigger === !1 && (this._taskId = e, this._tasklistId = f), i.router.navigate(c, b), this
            }, c.prototype.renderTaskDetail = function(a) {
                var b;
                return b = {}, b[_.isObject(a) ? "taskModel" : "_taskId"] = a, i.APP.showPanel(g, b), this
            }, c
        }(h)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("models/bookkeeping", ["require", "exports", "module", "teambition", "model"], function(a) {
        var c, e, f, g;
        return g = a("teambition"), e = a("model"), f = {category: {attr: "category",title: "类型",isDefault: !0,isSort: !0},content: {attr: "content",title: "内容",isDefault: !0,isSort: !0},creator: {attr: "creator",title: "创建者",isDefault: !0,isSort: !0},amount: {attr: "amount",title: "金额",isDefault: !0,isSort: !0},date: {attr: "date",title: "时间",isDefault: !0,isSort: !0}}, c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "bookkeeping", c.prototype.urlRoot = "bookkeepings", c.prototype.parse = function(a) {
                var b, c;
                return b = _.extend(this.toJSON(), a), b._approverIds && (b.approveRight = (c = g.user.id, d.call(b._approverIds, c) >= 0)), b
            }, c.prototype.getDisplayFields = function() {
                var a, b, c, e, g, h, i, j;
                for (e = this.get("displayFields") || [], g = [], h = 0, i = e.length; i > h; h++)
                    a = e[h], c = f[a], c && g.push(c);
                for (b in f)
                    c = f[b], c.isDefault && (j = c.attr, d.call(e, j) < 0) && g.push(c);
                return g
            }, c.prototype.getHiddenFields = function() {
                var a, b, c, e, g;
                c = this.get("displayFields") || [], e = [];
                for (a in f)
                    b = f[a], b.isDefault || (g = b.attr, d.call(c, g) >= 0) || e.push(b);
                return e
            }, c.prototype.getFields = function(a) {
                var b, c, d, e, g;
                for (d = [], e = 0, g = a.length; g > e; e++)
                    b = a[e], c = f[b], c && d.push(c);
                return d
            }, c
        }(e)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/bookkeepings", ["require", "exports", "module", "collection", "models/bookkeeping"], function(a) {
        var c, d, e;
        return d = a("collection"), e = a("models/bookkeeping"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "bookkeepings", c.prototype.boundToObjectType = "project", c.prototype.model = e, c
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/entry-category", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return d = a("model"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "entryCategory", c.prototype.urlRoot = "entryCategories", c.prototype.parse = function(a) {
                var b;
                return b = _.extend(this.toJSON(), a), b.iconStr = b.icon || "more", b
            }, c
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/entry-categories", ["require", "exports", "module", "collection", "models/entry-category", "moment", "lib/socket"], function(a) {
        var c, d, e, f, g;
        return c = a("collection"), e = a("models/entry-category"), f = a("moment"), g = a("lib/socket"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "entryCategories", c.prototype.boundToObjectType = "project", c.prototype.model = e, c.prototype.pageNum = 20, c.prototype.getCategory = function(a) {
                var b, c;
                return c = this.get(a), c || (b = {_id: "entryCategoryNull",icon: "",title: "没有类型",type: 0}, c = new e(b)), c
            }, c.prototype.getCategories = function(a, b) {
                var c;
                return c = this.toJSON(), _.filter(c, function(c) {
                    return a && a !== c.type ? !1 : _.isBoolean(b) && b !== c.isDefault ? !1 : !0
                })
            }, c.prototype.getDefaultId = function(a) {
                var b, c, d, e;
                for (e = this.models, c = 0, d = e.length; d > c; c++)
                    if (b = e[c], b.get("type") === a && b.get("isDefault"))
                        return b.id
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/entry", ["require", "exports", "module", "teambition", "model"], function(a) {
        var c, d, e;
        return e = a("teambition"), d = a("model"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "entry", c.prototype.urlRoot = "entries", c.prototype.parse = function(a) {
                var b, c;
                return c = this.toJSON(), b = _.extend({cost: "",receiver: "",profit: "",content: ""}, this.toJSON(), a)
            }, c.prototype.approve = function(a) {
                var b;
                return a || (a = {}), b = a.success, a.success = function(a) {
                    return function() {
                        return a.set("status", "approved"), "function" == typeof b ? b() : void 0
                    }
                }(this), a.url = "" + this.url() + "/approval", a.attrs = {}, this.sync("create", this, a), this
            }, c.prototype.revoke = function(a) {
                var b;
                return a || (a = {}), b = a.success, a.success = function(a) {
                    return function() {
                        return a.set("status", "confirmed"), "function" == typeof b ? b() : void 0
                    }
                }(this), a.url = "" + this.url() + "/approval", a.attrs = {}, this.sync("delete", this, a), this
            }, c.prototype.getEditRight = function() {
                return "approved" === this.get("status") ? "approved:" + this.hasRight() : this.hasRight()
            }, c
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("collections/entries", ["require", "exports", "module", "teambition", "collection", "collections/entry-categories", "models/entry", "moment", "collections/tags"], function(a) {
        var c, e, f, g, h, i, j;
        return j = a("teambition"), c = a("collection"), f = a("collections/entry-categories"), g = a("models/entry"), h = a("moment"), i = a("collections/tags"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "entries", c.prototype.boundToObjectType = "project", c.prototype.model = g, c.prototype.pageNum = 20, c.prototype.getPlaceholders = function() {
                var a, b, c;
                for (c = [], b = 0; b++ < 3; )
                    a = {creator: j.user.toJSON(),type: Math.random() > .5 ? 1 : -1,content: "placeholder内容" + b,note: "",date: new Date,amount: Math.floor(1e4 * Math.random()),status: "applying",category: {icon: "icon",title: "测试" + b}}, c.push(new Model(a));
                return c
            }, c.prototype.getCount = function(a, b) {
                var c;
                return c = {}, this.each(function(d) {
                    var e, f;
                    return f = d.get(a), b ? _.each(f, function(a) {
                        return c[a] || (c[a] = 0), c[a]++
                    }) : (e = f, c[e] || (c[e] = 0), c[e]++)
                }), c
            }, c.prototype.getCreators = function() {
                var a, b;
                return a = [], b = [], this.each(function(c) {
                    var e, f;
                    return e = c.get("creator"), f = e._id, d.call(a, f) < 0 ? (b.push(e), a.push(e._id)) : void 0
                }), b
            }, c.prototype.getCreatorIdsCount = function() {
                return this.getCount("_creatorId")
            }, c.prototype.getEntryCategoryIdsCount = function() {
                return this.getCount("_entryCategoryId")
            }, c.prototype.getTagIdsCount = function() {
                return this.getCount("tagIds", !0)
            }, c
        }(c)
    }), define("views/bookkeeping/bookkeeping-settings/approver/templates/basic", [], function() {
        return function() {
            var a = '<form class="settings-form"> <div class="settings-approve">审批人</div> <div class="settings-members"></div> <div class="settings-tips">只有审批人可以审批账目，您可以设置多个审批人</div></form>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/bookkeeping/bookkeeping-settings/approver/index", ["require", "exports", "module", "teambition", "./templates/basic", "models/bookkeeping", "collections/members", "views/member/member-involve/index", "lib/multi-modal/index", "thenjs"], function(a) {
        var c, d, e, f, g, h, i, j;
        return j = a("teambition"), c = a("./templates/basic"), d = a("models/bookkeeping"), g = a("collections/members"), f = a("views/member/member-involve/index"), h = a("lib/multi-modal/index"), i = a("thenjs"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "BookkeepingSettingsApproverView", e.prototype.tagName = "div", e.prototype.className = "bookkeeping-settings-approver-view", e.prototype.modalTitle = "审批人设置", e.prototype.events = {"click .settings-in-hanlder": "inHandler","click .settings-out-hanlder": "outHandler","submit .settings-form": "submit"}, e.prototype.initialize = function(a) {
                if (!a.bookkeepingModel)
                    throw new Error("" + this.viewName + ":options should have bookkeepingModel");
                return this.options = a, this.bookkeepingModel = a.bookkeepingModel, this._projectId = this.bookkeepingModel.get("_projectId"), this.model = new d({_projectId: this.bookkeepingModel.get("_projectId"),involveMembers: this.bookkeepingModel.get("_approverIds")}), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this), 100), e.__super__.initialize.apply(this, arguments)
            }, e.prototype.renderMain = function(a) {
                return a.html(c()), this.load({success: function(a) {
                    return function() {
                        return a.initMemberPicker()
                    }
                }(this)})
            }, e.prototype.load = function(a) {
                return i(function(a) {
                    return function(b) {
                        return g.fetch(a._projectId, {success: function(c) {
                            return a.membersCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function() {
                    return function() {
                        return null != a && "function" == typeof a.success ? a.success() : void 0
                    }
                }(this)).fail(function(a) {
                    return function(b, c) {
                        return console.error(c), a.close()
                    }
                }(this))
            }, e.prototype.initMemberPicker = function() {
                return this.involveView = this.requestSubView(f, {_projectId: this._projectId,objectModel: this.model,membersCollection: this.membersCollection,dropArea: this.$el}), this.involveView.$el.prependTo(this.$(".settings-members")), this
            }, e.prototype.saveApprovers = function() {
                return _.isEqual(this.bookkeepingModel.get("_approverIds"), this.model.get("involveMembers")) ? void 0 : this.bookkeepingModel.save(null, {attrs: {_approverIds: this.model.get("involveMembers")}})
            }, e.prototype.onClose = function() {
                return this.saveApprovers()
            }, e.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, e
        }(h)
    }), define("views/bookkeeping/bookkeeping-settings/categories/templates/basic", [], function() {
        return function() {
            var a = '<div class="settings-navigation"> <ul class="settings-switcher-set nav nav-tabs"> <li class="settings-switcher-wrap active"> <a class="settings-switcher" data-type="1">收入</a> </li> <li class="settings-switcher-wrap"> <a class="settings-switcher" data-type="-1">支出</a> </li> </ul></div><div class="settings-input-wrap clearfix"> <a class="icon icon-plus-sign pull-left"></a> <input class="add-input form-control pull-left" placeholder="添加类型" /> <button class="btn btn-link link-add-handler pull-right">创建</button></div><ul class="settings-list"></ul>';
            return a
        }
    }), define("views/bookkeeping/bookkeeping-settings/categories/templates/category", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="category" data-id="' + a._id + '"> <span class="icon icon-menu pull-left"></span> <div class="settings-handlers-editing clearfix"> <input type="text" class="form-control pull-left category-input" placeholder="分类名称" value=""> <button class="btn btn-primary btn-small settings-event-source pull-left" data-type="updateCategory">保存</button> <button class="btn btn-link btn-small settings-event-source pull-left" data-type="exitEditing">取消</button> </div> <div class="settings-handlers-without-state clearfix"> <span class="settings-category-case">' + b(a.title) + '</span> <a class="icon icon-trash-bold settings-event-source pull-right" data-type="deleteCategory" ></a> <a class="icon icon-td-pencil settings-event-source pull-right" data-type="enterEditing"></a> </div></li>';
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/bookkeeping/bookkeeping-settings/categories/index", ["require", "exports", "module", "teambition", "./templates/basic", "./templates/category", "collections/entries", "collections/entry-categories", "lib/multi-modal/index", "thenjs", "util"], function(a) {
        var c, d, e, f, g, h, i, j, k;
        return k = a("teambition"), c = a("./templates/basic"), e = a("./templates/category"), f = a("collections/entries"), g = a("collections/entry-categories"), h = a("lib/multi-modal/index"), i = a("thenjs"), j = a("util"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "BookkeepingSettingsCategoriesView", d.prototype.tagName = "div", d.prototype.className = "bookkeeping-settings-categories-view", d.prototype.modalTitle = "管理分类", d.prototype.type = 1, d.prototype.events = {"keyup .add-input": "keyupAddInput","click .link-add-handler": "createCategory","click .settings-switcher": "switchType","click .settings-event-source": "triggerEvent","keyup .category-input": "keyeupCategoryInput","deleteCategory .category": "deleteCategory","enterEditing .category": "enterEditing","updateCategory .category": "updateCategory","exitEditing .category": "exitEditing"}, d.prototype.initialize = function(a) {
                if (!a._projectId)
                    throw new Error("" + this.viewName + ":options should have _projectId");
                return this.options = a, this._projectId = a._projectId, _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this), 100), d.__super__.initialize.apply(this, arguments)
            }, d.prototype.renderMain = function() {
                return this.$modalBody.html(c()), this.$list = this.$(".settings-list"), this.load({success: function(a) {
                    return function() {
                        return a.listen().renderCategories()
                    }
                }(this)})
            }, d.prototype.load = function(a) {
                return i(function(a) {
                    return function(b) {
                        return g.fetch(a._projectId, {success: function(c) {
                            return a.entryCategoriesCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return f.fetch(a._projectId, {success: function(c) {
                            return a.entriesCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function() {
                    return function() {
                        return null != a && "function" == typeof a.success ? a.success() : void 0
                    }
                }(this))
            }, d.prototype.listen = function() {
                return this.listenTo(this.entryCategoriesCollection, "remove destory", this.removeCategory), this.listenTo(this.entryCategoriesCollection, "add change", function(a) {
                    return function(b) {
                        return a.renderCategory(b.toJSON(), !0)
                    }
                }(this)), this
            }, d.prototype.renderCategories = function() {
                var a, b;
                return this.$list.empty(), a = !1, b = this.entryCategoriesCollection.getCategories(this.type, a), _.each(b, function(a) {
                    return function(b) {
                        return a.renderCategory(b)
                    }
                }(this)), this
            }, d.prototype.renderCategory = function(a, b) {
                var c, d;
                return d = a.id || a._id, a.toJSON && (a = a.toJSON()), c = this.$(".category[data-id=" + d + "]"), c.length ? c.replaceWith(e(a)) : this.$list[b ? "prepend" : "append"](e(a)), this
            }, d.prototype.removeCategory = function(a) {
                var b, c;
                return c = a.id || a._id, b = this.$(".category[data-id=" + c + "]"), b.remove()
            }, d.prototype.switchType = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = parseInt(b.data("type")), c && c !== this.type ? (this.type = c, this.$(".settings-switcher-wrap").removeClass("active"), this.$(".settings-switcher[data-type=" + c + "]").parent().addClass("active"), this.renderCategories(), this) : void 0
            }, d.prototype.keyupAddInput = function(a) {
                return 13 === a.keyCode ? this.createCategory() : this.filterCategory()
            }, d.prototype.filterCategory = function() {
                var a;
                return a = this.$(".add-input").val(), a ? this.entryCategoriesCollection.each(function(b) {
                    var c, d, e, f;
                    return d = b.toJSON(), c = this.$(".category[data-id=" + d._id + "]"), f = c.text(), e = f.indexOf(a) < 0, c[e ? "addClass" : "removeClass"]("hide")
                }) : this.$(".category").removeClass("hide"), this
            }, d.prototype.createCategory = function() {
                var a, b;
                return a = this.$(".add-input"), (b = a.val()) ? (this.entryCategoriesCollection.create({title: b,type: this.type,_projectId: this._projectId}, {wait: !0,success: function(b) {
                    return function() {
                        return a.val(""), b.filterCategory()
                    }
                }(this),error: function() {
                    return function(a, b) {
                        return b.status = "error", j.message(b)
                    }
                }(this)}), this) : this
            }, d.prototype.keyeupCategoryInput = function(a) {
                var b;
                return b = $(a.currentTarget), 13 === a.keyCode && b.trigger("updateCategory"), this
            }, d.prototype.triggerEvent = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), c = b.prop("disabled"), b.hasClass("disabled") ? this : (d = b.data("type"), d && b.trigger(d), this)
            }, d.prototype.deleteCategory = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), d = b.data("id"), c = this.entryCategoriesCollection.get(d), c && c.destroy(), this
            }, d.prototype.enterEditing = function(a) {
                var b, c, d, e, f, g;
                return c = $(a.currentTarget), b = c.find("input"), f = c.data("id"), d = null != (g = this.entryCategoriesCollection.get(f)) ? g.toJSON() : void 0, e = "editing", this.$("." + e).removeClass(e), c.addClass(e), b.val(d.title), b.focusAtEnd(), this
            }, d.prototype.exitEditing = function(a) {
                var b;
                return b = $(a.currentTarget), b.removeClass("editing"), this
            }, d.prototype.updateCategory = function(a) {
                var b, c, d, e, f;
                return b = $(a.currentTarget), d = b.data("id"), c = this.entryCategoriesCollection.get(d), f = "updating", e = b.find("input").val(), b.find("input").focusAtEnd(), b.hasClass(f) || !e ? this : (b.addClass(f), c.save(null, {wait: !0,attrs: {title: e},success: function() {
                    return b.removeClass(f)
                },error: function() {
                    return function(a, b) {
                        return b.status = "error", j.message(b)
                    }
                }(this)}), this)
            }, d.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, d
        }(h)
    }), define("views/bookkeeping/bookkeeping-settings/displayFields/templates/basic", [], function() {
        return function(a) {
            var b = '<form class="settings-form"> <div class="settings-set settings-in"> <div class="settings-title">现有字段</div> <ul class="clearfix list-inline ui-sortable"> ', c = a["in"];
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += " ", "category" == d.attr ? (b += ' <li class="settings-field ', d.isDefault !== !0 && (b += "switch-handler"), b += '" data-attr="' + d.attr + '"> ' + d.title + " </li> ") : (b += ' <li class="settings-field ui-sortable-handle ', d.isDefault !== !0 && (b += "switch-handler"), b += '" data-attr="' + d.attr + '"> ' + d.title + " </li> "), b += " ";
            b += ' </ul> </div> <div class="settings-set settings-out hide"> <div class="settings-title">未添加字段</div> <ul class="clearfix list-inline ui-sortable"> ';
            var g = a.out;
            if (g)
                for (var d, h = -1, i = g.length - 1; i > h; )
                    d = g[h += 1], b += ' <li class="settings-field switch-handler" data-attr="' + d.attr + '"> ' + d.title + " </li> ";
            return b += " </ul> </div></form>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/bookkeeping/bookkeeping-settings/displayFields/index", ["require", "exports", "module", "teambition", "./templates/basic", "lib/multi-modal/index", "util"], function(a) {
        var c, d, e, f, g;
        return g = a("teambition"), c = a("./templates/basic"), e = a("lib/multi-modal/index"), f = a("util"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "BookkeepingSettingsDisplayFieldsView", d.prototype.tagName = "div", d.prototype.className = "bookkeeping-settings-displayFields-view", d.prototype.modalTitle = "账目字段设置", d.prototype.events = {"click .settings-in .switch-handler": "removeField","click .settings-out .switch-handler": "addField"}, d.prototype.initialize = function(a) {
                if (!a.bookkeepingModel)
                    throw new Error("" + this.viewName + ":options should have bookkeepingModel");
                return this.options = a, this.bookkeepingModel = a.bookkeepingModel, this.displayFields = this.bookkeepingModel.getDisplayFields(), this.hiddenFields = this.bookkeepingModel.getHiddenFields(), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this), 100), d.__super__.initialize.apply(this, arguments)
            }, d.prototype.renderMain = function() {
                var a;
                return a = {"in": this.displayFields,out: this.hiddenFields}, this.$modalBody.html(c(a)), this.checkOutFields(), this.initSortable()
            }, d.prototype.initSortable = function() {
                var a;
                return a = !1, this.$(".list-inline").sortable({items: ".ui-sortable-handle",connectWith: ".list-inline",helper: "clone",placeholder: "settings-field settings-field-placeholder",tolerance: "pointer",zIndex: 2001,scroll: !1,update: function(a) {
                    return function(b, c) {
                        var d;
                        return d = $(c.item[0]), d.closest(".settings-out").length && !d.hasClass("switch-handler") ? !1 : (a.$(".settings-in").find(".icon-tick").removeClass("icon-tick").addClass("icon-remove"), a.$(".settings-out").find(".icon-remove").removeClass("icon-remove").addClass("icon-tick"), a.parseFromUI())
                    }
                }(this)}), this
            }, d.prototype.parseFromUI = function() {
                var a, b;
                return a = [], this.$(".settings-in .settings-field").each(function() {
                    return a.push($(this).data("attr"))
                }), this.displayFields = this.bookkeepingModel.getFields(a), b = [], this.$(".settings-out .settings-field").each(function() {
                    return b.push($(this).data("attr"))
                }), this.hiddenFields = this.bookkeepingModel.getFields(b), this.checkOutFields()
            }, d.prototype.checkOutFields = function() {
                return this.hiddenFields.length ? this.$(".setting-out").show() : this.$(".setting-out").hide()
            }, d.prototype.removeField = function(a) {
                var b;
                return (b = (null != a ? a.currentTarget : void 0) ? $(a.currentTarget).data("attr") : a) ? (this.displayFields = _.reject(this.displayFields, function(a) {
                    return function(c) {
                        return c.attr === b ? (a.hiddenFields.unshift(c), !0) : !1
                    }
                }(this)), this.renderMain()) : void 0
            }, d.prototype.addField = function(a) {
                var b;
                return (b = (null != a ? a.currentTarget : void 0) ? $(a.currentTarget).data("attr") : a) ? (this.hiddenFields = _.reject(this.hiddenFields, function(a) {
                    return function(c) {
                        return c.attr === b ? (a.displayFields.push(c), !0) : !1
                    }
                }(this)), this.renderMain()) : void 0
            }, d.prototype.saveFields = function() {
                var a;
                return a = _.map(this.displayFields, "attr"), _.isEqual(a, this.bookkeepingModel.get("displayFields")) ? void 0 : this.bookkeepingModel.save(null, {attrs: {displayFields: a},success: function(a) {
                    return function() {
                        return a.close()
                    }
                }(this),error: function() {
                    return function(a, b) {
                        return b.status = "error", f.message(b, 2e3)
                    }
                }(this)})
            }, d.prototype.onClose = function() {
                return this.saveFields(), this
            }, d.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, d
        }(e)
    }), define("views/bookkeeping/bookkeeping-panel/templates/basic", [], function() {
        return function() {
            var a = '<div class="bookkeeping-panel-wrap scrollable"> <div class="bookkeeping-panel-header"> <a class="bookkeeping-panel-settings-toggler" data-type="approve" data-gta="event" data-label="bkp panel settings toggle"> <strong>记账设置</strong> <span class="icon icon-chevron-down pull-right"></span> </a> <a class="icon icon-remove pull-right bookkeeping-panel-toggler"></a> </div> <ul class="bookkeeping-panel-settings-set list"> <li> <a class="bookkeeping-panel-settings-handler" data-type="approve" data-gta="event" data-label="bkp panel settings approve"> 审批人设置 </a> </li> <li> <a class="bookkeeping-panel-settings-handler" data-type="displayFields" data-gta="event" data-label="bkp panel settings displayFields"> 账目字段设置 </a> </li> <li> <a class="bookkeeping-panel-settings-handler" data-type="category" data-gta="event" data-label="bkp panel settings category"> 管理分类 </a> </li> </ul> <div class="bookkeeping-panel-filter-set panel-set"> <div class="panel-title"> <strong>筛选</strong> <a class="filter-clear-handler pull-right" data-gta="event" data-label="bkp panel filter clear">清空筛选</a> </div> <div class="filter-input-wrap"> <input class="form-control filter-query-input" placeholder="查找相关账目" /> </div> <div class="filter-date-wrap"> <a class="filter-start-date filter-date-hanlder" data-type="startDate" data-gta="event" data-label="bkp panel filter startDate"></a> <div class="filter-date-line"></div> <a class="filter-end-date filter-date-hanlder" data-type="endDate" data-gta="event" data-label="bkp panel filter endDate"></a> </div> </div> <div class="bookkeeping-panel-filter-categories panel-set"></div> <div class="bookkeeping-panel-filter-tags panel-set"></div> <div class="bookkeeping-panel-filter-creators panel-set"></div> <div class="bookkeeping-panel-filter-approved-wrap"> <a class="filter-approved-handler" data-gta="event" data-label="bkp panel approve handler"> <div class="check-box pull-left"> <span class="icon icon-tick"></span> </div> <span>隐藏已经审核的账目</span> </a> </div></div><div class="bookkeeping-panel-layer"></div>';
            return a
        }
    }), define("views/bookkeeping/bookkeeping-panel/templates/categories", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            if (a.categories.length > 0) {
                c += ' <div class="panel-title"> <strong>类型</strong> </div> <ul class="list"> ';
                var d = a.categories;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; )
                        e = d[f += 1], c += ' <li> <a class="category" data-id="' + e._id + '">' + b(e.title) + '</a> <span class="icon icon-tick"></span> </li> ';
                c += " </ul>"
            }
            return c
        }
    }), define("views/bookkeeping/bookkeeping-panel/templates/creators", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            if (a.creators.length > 0) {
                c += ' <div class="panel-title"> <strong>创建者</strong> </div> <ul class="list"> ';
                var d = a.creators;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; )
                        e = d[f += 1], c += " ", e._id && (c += ' <li> <a class="member" data-id="' + e._id + '"> <div class="avatar img-circle img-24" style="background-image:url(' + e.avatarUrl + ');"></div> ' + b(e.name) + ' </a> <span class="icon icon-tick"></span> </li> '), c += " ";
                c += " </ul>"
            }
            return c
        }
    }), define("views/bookkeeping/bookkeeping-panel/templates/tags", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            if (a.tags.length > 0) {
                c += ' <div class="panel-title"> <strong>标签</strong> </div> <ul class="list"> ';
                var d = a.tags;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; )
                        e = d[f += 1], c += ' <li> <a class="tag" data-id="' + e._id + '"> <span class="tag-label tag-label-' + e.color + '"></span> <span class="tag-name">' + b(e.name) + '</span> </a> <span class="icon icon-tick"></span> </li> ';
                c += " </ul>"
            }
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/bookkeeping/bookkeeping-panel/index", ["require", "exports", "module", "teambition", "model", "thenjs", "util", "view", "collections/bookkeepings", "collections/entries", "collections/entry-categories", "collections/tags", "views/bookkeeping/bookkeeping-settings/approver/index", "views/bookkeeping/bookkeeping-settings/categories/index", "views/bookkeeping/bookkeeping-settings/displayFields/index", "lib/window/index", "./templates/basic", "./templates/categories", "./templates/creators", "./templates/tags"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v;
        return v = a("teambition"), l = a("model"), r = a("thenjs"), s = a("util"), t = a("view"), f = a("collections/bookkeepings"), i = a("collections/entries"), j = a("collections/entry-categories"), p = a("collections/tags"), m = a("views/bookkeeping/bookkeeping-settings/approver/index"), n = a("views/bookkeeping/bookkeeping-settings/categories/index"), o = a("views/bookkeeping/bookkeeping-settings/displayFields/index"), u = a("lib/window/index"), c = a("./templates/basic"), g = a("./templates/categories"), h = a("./templates/creators"), q = a("./templates/tags"), k = "ZH", e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "BookkeepingPanelView", e.prototype.tagName = "div", e.prototype.className = "bookkeeping-panel-view", e.prototype.events = {"click .bookkeeping-panel-toggler": "hide","click .bookkeeping-panel-settings-toggler": "toggleSettings","click .filter-date-hanlder": "showDatePicker","keyup .filter-query-input": "setQuery","click .tag": "setTagIds","click .member": "setCreatorId","click .category": "setCategoryId","click .filter-approved-handler": "toggleIsFilterApproved","click .filter-clear-handler": "resetFilter","click .bookkeeping-panel-settings-handler": "settingsHandler","mousewheel .scrollable": s.mousewheel}, e.prototype.initialize = function(a) {
                if (!a._projectId)
                    throw new Error("" + this.viewName + ":options should have _projectId");
                return this.options = a, this._projectId = a._projectId, this.load({success: function(a) {
                    return function() {
                        return a.resetFilter().listen().renderBasic().renderCategories().renderCreators().renderTags().refreshStatus()
                    }
                }(this)}), _.delay(function(a) {
                    return function() {
                        return a.layout()
                    }
                }(this), 100), e.__super__.initialize.apply(this, arguments)
            }, e.prototype.load = function(a) {
                return r(function(a) {
                    return function(b) {
                        return f.fetch(a._projectId, {success: function(c) {
                            return a.bookkeepingModel = c.at(0), a.isAdmin = a.bookkeepingModel.isAdmin(), b()
                        },error: function(a, c) {
                            return b(c, null)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return i.fetch(a._projectId, {success: function(c) {
                            return a.entriesCollection = c, b()
                        },error: function(a, c) {
                            return b(c, null)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return j.fetch(a._projectId, {success: function(c) {
                            return a.entryCategoriesCollection = c, b()
                        },error: function(a, c) {
                            return b(c, null)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return p.fetch(a._projectId, {success: function(c) {
                            return a.tagsCollection = c, b()
                        },error: function(a, c) {
                            return b(c, null)
                        }})
                    }
                }(this)).then(function() {
                    return function() {
                        return null != a && "function" == typeof a.success ? a.success() : void 0
                    }
                }(this))
            }, e.prototype.resetFilter = function() {
                return this.filterModel || (this.filterModel = new l), this.filterModel.set({query: "",startDate: "",endDate: "",categoryId: "",tagIds: [],creatorId: "",isFilterApproved: !1}), this
            }, e.prototype.listen = function() {
                return this.listenTo(this.filterModel, "change", function(a) {
                    return function() {
                        return a.refreshStatus(), a.filterEntries()
                    }
                }(this)), this.listenTo(this.entriesCollection, "change:date change:content", function(a) {
                    return function() {
                        return a.filterEntries(!0)
                    }
                }(this)), this.listenTo(this.entriesCollection, "change:_entryCategoryId", function(a) {
                    return function() {
                        return a.renderCategories(), a.refreshStatus(), a.filterEntries(!0)
                    }
                }(this)), this.listenTo(this.entriesCollection, "change:tagIds", function(a) {
                    return function() {
                        return a.renderTags(), a.refreshStatus(), a.filterEntries(!0)
                    }
                }(this)), this.listenTo(this.entriesCollection, "add", function(a) {
                    return function() {
                        return a.renderCategories(), a.renderTags(), a.renderCreators(), a.refreshStatus(), a.filterEntries(!0)
                    }
                }(this)), this.listenTo(this.entriesCollection, "remove", function(a) {
                    return function() {
                        return a.renderCategories(), a.renderTags(), a.renderCreators(), a.refreshStatus()
                    }
                }(this)), this.listenTo(this.entryCategoriesCollection, "remove", function(a) {
                    return function() {
                        return a.renderCategories()
                    }
                }(this)), this
            }, e.prototype.layout = function() {
                var a, b;
                return a = $(window), b = a.height() - this.$el.offset().top + a.scrollTop(), this.$el.css("height", "" + b + "px"), this
            }, e.prototype.renderBasic = function() {
                var a;
                return a = {isAdmin: this.isAdmin}, this.$el.html(c(a)), this
            }, e.prototype.renderCategories = function() {
                var a, b, c, d, e, f, h, i;
                h = [], f = !1, i = this.entriesCollection.getEntryCategoryIdsCount();
                for (b in i)
                    d = i[b], c = this.entryCategoriesCollection.get(b), d > 0 && c ? h.push(c.toJSON()) : d > 0 && (f = !0);
                return f && h.push(this.entryCategoriesCollection.getCategory().toJSON()), e = {categories: h}, a = this.$(".bookkeeping-panel-filter-categories"), a.html(g(e)), this
            }, e.prototype.renderCreators = function() {
                var a, b, c;
                return c = this.entriesCollection.getCreators(), b = {creators: c}, a = this.$(".bookkeeping-panel-filter-creators"), a.html(h(b)), this
            }, e.prototype.renderTags = function() {
                var a, b, c, d, e, f, g, h, i;
                for (d = [], e = this.entriesCollection.getTagIdsCount(), i = this.tagsCollection.toJSON(), g = 0, h = i.length; h > g; g++)
                    f = i[g], b = e[f._id], b && (f.count = b, d.push(f));
                return c = {tags: d}, a = this.$(".bookkeeping-panel-filter-tags"), a.html(q(c)), this
            }, e.prototype.refreshStatus = function() {
                var a, b, c, d, e, f, g, h, i, j, k, l, m, n;
                if (e = this.filterModel.toJSON(), this.$("input").val(e.query), i = (h = this.filterModel.get("startDate")) ? null != (l = s.formatDate(h)) ? l.dateString : void 0 : "开始时间", this.$(".filter-start-date").text(i), d = (c = this.filterModel.get("endDate")) ? null != (m = s.formatDate(c)) ? m.dateString : void 0 : "结束时间", this.$(".filter-end-date").text(d), this.$(".selected").removeClass("selected"), e.categoryId && this.$(".category[data-id=" + e.categoryId + "]").parent().addClass("selected"), e.tagIds.length)
                    for (n = e.tagIds, j = 0, k = n.length; k > j; j++)
                        f = n[j], this.$(".tag[data-id=" + f + "]").parent().addClass("selected");
                return e.creatorId && this.$(".member[data-id=" + e.creatorId + "]").parent().addClass("selected"), a = this.$(".filter-clear-handler"), e.categoryId || e.tagIds.length || e.creatorId || e.query || e.startDate || e.endDate ? a.addClass("active") : a.removeClass("active"), g = this.filterModel.get("isFilterApproved"), b = this.$(".filter-approved-handler"), b[g ? "addClass" : "removeClass"]("active"), this
            }, e.prototype.showDatePicker = function(a) {
                var b, c, d, e;
                return b = $(a.currentTarget), d = b.data("type"), b.data("datepicker") ? (e = !b.data("showDatepicker"), b.data("showDatepicker", e), b.data("datepicker").picker.toggle(e)) : (c = this.filterModel.get(d), c = c ? new Date(c) : new Date, b.datepicker({format: "yyyy-mm-dd",language: "ZH" === k ? "zh-CN" : k.toLowerCase(),todayHighlight: !0,placement: "left",todayBtn: "linked",tomorrowBtn: "linked",somedayBtn: "linked"}).datepicker("update", c).datepicker("show").focus().on("changeDate", function(a) {
                    return function(c) {
                        return a.filterModel.set(d, c.date), b.datepicker("hide")
                    }
                }(this)).on("hide", function() {
                    return function() {
                        return b.data("showDatepicker", !1)
                    }
                }(this)), b.data("showDatepicker", !0)), this
            }, e.prototype.setQuery = function(a) {
                var b;
                return b = $(a.currentTarget), this.filterModel.set("query", b.val()), this
            }, e.prototype.setTagIds = function(a) {
                var b, c, e;
                return b = $(a.currentTarget), c = b.data("id"), e = _.clone(this.filterModel.get("tagIds")), d.call(e, c) >= 0 ? e = _.without(e, c) : e.push(c), this.filterModel.set("tagIds", e), this
            }, e.prototype.setCategoryId = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), d = b.data("id"), c = this.filterModel.get("categoryId"), c === d && (d = ""), this.filterModel.set("categoryId", d), this
            }, e.prototype.setCreatorId = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), d = b.data("id"), c = this.filterModel.get("creatorId"), c === d && (d = ""), this.filterModel.set("creatorId", d), this
            }, e.prototype.toggleIsFilterApproved = function() {
                var a;
                return a = this.filterModel.get("isFilterApproved"), this.filterModel.set("isFilterApproved", !a), this
            }, e.prototype.filterEntries = function(a) {
                var b, c, d, e, f, g, h, i, j, k, l, m, n;
                if (a && !this.filtering)
                    return this;
                for (this.filtering = !1, h = this.filterModel.toJSON(), e = this.entriesCollection.toJSON(), m = 0, n = e.length; n > m; m++)
                    f = e[m], b = this.parentView.$el.find(".entry-view[data-id=" + f._id + "]"), i = !1, h.isFilterApproved && "approved" === f.status && (i = !0), !i && h.startDate && f.date && (l = new Date(h.startDate).getTime(), c = new Date(f.date).getTime(), l > c && (i = !0)), !i && h.endDate && f.date && (d = new Date(h.endDate).getTime(), c = new Date(f.date).getTime(), c > d && (i = !0)), !i && h.creatorId && h.creatorId !== f._creatorId && (i = !0), !i && h.categoryId && (j = this.entryCategoriesCollection.getCategory(f._entryCategoryId).toJSON(), j._id !== h.categoryId && (i = !0)), i || !h.tagIds.length || _.find(f.tagIds, function() {
                        return function(a) {
                            return _.contains(h.tagIds, a)
                        }
                    }(this)) || (i = !0), !i && (k = h.query) && (k = k.toLowerCase(), !s.matchString(f.note.toLowerCase(), k) && !s.matchString(f.content.toLowerCase(), k) && b.text().toLowerCase().indexOf(k) < 0 && (i = !0)), b[i ? "addClass" : "removeClass"]("hide"), i && (this.filtering = !0);
                return g = this.filtering ? "filtering" : "stopFilter", this.trigger(g), this
            }, e.prototype.refilter = function() {
                return this.renderCategories(), this.renderTags(), this.renderCreators(), this.refreshStatus(), this.filterEntries(!0)
            }, e.prototype.settingsHandler = function(a) {
                var b, c;
                if (this.isAdmin)
                    switch (b = $(a.currentTarget), c = b.data("type")) {
                        case "approve":
                            return this.openSettingsApprover(a);
                        case "displayFields":
                            return this.openSettingsDisplayFields(a);
                        case "category":
                            return this.openSettingsCategory(a)
                    }
            }, e.prototype.openSettingsDisplayFields = function() {
                return this.requestSubView(u).open(o, {bookkeepingModel: this.bookkeepingModel})
            }, e.prototype.openSettingsApprover = function() {
                return this.requestSubView(u).open(m, {bookkeepingModel: this.bookkeepingModel})
            }, e.prototype.openSettingsCategory = function() {
                return this.requestSubView(u).open(n, {_projectId: this._projectId})
            }, e.prototype.toggleSettings = function() {
                return this.isAdmin ? (this.$el.toggleClass("open"), this) : void 0
            }, e.prototype.hide = function() {
                return this.$el.removeClass("panel-active"), this.trigger("hide"), !1
            }, e.prototype.show = function() {
                return this.$el.addClass("panel-active"), this.trigger("show"), !1
            }, e.prototype.toggle = function() {
                return this.$el.hasClass("panel-active") ? this.hide() : this.show(), !1
            }, e.prototype.remove = function() {
                return this.resetFilter(), e.__super__.remove.apply(this, arguments)
            }, e
        }(t)
    }), define("views/bookkeeping/entry-creator/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<form class="entry-creator-form"> <div class="entry-category"> <ul class="entry-category-select ';
            c += 1 == a.type ? "income" : "expense", c += '"> ';
            var d = a.defaultCategories;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += " ", "other" != e.icon && (c += ' <li class="entry-category-option " data-icon="' + e.icon + '" data-id="' + e._id + '"> <span class="entry-icon icon icon-' + e.iconStr + '"></span> <span class="entry-category-title">' + b(e.title) + "</span> </li> "), c += " ";
            return c += ' <li class="entry-category-option other" data-icon="other"> <span class="entry-icon icon icon-more"></span> <span class="entry-category-title">更多</span> </li> </ul> </div> <div class="entry-content"> <input class="entry-content-input form-control" placeholder="内容" value="' + a.content + '" /> </div> <div class="entry-amount-date clearfix"> <div class="entry-amount"> <input class="entry-amount-input form-control" type="number" min="1" placeholder="金额" value="' + a.amount + '" /> </div> <div class="entry-date"> <label class="entry-date-label btn btn-default form-control-select" data-gta="event" data-label="bkp creator date"></label> </div> </div> <div class="entry-expansions clearfix hide"> <div class="entry-cost"> <input class="entry-cost-input form-control" type="number" placeholder="entryCreatorPlaceholderCost" value="' + a.cost + '" /> </div> <div class="entry-receiver"> <input class="entry-receiver-input form-control" type="text" placeholder="entryCreatorPlaceholderReceiver" value="' + a.receiver + '" /> </div> <div class="entry-profit"> <input class="entry-profit-input form-control" type="number" placeholder="entryCreatorPlaceholderProfit" value="' + a.profit + '" /> </div> </div> <div class="entry-note"> <textarea class="entry-note-input" placeholder="添加备忘">' + a.note + '</textarea> </div> <div class="entry-tags-set"></div> <div class="entry-involve-set"></div> <div class="submit-set clearfix"> <button class="btn btn-primary submit-handler pull-right" data-gta="event" data-label="bkp creator submit"> ', c += a.isUpdate ? "保存" : "创建", c += ' </button> <div class="btn-group dropup pull-right"> <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" data-gta="event" data-label="bkp creator involve"> <span class="visible-title">所有成员可见</span> <span class="icon icon-chevron-up"></span> </button> <ul class="dropdown-menu" role="menu"> <li><a class="visible-handler" data-type="members">所有成员可见</a></li> <li><a class="visible-handler" data-type="involves">仅参与者可见</a></li> </ul> </div> </div></form>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/bookkeeping/entry-creator/index", ["require", "exports", "module", "teambition", "views/member/member-involve/index", "lib/socket", "store", "thenjs", "util", "view", "models/entry-category", "models/entry", "collections/entries", "collections/entry-categories", "collections/members", "lib/multi-modal/index", "views/core/popover-menu/index", "views/tag/tag-picker/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t;
        return t = a("teambition"), j = a("views/member/member-involve/index"), n = a("lib/socket"), o = a("store"), q = a("thenjs"), r = a("util"), s = a("view"), f = a("models/entry-category"), h = a("models/entry"), d = a("collections/entries"), e = a("collections/entry-categories"), k = a("collections/members"), l = a("lib/multi-modal/index"), m = a("views/core/popover-menu/index"), p = a("views/tag/tag-picker/index"), c = a("./templates/basic"), i = "ZH", g = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "EntryCreatorView", d.prototype.tagName = "div", d.prototype.className = "entry-creator-view fade", d.prototype.modalTitle = "记录收入", d.prototype.events = {"click .entry-category-option": "categoryHandler","click .entry-date": "showDatePicker","click .submit-handler": "submit","change input, blur textarea": "parseEntry","click .visible-handler": "switchVisible"}, d.prototype.initialize = function(a) {
                if (!((null != a ? a._projectId : void 0) || a._entryId && a.type))
                    throw new Error("" + this.viewName + ":wrong options");
                return this.options = a, this.type = a.type || 1, -1 === this.type && (this.modalTitle = "记录支出"), this._projectId = a._projectId, this.localCache = o.namespace("temp").namespace("entry_creator"), this.localCacheId = "" + a._projectId + "_" + t.user.id + "_" + this.type, _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this), 100), d.__super__.initialize.apply(this, arguments)
            }, d.prototype.renderMain = function(a) {
                return this.load({success: function(b) {
                    return function() {
                        return b.reset().listen(), b.renderBasic(a).renderCategory().renderDate().renderVisible().initCategoryPicker().initInvolve().initTagPicker()
                    }
                }(this)})
            }, d.prototype.load = function(a) {
                return q(function(a) {
                    return function(b) {
                        return a.options._entryId ? (a.isUpdate = !0, h.fetch(a.options._entryId, {success: function(c) {
                            return a.entryModel = c, a._projectId = a.entryModel.get("_projectId"), b()
                        },error: function(a, c) {
                            return b(c)
                        }})) : b()
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return e.fetch(a._projectId, {success: function(c) {
                            return a.entryCategoriesCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return k.fetch(a._projectId, {success: function(c) {
                            return a.membersCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function() {
                    return function() {
                        return null != a && "function" == typeof a.success ? a.success() : void 0
                    }
                }(this))
            }, d.prototype.reset = function() {
                var a, b;
                return this.model && this.stopListening(this.model), this.isUpdate ? this.model = this.entryModel.clone() : (b = this.localCache(this.localCacheId) || {}, a = _.extend({type: this.type,_projectId: this._projectId,_boundToObjectId: this._projectId,_entryCategoryId: this.entryCategoriesCollection.getDefaultId(this.type),content: "",amount: "",date: new Date,note: "",involveMembers: [t.user.id],tagsId: [],visiable: "members"}, b), this.model = new h(a)), this
            }, d.prototype.listen = function() {
                return this.listenTo(this.model, "change:_entryCategoryId", this.renderCategory), this.listenTo(this.model, "change:date", this.renderDate), this.listenTo(this.model, "change:visiable", this.renderVisible), this.listenTo(this.model, "change", this.cacheEntry)
            }, d.prototype.renderBasic = function(a) {
                var b, d;
                return b = this.model.toJSON(), d = !0, b.defaultCategories = this.entryCategoriesCollection.getCategories(this.type, d), b.isUpdate = this.isUpdate, a.html(c(b)), a.find(".entry-note-input").flexText(), this.$submit = this.$el.find(".submit-handler"), this.$category = this.$el.find(".entry-category"), this.$date = this.$el.find(".entry-date-label"), this.$amountInput = this.$el.find(".entry-amount-input"), this.$contentInput = this.$el.find(".entry-content-input"), this.$noteInput = this.$el.find(".entry-note-input"), this.$visibleGroup = this.$el.find(".submit-set .btn-group"), this
            }, d.prototype.renderCategory = function() {
                var a, b, c, d;
                return c = this.model.get("_entryCategoryId"), a = null != (d = this.entryCategoriesCollection.get(c)) ? d.toJSON() : void 0, a && (this.$category.find(".active").removeClass("active"), b = a.icon ? a.icon : "other", this.$category.find("[data-icon=" + b + "]").addClass("active")), this
            }, d.prototype.renderDate = function() {
                var a, b, c;
                return a = this.model.get("date"), b = a ? null != (c = r.formatDate(a)) ? c.dateString : void 0 : "选择日期", this.$date.text(b), this
            }, d.prototype.renderVisible = function() {
                var a;
                return a = this.model.get("visiable"), a && (this.$visibleGroup.find(".selected").removeClass("selected"), this.$visibleGroup.find("[data-type=" + a + "]").parent().addClass("selected"), this.$visibleGroup.find(".visible-title").text(this.$visibleGroup.find(".selected").text())), this
            }, d.prototype.initCategoryPicker = function() {
                var a;
                return a = !1, this.typePickerView = this.requestSubView(m, {$toggler: this.$(".entry-category-option.other"),width: 240,addPlaceholder: "添加类型",dataList: this.entryCategoriesCollection.getCategories(this.type, a),selected: this.model.get("_entryCategoryId"),select: function(a) {
                    return function(b) {
                        return a.model.set("_entryCategoryId", b)
                    }
                }(this),add: function(b) {
                    return function(c) {
                        return b.entryCategoriesCollection.create({title: c,type: b.type,_projectId: b._projectId}, {wait: !0,success: function(c) {
                            return b.model.set("_entryCategoryId", c.id), b.typePickerView.update(b.entryCategoriesCollection.getCategories(b.type, a), b.model.get("_entryCategoryId"))
                        }})
                    }
                }(this)}), this
            }, d.prototype.initInvolve = function() {
                return this.involveView = this.requestSubView(j, {_projectId: this._projectId,objectModel: this.model,membersCollection: this.membersCollection,dropArea: this.$el,undeletable: !1,resident: [t.user.id]}), this.involveView.$el.prependTo(this.$(".entry-involve-set")), this
            }, d.prototype.initTagPicker = function() {
                return this.taPickerView = this.requestSubView(p, {_projectId: this._projectId,objectModel: this.model}), this.taPickerView.$el.prependTo(this.$(".entry-tags-set")), this
            }, d.prototype.categoryHandler = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), c = b.data("id"), d = b.data("icon"), c && "other" !== d ? this.model.set("_entryCategoryId", c) : void 0
            }, d.prototype.showDatePicker = function() {
                var a, b;
                return this.$date.data("datepicker") ? (b = !this.$date.data("showDatepicker"), this.$date.data("showDatepicker", b), this.$date.data("datepicker").picker.toggle(b)) : (a = this.model.get("date") ? new Date(this.model.get("date")) : new Date, this.$date.datepicker({format: "yyyy-mm-dd",language: "ZH" === i ? "zh-CN" : i.toLowerCase(),todayHighlight: !0,placement: "left",todayBtn: "linked",tomorrowBtn: "linked"}).datepicker("update", a).datepicker("show").focus().on("changeDate", function(a) {
                    return function(b) {
                        return a.model.set("date", b.date), a.$date.datepicker("hide")
                    }
                }(this)).on("hide", function(a) {
                    return function() {
                        return a.$date.data("showDatepicker", !1)
                    }
                }(this)), this.$date.data("showDatepicker", !0)), !0
            }, d.prototype.parseEntry = function() {
                var a, b, c, d, e, f;
                return e = {}, f = !1, d = this.$contentInput.val().trim(), d || (f = !0, e["entry-content-input"] = "entryCreatorErrorContentNotNull"), a = +this.$amountInput.val().trim(), b = /^\d+(\.\d{0,2})?$/, a > 0 && b.test(a) || (f = !0, e["entry-amount-input"] = "entryCreatorErrorAmountNotNull"), c = {content: d,amount: a >= 0 ? a : "",note: this.$noteInput.val().trim()}, this.model.set(c), f ? e : null
            }, d.prototype.switchVisible = function(a) {
                var b;
                return b = $(a.currentTarget), this.model.set("visiable", b.data("type")), this
            }, d.prototype.submit = function(a) {
                var b, c, d, e;
                if (null != a && a.preventDefault(), !this.$submit.prop("disabled")) {
                    if (c = "validate-error", this.$("." + c).removeClass(c), b = this.parseEntry()) {
                        for (d in b)
                            e = b[d], this.$("." + d).addClass(c);
                        return void this.$("." + c).first().focusAtEnd()
                    }
                    return this.disableSubmit(), this.model.save(null, {attrs: this.model.toJSON(),wait: !0,error: function(a) {
                        return function(b, c) {
                            return a.enableSubmit(), c.status = "error", Essage.show(c, 2e3)
                        }
                    }(this),success: function(a) {
                        return function(b) {
                            return a.isUpdate || a.localCache.remove(a.localCacheId), a.enableSubmit(), a.close(), n.trigger(":new:" + b.urlRoot + "/" + b.get("_projectId"), b.toJSON())
                        }
                    }(this)})
                }
            }, d.prototype.disableSubmit = function() {
                return this.$submit.attr("disabled", "disabled")
            }, d.prototype.enableSubmit = function() {
                return this.$submit.removeAttr("disabled")
            }, d.prototype.cacheEntry = function() {
                var a;
                return a = this.model.toJSON(), this.localCache(this.localCacheId, a), this
            }, d.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, d
        }(l)
    }), define("views/bookkeeping/entry-menu/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="list entry-menu-list"> ';
            return a.approveRight > 0 && (b += " <li> ", b += "confirmed" == a.status ? ' <a class="approve-entry-handler" data-gta="event" data-label="bkp menu approve"> <span class="icon icon-share-stroke"></span>批准账目 </a> ' : ' <a class="revoke-entry-handler" data-gta="event" data-label="bkp menu revoke"> <span class="icon icon-repeat-bold"></span>撤销账目 </a> ', b += " </li> "), b += " ", a.editRight > 0 ? (b += ' <li> <a class="edit-entry-handler" data-gta="event" data-label="bkp menu edit"> <span class="icon icon-pencil"></span>编辑账目 </a> </li> <li> <a class="archive-entry-handler" data-gta="event" data-label="bkp menu archive"> <span class="icon icon-archive"></span>归档账目 </a> </li> <li> <a class="delete-entry-handler" data-gta="event" data-label="bkp menu delete"> <span class="icon icon-trash"></span>删除账目 </a> </li> <li class="divider"></li> <li> ', "members" == a.visiable || "all" == a.visiable ? b += ' <a class="switch-visible-handler" data-type="involves" data-gta="event" data-label="bkp menu visible involves"> <span class="icon icon-lock2"></span>转换为参与者可见 </a> ' : "involves" == a.visiable && (b += ' <a class="switch-visible-handler" data-type="members" data-gta="event" data-label="bkp menu visible members"> <span class="icon icon-users-bold"></span>转换为所有成员可见 </a> '), b += " </li> ") : "approved:2" == a.editRight && (b += ' <li> <a class="archive-entry-handler" data-gta="entry" data-gta="event" data-label="bkp menu archive"> <span class="icon icon-archive"></span>归档账目 </a> </li> '), b += "</ul>"
        }
    }), define("views/bookkeeping/entry-menu/templates/delete", [], function() {
        return function() {
            var a = '<form class="entry-delete-form"> <p>确定要删除这个账目吗?</p> <button class="btn btn-danger" type="submit">删除</button></form>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/bookkeeping/entry-menu/index", ["require", "exports", "module", "./templates/basic", "./templates/delete", "views/bookkeeping/entry-creator/index", "lib/popover/index", "lib/window/index"], function(a) {
        var c, d, e, f, g, h;
        return c = a("./templates/basic"), d = a("./templates/delete"), e = a("views/bookkeeping/entry-creator/index"), g = a("lib/popover/index"), h = a("lib/window/index"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "EntryMenuView", f.prototype.popoverTitle = "记账菜单", f.prototype.events = {"click .edit-entry-handler": "openEditor","click .revoke-entry-handler": "revokeEntry","click .approve-entry-handler": "approveEntry","click .archive-entry-handler": "archiveEntry","click .delete-entry-handler": "enterDeleteSubMenu","click .switch-visible-handler": "switchVisible","submit .entry-delete-form": "submitDeleteForm"}, f.prototype.render = function() {
                var a;
                return this.entryModel = this.options.entryModel, this.bookkeepingModel = this.options.bookkeepingModel, a = this.entryModel.toJSON(), "list" !== this.options.status && (a.approveRight = this.bookkeepingModel.get("approveRight")), a.editRight = this.entryModel.getEditRight(), this.$el.html(c(a)), this
            }, f.prototype.openEditor = function() {
                return this.hide(), this.parentView.requestSubView(h).open(e, {_entryId: this.entryModel.id,type: this.entryModel.get("type")}), this.remove()
            }, f.prototype.approveEntry = function() {
                return this.entryModel.approve({success: function(a) {
                    return function() {
                        return a.remove(), Essage.show({message: "成功审核了账目",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, f.prototype.revokeEntry = function() {
                return this.entryModel.revoke({success: function(a) {
                    return function() {
                        return a.remove(), Essage.show({message: "成功撤销了账目",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, f.prototype.archiveEntry = function() {
                return this.entryModel.archive({success: function(a) {
                    return function() {
                        return a.remove(), Essage.show({message: "成功归档了账目",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, f.prototype.enterDeleteSubMenu = function() {
                return this.enterSubMenu("删除账目", function(a) {
                    return function() {
                        return a.$el.html(d())
                    }
                }(this)), this
            }, f.prototype.submitDeleteForm = function(a) {
                return a.preventDefault(), this.entryModel.destroy({success: function(a) {
                    return function() {
                        return a.remove(), Essage.show({message: "删除成功",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, f.prototype.switchVisible = function(a) {
                var b;
                return b = $(a.currentTarget), this.entryModel.saveAttr("visiable", b.data("type"), {success: function(a) {
                    return function() {
                        return a.remove(), Essage.show({message: "设置成功",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, f
        }(g)
    }), define("views/bookkeeping/entry-detail/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="entry-detail-content"> <div class="entry-set entry-detail-info"></div> <div class="entry-set entry-detail-tags-set"></div> <div class="entry-set entry-detail-involve-set"></div></div><div class="activity-creator-wrapper"></div>';
            return (a.approveRight || a.editRight > 0 || "approved:2" == a.editRight) && (b += ' <a class="menu-handler" data-toggle="popover" > <span class="icon icon-chevron-down"></span> </a>'), b
        }
    }), define("views/bookkeeping/entry-detail/templates/info", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="entry-info-set entry-content"> <span class="icon icon-' + a.category.iconStr + " ";
            return c += 1 == a.type ? "income" : "expense", c += '"></span> <span class="entry-content-case">' + b(a.content) + '</span></div><div class="entry-info-set entry-note"> ', c += a.note ? ' <span class="entry-note-case">' + b(a.note) + "</span> " : ' <span class="entry-note-case placeholder">（还有没添加备忘）</span> ', c += '</div><div class="entry-info-set entry-detail-other"> <div class="entry-other-2-1"> <div class="entry-date"> <span class="icon icon-calendar"></span> <span class="entry-date-case">' + a.dateStr + "</span> </div> ", a.receiver && (c += ' <div class="entry-receiver"> <span class="icon icon-user"></span> <span class="entry-receiver-case">' + a.receiver + "</span> </div> "), c += ' </div> <div class="entry-other-2-1"> <div class="entry-amount"> <span class="entry-amount-unit">￥</span> <span class="entry-amount-case">' + a.amount + "</span> </div> <div> ", _.isNumber(a.cost) && a.cost >= 0 && (c += ' <span class="entry-cost"> <span class="entry-cost-tips">成本</span> <span class="entry-cost-unit">￥</span> <span class="entry-cost-case">' + a.cost + "</span> </span> "), c += " ", _.isNumber(a.profit) && a.profit >= 0 && (c += ' <span class="entry-profit"> <span class="entry-profit-tips">利润</span> <span class="entry-profit-case">' + a.profit + '</span> <span class="entry-profit-unit">%</span> </span> '), c += " </div> </div></div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/bookkeeping/entry-detail/index", ["require", "exports", "module", "teambition", "views/activity/activity-timeline/index", "views/member/member-involve/index", "thenjs", "util", "view", "models/bookkeeping", "models/entry", "models/project", "collections/bookkeepings", "collections/entries", "collections/entry-categories", "collections/members", "views/bookkeeping/entry-menu/index", "views/events/event-menu/index", "views/core/popover-menu/index", "views/tag/tag-picker/index", "./templates/basic", "./templates/info"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w;
        return w = a("teambition"), c = a("views/activity/activity-timeline/index"), o = a("views/member/member-involve/index"), t = a("thenjs"), u = a("util"), v = a("view"), e = a("models/bookkeeping"), k = a("models/entry"), r = a("models/project"), f = a("collections/bookkeepings"), g = a("collections/entries"), h = a("collections/entry-categories"), p = a("collections/members"), j = a("views/bookkeeping/entry-menu/index"), l = a("views/events/event-menu/index"), q = a("views/core/popover-menu/index"), s = a("views/tag/tag-picker/index"), d = a("./templates/basic"), m = a("./templates/info"), n = "ZH", i = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "EntryDetailView", e.prototype.tagName = "div", e.prototype.className = "entry-detail-view thin-scroll fade", e.prototype.events = {"click .menu-handler": "toggleMenu",mousewheel: u.mousewheel}, e.prototype.initialize = function(a) {
                if (!(null != a ? a._entryId : void 0))
                    throw new Error("wrong options");
                return this.options = a, this._entryId = a._entryId, this.load({success: function(a) {
                    return function() {
                        var b;
                        return a.listen(), a.renderBasic().renderInfo().refreshStatus(), a.renderActivities().initInvolve().initTagPicker(), "function" == typeof (b = a.options).success ? b.success(a) : void 0
                    }
                }(this)}), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this))
            }, e.prototype.load = function(a) {
                return this.showLoadingIndicator(), t(function(a) {
                    return function(b) {
                        return k.fetch(a._entryId, {success: function(c) {
                            return a.entryModel = c, a._projectId = a.entryModel.get("_projectId"), b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return f.fetch(a._projectId, {success: function(c) {
                            return a.bookkeepingModel = c.models[0], a.displayFields = a.bookkeepingModel.getDisplayFields(), b()
                        },error: function(a, c) {
                            return b(c, null)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return h.fetch(a._projectId, {success: function(c) {
                            return a.entryCategoriesCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return p.fetch(a._projectId, {success: function(c) {
                            return a.membersCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function(b) {
                    return function() {
                        return b.hideLoadingIndicator(), null != a && "function" == typeof a.success ? a.success() : void 0
                    }
                }(this)).fail(function(a) {
                    return function(b, c) {
                        return console.error(c), a.close()
                    }
                }(this))
            }, e.prototype.listen = function() {
                var a;
                return this.stopListening(), this.options.onEventDelete && this.listenTo(this.entryModel, "remove", this.options.onEventDelete), this.options.onEventChange && this.listenTo(this.entryModel, "change", this.options.onEventChange), this.listenTo(this.entryModel, "remove destroy", this.close), a = "change:content change:category change:date change:amount change:note", this.listenTo(this.entryModel, a, this.renderInfo), this.listenTo(this.entryModel, "change:isArchived", function(a) {
                    return function(b) {
                        return b.get("isArchived") ? a.close() : void 0
                    }
                }(this)), this.listenTo(this.entryModel, "change:status", this.refreshStatus), this
            }, e.prototype.renderBasic = function() {
                var a;
                return a = this.entryModel.toJSON(), a.approveRight = this.bookkeepingModel.get("approveRight"), a.editRight = this.entryModel.getEditRight(), this.$el.html(d(a)), this.$info = this.$(".entry-detail-info"), this.$activityCreator = this.$(".activity-creator-wrapper"), this
            }, e.prototype.renderInfo = function() {
                var a, b;
                return a = this.entryModel.toJSON(), a.category = this.entryCategoriesCollection.getCategory(a._entryCategoryId).toJSON(), a.creator || (a.creator = {}), a.dateStr = (null != (b = u.formatDate(a.date)) ? b.dateString : void 0) || "", this.$info.html(m(a)), this
            }, e.prototype.refreshStatus = function() {
                return "approved" === this.entryModel.get("status") ? this.$el.addClass("approved") : this.$el.removeClass("approved"), this
            }, e.prototype.renderActivities = function() {
                return this.activityTimelineView = this.requestSubView(c, {boundToObjectType: "entry",_projectId: this._projectId,objectModel: this.entryModel,$scrollFrame: this.$el}), this.activityTimelineView.$el.appendTo(this.$(".entry-detail-content")), this
            }, e.prototype.initInvolve = function() {
                return this.involveView = this.requestSubView(o, {_projectId: this._projectId,objectModel: this.entryModel,membersCollection: this.membersCollection,dropArea: this.$el,undeletable: !1}), this.involveView.$el.prependTo(this.$(".entry-detail-involve-set")), this
            }, e.prototype.initTagPicker = function() {
                return this.taPickerView = this.requestSubView(s, {_projectId: this._projectId,objectModel: this.entryModel}), this.taPickerView.$el.prependTo(this.$(".entry-detail-tags-set")), this
            }, e.prototype.toggleMenu = function(a) {
                var b;
                return b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(j, {$toggler: b,entryModel: this.entryModel,bookkeepingModel: this.bookkeepingModel,onShown: function(a) {
                    return function() {
                        return a.$el.addClass("active")
                    }
                }(this),onHidden: function(a) {
                    return function() {
                        return a.$el.removeClass("active")
                    }
                }(this)}).show(), this
            }, e.prototype.close = function() {
                var a, b;
                return "EntryDetailPanelView" === (null != (b = this.parentView) ? b.viewName : void 0) ? "function" == typeof (a = this.parentView).back && a.back() : this.remove(), this
            }, e.prototype.remove = function() {
                var a, b;
                return null != (b = this.$activityCreator) && b.remove(), this.entryModel && (a = w.router.getUrl().replace("/entry/" + this.entryModel.id, ""), w.router.navigate(a, {trigger: !1})), e.__super__.remove.apply(this, arguments)
            }, e
        }(v)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/bookkeeping/entry-detail-panel/index", ["require", "exports", "module", "views/bookkeeping/entry-detail/index", "lib/panel/index"], function(a) {
        var c, d, e;
        return c = a("views/bookkeeping/entry-detail/index"), e = a("lib/panel/index"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "EntryDetailPanelView", d.prototype.className = "entry-detail-panel panel-view", d.prototype.defaultLayer = c, d.prototype.initialize = function(a) {
                if (!(null != a ? a._entryId : void 0))
                    throw new Error("" + this.viewName + ":options should have _entryId");
                return this._entryId = a._entryId, _.isNumber(a.rightOffset) && (this.rightOffset = a.rightOffset), d.__super__.initialize.apply(this, arguments)
            }, d.prototype.isSame = function(a) {
                var b;
                return b = a._entryId, b === this._entryId
            }, d
        }(e)
    }), define("views/bookkeeping/entry/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="entry-wrap"> ', d = a.displayFields;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; ) {
                    if (e = d[f += 1], c += ' <div class="entry-' + e.attr + '"> ', "category" == e.attr)
                        c += ' <span class="entry-category-icon icon icon-' + a.entry.category.iconStr + " ", c += 1 == a.entry.category.type ? "income" : "expense", c += '"></span> <span class="entry-category-title">' + b(a.entry.category.title) + "</span> ";
                    else if ("content" == e.attr) {
                        c += " ", "involves" == a.entry.visiable && (c += ' <span class="icon icon-lock2 hinted" data-title="仅参与者可见"></span> '), c += ' <span class="entry-content-case">' + b(a.entry[e.attr]) + "</span> ";
                        var h = a.tags;
                        if (h)
                            for (var i, j = -1, k = h.length - 1; k > j; )
                                i = h[j += 1], c += ' <span class="label tag"> <span class="tag-label tag-label-' + i.color + '"></span> <span class="tag-name">' + b(i.name) + "</span> </span> ";
                        c += " "
                    } else
                        "creator" == e.attr ? c += " " + b(a.entry.creator.name) + " " : "amount" == e.attr ? (c += ' <strong class="', c += 1 == a.entry.type ? "income" : "expense", c += '">' + a.entry[e.attr] + "</strong> ") : c += "date" == e.attr ? " " + a.entry.dateStr + " " : " " + b(a.entry[e.attr]) + " ";
                    c += " </div> "
                }
            return c += " ", a.noSettings || (c += ' <div class="entry-status"> ', "approved" == a.entry.status && (c += " 已审核 "), c += " </div> ", (a.approveRight > 0 || a.editRight > 0) && (c += ' <div class="entry-settings"> ', a.approveRight > 0 && (c += " ", c += "approved" == a.entry.status ? ' <a class="entry-handler" data-type="revoke">撤销</a> ' : ' <a class="entry-handler" data-type="approve">审核</a> ', c += " "), c += " ", c += a.editRight > 0 ? ' <a class="entry-handler icon icon-chevron-down hinted" data-type="menu" data-title="更多操作"></a> ' : ' <span class="entry-handler icon icon-chevron-down entry-icon-empty"></span> ', c += " </div> "), c += " "), c += "</div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/bookkeeping/entry/index", ["require", "exports", "module", "teambition", "thenjs", "util", "view", "models/bookkeeping", "models/entry-category", "models/entry", "collections/bookkeepings", "collections/entries", "collections/entry-categories", "collections/tags", "views/bookkeeping/entry-menu/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p;
        return p = a("teambition"), m = a("thenjs"), n = a("util"), o = a("view"), d = a("models/bookkeeping"), h = a("models/entry-category"), j = a("models/entry"), e = a("collections/bookkeepings"), f = a("collections/entries"), g = a("collections/entry-categories"), l = a("collections/tags"), i = a("views/bookkeeping/entry-menu/index"), c = a("./templates/basic"), k = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "EntryView", d.prototype.tagName = "li", d.prototype.className = "entry-view", d.prototype.events = {"click .entry-handler": "handler"}, d.prototype.initialize = function(a) {
                if (!(null != a ? a._entryId : void 0))
                    throw new Error("" + this.viewName + ":wrong options");
                return this.options = a, this._entryId = a._entryId, a.displayFields && (this.displayFields = a.displayFields, this.noSettings = !0), this.load({success: function(a) {
                    return function() {
                        return a.listen().renderBasic()
                    }
                }(this)}), this.$el.attr("data-id", this._entryId).addClass(a.viewType)
            }, d.prototype.load = function(a) {
                return m(function(a) {
                    return function(b) {
                        return j.fetch(a._entryId, {success: function(c) {
                            return a.entryModel = c, a._projectId = c.get("_projectId"), b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return e.fetch(a._projectId, {success: function(c) {
                            return a.bookkeepingModel = c.at(0), a.displayFields || (a.displayFields = a.bookkeepingModel.getDisplayFields()), b()
                        },error: function(a, c) {
                            return b(c, null)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return g.fetch(a._projectId, {success: function(c) {
                            return a.entryCategoriesCollection = c, a.entryCategoryModel = a.entryCategoriesCollection.getCategory(a.entryModel.get("_entryCategoryId")), b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return l.fetch(a._projectId, {success: function(c) {
                            return a.tagsCollection = c, b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function() {
                    return function() {
                        return null != a && "function" == typeof a.success ? a.success() : void 0
                    }
                }(this))
            }, d.prototype.listen = function() {
                return this.stopListening(), this.listenTo(this.bookkeepingModel, "change:approveRight", this.renderBasic), this.listenTo(this.entryModel, "change", this.renderBasic), this.listenTo(this.entryModel, "remove", this.remove), this.listenTo(this.entryCategoryModel, "change", this.renderBasic), this.listenTo(this.entryModel, "change:_entryCategoryId", function(a) {
                    return function() {
                        return a.entryCategoryModel = a.entryCategoriesCollection.getCategory(a.entryModel.get("_entryCategoryId")), a.listen()
                    }
                }(this)), this.listenTo(this.entryCategoryModel, "remove destroy", function(a) {
                    return function() {
                        return a.entryCategoryModel = a.entryCategoriesCollection.getCategory(a.entryModel.get("_entryCategoryId")), a.listen(), a.renderBasic()
                    }
                }(this)), this
            }, d.prototype.renderBasic = function() {
                var a, b, d, e, f, g, h, i, j, k;
                for (this.$el.removeClass("active"), d = this.entryModel.toJSON(), d.category = this.entryCategoryModel.toJSON(), d.creator || (d.creator = {}), f = [], i = d.tagIds, g = 0, h = i.length; h > g; g++)
                    k = i[g], e = this.tagsCollection.get(k), e && f.push(e.toJSON());
                return a = {displayFields: this.displayFields,noSettings: this.noSettings,entry: d,approveRight: this.bookkeepingModel.get("approveRight"),tags: f,editRight: this.entryModel.getEditRight()}, a.entry.dateStr = (b = this.entryModel.get("date")) ? null != (j = n.formatDate(b)) ? j.dateString : void 0 : "", this.$el.html(c(a)), this
            }, d.prototype.handler = function(a) {
                var b, c;
                return b = this.$(a.currentTarget), (c = b.data("type")) ? ("approve" === c ? this.entryModel.approve() : "revoke" === c ? this.entryModel.revoke() : "menu" === c && this.toggleMenu(a), !1) : void 0
            }, d.prototype.toggleMenu = function(a) {
                var b;
                return b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(i, {status: "list",$toggler: b,entryModel: this.entryModel,onShown: function(a) {
                    return function() {
                        return a.$el.addClass("active")
                    }
                }(this),onHidden: function(a) {
                    return function() {
                        return a.$el.removeClass("active")
                    }
                }(this)}).show(), this
            }, d
        }(o)
    }), define("views/bookkeeping/bookkeeping/templates/basic", [], function() {
        return function() {
            var a = '<div class="test"></div><div class="bookkeeping-header-tips"> <div class="bookkeeping-header-tips-fixed body-wrap"> <div class="bookkeeping-header-tips-wrap card"> 当前账目还未设置审批人，只有审批人才能对账目进行审批，<a class=\'bookkeping-setting-approver\'>设置审批人</a> <a class="bookkeeping-header-tips-close icon icon-remove pull-right" data-gta="event" data-label="bkp home header tips"></a> </div> </div></div><div class="bookkeeping-header"> <div class="bookkeeping-header-fixed  body-wrap"> <div class="bookkeeping-header-wrap"> <a class="bookkeeping-creator link-add-handler hide" data-type="-1" data-gta="event" data-label="bkp home creator expense"> <span class="icon icon-expense"></span> <span>记录支出</span> </a> <a class="bookkeeping-creator link-add-handler hide" data-type="1" data-gta="event" data-label="bkp home creator income"> <span class="icon icon-income"></span> <span>记录收入</span> </a> <a class="bookkeeping-panel-toggler pull-right" data-gta="event" data-label="bkp home panel toggle"> <span class="filtering-state">（已筛选）</span> <span>筛选和设置</span> <span class="icon icon-chevron-down"></span> </a> </div> </div></div><div class="bookkeeping-content card"></div><div class="bookkeeping-placeholder"> <span class="icon icon-bookkeeping"></span> <br /> <span>轻松记录每一笔开支</span> <br /> <span class="bookkeeping-approve-tips"> （只有审批人可以对账目进行审批，记账开始请先<a class=\'bookkeping-setting-approver\'>设置审批人</a>） </span></div>';
            return a
        }
    }), define("views/bookkeeping/bookkeeping/templates/content", [], function() {
        return function(a) {
            var b = '<header class="bookkeeping-content-header"> <div  class="bookkeeping-content-header-fixed body-wrap"> <div class="bookkeeping-content-header-wrap"> ', c = a;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += ' <div class="entry-' + d.attr + '"> ', b += d.isSort ? ' <a class="bookkeeping-sort" data-orderby="' + d.attr + '">' + d.title + "</a> " : " " + d.title + " ", b += " </div> ";
            return b += ' </div> </div></header><section> <ul class="bookkeeping-list"></ul></section><footer class="bookkeeping-content-footer body-wrap"> <div class="pull-left bookkeeping-expense"> <span class="bookkeeping-total-normal">总支出</span> <span class="bookkeeping-total-filtering">筛选后支出</span> <br /> <span class="bookkeeping-amount">0</span> </div> <div class="pull-left bookkeeping-income"> <span class="bookkeeping-total-normal">总收入</span> <span class="bookkeeping-total-filtering">筛选后收入</span> <br /> <span class="bookkeeping-amount">0</span> </div></footer>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/bookkeeping/bookkeeping/index", ["require", "exports", "module", "teambition", "lib/scrollable", "thenjs", "util", "view", "models/bookkeeping", "models/project", "collections/bookkeepings", "collections/entries", "collections/entry-categories", "views/bookkeeping/bookkeeping-panel/index", "views/bookkeeping/entry-creator/index", "views/bookkeeping/entry-detail-panel/index", "views/bookkeeping/entry/index", "views/bookkeeping/bookkeeping-settings/approver/index", "views/bookkeeping/bookkeeping-settings/displayFields/index", "lib/window/index", "./templates/basic", "./templates/content"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x;
        return x = a("teambition"), p = a("lib/scrollable"), s = a("thenjs"), t = a("util"), u = a("view"), e = a("models/bookkeeping"), o = a("models/project"), h = a("collections/bookkeepings"), j = a("collections/entries"), k = a("collections/entry-categories"), f = a("views/bookkeeping/bookkeeping-panel/index"), l = a("views/bookkeeping/entry-creator/index"), m = a("views/bookkeeping/entry-detail-panel/index"), n = a("views/bookkeeping/entry/index"), q = a("views/bookkeeping/bookkeeping-settings/approver/index"), r = a("views/bookkeeping/bookkeeping-settings/displayFields/index"), v = a("lib/window/index"), c = a("./templates/basic"), i = a("./templates/content"), w = {category: "_entryategoryId",creator: "_creatorId"}, g = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "BookkeepingView", e.prototype.tagName = "div", e.prototype.className = "bookkeeping-view fade body-wrap", e.prototype.order = "asc", e.prototype.orderBy = "update", e.prototype.routes = {"": "enterHome","entry/:_entryId": "enterHome","*paramString": "onRouteError"}, e.prototype.events = {"click .bookkeeping-creator": "openCreator","click .open-detail": "openDetail","click .bookkeeping-sort": "sortHandler","click .bookkeping-setting-approver": "openSettingsApprover","click .bookkeping-setting-displayFields": "openSettingsDisplayFields","click .bookkeeping-header-tips-close": "closeHeaderTips","click .bookkeeping-panel-toggler": "togglePanel"}, e.prototype.initialize = function(a) {
                return a ? (this.options = a, this._projectId = a._projectId, this.renderBasic(), this.load({success: function(a) {
                    return function() {
                        return a.listen().renderContent().renderItems().initCreator().initPanel().calculateAmount().checkPlaceholder().checkApproveTips()
                    }
                }(this)}), this.registerAsResponsive(), this.setupScroll(), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in"), a.layout()
                    }
                }(this), 100)) : void 0
            }, e.prototype.enterHome = function(a) {
                return this.openDetail(a, {isRouter: !0})
            }, e.prototype.onRouteError = function() {
                return x.router.home(), this
            }, e.prototype.layout = function() {
                var a, b;
                return a = $(window).height() - this.$content.offset().top, this.$content.css("min-height", "" + a + "px"), null != (b = this.bookkeepingPanel) && b.layout(), this
            }, e.prototype.load = function(a) {
                return this.showLoadingIndicator(this.$content, {isPrepend: !0}), s(function(a) {
                    return function(b) {
                        return h.fetch(a._projectId, {success: function(c) {
                            return a.bookkeepingModel = c.at(0), b()
                        },error: function(a, c) {
                            return b(c, null)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return j.fetch(a._projectId, {success: function(c) {
                            return a.entriesCollection = c, b()
                        },error: function(a, c) {
                            return b(c, null)
                        }})
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return k.fetch(a._projectId, {success: function(c) {
                            return a.entryCategoriesCollection = c, b()
                        },error: function(a, c) {
                            return b(c, null)
                        }})
                    }
                }(this)).then(function(b) {
                    return function() {
                        return b.hideLoadingIndicator(), null != a && "function" == typeof a.success ? a.success() : void 0
                    }
                }(this)).fail(function() {
                    return function(a, b) {
                        return console.error(b)
                    }
                }(this)), this
            }, e.prototype.loadMore = function(a) {
                return this.entriesCollection.loadMore({silent: !0,beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$itemList)
                    }
                }(this),success: function(b) {
                    return function(c, d) {
                        return b.hideLoadingIndicator({animated: !0}), b.renderItems(d), b.bookkeepingPanel.refilter(), b.calculateAmount(), b.entriesCollection.hasMore && "function" == typeof a ? a() : void 0
                    }
                }(this)}), this
            }, e.prototype.listen = function() {
                return this.stopListening(), this.listenTo(this.bookkeepingModel, "change:displayFields", function(a) {
                    return function() {
                        return a.renderContent(), a.renderItems(), a.bookkeepingPanel.filterEntries(), a.calculateAmount()
                    }
                }(this)), this.listenTo(this.bookkeepingModel, "change:tipsClosed change:_approverIds", this.checkApproveTips), this.listenTo(this.entriesCollection, "add", function(a) {
                    return function(b) {
                        return a.renderItems(b, !0)
                    }
                }(this)), this.listenTo(this.entriesCollection, "add remove", function(a) {
                    return function() {
                        return a.checkPlaceholder(), a.checkApproveTips()
                    }
                }(this)), this.listenTo(this.entriesCollection, "add change:amount remove", function(a) {
                    return function() {
                        return a.calculateAmount()
                    }
                }(this)), this.listenTo(this.entriesCollection, "remove", this.removeItem), this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$content = this.$(".bookkeeping-content"), this
            }, e.prototype.renderContent = function() {
                var a;
                return a = this.bookkeepingModel.getDisplayFields(), this.$content.html(i(a)), this.$itemList = this.$content.find(".bookkeeping-list"), this.$placeholder = this.$(".bookkeeping-placeholder"), this
            }, e.prototype.renderItems = function(a, b) {
                var c, d;
                return this.renderSort(), a && _.isArray(a) ? c = a : a ? c = [a] : (this.$itemList.empty(), d = (w[this.orderBy] ? w[this.orderBy] : void 0) || this.orderBy, this.entriesCollection.orderBy = d, this.entriesCollection.sort(), c = this.entriesCollection.toJSON(), "desc" === this.order && c.reverse()), _.each(c, function(a) {
                    return function(c) {
                        return a.renderItem(c, b)
                    }
                }(this)), this
            }, e.prototype.renderItem = function(a, b) {
                var c, d, e;
                return e = a.id || a._id, d = this.$itemList.find(".entry-view[data-id=" + e + "]"), c = this.requestSubView(n, {_entryId: e,viewType: "open-detail"}).$el, d.length ? d.replaceWith(c) : c[b === !0 ? "prependTo" : "appendTo"](this.$itemList), this
            }, e.prototype.removeItem = function(a) {
                var b;
                return b = a.id || a._id, this.$itemList.find(".entry-view[data-id=" + b + "]").remove(), this
            }, e.prototype.renderSort = function() {
                var a, b, c, d;
                return c = this.order, d = this.orderBy, b = ".bookkeeping-sort", this.$el.find("" + b + ".dropup").removeClass("dropup"), this.$el.find("" + b + " .caret").remove(), a = this.$el.find("" + b + "[data-orderby='" + d + "']"), a.append("<span class='caret'></span>"), "asc" === c && a.addClass("dropup"), this
            }, e.prototype.initCreator = function() {
                return this.bookkeepingModel.hasRight() >= 0 && this.$(".bookkeeping-creator").removeClass("hide"), this
            }, e.prototype.initPanel = function() {
                var a;
                return null != (a = this.bookkeepingPanel) && a.remove(), this.bookkeepingPanel = this.requestSubView(f, {_projectId: this._projectId}), this.listenTo(this.bookkeepingPanel, "filtering", function(a) {
                    return function() {
                        return a.isFiltering = !0, a.$el.addClass("filtering"), a.calculateAmount()
                    }
                }(this)), this.listenTo(this.bookkeepingPanel, "stopFilter", function(a) {
                    return function() {
                        return a.isFiltering = !1, a.$el.removeClass("filtering"), a.calculateAmount()
                    }
                }(this)), this.listenTo(this.bookkeepingPanel, "show", function(a) {
                    return function() {
                        return a.$el.addClass("pannel-showing")
                    }
                }(this)), this.listenTo(this.bookkeepingPanel, "hide", function(a) {
                    return function() {
                        return a.$el.removeClass("pannel-showing")
                    }
                }(this)), this.bookkeepingPanel.$el.appendTo(this.$(".bookkeeping-header-wrap")), this
            }, e.prototype.calculateAmount = function() {
                var a, b, c;
                return a = 0, c = 0, this.isFiltering ? (b = [], this.$itemList.children().filter(":visible").each(function() {
                    var a, c;
                    return a = $(this), c = a.data("id"), c ? b.push(c) : void 0
                }), this.entriesCollection.each(function(e) {
                    var f;
                    if (f = e.id, !(d.call(b, f) < 0))
                        return -1 === e.get("type") ? a += e.get("amount") || 0 : c += e.get("amount") || 0
                })) : this.entriesCollection.each(function(b) {
                    return -1 === b.get("type") ? a += b.get("amount") || 0 : c += b.get("amount") || 0
                }), this.$(".bookkeeping-expense .bookkeeping-amount").text(a.toFixed(2)), this.$(".bookkeeping-income .bookkeeping-amount").text(c.toFixed(2)), this
            }, e.prototype.checkApproveTips = function() {
                var a, b, c, d, e, f;
                return e = this.bookkeepingModel, c = this.entriesCollection, a = this.$(".bookkeeping-header-tips"), b = this.$(".bookkeeping-approve-tips"), f = "header-tips-showing", d = this.bookkeepingModel.isAdmin(), 0 === e.get("_approverIds").length && c.length && d && !e.get("tipsClosed") ? (a.show(), this.layout()) : (a.hide(), this.layout()), 0 === e.get("_approverIds").length && 0 === c.length && d ? b.show() : b.hide(), this
            }, e.prototype.checkPlaceholder = function() {
                var a;
                return a = this.entriesCollection.length > 0 ? "hide" : "show", this.$placeholder[a](), this
            }, e.prototype.openCreator = function(a) {
                var b, c;
                return (null != a ? a.currentTarget : void 0) ? (b = this.$(a.currentTarget), c = b.data("type")) : c = a, c = parseInt(c), 1 === c || -1 === c ? this.requestSubView(v).open(l, {backdrop: "static",type: c,_projectId: this._projectId}) : void 0
            }, e.prototype.openSettingsDisplayFields = function() {
                return this.requestSubView(v).open(r, {bookkeepingModel: this.bookkeepingModel})
            }, e.prototype.openSettingsApprover = function() {
                return this.requestSubView(v).open(q, {bookkeepingModel: this.bookkeepingModel})
            }, e.prototype.openDetail = function(a, b) {
                var c, d, e;
                return (null != a ? a.currentTarget : void 0) ? (c = $(a.currentTarget), d = c.data("id")) : d = a, d ? (x.APP.showPanel(m, {_entryId: d}), (null != b ? b.isRouter : void 0) ? void 0 : (e = x.router.getPrefix() + ("/bookkeeping/entry/" + d), x.router.navigate(e))) : void 0
            }, e.prototype.closeHeaderTips = function() {
                return this.bookkeepingModel.set("tipsClosed", !0), this
            }, e.prototype.togglePanel = function() {
                return this.bookkeepingPanel.toggle(), this
            }, e.prototype.sortHandler = function(a) {
                var b, c, e;
                return a.currentTarget ? (b = $(a.currentTarget), e = b.data("orderby")) : e = a, this.orderBy === e ? this.order = "asc" === this.order ? "desc" : "asc" : (this.orderBy = e, c = ["category", "content", "creator", "receiver"], this.order = d.call(c, e) >= 0 ? "asc" : "desc"), this.renderItems(), this.bookkeepingPanel.filterEntries()
            }, e
        }(u), _.extend(g.prototype, p), g
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/past-events-group", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return c = a("model"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "pastEventsGroup", c.prototype.urlRoot = "", c.prototype.idAttribute = "month", c.prototype.defaults = {month: "",count: 0}, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/past-events-groups", ["require", "exports", "module", "collection", "models/past-events-group"], function(a) {
        var c, d, e;
        return c = a("collection"), d = a("models/past-events-group"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "pastEventsGroups", c.prototype.model = d, c.prototype.comparator = function(a, b) {
                return a.get("month") - b.get("month")
            }, c.prototype.sync = function(a, b, d) {
                switch (a) {
                    case "read":
                        d.url = "events"
                }
                return c.__super__.sync.apply(this, arguments)
            }, c
        }(c)
    }), define("views/events/events-card/templates/basic", [], function() {
        return function(a) {
            var b = '<header class="events-card-header card-header"> <span class="witch-day">' + a.dayString + "</span> ";
            return a.dateString != a.dayString && (b += ' <span class="date"> · ' + a.dateString + "</span> "), b += '</header><section class="events-card-content"> <ul class="events-card-list"></ul></section>'
        }
    }), define("views/events/event/templates/basic", [], function() {
        return function() {
            var a = '<div class="event-time"></div><div class="event-content"> <div class="event-content-container"></div> <div class="involve-set"></div></div><a class="button more icon icon-chevron-right"></a>';
            return a
        }
    }), define("views/events/event/templates/info", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<h3 class="event-title">' + b(a.title) + "</h3>";
            return a.location && (c += ' <p class="event-place"> <span class="icon-location icon"></span> ' + b(a.location) + " </p>"), "involves" == a.visiable && (c += ' <span class="icon icon-lock2 hinted" data-title="仅参与者可见"></span>'), c
        }
    }), define("views/events/event/templates/time", [], function() {
        return function(a) {
            var b = " <time>" + a.startDateString + "</time> ";
            return a.endDateString && (b += " ~ <time>" + a.endDateString + "</time> "), b += " ", a.freqString && (b += ' <span class="label label-info event-recurrence"><span class="icon icon-repeat-bold"></span>' + a.freqString + "</span> "), b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/events/event/index", ["require", "exports", "module", "views/member/member-involve/index", "moment", "rrule", "util", "view", "collections/members", "./templates/basic", "./templates/info", "./templates/time"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m;
        return h = a("views/member/member-involve/index"), i = a("moment"), j = a("rrule"), l = a("util"), m = a("view"), g = a("collections/members"), c = a("./templates/basic"), e = a("./templates/info"), k = a("./templates/time"), f = "ZH", d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "Event", d.prototype.tagName = "li", d.prototype.className = "event-view clearfix", d.prototype.initialize = function(a) {
                return a.eventModel ? (this.options = a, this.eventModel = a.eventModel, this.renderBasic(), this.renderTime(), this.renderInfo(), this.renderInvolve(), this.listen(), this) : void 0
            }, d.prototype.listen = function() {
                return this.listenTo(this.eventModel, "change:title change:content change:location change:visiable", this.renderInfo), this.listenTo(this.eventModel, "change:startDate change:endDate change:_sourceId change:updated", this.renderTime), this.listenTo(this.eventModel, "destroy remove", this.remove), this
            }, d.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$el.attr({"data-gta": "event","data-id": this.eventModel.id,"data-label": "open event detail"}), this.$eventTime = this.$(".event-time"), this.$eventInfoContainer = this.$(".event-content-container"), this.$involveSet = this.$(".involve-set"), this
            }, d.prototype.renderTime = function() {
                var a, b, c, d, e, f, g;
                return a = this.eventModel.toJSON(), a.title = l.escape(a.title), a.content = l.escape(a.content), a.location = l.escape(a.location), a.startDateString = i(a.startDate).format("LT"), f = l.formatDate(new Date(a.startDate)).dateString, c = i("today" === this.eventModel.getScope() ? new Date : a.startDate), d = l.formatDate(c).dateString, f !== d && (a.startDateString = d + " " + a.startDateString), null != a.endDate && (b = l.formatDate(new Date(a.endDate)).dateString, a.endDateString = i(a.endDate).format("LT"), b !== d && (a.endDateString = b + " " + a.endDateString)), (e = null != (g = this.eventModel.isRecurrenceDelegate()) ? g.getRRule() : void 0) && (a.freqString = l.freq2Label(e).string), this.$eventTime.html(k(a)), this
            }, d.prototype.renderInfo = function() {
                var a;
                return a = this.eventModel.toJSON(), this.$eventInfoContainer.html(e(a)), this
            }, d.prototype.renderInvolve = function() {
                return this.requestSubView(h, {_projectId: this.eventModel.get("_projectId"),objectModel: this.eventModel,membersCollection: g.get(this.eventModel.get("_projectId")),dropArea: this.$el,undeletable: !1}).$el.prependTo(this.$involveSet), this
            }, d
        }(m)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/events/events-card/index", ["require", "exports", "module", "./templates/basic", "views/events/event/index", "collections/events", "moment", "util", "view"], function(a) {
        var c, d, e, f, g, h, i, j;
        return c = a("./templates/basic"), d = a("views/events/event/index"), e = a("collections/events"), h = a("moment"), i = a("util"), j = a("view"), g = "ZH", f = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "EventsCard", e.prototype.tagName = "div", e.prototype.className = "events-card card", e.prototype.initialize = function(a) {
                return a.day ? (this.day = a.day, this.cache = {}, this.renderBasic(), this.$el.attr("data-date", a.day), this) : void 0
            }, e.prototype.renderBasic = function() {
                var a, b;
                return b = "ZH" === g ? "MMMDo" : "MMM Do", a = h(this.day, "YYYYMMDD"), this.$el.html(c({dayString: a.calendar(),dateString: a.format(b)})), this.$eventList = this.$(".events-card-list"), this
            }, e.prototype.listen = function(a) {
                return this.listenTo(a, "destroy remove", this.removeEvent), this
            }, e.prototype.addEvent = function(a) {
                var b, c, e, f, g;
                if (null != (g = this.cache[a.id]) && g.remove(), e = this.cache[a.id] = this.requestSubView(d, {eventModel: a}), f = h(a.get("startDate")).valueOf(), e.$el.data("timestamp", f), b = this.$eventList.find(".event-view:first"), b.length)
                    if (f < b.data("timestamp"))
                        e.$el.insertBefore(b);
                    else {
                        for (c = b.next(); c.length && f > c.data("timestamp"); )
                            b = c, c = b.next();
                        e.$el.insertAfter(b)
                    }
                else
                    e.$el.appendTo(this.$eventList);
                return this.listen(a), e.$el
            }, e.prototype.removeEvent = function(a) {
                var b, c;
                return this.stopListening(a), null != (b = this.cache[a.id]) && b.remove(), delete this.cache[a.id], this.$eventList.children().length || null != (c = this.$el) && c.slideUp(300, "swing", function(a) {
                    return function() {
                        return a.remove()
                    }
                }(this)), this
            }, e
        }(j)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/events/event-detail-panel/index", ["require", "exports", "module", "views/events/event-detail/index", "lib/panel/index"], function(a) {
        var c, d, e;
        return d = a("views/events/event-detail/index"), e = a("lib/panel/index"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "EventDetailPanel", c.prototype.className = "event-detail-panel panel-view", c.prototype.defaultLayer = d, c.prototype.initialize = function(a) {
                return a && (a.eventModel || a._eventId) ? (this._eventId = a._eventId || a.eventModel.id, _.isNumber(a.rightOffset) && (this.rightOffset = a.rightOffset), c.__super__.initialize.apply(this, arguments)) : !1
            }, c.prototype.isSame = function(a) {
                var b, c;
                return b = a._eventId || (null != (c = a.eventModel) ? c.id : void 0), b === this._eventId
            }, c
        }(e)
    }), define("views/events/past-events/templates/basic", [], function() {
        return function() {
            var a = '<header class="past-events-header"> <div class="past-events-title"> 过去的日程・<span class="past-events-total">0</span> <a class="past-events-toggler" data-gta="event" data-label="events|toggle past events">显示</a> </div></header><div class="past-events-wrap card accordion"></div>';
            return a
        }
    }), define("views/events/past-events/templates/event", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="event-view clearfix" data-id="' + a._id + "\" data-gta='event' data-label='events|open past event detail'> <div class=\"event-time\"> <time>" + a.startDateString + "</time> ";
            return a.endDateString && (c += " <span> ~ </span> <time>" + a.endDateString + "</time> "), c += ' </div> <div class="event-content"> <h3 class="event-title">' + b(a.title) + "</h3> ", a.location && (c += ' <p class="event-place muted"> <span class="icon icon-location"></span> ' + b(a.location) + " </p> "), c += ' </div> <a class="button more icon icon-chevron-right"></a></li>'
        }
    }), define("views/events/past-events/templates/group", [], function() {
        return function(a) {
            var b = '<ul id="past-events-accordion"> ', c = a.groups;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += ' <li class="panel"> <div class="accordion-title collapsed" data-toggle="collapse" data-parent="#past-events-accordion" href="#past-events-group' + e + '" data-gta="event" data-label="events|show past events"> <span class="caret pull-left"></span> <span>' + d.monthString + '</span> </div> <div id="past-events-group' + e + '" class="collapse" data-month="' + d.month + '"> <ul class="accordion-list events-list"></ul> </div> </li> ';
            return b += "</ul>"
        }
    }), define("views/events/past-events/templates/placeholder", [], function() {
        return function() {
            var a = '<div class="event-placeholder placeholder muted"> <a class="icon icon-calendar"></a> <br /> 目前还没有日程</div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/events/past-events/index", ["require", "exports", "module", "moment", "util", "view", "collections/events", "collections/past-events-groups", "./templates/basic", "./templates/event", "./templates/group", "./templates/placeholder"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m;
        return h = a("moment"), l = a("util"), m = a("view"), e = a("collections/events"), i = a("collections/past-events-groups"), c = a("./templates/basic"), d = a("./templates/event"), f = a("./templates/group"), k = a("./templates/placeholder"), g = "ZH", j = function(a) {
            function g() {
                return g.__super__.constructor.apply(this, arguments)
            }
            return b(g, a), g.prototype.viewName = "PastEventsView", g.prototype.className = "past-events-view accordion", g.prototype.events = {"click .past-events-toggler": "togglePastEvents","show.bs.collapse": "loadPastEvents","hidden.bs.collapse": "clearPastEvents"}, g.prototype.initialize = function(a) {
                return a._projectId ? (this._projectId = a._projectId, this.renderBasic(), i.fetch(this._projectId, {attrs: {_projectId: this._projectId,group: !0,today: h().startOf("day").toISOString()},beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$el, {isPrepend: !1})
                    }
                }(this),success: function(a) {
                    return function(b) {
                        return a.$el ? (a.pastEventsGroupsCollection = b, a.hideLoadingIndicator(), a.renderGroup()) : void 0
                    }
                }(this)}), this) : !1
            }, g.prototype.listen = function(a, b) {
                return this.eventsCollection && this.stopListening(this.eventsCollection), this.eventsCollection = a, this.listenTo(a, "add", function(a) {
                    return function(c) {
                        return a.renderEvent(c, b)
                    }
                }(this)), this.listenTo(a, "destroy remove", function(a) {
                    return function(b) {
                        return a.$(".event-view[data-id=" + b.id + "]").remove()
                    }
                }(this)), this.listenTo(a, "change:startDate change:endDate", function(b) {
                    return function(c) {
                        var d, f, g;
                        return "past" !== c.getScope() ? (a.remove(c), null != (g = e.find(b._projectId)) ? g.add(c) : void 0) : (d = h(c.get("startDate")).format("YYYYMM"), f = e.find("" + b._projectId + "_" + d), f !== a ? (a.remove(c), null != f ? f.add(c) : void 0) : void 0)
                    }
                }(this)), this
            }, g.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$pastEvents = this.$(".past-events-wrap"), this
            }, g.prototype.renderGroup = function() {
                var a, b;
                return a = [], b = 0, _.each(this.pastEventsGroupsCollection.toJSON(), function(c) {
                    return c.count ? (b += c.count, c.monthString = h(c.month, "YYYYMM").format("YYYY年MM月"), a.push(c)) : void 0
                }), a.sort(function(a, b) {
                    return b.month - a.month
                }), this.$pastEvents.html(f({groups: a})), this.$(".past-events-total").text(b), this
            }, g.prototype.loadPastEvents = function(a) {
                var b, c, d, f, g, i;
                return this.clearPastEvents(a), c = $(a.target), b = c.find(".events-list"), f = c.data("month"), this.showLoadingIndicator(b, {isPrepend: !1}), d = h(f, "YYYYMM").startOf("month"), g = h(f, "YYYYMM").endOf("month"), i = h().subtract(1, "days").endOf("day"), d.isBefore(i) ? (g.isBefore(i) || (g = i), d = d.toISOString(), g = g.toISOString(), e.fetch("" + this._projectId + "_" + f, {silent: !0,fromDate: d,toDate: g,attrs: {_projectId: this._projectId,today: h().startOf("day").toISOString(),from: d,to: g},success: function(a) {
                    return function(c) {
                        return a.$el ? (a.hideLoadingIndicator(), c.each(function(c) {
                            return a.renderEvent(c, b)
                        }), a.listen(c, b)) : void 0
                    }
                }(this)}), this) : void 0
            }, g.prototype.clearPastEvents = function(a) {
                return this.eventsCollection && this.stopListening(this.eventsCollection), $(a.target).find(".events-list").empty(), this
            }, g.prototype.renderEvent = function(a, b) {
                var c, e, f, g, i, j;
                return e = a.toJSON(), g = "HH:mm", e.startDateString = h(e.startDate).format(g), i = l.formatDate(new Date(e.startDate)).dateString, e.startDateString = i + " " + e.startDateString, null != e.endDate && (f = l.formatDate(new Date(e.endDate)).dateString, e.endDateString = h(e.endDate).format(g), f !== i && (e.endDateString = f + " " + e.endDateString)), c = $(d(e)), c.data("model", a), j = b.find(".event[data-id=" + a.id + "]"), j.length ? j.replaceWith(c) : (j.remove(), c.appendTo(b)), this
            }, g.prototype.checkPlaceholder = function() {
                return this.$placeholder.remove(), this.eventsCollection.length || this.$el.html(this.$placeholder), this
            }, g.prototype.togglePastEvents = function(a) {
                var b;
                if (this.pastEventsGroupsCollection.length)
                    return this.$pastEvents.toggleClass("active"), b = this.$pastEvents.hasClass("active"), $(a.currentTarget).text(b ? "隐藏" : "显示"), b ? this.scrollToView(this.$pastEvents) : void 0
            }, g.prototype.scrollToView = function(a) {
                return _.delay(function(b) {
                    return function() {
                        var c;
                        return null != (c = b.parentView) && "function" == typeof c.slideTo ? c.slideTo(a, !0, 150) : void 0
                    }
                }(this)), this
            }, g
        }(m)
    }), define("views/events/events/templates/basic", [], function() {
        return function(a) {
            var b = "";
            return a.hasRight >= 0 && (b += '<div class="events-header body-wrap"> <div class="card"> <a class="event-create-handler link-add-handler" data-gta="event" data-label="events|add event"> <span class="icon icon-plus-sign"></span>添加日程</a> </div></div>'), b += '<div class="events-card-wrap"></div><div class="event-placeholder placeholder muted card"> <span class="icon icon-calendar"></span> <br /> 添加新日程，安排你的会议或其它活动</div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/events/events/index", ["require", "exports", "module", "teambition", "moment", "lib/scrollable", "view", "collections/events", "collections/members", "collections/past-events-groups", "collections/projects", "views/events/events-card/index", "views/events/event-creator/index", "views/events/event-detail-panel/index", "views/events/past-events/index", "lib/window/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q;
        return q = a("teambition"), j = a("moment"), n = a("lib/scrollable"), o = a("view"), g = a("collections/events"), i = a("collections/members"), k = a("collections/past-events-groups"), m = a("collections/projects"), f = a("views/events/events-card/index"), d = a("views/events/event-creator/index"), e = a("views/events/event-detail-panel/index"), l = a("views/events/past-events/index"), p = a("lib/window/index"), c = a("./templates/basic"), h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "EventsView", h.prototype.className = "events-view body-wrap fade", h.prototype.hotkeys = {c: "openEventCreator"}, h.prototype.routes = {"": "loadEvents","event/:_eventId": "loadEvents","*paramString": "home"}, h.prototype.events = {"click .event-create-handler": "openEventCreator","click .event-view": "openDetail"}, h.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this.options = a, this._projectId = this.options._projectId, this.projectModel = m.getOne(0, this._projectId), this.dayView = {}, this.eventsCollection = g.get(this._projectId, {boundToObjectType: "project"}), this.membersCollection = i.get(this._projectId), this.renderBasic().setupScroll(), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this) : void 0
            }, h.prototype.home = function() {
                return this.updateUrl({_eventId: null}, {trigger: !0})
            }, h.prototype.listen = function() {
                return this.listenTo(this.eventsCollection, "change:startDate change:endDate", function(a) {
                    return function(b) {
                        var c, d;
                        return "past" === b.getScope() ? (a.eventsCollection.remove(b), c = j(b.get("startDate")).format("YYYYMM"), null != (d = g.find("" + a._projectId + "_" + c)) ? d.add(b) : void 0) : b.OnDate !== b.getOnDate() ? (a.eventsCollection.remove(b), a.eventsCollection.add(b)) : void 0
                    }
                }(this)), this.listenTo(this.eventsCollection, "add", function(a) {
                    return function(b) {
                        var c;
                        return c = a.renderEvent(b), a.checkPlaceholder(), _.delay(function() {
                            return a.$el ? a.scrollToEvent(c) : void 0
                        }, 300)
                    }
                }(this)), this.listenTo(this.eventsCollection, "remove destroy", this.checkPlaceholder), this
            }, h.prototype.loadEvents = function(a) {
                return g.fetch(this._projectId, {silent: !0,attrs: {today: j().startOf("day").toISOString()},beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$el, {isPrepend: !1})
                    }
                }(this),success: function(b) {
                    return function(c) {
                        return b.$el ? (b.eventsCollection || (b.eventsCollection = c), b.hideLoadingIndicator(), b.checkPlaceholder(), b.renderEvents(), a && b.openDetail(a), b.initPastEvents(), b.listen()) : void 0
                    }
                }(this)}), this
            }, h.prototype.renderBasic = function() {
                var a;
                return a = this.projectModel.hasRight(), this.$el.html(c({hasRight: a})), this.$events = this.$(".events-card-wrap"), this.$placeholder = this.$(".event-placeholder"), this.$creatorHandler = this.$(".event-create-handler"), this.$el[a >= 0 ? "removeClass" : "addClass"]("no-right"), this
            }, h.prototype.renderEvents = function() {
                return this.eventsCollection.each(function(a) {
                    return function(b) {
                        return "past" === b.getScope() ? a.eventsCollection.remove(b) : a.renderEvent(b)
                    }
                }(this)), this
            }, h.prototype.renderEvent = function(a) {
                var b;
                return a.OnDate = a.getOnDate(), b = this.getOrRenderEventsCard(a.OnDate), b.addEvent(a)
            }, h.prototype.initPastEvents = function() {
                return this.requestSubView(l, {_projectId: this._projectId}).$el.appendTo(this.$el), this
            }, h.prototype.getOrRenderEventsCard = function(a) {
                var b, c, d, e;
                if (b = this.$events.find(".events-card[data-date=" + a + "]"), b.length)
                    return b.data("view");
                if (e = this.requestSubView(f, {day: a}), e.$el.data("view", e), c = this.$events.find(".events-card:first"), c.length)
                    if (a < c.data("date"))
                        e.$el.insertBefore(c);
                    else {
                        for (d = c.next(); d.length && a > d.data("date"); )
                            c = d, d = c.next();
                        e.$el.insertAfter(c)
                    }
                else
                    e.$el.appendTo(this.$events);
                return e
            }, h.prototype.openEventCreator = function() {
                return this.requestSubView(p).open(d, {backdrop: "static",eventsCollection: this.eventsCollection,_projectId: this._projectId}), this
            }, h.prototype.openDetail = function(a) {
                var b, c;
                return a.target && $(a.target).closest(".add-involvement-handler, .remove-member-handler").length ? this : (a.currentTarget && (b = $(a.currentTarget), a = b.data("id"), c = b.data("model")), c || (c = this.eventsCollection.get(a)), c && q.APP.showPanel(e, {_eventId: a,_projectId: this._projectId,eventModel: c,noRecurrence: "past" === c.getScope()}), this.updateUrl({_eventId: c ? a : ""}, {trigger: !1}), this)
            }, h.prototype.scrollToEvent = function(a) {
                return this.slideTo(a, !0, 150, function() {
                    return function() {
                        return a.transition({"background-color": "#fefbdd"}, 400, function() {
                            return a.transition({"background-color": "white"}, 1e3)
                        })
                    }
                }(this)), this
            }, h.prototype.checkPlaceholder = function() {
                return this.$placeholder[this.eventsCollection.length ? "hide" : "show"](), this
            }, h.prototype.updateUrl = function(a, b) {
                var c;
                return c = q.router.getPrefix() + "/events", a._eventId && (c += "/event/" + a._eventId), q.router.navigate(c, b), this
            }, h
        }(o), _.extend(h.prototype, n), h
    }), define("views/inbox/message/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            return c += a.creator.avatarUrl ? '<div class="avatar img-circle img-24 pull-left" style="background-image: url(' + a.creator.avatarUrl + ');"></div>' : '<div class="avatar img-circle img-24 pull-left no-avatar"></div>', c += '<div class="message-detail"> <p class="message-content"> ' + b(a.creator.name), a.atMe && (c += '<span class="message-at"> [@我]</span>'), c += ' <span class="message-content-title"></span> </p> <p class="object-content muted"> <span class="icon ' + a.iconName + '"></span> <span class="message-content-subtitle"></span> <span class="unread-activities-count pull-right">', a.unreadActivitiesCount > 0 && (c += "" + a.unreadActivitiesCount), c += '</span> </p> <a class="delete-handler icon icon-remove hinted" data-title="删除信息" data-gta="event" data-label="delete message"> </a></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/inbox/message/index", ["require", "exports", "module", "teambition", "./templates/basic", "collections/messages", "view"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("./templates/basic"), d = a("collections/messages"), f = a("view"), g = {post: "icon-wall-bold",task: "icon-board-bold",event: "icon-calendar-bold",work: "icon-file-bold",entry: "icon-bookkeeping",system: "icon-circle-info"}, e = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "MessageView", d.prototype.tagName = "li", d.prototype.className = "message-view clearfix card", d.prototype.events = {"click .delete-handler": "deleteMessage"}, d.prototype.initialize = function(a) {
                return (null != a ? a.messageModel : void 0) ? (this.messageModel = a.messageModel, this.renderBasic().refreshRead().listen(), this) : void 0
            }, d.prototype.listen = function() {
                return this.listenTo(this.messageModel, "change", this.renderBasic), this.listenTo(this.messageModel, "change:isRead", this.refreshRead), this.listenTo(this.messageModel, "remove destroy", this.archive), this
            }, d.prototype.renderBasic = function() {
                var a, b;
                return a = this.messageModel.genMessage(), a.atMe = null != (b = a.mentions) ? b[h.user.id] : void 0, a.iconName = g[a.boundToObjectType || a.type], this.$el.html(c(a)).attr("data-id", this.messageModel.id), this.$el.find(".message-content-title").text(a.title), this.$el.find(".message-content-subtitle").text(a.subtitle), this
            }, d.prototype.refreshRead = function() {
                return this.$el.toggleClass("read", this.messageModel.get("isRead")), this.$(".unread-activities-count").html(this.messageModel.get("unreadActivitiesCount") || ""), this
            }, d.prototype.deleteMessage = function() {
                return this.messageModel.archive(), this.archive(), this
            }, d.prototype.archive = function() {
                var a;
                return null != (a = this.$el) && a.slideUp(300, "swing", function(a) {
                    return function() {
                        return a.remove()
                    }
                }(this)), this
            }, d
        }(f)
    }), define("views/inbox/system-message/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<header class="system-message-header clearfix"> <h5 class="system-message-title pull-left"> ' + a.subtitle + " </h5> ";
            return a.systemRight >= 0 && (c += ' <div class="system-message-handler pull-right"> <a class="menu-handler"> 更多 <span class="icon icon-chevron-down"></span> </a> </div> '), c += '</header><div class="system-message-content hack-render-bug readable"> <strong class="user-name">' + b(a.creator.name) + "</strong> " + b(a.title) + "</div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/inbox/system-message/index", ["require", "exports", "module", "./templates/basic", "models/message", "view"], function(a) {
        var c, d, e, f, g;
        return c = a("./templates/basic"), e = a("models/message"), g = a("view"), d = "ZH", f = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "SystemMessageView", d.prototype.className = "system-message", d.prototype.initialize = function(a) {
                return a._messageId || a.messageModel ? (this.options = a, this.messageModel = a.messageModel, this.renderBasic(), this) : void 0
            }, d.prototype.renderBasic = function() {
                var a;
                return a = this.messageModel.genMessage(), this.$el.html(c(a)), this
            }, d
        }(g)
    }), define("views/inbox/inbox/templates/basic", [], function() {
        return function() {
            var a = '<header class="inbox-header sub-navigator"> <div class="inbox-wrap"> <div class="messages-wrapper"> <div class="messages-header clearfix"> <span class="inbox-title">我的消息</span> <div class="pull-right"> <a class="read-all-handler" data-gta="event" data-label="read all messages"> <span class="icon icon-tick"></span>标记全部已读 </a> <span class="divider-vertical">&nbsp;</span> <a class="clear-readed-handler hinted" data-gta="event" data-label="clear readed messages" data-title="清空已读消息"> <span class="icon icon-trash-bold"></span> </a> </div> </div> </div> <div class="message-detail-wrapper"> <div class="detail-header"></div> </div> </div></header><div class="inbox-content inbox-wrap"> <div class="messages-wrapper"> <ul class="messages thin-scroll"></ul> </div> <div class="message-detail-wrapper"> <div class="detail-panel hack-render-bug"></div> </div></div><footer class="inbox-footer" data-gta="event" data-label="close inbox"> <span class="icon icon-chevron-up"></span></footer>';
            return a
        }
    }), define("views/inbox/inbox/templates/title", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "", d = a;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += '<a class="btn url-handler" href="' + e.url + '" data-gta="event" data-label="' + (0 == f ? "inbox|goto project" : "inbox|goto app") + '">' + b(e.title) + "</a>";
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/inbox/inbox/index", ["require", "exports", "module", "teambition", "lib/scrollable", "lib/selectable", "lib/socket", "thenjs", "util", "view", "models/message", "collections/activities", "collections/messages", "collections/organizations", "collections/projects", "lib/confirm/index", "views/bookkeeping/entry-detail/index", "views/events/event-detail/index", "views/inbox/message/index", "views/wall/post-detail/index", "views/library/previewer/index", "views/inbox/system-message/index", "views/board/task/task-detail/index", "lib/window/index", "./templates/basic", "./templates/title"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z;
        return z = a("teambition"), q = a("lib/scrollable"), r = a("lib/selectable"), s = a("lib/socket"), v = a("thenjs"), w = a("util"), x = a("view"), j = a("models/message"), c = a("collections/activities"), l = a("collections/messages"), m = a("collections/organizations"), p = a("collections/projects"), e = a("lib/confirm/index"), g = a("views/bookkeeping/entry-detail/index"), h = a("views/events/event-detail/index"), k = a("views/inbox/message/index"), n = a("views/wall/post-detail/index"), o = a("views/library/previewer/index"), t = a("views/inbox/system-message/index"), u = a("views/board/task/task-detail/index"), y = a("lib/window/index"), d = a("./templates/basic"), f = a("./templates/title"), i = function(a) {
            function i() {
                return i.__super__.constructor.apply(this, arguments)
            }
            return b(i, a), i.prototype.viewName = "InboxView", i.prototype.className = "inbox-view float-view", i.prototype.events = {"click .new-messages-handler": "showNew","click .all-messages-handler": "showAll","click .inbox-footer": "clear","click .clear-readed-handler": "clearReadMessages","click .read-all-handler": "readAllMessages","click .message-view": "showMessageDetail"}, i.prototype.hotkeys = {j: "selectNext",k: "selectPrev"}, i.prototype.initialize = function(a) {
                return this.options = a || {}, this.renderBasic().setupScroll(this.$messages), this.showLoadingIndicator(this.$messages, {isPrepend: !0}), this.load({remove: !1,silent: !0,success: function(b) {
                    return function() {
                        return b.$el ? (b.hideLoadingIndicator({animated: !0}), b.renderMessages(), a._messageId && b.showMessageDetail(a._messageId), b.listen()) : void 0
                    }
                }(this)}), $("#navigator .inbox-handler").addClass("active"), this
            }, i.prototype.listen = function() {
                var a;
                return this.listenTo(this.collection, "remove destroy", this.checkArchived), this.listenTo(this.collection, "add", function(a) {
                    return function(b) {
                        return a.renderMessage(b, !0), a.checkUnread()
                    }
                }(this)), this.listenTo(this.collection, "change:isRead", function(a) {
                    return function(b, c) {
                        return c ? z.user.set("badge", z.user.get("badge") - b.previous("unreadActivitiesCount")) : a.moveNewMessageToTop(b)
                    }
                }(this)), a = _.throttle(function(a) {
                    return function() {
                        return a.collection && a.collection.getUnreadCount() !== z.user.get("badge") ? (a.collection.resetSoft(), a.collection.fetch({remove: !1,success: function() {
                            return a.checkUnread()
                        }})) : void 0
                    }
                }(this), 5e3, {leading: !1}), this.listenTo(z.user, "change:badge", function(b) {
                    return function(c, d) {
                        return d !== b.collection.getUnreadCount() ? a() : void 0
                    }
                }(this)), this
            }, i.prototype.renderBasic = function() {
                return this.$el.html(d()), this.$messages = this.$(".messages"), this.$detailPanel = this.$(".detail-panel"), this.$detailHeader = this.$(".detail-header"), this
            }, i.prototype.load = function(a) {
                return this.collection = l.get(z.user.id), this.collection.synced && this.collection.getUnreadCount() === z.user.get("badge") || this.collection.resetSoft(), l.fetch(z.user.id, a), this
            }, i.prototype.loadMore = function(a) {
                return this.collection.loadMore({silent: !0,beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$messages)
                    }
                }(this),success: function(b) {
                    return function(c, d) {
                        return b.$el ? (b.hideLoadingIndicator({animated: !0}), _.each(d, function(a) {
                            return b.renderMessage(b.collection.get(a._id))
                        }), b.collection.hasMore ? "function" == typeof a && a() : b.showEndPoint(b.$messages), z.gta.event(null, "load more", "inbox|view more message")) : void 0
                    }
                }(this)}), this
            }, i.prototype.renderMessages = function() {
                return this.removeSubViews(), this.$messages.empty(), this.$detailPanel.empty(), this.$detailHeader.empty(), this.prevMessageModel = null, this.collection.sort(), this.collection.each(function(a) {
                    return function(b) {
                        return a.renderMessage(b)
                    }
                }(this)), this
            }, i.prototype.renderMessage = function(a, b) {
                var c;
                return c = b ? "prependTo" : "appendTo", this.requestSubView(k, {messageModel: a}).$el[c](this.$messages), this
            }, i.prototype.moveNewMessageToTop = function(a) {
                return this.$messages.find("[data-id=" + a.id + "]").prependTo(this.$messages), this
            }, i.prototype.showMessageDetail = function(a) {
                var b, d, e, f, i, j, k, l;
                if (z.gta.event(null, "click", "inbox|view message detail"), a.currentTarget && (a = $(a.currentTarget).data("id")), d = function(a) {
                    return function(b, c) {
                        var d, e, f;
                        return (d = b.$activityCreator) ? (e = .5 * a.$detailPanel.height(), f = function(a) {
                            return b.$el.css("bottom", a)
                        }, d.appendTo(a.$detailPanel), b.activityTimelineView.renderCreator(d, e), d.find(".flex-text-wrap").css("max-height", e), d.on("slideHide.activity", function() {
                            return f(0)
                        }).on("slideShow.activity changeHeight.activity", function(a, b) {
                            return f(b - 1)
                        }).slideShow(), c ? _.delay(function() {
                            return a.$el && b.activityTimelineView ? b.activityTimelineView.scrollToBottom() : void 0
                        }, 1e3) : void 0) : void 0
                    }
                }(this), b = this.collection.get(a), b && !b.get("isArchived")) {
                    if (f = b.get("_latestActivityId"), f && _.delay(function() {
                        var a;
                        return a = c.find(b.get("_objectId")), a && !a.get(f) ? a.fetch() : void 0
                    }, 1e3), this.setActive(this.$(".message-view[data-id=" + a + "]")), b === this.prevMessageModel && "work" !== b.get("objectType"))
                        return b.markRead();
                    if (this.prevMessageModel = b, null != (j = this.detailView) && null != (k = j.currentView) && "function" == typeof k.close && k.close(), null != (l = this.detailView) && l.remove(), this.$detailHeader.empty(), this.$detailPanel.empty(), e = b.get("_objectId"), i = b.get("_projectId"), b.markRead(), this.$detailPanel.removeClass("system-message-pannel"), "system" === b.get("type"))
                        this.detailView = this.requestSubView(t, {messageModel: b,inPanel: !0}), this.detailView.$el.appendTo(this.$detailPanel), this.$detailPanel.addClass("system-message-pannel"), this.renderDetailHeader(b);
                    else
                        switch (b.get("objectType")) {
                            case "task":
                                this.detailView = this.requestSubView(u, {_taskId: e,inPanel: !0,success: function(a) {
                                    return function(c) {
                                        return a.renderDetailHeader(b, c.taskModel), d(c, !0)
                                    }
                                }(this)}), this.detailView.$el.addClass("detail-card").appendTo(this.$detailPanel);
                                break;
                            case "post":
                                this.detailView = this.requestSubView(n, {_postId: e,inPanel: !0,success: function(a) {
                                    return function(c) {
                                        return a.renderDetailHeader(b, c.postModel), d(c, !0)
                                    }
                                }(this)}), this.detailView.$el.addClass("detail-card").appendTo(this.$detailPanel);
                                break;
                            case "event":
                                this.detailView = this.requestSubView(h, {_eventId: e,inPanel: !0,success: function(a) {
                                    return function(c) {
                                        return a.renderDetailHeader(b, c.eventModel), d(c, !0)
                                    }
                                }(this)}), this.detailView.$el.addClass("detail-card").appendTo(this.$detailPanel);
                                break;
                            case "work":
                                this.detailView = this.requestSubView(y).open(o, {_workId: e});
                                break;
                            case "entry":
                                this.detailView = this.requestSubView(g, {_entryId: e,inPanel: !0,success: function(a) {
                                    return function(c) {
                                        return a.renderDetailHeader(b, c.eventModel), d(c, !0)
                                    }
                                }(this)}), this.detailView.$el.addClass("detail-card").appendTo(this.$detailPanel)
                        }
                    return this
                }
            }, i.prototype.renderDetailHeader = function(a, b) {
                var c, d, e, g;
                return c = [], e = a.get("_organizationId"), g = a.get("_projectId"), d = a.get("objectType"), v.parallel([function() {
                    return function(a) {
                        return m.fetchOne(0, e, {success: function(b) {
                            return a(null, b)
                        },error: function(b) {
                            return a(b, null)
                        }})
                    }
                }(this), function() {
                    return function(a) {
                        return p.fetchOne(0, g, {success: function(b) {
                            return b.hasRight() >= 0 && !b.subscribed && (s.join("projects", b.id), b.subscribed = !0), a(null, b)
                        },error: function(b) {
                            return a(b, null)
                        }})
                    }
                }(this)]).fin(function(a) {
                    return function(h, i, j) {
                        var k, l, m;
                        if (!i) {
                            if (k = j[0], (null != k ? k.id : void 0) && c.push({url: "/organization/" + e,title: "前往组织：" + k.get("name")}), l = j[1], (null != l ? l.id : void 0) && (m = "/project/" + g, c.push({url: "" + m,title: "前往项目：" + l.get("name")})), m && b)
                                switch (d) {
                                    case "task":
                                        c.push({url: "" + m + "/tasks/scrum/" + b.get("_tasklistId") + "/task/" + b.id,title: "前往任务板"});
                                        break;
                                    case "post":
                                        c.push({url: "" + m + "/posts/post/" + b.id,title: "前往分享墙"});
                                        break;
                                    case "event":
                                        c.push({url: "" + m + "/events/event/" + b.id,title: "前往日程表"})
                                }
                            return a.$detailHeader.html(f(c))
                        }
                    }
                }(this)), this
            }, i.prototype.selectPrev = function() {
                return this.prev(function(a) {
                    return function() {
                        return a.showMessageDetail(a.getActive().data("id"))
                    }
                }(this)), this
            }, i.prototype.selectNext = function() {
                return this.next(function(a) {
                    return function() {
                        return a.showMessageDetail(a.getActive().data("id"))
                    }
                }(this)), this
            }, i.prototype.clear = function() {
                return z.APP.Float.close(), this
            }, i.prototype.clearReadMessages = function() {
                return this.collection.getReaded().length && this.requestSubView(e, {title: "清空已读消息",description: "确定要清空所有已读消息吗？",onConfirm: function(a) {
                    return function() {
                        return a.collection.archiveRead(), a.collection.getUnread().length ? void 0 : _.delay(function() {
                            return a.clear()
                        })
                    }
                }(this)}), this
            }, i.prototype.readAllMessages = function() {
                return this.collection.readAll(), this
            }, i.prototype.checkArchived = function(a) {
                var b, c, d, e;
                return a && (null != (b = this.prevMessageModel) ? b.id : void 0) === a.id && (null != (c = this.detailView) && null != (d = c.currentView) && "function" == typeof d.close && d.close(), null != (e = this.detailView) && e.remove(), this.$detailPanel.empty(), this.$detailHeader.empty()), this
            }, i.prototype.checkUnread = function() {
                var a;
                return a = this.collection.getUnreadCount(), a > z.user.get("badge") && z.user.set("badge", a), this
            }, i.prototype.beforeClose = function() {
                return $("#navigator .inbox-handler").removeClass("active"), this
            }, i.prototype.remove = function() {
                var a;
                return this.beforeClose(), a = z.router.getUrl().replace(/\/inbox.*/, ""), z.router.navigate(a, {trigger: !1}), i.__super__.remove.apply(this, arguments)
            }, i
        }(x), _.extend(i.prototype, r(".message-view")), _.extend(i.prototype, q), i
    }), define("views/my/my/templates/basic", [], function() {
        return function() {
            var a = '<header class="my-header sub-nav sub-navigator"> <ul class="nav nav-underscore my-wrap"> <li class="active"> <a class="my-tasks-handler" data-gta="event" data-label="my tasks">我的任务</a> </li> <li> <a class="my-involve-tasks-handler" data-gta="event" data-label="my involve tasks">我参与的任务</a> </li> <li> <a class="my-events-handler" data-gta="event" data-label="my events">我的日程</a> </li> <li> <a class="my-notes-handler" data-gta="event" data-label="my notes">我的笔记</a> </li> </ul></header><div class="my-content-wrap"> <div class="my-content card my-wrap"></div></div><footer class="my-footer" data-gta="event" data-label="close my"> <span class="icon icon-chevron-up"></span></footer>';
            return a
        }
    }), define("views/events/events-list/templates/event-date", [], function() {
        return function(a) {
            var b = '<li class="event-date-wrap" data-date="' + a.date + '"> <strong class="event-date">' + a.dateString + "</strong></li>";
            return b
        }
    }), define("views/events/events-list/templates/event", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="event" data-id="' + a._id + '" data-date="' + a.date + '" data-type="event"  data-gta=\'event\' data-label=\'open event detail\'> <div class="event-time"> <time>' + a.startDateString + "</time> ";
            return a.endDateString && (c += " <time>" + a.endDateString + "</time> "), c += ' </div> <div class="event-content"> <span class="event-title">' + b(a.title) + "</span> ", a.project && a.project.name && a.project._id && (c += ' <a class="event-tag" data-tag="project" data-id="' + a.project._id + '" data-gta="event" data-label="event|go to project"> #' + b(a.project.name) + " </a> "), c += " </div></li>"
        }
    }), define("views/events/events-list/templates/placeholder", [], function() {
        return function() {
            var a = '<div class="event-placeholder placeholder muted"> <a class="icon icon-calendar"></a> <br /> 目前还没有日程</div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/events/events-list/index", ["require", "exports", "module", "teambition", "./templates/event-date", "views/events/event-detail-panel/index", "./templates/event", "moment", "./templates/placeholder", "util", "view"], function(a) {
        var c, d, e, f, g, h, i, j, k;
        return k = a("teambition"), c = a("./templates/event-date"), d = a("views/events/event-detail-panel/index"), e = a("./templates/event"), g = a("moment"), h = a("./templates/placeholder"), i = a("util"), j = a("view"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "EventsListView", f.prototype.tagName = "ul", f.prototype.className = "events-list", f.prototype.events = {"click .event": "openDetail"}, f.prototype.initialize = function(a) {
                return (null != a ? a.eventsCollection : void 0) ? (this.options = a, this.eventsCollection = a.eventsCollection, this.$placeholder = $(h()), this.checkPlaceholder().renderEvents().listen(), a.groupBy && this.$el.addClass("events-group"), this) : !1
            }, f.prototype.listen = function() {
                return this.listenTo(this.eventsCollection, "add change", function(a) {
                    return function(b) {
                        return b.collection === a.eventsCollection && a.renderEvent(b, !0), a.checkPlaceholder()
                    }
                }(this)), this.listenTo(this.eventsCollection, "destroy remove", function(a) {
                    return function(b) {
                        return a.$(".event[data-id=" + b.id + "]").remove(), a.checkGroupBy(b), a.checkPlaceholder()
                    }
                }(this)), this
            }, f.prototype.renderEvents = function() {
                var a;
                return a = this.eventsCollection.models.slice(), a.sort(function(a, b) {
                    return new Date(a.get("startDate")) - new Date(b.get("startDate"))
                }), _.each(a, function(a) {
                    return function(b) {
                        return a.renderEvent(b)
                    }
                }(this)), this
            }, f.prototype.renderEvent = function(a) {
                var b, c, d, f, h, j, k, l, m, n, o, p, q;
                if (j = a.toJSON(), m = "HH:mm", j.startDateString = g(j.startDate).format(m), p = i.formatDate(new Date(j.startDate)).dateString, n = g("today" === a.getScope() ? new Date : j.startDate), l = {date: n.format("YYYYMMDD"),dateString: i.formatDate(n).dateString}, d = this.getOrRenderEventDate(l), p === l.dateString && this.options.groupBy || (j.startDateString = l.dateString + " " + j.startDateString), null != j.endDate && (k = i.formatDate(new Date(j.endDate)).dateString, j.endDateString = g(j.endDate).format(m), j.startDateString += " - ", k !== l.dateString ? j.endDateString = k + " " + j.endDateString : (j.startDateString += j.endDateString, j.endDateString = "")), j.date = l.date, c = $(e(j)), q = this.$(".event[data-id=" + a.id + "]"), o = q.data("date") + "", q.length && o === j.date)
                    q.replaceWith(c);
                else {
                    for (q.remove(), f = this.$("[data-date=" + o + "]"), f.length <= 1 && f.remove(), b = d, h = b.next(".event"); h.length; )
                        b = h, h = b.next(".event");
                    c.insertAfter(b)
                }
                return this
            }, f.prototype.getOrRenderEventDate = function(a) {
                var b, d;
                return this.eventDates || (this.eventDates = []), b = this.$(".event-date-wrap[data-date=" + a.date + "]"), b.length || (b = $(c(a)), this.eventDates.push(+a.date), this.eventDates.sort(), d = this.eventDates.indexOf(+a.date), d < this.eventDates.length - 1 ? b.insertBefore(this.$(".event-date-wrap[data-date=" + this.eventDates[d + 1] + "]")) : b.appendTo(this.$el)), b
            }, f.prototype.checkGroupBy = function(a) {
                var b, c, d;
                return d = g("today" === a.getScope() ? new Date : a.get("startDate")).format("YYYYMMDD"), b = this.$(".event-date-wrap[data-date=" + d + "]"), c = b.next(), (!c.length || c.hasClass("event-date-wrap")) && b.remove(), this
            }, f.prototype.checkPlaceholder = function() {
                return this.$placeholder.remove(), this.eventsCollection.length || this.$el.html(this.$placeholder), this
            }, f.prototype.openDetail = function(a) {
                var b;
                return b = this.eventsCollection.get($(a.currentTarget).data("id")), k.APP.showPanel(d, {_projectId: b.get("_projectId"),eventModel: b,rightOffset: this.options.rightOffset}), this
            }, f
        }(j)
    }), define("views/my/events/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="today-events" data-gta="event" data-label="my today events" data-value="my today events"> <h3>今天的日程 ・ <span class="today-events-count">0</span> <a class="icalendar pull-right link-add-handler" data-gta="event" data-label="subscribe my events"><i class="icon icon-calendar-bold"></i> 订阅「' + a.title + '」</a> </h3></div><div class="future-events" data-gta="event" data-label="my future events" data-value="my future events"> <h3>未来的日程 ・ <span class="future-events-count">0</span></h3></div>';
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/my/events/index", ["require", "exports", "module", "teambition", "lib/http", "moment", "view", "models/event", "collections/events", "views/events/events-list/index", "views/core/icalendar/index", "lib/window/index", "./templates/basic"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n;
        return n = a("teambition"), h = a("lib/http"), j = a("moment"), l = a("view"), e = a("models/event"), f = a("collections/events"), g = a("views/events/events-list/index"), i = a("views/core/icalendar/index"), m = a("lib/window/index"), c = a("./templates/basic"), k = function(a) {
            function k() {
                return k.__super__.constructor.apply(this, arguments)
            }
            return b(k, a), k.prototype.viewName = "MyEventsView", k.prototype.tagName = "section", k.prototype.className = "my-events-view fade", k.prototype.events = {"click .event-tag": "onClickEventTag","click .icalendar": "showICalendar"}, k.prototype.initialize = function(a) {
                return this.options = _.extend({}, a), this.options.title = "我的日程", this.options.webcal = n.user.get("calLink"), this.todayEventsCollection = f.get("" + n.user.id + "_today_events"), this.futureEventsCollection = f.get("" + n.user.id + "_future_events"), this.loadEvents(), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this
            }, k.prototype.renderBasic = function() {
                return this.$el.html(c(this.options)), this
            }, k.prototype.listen = function() {
                return this.listenTo(this.todayEventsCollection, "add remove", this.refreshTodayEventsCount), this.listenTo(this.futureEventsCollection, "add remove", this.refreshFutureEventsCount), this.listenTo(this.todayEventsCollection, "change", function(a) {
                    return function(b) {
                        var c;
                        return c = !n.user.id, d.call(b.get("involveMembers"), c) >= 0 ? a.todayEventsCollection.remove(b) : "future" === b.getScope() ? (a.todayEventsCollection.remove(b), a.futureEventsCollection.add(b)) : void 0
                    }
                }(this)), this.listenTo(this.futureEventsCollection, "change", function(a) {
                    return function(b) {
                        var c;
                        return c = !n.user.id, d.call(b.get("involveMembers"), c) >= 0 ? a.futureEventsCollection.remove(b) : "today" === b.getScope() ? (a.futureEventsCollection.remove(b), a.todayEventsCollection.add(b)) : void 0
                    }
                }(this)), this
            }, k.prototype.loadEvents = function() {
                return this.showLoadingIndicator(this.$el), h.ajax("events/me", {data: {endDate: j().startOf("day").toISOString()},expireCache: {namespace: "my_events",expire: 60},success: function(a) {
                    return function(b) {
                        return a.$el ? (_.each(b, function(c, d) {
                            var f;
                            return c = new e(c), b[d] = c.attributes, f = c.getScope(), "today" === f ? a.todayEventsCollection.add(c) : "future" === f ? a.futureEventsCollection.add(c) : void 0
                        }), a.hideLoadingIndicator(), a.renderBasic().listen(), a.requestSubView(g, {groupBy: !0,rightOffset: 0,eventsCollection: a.todayEventsCollection}).$el.appendTo(a.$(".today-events")), a.requestSubView(g, {groupBy: !0,rightOffset: 0,eventsCollection: a.futureEventsCollection}).$el.appendTo(a.$(".future-events")), a.refreshTodayEventsCount().refreshFutureEvenCount()) : void 0
                    }
                }(this)}), this
            }, k.prototype.onClickEventTag = function(a) {
                var b;
                return a.stopPropagation(), b = $(a.currentTarget).data("id"), n.router.navigate("project/" + b + "/events", {trigger: !0}), this
            }, k.prototype.refreshTodayEventsCount = function() {
                return this.$(".today-events-count").text(this.todayEventsCollection.length), this
            }, k.prototype.refreshFutureEvenCount = function() {
                return this.$(".future-events-count").text(this.futureEventsCollection.length), this
            }, k.prototype.showICalendar = function() {
                return this.requestSubView(m).open(i, this.options), this
            }, k
        }(l)
    }), define("views/my/invovle-tasks/templates/basic", [], function() {
        return function() {
            var a = '<div class="today-tasks" data-gta="event" data-label="my invovle today tasks" data-value="my invovle today tasks"> <h3>今天的任务 ・ <span class="today-tasks-count">0</span></h3></div><div class="recent-tasks" data-gta="event" data-label="my invovle recent tasks" data-value="my invovle recent tasks"> <h3>近期的任务 ・ <span class="recent-tasks-count">0</span></h3></div><div class="future-tasks" data-gta="event" data-label="my invovle future tasks" data-value="my invovle future tasks"> <h3>未来的任务 ・ <span class="future-tasks-count">0</span></h3></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/my/invovle-tasks/index", ["require", "exports", "module", "teambition", "./templates/basic", "lib/http", "collections/tasks", "views/board/task/task-list/index", "models/task", "view"], function(a) {
        var c, d, e, f, g, h, i, j;
        return j = a("teambition"), c = a("./templates/basic"), d = a("lib/http"), h = a("collections/tasks"), f = a("views/board/task/task-list/index"), g = a("models/task"), i = a("view"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "MyInvovleTasksView", e.prototype.tagName = "section", e.prototype.className = "my-invovle-tasks-view fade", e.prototype.initialize = function(a) {
                return this.options = _.extend({}, a), this.todayTasksCollection = h.get("" + j.user.id + "_invovle_today_tasks"), this.recentTasksCollection = h.get("" + j.user.id + "_invovle_recent_tasks"), this.futureTasksCollection = h.get("" + j.user.id + "_invovle_future_tasks"), this.loadTasks(), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$recentTasks = this.$(".recent-tasks"), this
            }, e.prototype.listen = function() {
                return this.listenTo(this.todayTasksCollection, "add remove", this.refreshTodayTasksCount), this.listenTo(this.recentTasksCollection, "add remove", this.refreshRecentTasksCount), this.listenTo(this.futureTasksCollection, "add remove", this.refreshFutureTasksCount), this.listenTo(this.todayTasksCollection, "change", function(a) {
                    return function(b) {
                        var c;
                        return b.get("isDone") || j.user.id === b.get("_executorId") || !b.isInvolved(j.user.id) ? a.todayTasksCollection.remove(b) : "today" !== (c = b.getScope()) ? (a.todayTasksCollection.remove(b), "recent" === c ? a.recentTasksCollection.add(b) : a.futureTasksCollection.add(b)) : void 0
                    }
                }(this)), this.listenTo(this.recentTasksCollection, "change", function(a) {
                    return function(b) {
                        var c;
                        return b.get("isDone") || j.user.id === b.get("_executorId") || !b.isInvolved(j.user.id) ? a.recentTasksCollection.remove(b) : "recent" !== (c = b.getScope()) ? (a.recentTasksCollection.remove(b), "today" === c ? a.todayTasksCollection.add(b) : a.futureTasksCollection.add(b)) : void 0
                    }
                }(this)), this.listenTo(this.futureTasksCollection, "change", function(a) {
                    return function(b) {
                        var c;
                        return b.get("isDone") || j.user.id === b.get("_executorId") || !b.isInvolved(j.user.id) ? a.futureTasksCollection.remove(b) : "future" !== (c = b.getScope()) ? (a.futureTasksCollection.remove(b), "today" === c ? a.todayTasksCollection.add(b) : a.recentTasksCollection.add(b)) : void 0
                    }
                }(this)), this
            }, e.prototype.loadTasks = function() {
                return this.showLoadingIndicator(this.$el), d.ajax("tasks/involves", {data: {count: 0},expireCache: {namespace: "my_involve_tasks",expire: 60},success: function(a) {
                    return function(b) {
                        return a.$el ? (_.each(b, function(c, d) {
                            var e;
                            return c = new g(c), b[d] = c.attributes, e = c.getScope(), "today" === e ? a.todayTasksCollection.add(c) : "recent" === e ? a.recentTasksCollection.add(c) : "future" === e ? a.futureTasksCollection.add(c) : void 0
                        }), a.hideLoadingIndicator(), a.renderBasic().listen(), a.requestSubView(f, {isPrepend: !0,groupBy: !0,tasksCollection: a.todayTasksCollection,rightOffset: 0}).$el.appendTo(a.$(".today-tasks")), a.requestSubView(f, {isPrepend: !0,groupBy: !0,tasksCollection: a.recentTasksCollection,rightOffset: 0}).$el.appendTo(a.$(".recent-tasks")), a.requestSubView(f, {isPrepend: !0,groupBy: !0,tasksCollection: a.futureTasksCollection,rightOffset: 0}).$el.appendTo(a.$(".future-tasks")), a.refreshTodayTasksCount().refreshRecentTasksCount().refreshFutureTasksCount()) : void 0
                    }
                }(this)}), this
            }, e.prototype.refreshTodayTasksCount = function() {
                return this.$(".today-tasks-count").text(this.todayTasksCollection.length), this
            }, e.prototype.refreshRecentTasksCount = function() {
                return this.$(".recent-tasks-count").text(this.recentTasksCollection.length), this.$recentTasks[this.recentTasksCollection.length ? "show" : "hide"](), this
            }, e.prototype.refreshFutureTasksCount = function() {
                return this.$(".future-tasks-count").text(this.futureTasksCollection.length), this
            }, e
        }(i)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/note", ["require", "exports", "module", "model"], function(a) {
        var c, d;
        return c = a("model"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "note", c.prototype.urlRoot = "notes", c.prototype.defaults = {objectType: "note",_teamId: "",_userId: "",created: "",updated: "",title: "",content: ""}, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/notes", ["require", "exports", "module", "collection", "models/note"], function(a) {
        var c, d, e;
        return c = a("collection"), e = a("models/note"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.model = e, c.prototype.name = "notes", c.prototype.orderBy = "latest-updated", c
        }(c)
    }), define("views/my/notes/templates/basic", [], function() {
        return function() {
            var a = '<h3 class="note-header">我的笔记 ・ <span class="notes-count">0</span></h3><a class="create-note-handler btn btn-primary" data-gta="event" data-label="create note"> <span class="icon icon-plus"></span> 创建</a><ul class="notes-list"></ul>';
            return a
        }
    }), define("views/my/notes/templates/note", [], function() {
        return function(a) {
            var b = '<li class="note card ';
            return a.isCreate && (b += "active"), b += '" data-id="' + a._id + '" data-gta="event" data-label="show note detail"> <input class="note-title" placeholder="标题..." value="' + (a.title || "") + '"/> <textarea class="note-content" placeholder="内容...">' + (a.content || "") + '</textarea> <time class="time-stamp">' + (a.dateString || "") + '</time> <div class="note-handler-set clearfix"> ', a.isCreate || (b += ' <a class="delete-note-handler pull-left" data-gta="event" data-label="delete note"> <span class="icon icon-trash"></span> 删除 </a> '), b += ' <a class="save-note-handler btn btn-primary pull-right" data-gta="event" data-label="save note"> ', b += a.isCreate ? "创建" : "保存", b += ' </a> <a class="cancel-note-handler pull-right"> 取消 </a> </div></li>'
        }
    }), define("views/my/notes/templates/placeholder", [], function() {
        return function() {
            var a = '<div class="note-placeholder placeholder muted"> <span class="icon icon-book"></span> <br> 当前还没有笔记</div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/my/notes/index", ["require", "exports", "module", "teambition", "store", "util", "view", "collections/notes", "lib/confirm/index", "./templates/basic", "./templates/note", "./templates/placeholder"], function(a) {
        var c, d, e, f, g, h, i, j, k, l;
        return l = a("teambition"), i = a("store"), j = a("util"), k = a("view"), f = a("collections/notes"), d = a("lib/confirm/index"), c = a("./templates/basic"), e = a("./templates/note"), h = a("./templates/placeholder"), g = function(a) {
            function g() {
                return g.__super__.constructor.apply(this, arguments)
            }
            return b(g, a), g.prototype.viewName = "NotesView", g.prototype.tagName = "div", g.prototype.className = "notes-view clearfix fade", g.prototype.events = {"click .create-note-handler": "createNote","click .delete-note-handler": "deleteNote","click .save-note-handler": "saveNote","click .cancel-note-handler": "cancelNote","focusin .note": "editNote","keydown .note-content, .note-title": "quickSaveNote"}, g.prototype.initialize = function() {
                return this.localCache = i.namespace("temp").namespace("notes_myboard"), this.localCacheId = l.user.id, this.$placeholder = $(h()), this.renderBasic(), this.load({beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$el)
                    }
                }(this),success: function(a) {
                    return function() {
                        return a.$el ? (a.hideLoadingIndicator(), a.notesCollection.each(function(b) {
                            return a.renderNote(b)
                        }), a.listen(), a.checkPlaceholder()) : void 0
                    }
                }(this)}), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this
            }, g.prototype.listen = function() {
                return this.listenTo(this.notesCollection, "add", function(a) {
                    return this.renderNote(a, !0), this.cancelCreate(), this.checkPlaceholder()
                }), this.listenTo(this.notesCollection, "change", this.renderNote), this.listenTo(this.notesCollection, "remove", this.removeNote), this.listenTo(this.notesCollection, "change destroy remove", this.checkPlaceholder), this
            }, g.prototype.load = function(a) {
                return a || (a = {}), "function" == typeof a.beforeSend && a.beforeSend(), f.fetch(l.user.id, {success: function(b) {
                    return function(c) {
                        return b.notesCollection = c, "function" == typeof a.success ? a.success() : void 0
                    }
                }(this)}), this
            }, g.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$list = this.$(".notes-list"), this
            }, g.prototype.renderNote = function(a, b) {
                var c, d, f;
                return f = a.toJSON(), f.dateString = j.formatDate(f.updated).dateString, c = $(e(f)), d = this.$(".note[data-id=" + f._id + "]"), d.length ? d.replaceWith(c) : c[b === !0 ? "prependTo" : "appendTo"](this.$list), c.find(".note-content").flexText(), this.refreshNotesCount(), this
            }, g.prototype.removeNote = function(a) {
                var b, c;
                return c = a.toJSON(), b = this.$(".note[data-id=" + c._id + "]"), b.remove(), this
            }, g.prototype.createNote = function() {
                var a, b, c;
                if (!this.$(".note[data-id=new_note]").length)
                    return this.$createNote = $(e({_id: "new_note",isCreate: !0})), c = this.localCache(this.localCacheId) || {}, b = this.$createNote.find(".note-title"), a = this.$createNote.find(".note-content"), b.val(c.title).on("change", function(a) {
                        return function() {
                            return a.cacheNote()
                        }
                    }(this)), a.val(c.content).on("change", function(a) {
                        return function() {
                            return a.cacheNote()
                        }
                    }(this)).flexText(), this.$createNote.prependTo(this.$list), b.focusAtEnd(), this
            }, g.prototype.deleteNote = function(a) {
                var b;
                return b = $(a.currentTarget).closest(".note"), this.requestSubView(d, {title: "确认删除笔记",description: "一旦删除笔记，将无法恢复",confirm: "删除",onConfirm: function(a) {
                    return function() {
                        var c;
                        return null != (c = a.notesCollection.get(b.data("id"))) ? c.destroy() : void 0
                    }
                }(this)}), this
            }, g.prototype.saveNote = function(a) {
                var b, c, d, e;
                return b = $(a.currentTarget).closest(".note"), c = b.data("id"), e = {title: b.find(".note-title").val().trim(),content: b.find(".note-content").val().trim()}, b.find(".flex-text-wrap").removeClass("validate-error"), b.find(".note-title").removeClass("validate-error"), e.title ? e.content ? (d = this.notesCollection.get(b.data("id")), d ? (this.cancelEdit(), d.save(null, {attrs: e,wait: !0})) : this.notesCollection.create(e, {wait: !0,success: function(a) {
                    return function() {
                        return a.resetCache()
                    }
                }(this)}), this) : b.find(".flex-text-wrap").addClass("validate-error") : b.find(".note-title").addClass("validate-error")
            }, g.prototype.editNote = function(a) {
                var b;
                return b = $(a.currentTarget), b.hasClass("active") ? void 0 : (this.cancelEdit(), b.addClass("active"), this)
            }, g.prototype.cancelCreate = function() {
                var a;
                return (a = this.$createNote) && (this.$createNote = null, a.remove()), this
            }, g.prototype.cancelEdit = function() {
                var a, b, c;
                return a = this.$(".note.active[data-id!=new_note]"), b = a.data("id"), c = this.notesCollection.get(b), c ? this.renderNote(c) : a.remove()
            }, g.prototype.cancelNote = function(a) {
                var b, c;
                return b = $(a.currentTarget).closest(".note"), c = b.data("id"), "new_note" === c ? this.cancelCreate() : this.cancelEdit(), this
            }, g.prototype.quickSaveNote = function(a) {
                return 13 === a.keyCode && (a.ctrlKey || a.shiftKey || a.metaKey) && (a.preventDefault(), this.saveNote(a)), this
            }, g.prototype.resetCache = function() {
                return this.localCache(this.localCacheId, {title: "",content: ""}), this
            }, g.prototype.cacheNote = function() {
                return this.localCacheId && this.$createNote && this.localCache(this.localCacheId, {title: this.$createNote.find(".note-title").val().trim(),content: this.$createNote.find(".note-content").val().trim()}), this
            }, g.prototype.refreshNotesCount = function() {
                return this.$(".notes-count").text(this.notesCollection.length), this
            }, g.prototype.checkPlaceholder = function() {
                return this.$placeholder.remove(), this.notesCollection.length || this.$list.html(this.$placeholder), this
            }, g
        }(k)
    }), define("views/my/tasks/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="today-tasks" data-gta="event" data-label="my today tasks" data-value="my today tasks"> <h3>今天的任务 ・ <span class="today-tasks-count">0</span> <a class="icalendar pull-right link-add-handler" data-gta="event" data-label="subscribe my tasks"><i class="icon icon-calendar-bold"></i> 订阅「' + a.title + '」</a> </h3></div><div class="recent-tasks" data-gta="event" data-label="my recent tasks" data-value="my recent tasks"> <h3>近期的任务 ・ <span class="recent-tasks-count">0</span></h3></div><div class="future-tasks" data-gta="event" data-label="my future tasks" data-value="my future tasks"> <h3>未来的任务 ・ <span class="future-tasks-count">0</span></h3></div>';
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/my/tasks/index", ["require", "exports", "module", "teambition", "lib/http", "view", "models/task", "collections/tasks", "views/core/icalendar/index", "views/board/task/task-list/index", "lib/window/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l;
        return l = a("teambition"), d = a("lib/http"), j = a("view"), h = a("models/task"), i = a("collections/tasks"), e = a("views/core/icalendar/index"), g = a("views/board/task/task-list/index"), k = a("lib/window/index"), c = a("./templates/basic"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "MyTasksView", f.prototype.tagName = "section", f.prototype.className = "my-tasks-view fade", f.prototype.events = {"click .icalendar": "showICalendar"}, f.prototype.initialize = function(a) {
                return this.options = _.extend({}, a), this.options.title = "我的任务", this.options.webcal = l.user.get("taskCalLink"), this.todayTasksCollection = i.get("" + l.user.id + "_today_tasks"), this.recentTasksCollection = i.get("" + l.user.id + "_recent_tasks"), this.futureTasksCollection = i.get("" + l.user.id + "_future_tasks"), this.loadTasks(), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this
            }, f.prototype.renderBasic = function() {
                return this.$el.html(c(this.options)), this.$recentTasks = this.$(".recent-tasks"), this
            }, f.prototype.listen = function() {
                return this.listenTo(this.todayTasksCollection, "add remove", this.refreshTodayTasksCount), this.listenTo(this.recentTasksCollection, "add remove", this.refreshRecentTasksCount), this.listenTo(this.futureTasksCollection, "add remove", this.refreshFutureTasksCount), this.listenTo(this.todayTasksCollection, "change", function(a) {
                    return function(b) {
                        var c;
                        return b.get("isDone") || !b.isExecutor(l.user.id) ? a.todayTasksCollection.remove(b) : "today" !== (c = b.getScope()) ? (a.todayTasksCollection.remove(b), "recent" === c ? a.recentTasksCollection.add(b) : a.futureTasksCollection.add(b)) : void 0
                    }
                }(this)), this.listenTo(this.recentTasksCollection, "change", function(a) {
                    return function(b) {
                        var c;
                        return b.get("isDone") || !b.isExecutor(l.user.id) ? a.recentTasksCollection.remove(b) : "recent" !== (c = b.getScope()) ? (a.recentTasksCollection.remove(b), "today" === c ? a.todayTasksCollection.add(b) : a.futureTasksCollection.add(b)) : void 0
                    }
                }(this)), this.listenTo(this.futureTasksCollection, "change", function(a) {
                    return function(b) {
                        var c;
                        return b.get("isDone") || !b.isExecutor(l.user.id) ? a.futureTasksCollection.remove(b) : "future" !== (c = b.getScope()) ? (a.futureTasksCollection.remove(b), "today" === c ? a.todayTasksCollection.add(b) : a.recentTasksCollection.add(b)) : void 0
                    }
                }(this)), this
            }, f.prototype.loadTasks = function() {
                return this.showLoadingIndicator(this.$el), d.ajax("tasks/me", {data: {withSubtasks: !0,withTags: !0},expireCache: {namespace: "my_tasks",expire: 60},success: function(a) {
                    return function(b) {
                        return a.$el ? (_.each(b, function(c, d) {
                            var e;
                            return c = new h(c), b[d] = c.attributes, e = c.getScope(), "today" === e ? a.todayTasksCollection.add(c) : "recent" === e ? a.recentTasksCollection.add(c) : "future" === e ? a.futureTasksCollection.add(c) : void 0
                        }), a.hideLoadingIndicator(), a.renderBasic().listen(), a.requestSubView(g, {isPrepend: !0,groupBy: !0,noExecutor: !0,withSubtasks: !0,_taskId: a.options._taskId,tasksCollection: a.todayTasksCollection,rightOffset: 0}).$el.appendTo(a.$(".today-tasks")), a.requestSubView(g, {isPrepend: !0,groupBy: !0,noExecutor: !0,withSubtasks: !0,_taskId: a.options._taskId,tasksCollection: a.recentTasksCollection,rightOffset: 0}).$el.appendTo(a.$(".recent-tasks")), a.requestSubView(g, {isPrepend: !0,groupBy: !0,noExecutor: !0,withSubtasks: !0,_taskId: a.options._taskId,tasksCollection: a.futureTasksCollection,rightOffset: 0}).$el.appendTo(a.$(".future-tasks")), a.refreshTodayTasksCount().refreshRecentTasksCount().refreshFutureTasksCount()) : void 0
                    }
                }(this)}), this
            }, f.prototype.refreshTodayTasksCount = function() {
                return this.$(".today-tasks-count").text(this.todayTasksCollection.length), this
            }, f.prototype.refreshRecentTasksCount = function() {
                return this.$(".recent-tasks-count").text(this.recentTasksCollection.length), this.$recentTasks[this.recentTasksCollection.length ? "show" : "hide"](), this
            }, f.prototype.refreshFutureTasksCount = function() {
                return this.$(".future-tasks-count").text(this.futureTasksCollection.length), this
            }, f.prototype.showICalendar = function() {
                return this.requestSubView(k).open(e, this.options), this
            }, f
        }(j)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/my/my/index", ["require", "exports", "module", "teambition", "./templates/basic", "views/my/events/index", "views/my/invovle-tasks/index", "views/my/notes/index", "views/my/tasks/index", "view"], function(a) {
        var c, d, e, f, g, h, i, j;
        return j = a("teambition"), c = a("./templates/basic"), d = a("views/my/events/index"), e = a("views/my/invovle-tasks/index"), f = a("views/my/notes/index"), g = a("views/my/tasks/index"), i = a("view"), h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "MyView", h.prototype.className = "my-view", h.prototype.events = {"click .my-footer": "clear","click .my-tasks-handler": "openTasks","click .my-involve-tasks-handler": "openInvolveTasks","click .my-notes-handler": "openNotes","click .my-events-handler": "openEvents"}, h.prototype.initialize = function(a) {
                return this.options = a || {}, this.renderBasic().openTasks(), $("#navigator .my-handler").addClass("active"), this
            }, h.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$content = this.$(".my-content"), this
            }, h.prototype.activeTab = function(a) {
                var b;
                return b = $(a).parent("li"), b.siblings().removeClass("active"), b.addClass("active"), !0
            }, h.prototype.enterSection = function(a, b, c) {
                var h;
                if (this.section !== a) {
                    switch (this.section = a, null != (h = this.currentView) && h.remove(), a) {
                        case "tasks":
                            this.activeTab(this.$(".my-tasks-handler")), this.currentView = this.requestSubView(g, {_taskId: c}), this.$content.html(this.currentView.$el);
                            break;
                        case "involveTasks":
                            this.activeTab(this.$(".my-involve-tasks-handler")), this.currentView = this.requestSubView(e), this.$content.html(this.currentView.$el);
                            break;
                        case "notes":
                            this.activeTab(this.$(".my-notes-handler")), this.currentView = this.requestSubView(f), this.$content.html(this.currentView.$el);
                            break;
                        case "events":
                            this.activeTab(this.$(".my-events-handler")), this.currentView = this.requestSubView(d, {_eventId: c}), this.$content.html(this.currentView.$el);
                            break;
                        default:
                            this.home()
                    }
                    return $("body").scrollTop(0), this
                }
            }, h.prototype.openTasks = function() {
                return this.enterSection("tasks"), this
            }, h.prototype.openInvolveTasks = function() {
                return this.enterSection("involveTasks"), this
            }, h.prototype.openNotes = function() {
                return this.enterSection("notes"), this
            }, h.prototype.openEvents = function() {
                return this.enterSection("events"), this
            }, h.prototype.beforeClose = function() {
                return $("#navigator .my-handler").removeClass("active"), this
            }, h.prototype.clear = function() {
                return j.APP.Float.close(), this
            }, h.prototype.remove = function() {
                var a;
                return this.beforeClose(), a = j.router.getUrl().replace(/\/my.*/, ""), j.router.navigate(a, {trigger: !1}), h.__super__.remove.apply(this, arguments)
            }, h
        }(i)
    }), define("views/search/search/templates/noresult", [], function() {
        return function() {
            var a = '<div class="search-placeholder-wrap muted"> <div> <p> <span class="icon icon-search-warning"></span> </p> <p class="search-placeholder-content">快速搜索，查找你所需的内容</p> </div></div>';
            return a
        }
    }), define("views/search/search/templates/placeholder", [], function() {
        return function() {
            var a = '<div class="search-placeholder-wrap muted"> <div> <p> <span class="icon icon-search-file"></span> <span class="search-beta">Beta<br/>测试版</span> </p> <p class="search-placeholder-content">快速搜索，查找你所需的内容</p> </div></div>';
            return a
        }
    }), define("views/search/search/templates/result", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            if (a.tasks.length) {
                c += '<li class="search-result card"> ';
                var d = a.tasks;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; ) {
                        if (e = d[f += 1], c += ' <a class="result-handler task" data-id="' + e._id + '"> <div class="result-thumbnail"> <span class="icon icon-checkbox"></span> </div> <div class="result-content"> <p> <span>' + e.title + "</span> ", e.tag && (c += ' <span class="label"> <span class="tag-label tag-label-' + e.tag.color + '"></span> <span class="tag-name">' + b(e.tag.name) + "</span> </span> "), c += " </p> ", e.subtasks && e.subtasks.length > 0) {
                            c += " <ul> ";
                            var h = e.subtasks;
                            if (h)
                                for (var i, j = -1, k = h.length - 1; k > j; )
                                    i = h[j += 1], c += ' <li class="subtask"> <span class="icon icon-checkbox"></span> ' + (i.content || i.highlight) + " </li> ";
                            c += " </ul> "
                        }
                        c += " </div> </a> "
                    }
                c += "</li>"
            }
            if (a.posts.length) {
                c += '<li class="search-result card"> ';
                var l = a.posts;
                if (l)
                    for (var e, m = -1, n = l.length - 1; n > m; )
                        e = l[m += 1], c += ' <a class="result-handler post" data-id="' + e._id + '"> <div class="result-thumbnail"> <div class="avatar img-24 img-circle pull-left" style="background-image: url(' + e.avatarUrl + ');"></div> </div> <div class="result-content"> <p> <span>' + e.title + "</span> ", e.tag && (c += ' <span class="label"> <span class="tag-label tag-label-' + e.tag.color + '"></span> <span class="tag-name">' + b(e.tag.name) + "</span> </span> "), c += " </p> </div> </a> ";
                c += "</li>"
            }
            if (a.files.length) {
                c += '<li class="search-result card"> ';
                var o = a.files;
                if (o)
                    for (var e, p = -1, q = o.length - 1; q > p; )
                        e = o[p += 1], c += ' <a class="result-handler work" data-id="' + e._id + '"> <div class="result-thumbnail"> ', c += e.thumbnailUrl ? ' <div class="work-thumbnail ' + e.fileType + ' pull-left" style="background-image: url(' + e.thumbnailUrl + ');"></div> ' : ' <span class="icon icon-file-bold"></span> ', c += ' </div> <div class="result-content"> <p> <span>' + e.title + "</span> ", e.tag && (c += ' <span class="label"> <span class="tag-label tag-label-' + e.tag.color + '"></span> <span class="tag-name">' + b(e.tag.name) + "</span> </span> "), c += " </p> </div> </a> ";
                c += "</li>"
            }
            if (a.events.length) {
                c += '<li class="search-result card"> ';
                var r = a.events;
                if (r)
                    for (var e, s = -1, t = r.length - 1; t > s; )
                        e = r[s += 1], c += ' <a class="result-handler event" data-id="' + e._id + '"> <div class="result-content"> <p> <time class="event-date">' + e.eventDateString + "</time> <span>" + e.title + "</span> ", e.tag && (c += ' <span class="label"> <span class="tag-label tag-label-' + e.tag.color + '"></span> <span class="tag-name">' + b(e.tag.name) + "</span> </span> "), c += " </p> </div> </a> ";
                c += "</li>"
            }
            return c
        }
    }), define("views/search/search/templates/basic", [], function() {
        return function() {
            var a = '<div class="search-body"> <div class="search-form body-wrap clearfix"> <input type="search" placeholder="可以搜索任务、分享、日程、文件..." maxlength="100" class="form-control search-input pull-left"> <button class="search-btn btn btn-primary pull-left"> <span class="icon icon-search"></span> </button> </div></div><div class="search-content body-wrap"> <div class="result-list-wrapper"> <ul class="result-list thin-scroll"></ul> </div> <div class="result-detail-wrapper"> <div class="detail-header"></div> <div class="detail-panel hack-render-bug"> </div> </div></div>';
            return a
        }
    }), define("views/search/search/templates/title", [], function() {
        return function(a) {
            var b = '<a class="btn url-handler" href="' + a[0].url + '">' + a[0].title + "</a>";
            return a[1] && (b += '<a class="btn url-handler" href="' + a[1].url + '">' + a[1].title + "</a>"), b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/search/search/index", ["require", "exports", "module", "teambition", "moment", "lib/scrollable", "util", "view", "collections/projects", "collections/searches", "views/events/event-detail/index", "views/wall/post-detail/index", "views/library/previewer/index", "views/board/task/task-detail/index", "lib/window/index", "./templates/noresult", "./templates/placeholder", "./templates/result", "./templates/basic", "./templates/title"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t;
        return t = a("teambition"), d = a("moment"), k = a("lib/scrollable"), q = a("util"), r = a("view"), i = a("collections/projects"), n = a("collections/searches"), c = a("views/events/event-detail/index"), g = a("views/wall/post-detail/index"), h = a("views/library/previewer/index"), o = a("views/board/task/task-detail/index"), s = a("lib/window/index"), e = a("./templates/noresult"), f = a("./templates/placeholder"), j = a("./templates/result"), l = a("./templates/basic"), p = a("./templates/title"), m = function(a) {
            function k() {
                return k.__super__.constructor.apply(this, arguments)
            }
            return b(k, a), k.prototype.viewName = "SearchView", k.prototype.className = "search-view float-view", k.prototype.events = {"click .search-btn": "startSearch","keydown .search-input": "quickSearch","click .result-handler": "openDetail"}, k.prototype.initialize = function(a) {
                return this.options = a || {}, this.collection = n.get(0), this.renderBasic().listen(), $("#navigator .search-handler").addClass("active"), this.$el.transition({scale: 1,opacity: 1}, 218, function(a) {
                    return function() {
                        return a.$input.focusAtEnd()
                    }
                }(this)), this
            }, k.prototype.renderBasic = function() {
                return this.$el.html(l()), this.$placeholder = $(f()), this.$noresult = $(e()), this.$input = this.$(".search-input"), this.$list = this.$(".result-list").html(this.$placeholder), this.$detailHeader = this.$(".detail-header"), this.$detailPanel = this.$(".detail-panel"), this
            }, k.prototype.listen = function() {
                return this.listenTo(this.collection, "reset", function(a) {
                    return function() {
                        return a.$list.empty()
                    }
                }(this)), this
            }, k.prototype.renderResult = function(a) {
                var b;
                return b = {tasks: [],posts: [],files: [],events: []}, _.each(a, function(a) {
                    return function(c) {
                        switch (c = a.getHighlight(c), c = a.getDateString(c), c.type) {
                            case "task":
                                return b.tasks.push(c);
                            case "post":
                                return b.posts.push(c);
                            case "work":
                                return b.files.push(c);
                            case "event":
                                return b.events.push(c)
                        }
                    }
                }(this)), this.$list.append(j(b)), this
            }, k.prototype.getHighlight = function(a) {
                return a.title = _.escape(a.title || a.highlight), a.title = a.title.replace(/\&lt;em\&gt;([^\s]+?)\&lt;\/em\&gt;/g, "<em>$1</em>"), a
            }, k.prototype.getDateString = function(a) {
                var b, c;
                return a.startDate && (c = q.formatDate(new Date(a.startDate)).dateString, a.eventDateString = c + " " + d(a.startDate).format("LT"), a.endDate && (a.eventDateString += " ~", b = q.formatDate(new Date(a.endDate)).dateString, b !== c && (a.eventDateString += " " + b), a.eventDateString += " " + d(a.endDate).format("LT"))), a.dateString = q.formatDate(new Date(a.date)).dateString, a
            }, k.prototype.startSearch = function() {
                var a;
                return a = this.$input.val().trim(), this.collection.reset(), this.$detailHeader.empty(), this.text = a, this.text ? this.load({silent: !0,attrs: {q: this.text},beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$list)
                    }
                }(this),success: function(a) {
                    return function(b, c) {
                        return a.$el ? (a.renderResult(c), a.hideLoadingIndicator(), a.checkPlaceholder(), a.collection.hasMore ? a.setupScroll(a.$list) : a.collection.length && a.showEndPoint(a.$list), t.gta.event(null, "view", "search result|start search", a.text.length)) : void 0
                    }
                }(this)}) : this.checkPlaceholder(), this
            }, k.prototype.quickSearch = function(a) {
                return 13 === a.keyCode && (a.preventDefault(), this.startSearch()), this
            }, k.prototype.load = function(a) {
                return this.collection.resetSoft(), this.collection.fetch(a), this
            }, k.prototype.loadMore = function(a) {
                return this.collection.loadMore({silent: !0,attrs: {q: this.text},beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$list)
                    }
                }(this),success: function(b) {
                    return function(c, d) {
                        return b.$el ? (b.hideLoadingIndicator({animated: !0}), _.each(d, function(a) {
                            return b.collection.add(a)
                        }), b.renderResult(d), b.collection.hasMore ? "function" == typeof a && a() : b.showEndPoint(b.$list), t.gta.event(null, "view", "search result|load more", b.pageIndex + 1)) : void 0
                    }
                }(this)}), this
            }, k.prototype.checkPlaceholder = function() {
                var a;
                return this.collection.length ? this.$noresult.remove() : this.text.length > 0 && (a = this.text, this.$noresult.find(".search-placeholder-content").text("抱歉，没有找到与 “" + a + "” 相关的内容"), this.$list.html(this.$noresult)), this
            }, k.prototype.openDetail = function(a) {
                var b, d, e, f, i, j, k, l;
                if (b = $(a.currentTarget), !b.hasClass("active")) {
                    switch (this.$list.find(".active").removeClass("active"), b.addClass("active"), f = b.data("id"), d = this.collection.get(f), e = function(a) {
                        return function(b) {
                            var c, d, e;
                            return (c = b.$activityCreator) ? (d = .5 * a.$detailPanel.height(), e = function(a) {
                                return b.$el.css("bottom", a)
                            }, c.appendTo(a.$detailPanel), b.activityTimelineView.renderCreator(c, d), c.find(".flex-text-wrap").css("max-height", d), c.on("slideHide.activity", function() {
                                return e(0)
                            }).on("slideShow.activity changeHeight.activity", function(a, b) {
                                return e(b - 1)
                            }).slideShow()) : void 0
                        }
                    }(this), null != (j = this.detailView) && null != (k = j.currentView) && "function" == typeof k.close && k.close(), null != (l = this.detailView) && l.remove(), this.$detailHeader.empty(), this.$detailPanel.empty(), i = d.get("_projectId"), d.get("type")) {
                        case "task":
                            this.detailView = this.requestSubView(o, {_taskId: f,inPanel: !0,success: function(a) {
                                return function(b) {
                                    return a.renderDetailHeader("task", i, b.taskModel), e(b, !0)
                                }
                            }(this)}), this.detailView.$el.addClass("detail-card").appendTo(this.$detailPanel);
                            break;
                        case "post":
                            this.detailView = this.requestSubView(g, {_postId: f,inPanel: !0,success: function(a) {
                                return function(b) {
                                    return a.renderDetailHeader("post", i, b.postModel), e(b, !0)
                                }
                            }(this)}), this.detailView.$el.addClass("detail-card").appendTo(this.$detailPanel);
                            break;
                        case "event":
                            this.detailView = this.requestSubView(c, {_eventId: f,inPanel: !0,success: function(a) {
                                return function(b) {
                                    return a.renderDetailHeader("event", i, b.eventModel), e(b, !0)
                                }
                            }(this)}), this.detailView.$el.addClass("detail-card").appendTo(this.$detailPanel);
                            break;
                        case "work":
                            this.detailView = this.requestSubView(s).open(h, {_workId: f})
                    }
                    return t.gta.event(null, "view", "search click|show detail", b.index())
                }
            }, k.prototype.renderDetailHeader = function(a, b, c) {
                var d, e, f;
                if (e = i.getOne(0, b)) {
                    switch (f = "/project/" + e.id, d = [{url: f,title: "前往项目：" + e.get("name")}], a) {
                        case "task":
                            d[1] = {url: "" + f + "/tasks/scrum/" + c.get("_tasklistId") + "/task/" + c.id,title: "前往任务板"};
                            break;
                        case "post":
                            d[1] = {url: "" + f + "/posts/post/" + c.id,title: "前往分享墙"};
                            break;
                        case "event":
                            d[1] = {url: "" + f + "/events/event/" + c.id,title: "前往日程表"}
                    }
                    this.$detailHeader.html(p(d))
                }
                return this
            }, k.prototype.remove = function() {
                return $("#navigator .search-handler").removeClass("active"), k.__super__.remove.apply(this, arguments)
            }, k
        }(r), _.extend(m.prototype, k), m
    }), define("views/core/float/templates/basic", [], function() {
        return function() {
            var a = '<div class="slide-view-wrapper" id="slide-view-wrapper"></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/core/float/index", ["require", "exports", "module", "teambition", "views/inbox/inbox/index", "views/my/my/index", "views/search/search/index", "./templates/basic", "view"], function(a) {
        var c, d, e, f, g, h, i, j, k, l;
        return l = a("teambition"), f = a("views/inbox/inbox/index"), g = a("views/my/my/index"), i = a("views/search/search/index"), j = a("./templates/basic"), k = a("view"), h = {position: "absolute",right: "-100%"}, c = $("body"), d = $(window), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "FloatView", e.prototype.hotkeys = {i: "toggleInbox",m: "toggleMy","s|/": "toggleSearch",esc: function(a) {
                return a.preventDefault(), this.close()
            }}, e.prototype.disableFloat = !1, e.prototype.open = function(a, b, d) {
                return this.disableFloat || l.user.get("isGhost") ? void 0 : (l.APP.hidePanel(), b = _.extend({animateType: "slide"}, b || {}), this.currentView instanceof a ? (this.currentView.remove(), this.currentView = this._currentView = this.requestSubView(a, b), this.currentView.$el.appendTo(c), this.listenTo(this.currentView, "close", function(a) {
                    return function() {
                        return a.close()
                    }
                }(this)), l.APP.setDataCategory(d)) : (this._currentView = this.requestSubView(a, b), this._closeView(function(a) {
                    return function() {
                        return a.currentView = a._currentView, a.animate(a.currentView.$el, "open", b.onOpen), a.listenTo(a.currentView, "close", function() {
                            return a.close()
                        }), l.APP.setDataCategory(d)
                    }
                }(this))), this)
            }, e.prototype._closeView = function(a) {
                var b, c, d;
                return l.APP.hidePanel(), l.APP.setDataCategory(), this.currentView ? (c = this.prevView = this.currentView, b = this.$container, null != (d = this.prevView) && "function" == typeof d.beforeClose && d.beforeClose(), this.animate(c.$el, "close", function() {
                    return function() {
                        return null != c && "function" == typeof c.remove && c.remove(), null != b && "function" == typeof b.remove && b.remove(), "function" == typeof a ? a() : void 0
                    }
                }(this))) : "function" == typeof a && a(), this
            }, e.prototype.close = function(a) {
                return this.disableFloat ? void 0 : (l.APP.hidePanel(), this._closeView(function(b) {
                    return function() {
                        return b.currentView = b.prevView = b._currentView = null, "function" == typeof a ? a() : void 0
                    }
                }(this)), this)
            }, e.prototype.toggle = function(a, b, c) {
                var d;
                if (!this.disableFloat)
                    return b || (b = {}), d = b.isSame || function(b) {
                        return function() {
                            return b.currentView instanceof a
                        }
                    }(this), d = d(), d ? this.close() : this.open(a, b, c), !d
            }, e.prototype.toggleMy = function(a) {
                return this.toggle(g, a, "my")
            }, e.prototype.toggleInbox = function(a) {
                return this.toggle(f, a, "inbox")
            }, e.prototype.toggleSearch = function(a) {
                return null == a && (a = {}), a.animateType = "fade", this.toggle(i, a, "search")
            }, e.prototype.animate = function(a, b, c) {
                return "open" === b ? this.animate_open(a, b, c) : this.animate_close(a, b, c)
            }, e.prototype.animate_open = function(a, b, e) {
                var f, g;
                switch (c.addClass("float-open"), f = this.currentView.options.animateType) {
                    case "slide":
                        return g = -d.height(), a.transition({y: g}, 0), a.appendTo(c), a.transition({y: 0}, 300, "ease", function() {
                            return function() {
                                return a.transition({y: .01 * g}, 80, function() {
                                    return a.transition({y: 0}, 40, function() {
                                        return "function" == typeof e ? e() : void 0
                                    })
                                })
                            }
                        }(this));
                    case "fade":
                        return a.appendTo(c), a.fadeIn(218, function() {
                            return function() {
                                return "function" == typeof e ? e() : void 0
                            }
                        }(this))
                }
            }, e.prototype.animate_close = function(a, b, e) {
                var f, g, h, i;
                if (f = (null != (h = this._currentView) ? h.options.animateType : void 0) || !1, g = (null != (i = this.prevView) ? i.options.animateType : void 0) || !1, g !== f && g && f)
                    return c.removeClass("float-open"), "function" == typeof e ? e() : void 0;
                switch (g) {
                    case "slide":
                        return a.transition({y: -d.height()}, 300, "snap", function() {
                            return function() {
                                return c.removeClass("float-open"), "function" == typeof e ? e() : void 0
                            }
                        }(this));
                    case "fade":
                        return a.fadeOut(218, function() {
                            return function() {
                                return c.removeClass("float-open"), "function" == typeof e ? e() : void 0
                            }
                        }(this))
                }
            }, e.prototype.remove = function() {
                return c.removeClass("float-open"), e.__super__.remove.apply(this, arguments)
            }, e
        }(k)
    }), define("views/home/events-list/templates/event", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="event open-detail clearfix" data-id="' + a._id + "\" data-gta='event' data-label='home |open today event detail' data-date=\"" + a.startDate + '"> <div class="event-time muted"> <time>' + a.startDateString + "</time> ";
            return a.endDateString && (c += " ~ <time>" + a.endDateString + "</time> "), c += ' </div> <div class="event-content"> <p class="event-title"> ' + b(a.title) + " </p> ", a.location && (c += ' <p class="event-place muted"> <span class="icon icon-location"></span> ' + b(a.location) + " </p> "), c += " </div></li>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/home/events-list/index", ["require", "exports", "module", "teambition", "collections/events", "views/events/event-detail-panel/index", "./templates/event", "moment", "util", "view"], function(a) {
        var c, d, e, f, g, h, i, j, k;
        return k = a("teambition"), e = a("collections/events"), c = a("views/events/event-detail-panel/index"), d = a("./templates/event"), h = a("moment"), i = a("util"), j = a("view"), g = "ZH", f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.tagName = "ul", f.prototype.className = "today-events-view", f.prototype.events = {"click .open-detail": "openEvent"}, f.prototype.initialize = function(a) {
                return a._projectId ? (this._projectId = a._projectId, e.fetch(this._projectId, {attrs: {today: h().startOf("day").toISOString()},success: function(a) {
                    return function(b) {
                        return a.eventsCollection = b, a.renderBasic().listen()
                    }
                }(this)}), this) : void 0
            }, f.prototype.listen = function() {
                return this.listenTo(this.eventsCollection, "remove destroy", function(a) {
                    return function(b) {
                        return a.removeEvent(b), a.checkEvents()
                    }
                }(this)), this.listenTo(this.eventsCollection, "add change", function(a) {
                    return function(b) {
                        return a.renderEvent(b), a.checkEvents()
                    }
                }(this)), this
            }, f.prototype.renderBasic = function() {
                return this.eventsCollection.each(function(a) {
                    return function(b) {
                        return a.renderEvent(b)
                    }
                }(this)), _.delay(function(a) {
                    return function() {
                        return a.$parentCard = a.$el.closest(".today-events"), a.checkEvents()
                    }
                }(this)), this
            }, f.prototype.renderEvent = function(a) {
                var b, c, e, f, g, j;
                if ("today" !== a.getScope())
                    return this.removeEvent(a);
                if (f = a.toJSON(), f.title = i.escape(f.title), f.location = i.escape(f.location), g = h(f.startDate), f.startDate = g.valueOf(), f.startDateString = g.format("LT"), null != f.endDate && (f.endDateString = h(f.endDate).format("LT")), c = $(d(f)), j = this.$(".event[data-id=" + f._id + "]"), j.length && f.startDate === +j.data("date"))
                    j.replaceWith(c);
                else {
                    if (j.remove(), b = this.$(".event:first"), !(b.length && f.startDate > b.data("date")))
                        return c.prependTo(this.$el);
                    for (e = b.next(".event"); e.length && f.startDate > e.data("date"); )
                        b = e, e = b.next(".event");
                    c.insertAfter(b)
                }
                return this
            }, f.prototype.removeEvent = function(a) {
                return this.$(".event[data-id=" + a.id + "]").remove(), this
            }, f.prototype.openEvent = function(a) {
                var b, d;
                return d = $(a.currentTarget).data("id"), (b = this.eventsCollection.get(d)) ? (k.APP.showPanel(c, {noExecutor: !0,_projectId: b.get("_projectId"),eventModel: b}), this) : void 0
            }, f.prototype.checkEvents = function() {
                return this.$parentCard[this.$el.children().length ? "show" : "hide"]()
            }, f
        }(j)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/review", ["require", "exports", "module", "model", "util"], function(a) {
        var c, d, e;
        return c = a("model"), e = a("util"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "review", c.prototype.urlRoot = "reviews", c.prototype.initialize = function(a, b) {
                return b || (b = {}), b.bindByMatrix = !1, c.__super__.initialize.apply(this, arguments)
            }, c.prototype.parse = function(a) {
                var b, c;
                return b = a.boundToObject, c = function() {
                    switch (a.boundToObjectType) {
                        case "task":
                        case "entry":
                            return b.content;
                        case "event":
                            return b.title;
                        case "work":
                            return b.fileName;
                        case "post":
                            return e.parsePost(b).description
                    }
                }(), a.content = e.escape(c), a
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("collections/reviews", ["require", "exports", "module", "collection", "models/review"], function(a) {
        var c, d, e;
        return c = a("collection"), d = a("models/review"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "reviews", c.prototype.model = d, c.prototype.boundToObjectType = "project", c.prototype.parse = function(a) {
                var b;
                if (a)
                    return b = [], _.isArray(a) || (a = [a]), _.each(a, function() {
                        return function(a) {
                            var c;
                            return c = ("function" == typeof a.get ? a.get("boundToObject") : void 0) || a.boundToObject, (null != c ? c.recurrence : void 0) ? void 0 : b.push(a)
                        }
                    }(this)), b
            }, c.prototype.getAdjacentUnique = function() {
                var a, b;
                return b = [], a = null, this.each(function() {
                    return function(c) {
                        var d, e;
                        return d = null != (e = c.get("boundToObject")) ? e._id : void 0, d !== a || "project" === c.get("boundToObjectType") ? (b.push(c), a = d) : void 0
                    }
                }(this)), b
            }, c.prototype.comparator = function(a) {
                return -new Date(a.get("created")).getTime()
            }, c
        }(c)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/wall/post-panel/index", ["require", "exports", "module", "lib/panel/index", "views/wall/post-detail/index"], function(a) {
        var c, d, e;
        return c = a("lib/panel/index"), d = a("views/wall/post-detail/index"), e = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "PostPanelView", c.prototype.className = "post-panel panel-view", c.prototype.defaultLayer = d, c.prototype.initialize = function(a) {
                return a && (a.postModel || a._postId) ? (this._postId = a._postId || a.postModel.id, _.isNumber(a.rightOffset) && (this.rightOffset = a.rightOffset), c.__super__.initialize.apply(this, arguments)) : !1
            }, c.prototype.isSame = function(a) {
                var b, c;
                return b = a._postId || (null != (c = a.postModel) ? c.id : void 0), b === this._postId
            }, c
        }(c)
    }), define("views/home/reviews-card/templates/review", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="review open-detail" data-type="' + a.boundToObjectType + '" data-id="' + a._id + '" data-object-id="' + a._boundToObjectId + '" data-gta="event" data-label="home|view activity detail"> <div class="avatar img-circle img-24" style="background-image:url(' + a.creator.avatarUrl + ')"></div> <div class="review-body';
            return a.isSystem && (c += "-system"), c += ' clearfix" data-type="' + a.boundToObjectType + '"> <p class="review-title"><span class="review-executor">' + b(a.creator.name) + "</span>" + b(a.title) + "</p> ", a.isSystem || (c += ' <p class="review-content"> <span class="icon ' + a.icon + '"></span> <span class="hinted auto-hint" data-title="' + a.content + '">' + b(a.content) + "</span> </p> "), c += ' </div> <div class="review-timeline"> <time class="muted">' + a.createdTime + "</time> </div></li>"
        }
    }), define("views/review/week-picker/templates/basic", [], function() {
        return function(a) {
            var b = "", c = a.weeks;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += " ", b += "groupBy" == d.type ? ' <li class="week-item group-by"> <span class="group-name">' + d.groupName + "</span> </li> " : ' <li class="week-item" data-index="' + e + '" data-gta="event" data-label="review week" data-action="click"> <a> <span class="start-date">' + d.startDateString + '</span> <span> - </span> <span class="end-date">' + d.endDateString + '</span> <span class="week"> (' + d.week + ")</span> </a> </li> ";
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/review/week-picker/index", ["require", "exports", "module", "lib/dropdown/index", "moment", "./templates/basic"], function(a) {
        var c, d, e, f;
        return c = a("lib/dropdown/index"), d = a("moment"), e = a("./templates/basic"), f = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "WeekPickerView", c.prototype.className = "week-picker-wrapper thin-scroll", c.prototype.events = {"click .week-item": "selectedWeek"}, c.prototype.initialize = function(a) {
                return (null != a ? a.projectCreated : void 0) ? (this.options = a, this.options.direction = "auto bottom", this.weeks = [], this.weeksList = [], this.renderBasic().renderSelected(this.weeks[0]), this) : void 0
            }, c.prototype._generateWeek = function() {
                var a, b, c, e, f, g, h, i;
                for (b = d(), i = f = null, e = 52; e > 0; )
                    g = b.clone().startOf("week"), c = b.clone().endOf("week"), f = b.format("MMM"), h = b.format("wo"), f !== i && (i = f, this.weeksList.push({type: "groupBy",groupName: f})), a = {startDateString: g.format("MM.DD"),endDateString: c.format("MM.DD"),startDate: g.toISOString(),endDate: c.toISOString(),week: h}, this.weeksList.push(a), this.weeks.push(a), e--, g.valueOf() < d(this.options.projectCreated).valueOf() && (e = 0), b.add(-1, "weeks");
                return this
            }, c.prototype.renderBasic = function() {
                return this._generateWeek(), this.$el.html(e({weeks: this.weeksList})), this
            }, c.prototype.renderSelected = function(a) {
                return _.isObject(a) && (a = this.weeksList.indexOf(a)), this.index = a, this.$(".selected").removeClass("selected"), this.$("[data-index=" + a + "]").addClass("selected"), this
            }, c.prototype.selectedWeek = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), c = b.data("index"), this.index !== c && (this.renderSelected(c), "function" == typeof (d = this.options).onSelectedChange && d.onSelectedChange(this.weeksList[c])), this
            }, c
        }(c)
    }), define("views/home/reviews-card/templates/card", [], function() {
        return function(a) {
            var b = '<li class="reviews-card card" data-date="' + a.startDate + '"> <header class="card-header"> ' + a.dateString + '动态 </header> <section class="card-content"> <ul class="reviews-list"></ul> </section></li>';
            return b
        }
    }), define("views/home/reviews-card/templates/placeholder", [], function() {
        return function() {
            var a = '<div class="project-activities-placeholder"> <span class="placeholder-image"></span> <span class="icon icon-project"></span><br /> <span class="placeholder-message">项目动态，实时展现项目进展</span><br /> <span class="placeholder-message">点击上方新建按钮添加内容</span></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/home/reviews-card/index", ["require", "exports", "module", "teambition", "moment", "lib/scrollable", "util", "view", "models/review", "collections/members", "collections/projects", "collections/reviews", "collections/works", "views/bookkeeping/entry-detail-panel/index", "views/events/event-detail-panel/index", "views/wall/post-panel/index", "views/library/previewer/index", "./templates/review", "views/board/task/task-detail-panel/index", "views/review/week-picker/index", "lib/window/index", "./templates/card", "./templates/placeholder"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y;
        return y = a("teambition"), h = a("moment"), q = a("lib/scrollable"), s = a("util"), t = a("view"), n = a("models/review"), g = a("collections/members"), l = a("collections/projects"), m = a("collections/reviews"), w = a("collections/works"), d = a("views/bookkeeping/entry-detail-panel/index"), e = a("views/events/event-detail-panel/index"), j = a("views/wall/post-panel/index"), k = a("views/library/previewer/index"), o = a("./templates/review"), r = a("views/board/task/task-detail-panel/index"), u = a("views/review/week-picker/index"), v = a("lib/window/index"), c = a("./templates/card"), i = a("./templates/placeholder"), f = "ZH", x = {_boundToObjectId: "xxxxxxx",_id: "xxxxxxx",action: "create",boundToObjectType: "task",content: "测试任务",title: "创建了任务",creator: {}}, p = function(a) {
            function n() {
                return n.__super__.constructor.apply(this, arguments)
            }
            return b(n, a), n.prototype.viewName = "ReviewsCardView", n.prototype.tagName = "ul", n.prototype.className = "reviews-card-view", n.prototype.events = {"click .open-detail": "openDetail"}, n.prototype.initialize = function(a) {
                var b, c;
                if (null != a ? a._projectId : void 0)
                    return x._creatorId = y.user.id, x.created = (new Date).toISOString(), x.creator.avatarUrl = y.user.get("avatarUrl"), x.creator.name = y.user.get("name"), this.options = a, this._projectId = a._projectId, this.projectModel = l.getOne(0, this._projectId), this.membersCollection = g.get(this._projectId), this.loadedReviews = 0, this.todayDate = c = h().startOf("day").toISOString(), b = h().endOf("day").toISOString(), this.dateList = [{startDate: c,endDate: b}], this.showLoadingIndicator(), m.fetch(this._projectId, {attrs: {_projectId: this._projectId,startDate: c,endDate: b},success: function(a) {
                        return function(b) {
                            return a.reviewsCollection = a.filterWorks(b), a.hideLoadingIndicator({animated: !0}), a.loadedReviews = b.length, a.renderCard(b, c), a.checkPlaceholder(), a.listen(), a.checkload(15)
                        }
                    }(this)}), this
            }, n.prototype.listen = function() {
                return this.listenTo(this.reviewsCollection, "add", function(a) {
                    return function(b) {
                        var c;
                        return c = a.$(".reviews-card[data-date=" + h(a.todayDate).valueOf() + "]"), c = c.find(".reviews-list"), a.checkPlaceholder(), a.renderReview(b, c, !0)
                    }
                }(this)), this
            }, n.prototype.filterWorks = function(a) {
                var b, c;
                return c = this.projectModel.get("_defaultCollectionId"), b = a.filter(function() {
                    return function(a) {
                        var b;
                        return (null != (b = a.get("boundToObject")) ? b._parentId : void 0) === c
                    }
                }(this)), a.remove(b), a
            }, n.prototype.load = function(a) {
                var b;
                return b = "" + this._projectId + "_" + a.startDate, a.beforeSend(), m.fetch(b, {boundToObjectType: "",attrs: {_projectId: this._projectId,startDate: a.startDate,endDate: a.endDate},success: function(b) {
                    return function(c) {
                        return b.$el ? a.success(c) : void 0
                    }
                }(this),error: function() {
                    return function() {
                        return "function" == typeof a.error ? a.error() : void 0
                    }
                }(this)}), this
            }, n.prototype.checkload = function(a) {
                return this.$el && --a ? (this.checkingload = !0, this.loadMore(function(b) {
                    return function() {
                        return b.loadedReviews < 10 ? _.delay(function() {
                            return b.checkload(a)
                        }, 200) : (b.checkingload = !1, b.setupScroll(), b.setupLoadMore(10))
                    }
                }(this), null, !0), this) : void 0
            }, n.prototype.loadMore = function(a, b, c) {
                var d, e, f, g;
                return f = _.last(this.dateList).startDate, d = h(f).subtract(1, "days"), d.isBefore(this.projectModel.get("created"), "day") ? void 0 : (g = d.startOf("day").toISOString(), e = d.endOf("day").toISOString(), this.dateList.push({startDate: g,endDate: e}), this.load({startDate: g,endDate: e,beforeSend: function(a) {
                    return function() {
                        return a.checkingload ? void 0 : a.showLoadingIndicator(a.$el)
                    }
                }(this),success: function(b) {
                    return function(d) {
                        return b.hideLoadingIndicator({animated: !0}), b.filterWorks(d), b.loadedReviews += d.length, b.renderCard(d, g), "function" == typeof a && a(), c ? void 0 : y.gta.event(null, "load more", "home|view more activities")
                    }
                }(this)}), this)
            }, n.prototype.renderCard = function(a, b) {
                var d, e, g, i, j, k;
                if (j = a.getAdjacentUnique(), b = h(b), d = this.$(".reviews-card[data-date=" + b.valueOf() + "]"), !d.length) {
                    if (i = "EN" === f ? "MMM Do" : "MMMDo", k = b.isSame(h(), "day"), g = k ? "今日" : b.format(i), "EN" === f && (g += " "), !k && !j.length)
                        return;
                    d = $(c({startDate: b.valueOf(),dateString: g})), k && (d.find("header").addClass("guide-handler").data("guide", "homeToday"), this.$todayCard = d), d.appendTo(this.$el)
                }
                return e = d.find(".reviews-list"), _.each(j, function(a) {
                    return function(b) {
                        return a.renderReview(b, e)
                    }
                }(this)), this
            }, n.prototype.renderReview = function(a, b, c, d) {
                var e, f, g;
                switch (g = d ? a : a.toJSON(), g.createdTime = h(g.created).format("HH:mm"), g.creator || (g.creator = {}), f = g.boundToObject, g.boundToObjectType) {
                    case "task":
                        g.icon = "icon-board-bold";
                        break;
                    case "post":
                        g.icon = "icon-wall-bold";
                        break;
                    case "work":
                        g.icon = "icon-file-bold", g.reviewContent += " (" + s.formatFileSize(f.fileSize || 0) + ")";
                        break;
                    case "event":
                        g.icon = "icon-calendar-bold";
                        break;
                    case "project":
                        g.isSystem = !0;
                        break;
                    case "entry":
                        g.icon = "icon-bookkeeping"
                }
                return e = $(o(g)), d && e.addClass("demo-reivew"), b[c === !0 ? "prepend" : "append"](e), this
            }, n.prototype.checkPlaceholder = function() {
                var a, b, c, d, e, f;
                if (this.$todayCard) {
                    if (a = this.$todayCard.find(".reviews-list"), a.find(".review-placeholder, .project-activities-placeholder, .demo-reivew").remove(), !(null != (e = this.reviewsCollection) ? e.length : void 0)) {
                        for (f = [1, 2, 3], c = 0, d = f.length; d > c; c++)
                            b = f[c], this.renderReview(_.clone(x), a, null, !0);
                        a.append(i())
                    }
                    return this
                }
            }, n.prototype.openDetail = function(a) {
                var b, c, f;
                switch (b = $(a.currentTarget), f = b.data("type"), c = b.data("object-id"), f) {
                    case "task":
                        y.APP.showPanel(r, {_projectId: this._projectId,_taskId: c});
                        break;
                    case "event":
                        y.APP.showPanel(e, {_projectId: this._projectId,_eventId: c});
                        break;
                    case "post":
                        y.APP.showPanel(j, {_projectId: this._projectId,_postId: c});
                        break;
                    case "work":
                        w.fetchOne(this._projectId, c, {success: function(a) {
                            return function(b) {
                                var c;
                                return c = {_projectId: a._projectId,workModel: b,workModels: [b]}, a.requestSubView(v).open(k, c)
                            }
                        }(this)});
                        break;
                    case "entry":
                        y.APP.showPanel(d, {_entryId: c})
                }
                return this
            }, n
        }(t), _.extend(p.prototype, q), p
    }), define("views/home/tasks-chart/templates/placeholder", [], function() {
        return function() {
            var a = '<a class="tasks-chart-placeholder"> <span class="placeholder-image"></span><br /> <span class="placeholder-message">项目最近5天任务进展情况，实时更新</span></a>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/home/tasks-chart/index", ["require", "exports", "module", "teambition", "ichart", "moment", "./templates/placeholder", "util", "view"], function(a) {
        var c, d, e, f, g, h, i, j, k;
        return k = a("teambition"), d = a("ichart"), f = a("moment"), g = a("./templates/placeholder"), i = a("util"), j = a("view"), e = "ZH", c = {render: "recent-tasks-progress",border: null,animation: !0,data: [],labels: [],padding: [0, 30, 0, 0],width: 350,height: 230,column_width: 25,background_color: "#ffffff",label: {color: "#a6a6a6"},sub_option: {label: {color: "transparent"},border: null},legend: {enable: !0,align: "center",valign: "bottom",background_color: null,line_height: 20,color: "#a6a6a6",border: null,column: 2,offsety: -5,legend_space: 20},coordinate: {border: null,width: "100％",height: 140,padding: 0,offsety: -20,offsetx: 30,grid_color: "rgba(0, 0, 0, 0.07)",axis: {color: "rgba(0, 0, 0, 0.12)",width: 0},scale: [{label: {color: "#a6a6a6"}}]}}, h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "TasksChartView", h.prototype.className = "tasks-chart-view", h.prototype.events = {"click .tasks-chart-placeholder": "closePlaceholder"}, h.prototype.initialize = function(a) {
                return a.projectModel ? (this.projectModel = a.projectModel, this.$el.attr("id", c.render), _.delay(function(a) {
                    return function() {
                        return a.renderBasic(), a.listen()
                    }
                }(this)), this) : void 0
            }, h.prototype.listen = function() {
                return this.listenTo(this.projectModel, "change:recent", this.refreshChart), this
            }, h.prototype.genLabels = function() {
                var a, b, c, d;
                for (d = ["昨天", "今天"], c = 3, a = f().subtract(1, "days"), b = "EN" === e ? "MMM D" : "MMMD日"; c-- > 0; )
                    d.unshift(a.subtract(1, "days").format(b));
                return d
            }, h.prototype.genData = function() {
                var a, b, c, d, e, f, g;
                for (b = 5, a = [{name: "已完成的任务数",value: [0, 0, 0, 0, 0],color: "#cbf2c7"}], this.emptyData = 0, c = this.projectModel.get("recent"), g = a[0].value, b = e = 0, f = g.length; f > e; b = ++e)
                    d = g[b], a[0].value[b] = c[b] || 0, this.emptyData = this.emptyData || c[b];
                return a
            }, h.prototype.renderBasic = function() {
                return this.chartOptions = _.clone(c), this.chartOptions.labels = this.genLabels(), this.chartOptions.data = this.genData(), this.chartOptions.tip = {enable: !0,border: {color: "rgba(0, 0, 0, 0.12)",width: 1,radius: 2},showType: "fixed",style: "textAlign:left;padding:4px 5px;cursor:pointer;backgroundColor:rgba(0, 0, 0,.85);fontSize:12px;color:#fff;",listeners: {parseText: function() {
                    return function(a, b, c, d, e) {
                        var f;
                        return f = parseInt(e), d = "", c > 0 && (d += "已完成: " + c), d
                    }
                }(this)}}, this.chart = new d.ColumnStacked2D(this.chartOptions), this.chart.draw(), this.emptyData || this.$el.append(g()), k.chart = this.chart, this
            }, h.prototype.refreshChart = function() {
                var a;
                return this.chartOptions.data = this.genData(), this.chart.load(this.chartOptions.data), null != (a = this.chart.rectangles[4]) && a.tip.refresh(), this.emptyData && this.closePlaceholder(), this
            }, h.prototype.closePlaceholder = function() {
                return this.$(".tasks-chart-placeholder").remove(), this
            }, h
        }(j)
    }), define("views/home/task-creator/templates/basic", [], function() {
        return function() {
            var a = '<form class="task-creator-form"> <textarea class="task-content-input form-control" placeholder="任务内容"></textarea> <div class="creator-handler-set executor-wrap clearfix"> <div class="creator-handler-wrap"> <a class="executor-handler"> <span class="avatar img-circle img-24"></span> <span class="name"></span><span>执行</span> </a> </div> </div> <div class="creator-handler-set clearfix"> <div class="creator-handler-wrap"> <a class="tasklist-handler"> <span class="icon icon-th-list"></span> <span class="tasklist-title"></span> </a> </div> <div class="creator-handler-wrap"> <a class="duedate-handler"> <span class="icon icon-calendar-bold"></span> <span class="due-text">选择截止日期</span> </a> </div> </div> <div class="creator-handler-set clearfix"> <div class="creator-handler-wrap"> <a class="creator-handler priority-handler"> <span class="icon icon-circle-bold priority-label"></span> <span class="priority-text">选择优先级</span> </a> </div> <div class="creator-handler-wrap"> <a class="creator-handler repeat-handler"> <span class="icon icon-repeat"></span> <span class="repeat-text">选择重复周期</span> </a> </div> </div> <div class="creator-handler-set tags-wrap clearfix"></div> <div class="creator-handler-set involve-wrap clearfix"></div> <div class="creator-handler-set submit-set clearfix"> <button class="btn btn-primary submit-handler pull-right">创建</button> <div class="btn-group dropup pull-right"> <button class="btn btn-default dropdown-toggle" data-toggle="dropdown"> <span class="visible-title">所有成员可见</span> <span class="icon icon-chevron-up"></span> </button> <ul class="dropdown-menu" role="menu"> <li><a class="visible-handler" data-type="members">所有成员可见</a></li> <li><a class="visible-handler" data-type="involves">仅参与者可见</a></li> </ul> </div> </div></form>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/home/task-creator/index", ["require", "exports", "module", "teambition", "rrule", "store", "thenjs", "util", "models/task", "collections/members", "collections/projects", "collections/tasklists", "views/member/member-involve/index", "views/member/member-menu/index", "lib/multi-modal/index", "views/core/popover-confirm/index", "views/core/popover-menu/index", "views/tag/tag-picker/index", "views/board/task/task-priority/index", "views/board/task/task-repeat/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v;
        return v = a("teambition"), l = a("rrule"), m = a("store"), t = a("thenjs"), u = a("util"), p = a("models/task"), e = a("collections/members"), k = a("collections/projects"), s = a("collections/tasklists"), f = a("views/member/member-involve/index"), g = a("views/member/member-menu/index"), h = a("lib/multi-modal/index"), i = a("views/core/popover-confirm/index"), j = a("views/core/popover-menu/index"), n = a("views/tag/tag-picker/index"), q = a("views/board/task/task-priority/index"), r = a("views/board/task/task-repeat/index"), c = a("./templates/basic"), d = "ZH", o = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "TaskCreatorView", h.prototype.className = "home-task-creator-view", h.prototype.modalTitle = "添加任务", h.prototype.events = {"change .task-content-input": "cacheTask","keydown .task-content-input": "quickSubmit","click .submit-handler": "submit","click .visible-handler": "switchVisible"}, h.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this.options = a, this._projectId = a._projectId, this.projectModel = k.getOne(0, this._projectId), this.membersCollection = e.get(this._projectId), this.localCache = m.namespace("temp").namespace("tasks_home"), this.localCacheId = "" + a._projectId + "_" + v.user.id, this.tasklistsCollection = a.tasklistCollection, this.reset(), h.__super__.initialize.apply(this, arguments)) : void 0
            }, h.prototype.reset = function() {
                var a;
                return this.taskModel && this.stopListening(this.taskModel), a = this.localCache(this.localCacheId) || {}, this._tasklistId = a._tasklistId, this._executorId = a._executorId || v.user.id, this._tasklistId ? this.tasklistModel = this.tasklistsCollection.get(this._tasklistId) : (this.tasklistModel = this.tasklistsCollection.at(0), this._tasklistId = this.tasklistModel.id), this.taskModel = new p({_creatorId: v.user.id,_executorId: this._executorId,_projectId: this._projectId,_tasklistId: this._tasklistId,priority: 0,dueDate: a.dueDate || null,involveMembers: a.involveMembers || [v.user.id],content: a.content || ""}), this.rrule = new l({freq: l.WEEKLY,dtstart: new Date}), this.hasRecurrence = !1, this.listenTo(this.taskModel, "change", this.cacheTask), this.listenTo(this.taskModel, "change:_executorId", this.renderExecutor), this.listenTo(this.taskModel, "change:dueDate", this.renderDueDate), this.listenTo(this.taskModel, "change:_tasklistId", this.renderTasklist), this
            }, h.prototype.renderMain = function(a) {
                return a.html(c()), this.$input = this.$(".task-content-input").val(this.taskModel.get("content")), this.$executorHandler = this.$(".executor-handler"), this.$duedateHandler = this.$(".duedate-handler"), this.$tasklistHandler = this.$(".tasklist-handler"), this.$submit = this.$(".submit-handler"), this.$visibleTitle = this.$(".visible-title"), this.initExecutor().initDatePicker().initTasklist().initInvolve().initTagPicker().initPriority().initRepeat().renderExecutor().renderDueDate().renderTasklist().renderPriority().renderRepeat().cacheTask(), this.switchVisible(this.$(".visible-handler[data-type=" + (this.taskModel.get("visiable") || "members") + "]")), this
            }, h.prototype.onOpen = function() {
                return this.focus(), this
            }, h.prototype.focus = function() {
                var a;
                return null != (a = this.$input) && a.focusAtEnd(), this
            }, h.prototype.initExecutor = function() {
                return this.requestSubView(g, {$toggler: this.$executorHandler,noAssign: !0,membersCollection: this.membersCollection,selected: [this._executorId],direction: "top",select: function(a) {
                    return function(b) {
                        var c;
                        return a._executorId = b, a.taskModel.set({_executorId: b}), c = a.taskModel.get("involveMembers"), b && a.taskModel.set("involveMembers", _.union(c, [b])), a.focus()
                    }
                }(this)}), this
            }, h.prototype.initDatePicker = function() {
                var a;
                return a = !1, this.$duedateHandler.data("datepicker") || this.$duedateHandler.datepicker({format: "mm-dd-yyyy",placement: "bottom" === this.options.direction ? "left" : "top",language: "ZH" === d ? "zh-CN" : d.toLowerCase(),todayHighlight: !0,todayBtn: "linked",tomorrowBtn: "linked",somedayBtn: "linked"}).on("changeDate", function(a) {
                    return function(b) {
                        return a.$el ? (a.taskModel.set({dueDate: b.date}), a.$duedateHandler.datepicker("hide"), a.focus()) : void 0
                    }
                }(this)).on("click", function(b) {
                    return function() {
                        return a = !a, b.$duedateHandler.data("datepicker").picker.toggle(a)
                    }
                }(this)).on("hide", function() {
                    return function() {
                        return a = !1
                    }
                }(this)), this
            }, h.prototype.initTasklist = function() {
                return this.requestSubView(j, {$toggler: this.$tasklistHandler,dataList: this.tasklistsCollection.map(function(a) {
                    return {_id: a.get("_id"),title: a.get("title")}
                }),selected: this.tasklistModel.id,select: function(a) {
                    return function(b) {
                        return a.tasklistModel = a.tasklistsCollection.get(b), a.taskModel.set({_tasklistId: b}), a.focus()
                    }
                }(this)}), this
            }, h.prototype.initInvolve = function() {
                return this.requestSubView(f, {_projectId: this._projectId,objectModel: this.taskModel,membersCollection: this.membersCollection,resident: [v.user.id]}).$el.prependTo(this.$(".involve-wrap")), this
            }, h.prototype.initTagPicker = function() {
                return this.requestSubView(n, {_projectId: this._projectId,objectModel: this.taskModel}).$el.prependTo(this.$(".tags-wrap")), this
            }, h.prototype.initRepeat = function() {
                return this.requestSubView(r, {repeatLabel: u.freq2Label(this.hasRecurrence ? this.rrule : null).label,select: function(a) {
                    return function(b) {
                        var c;
                        return c = u.label2Freq(b), a.hasRecurrence = !!c, c && a.updateRecurrence(c), a.renderRepeat()
                    }
                }(this)}).setup(this.$(".repeat-handler")), this
            }, h.prototype.initPriority = function() {
                return this.requestSubView(q, {currentPriority: this.taskModel.get("priority"),select: function(a) {
                    return function(b) {
                        return a.taskModel.set({priority: b}), a.renderPriority()
                    }
                }(this)}).setup(this.$(".priority-handler")), this
            }, h.prototype.switchVisible = function(a) {
                var b;
                return b = a.currentTarget ? $(a.currentTarget) : a, b.parent().addClass("selected").siblings().removeClass("selected"), this.$visibleTitle.text(b.text()), this.taskModel.set("visiable", b.data("type")), this
            }, h.prototype.renderExecutor = function() {
                var a, b;
                return a = null != (b = this.membersCollection.get(this._executorId)) ? b.toJSON() : void 0, a || (a = {name: "待认领"}), a.avatarUrl ? this.$executorHandler.find(".avatar").css({"background-image": "url(" + a.avatarUrl + ")"}) : this.$executorHandler.find(".avatar").css({"background-image": ""}).addClass("no-avatar"), this.$executorHandler.find(".name").text(a.name), this
            }, h.prototype.renderDueDate = function() {
                var a, b;
                return a = this.taskModel.get("dueDate"), b = a ? u.formatDate(a).dateString : "选择截止日期", this.$duedateHandler.find(".due-text").text(b), this
            }, h.prototype.renderTasklist = function() {
                return this.$tasklistHandler.find(".tasklist-title").text(this.tasklistModel.get("title")), this
            }, h.prototype.renderRepeat = function() {
                var a;
                return a = this.hasRecurrence ? u.freq2Label(this.rrule).string : "选择重复周期", this.$(".repeat-text").text(a), this
            }, h.prototype.renderPriority = function() {
                var a, b;
                return a = this.taskModel.get("priority"), b = a ? u.getPriorityDisplay(a) : "选择优先级", this.$(".priority-label").removeClass("task-priority-0 task-priority-1 task-priority-2").addClass("task-priority-" + a), this.$(".priority-text").text(b), this
            }, h.prototype.updateRecurrence = function(a) {
                return this.rrule = new l(_.extend(this.rrule.origOptions, a)), this
            }, h.prototype.cacheTask = function() {
                var a;
                return a = this.taskModel.toJSON(), a.content = this.$input.val().trim(), this.localCache(this.localCacheId, a.content ? a : null), this
            }, h.prototype.submit = function(a) {
                var b, c;
                return null != a && a.preventDefault(), this.$submit.prop("disabled") ? void 0 : (b = this.$input.val().trim(), c = _.compact(b.split(/\r\n|\r|\n/)), c.length > 1 ? this.createMultipleTasks(c, b) : 1 === c.length ? this.createTask([b]) : this.focus(), !1)
            }, h.prototype.createTask = function(a) {
                var b;
                return this.disableSubmit(!0), this.hasRecurrence && this.taskModel.set({recurrence: this.taskModel.genRecurrence(this.rrule)}), b = this.taskModel.toJSON(), t.eachSeries(a, function(a) {
                    return function(c, d) {
                        return b.content = d, a.taskModel.clone().save(null, {attrs: _.clone(b),wait: !0,error: function(a, b) {
                            return c(b)
                        },success: function(b) {
                            var d;
                            return b.set("tasklist", a.tasklistModel.toJSON()), "function" == typeof (d = a.options).success && d.success(b), c()
                        }})
                    }
                }(this)).then(function(b) {
                    return function() {
                        return b.localCache.remove(b.localCacheId), b.disableSubmit(!1), b.close(), v.gta.event(null, "click", "add tasks success", a.length)
                    }
                }(this)).fail(function(a) {
                    return function(b, c) {
                        return a.disableSubmit(!1), Essage.show({message: c,status: "error"}, 2e3)
                    }
                }(this))
            }, h.prototype.createMultipleTasks = function(a, b) {
                var c;
                return c = 20, a.length > c ? this.requestSubView(i, {$toggler: this.$input,title: "内容行数太多了",description: "内容最多为 " + c + " 行，你当前输入了 " + a.length + " 行。",cancelStr: "好吧，我知道了",onCancel: function(a) {
                    return function() {
                        return a.focus()
                    }
                }(this)}).show() : this.requestSubView(i, {$toggler: this.$input,title: "创建多条任务",description: "系统检测到你输入了 " + a.length + " 行内容，你是想创建多条任务吗？",cancelStr: "创建一条",confirmStr: "创建 " + a.length + " 条",onCancel: function(a) {
                    return function() {
                        return a.createTask([b])
                    }
                }(this),onConfirm: function(b) {
                    return function() {
                        return b.createTask(a)
                    }
                }(this)}).show()
            }, h.prototype.disableSubmit = function(a) {
                return this.$submit.prop("disabled", a), this.$submit[a ? "addClass" : "removeClass"]("disabled"), this
            }, h.prototype.quickSubmit = function(a) {
                return 13 === a.keyCode && (a.preventDefault(), this.submit(a)), this
            }, h.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, h
        }(h)
    }), define("views/home/home/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="card-wrap-left"> ';
            return a.hasRight >= 0 && (b += ' <div class="home-creator-wrap clearfix"> <div class="avatar img-circle img-48 pull-left" style="background-image:url(' + a.avatarUrl + ')"></div> <div class="card creator-handler-set clearfix"> <div class="handler-wrap"> <a class="creator-handler task-creator-handler" data-gta="event" data-label="home|create task"> <span class="icon icon-board"></span><br /> <span class="handler-title">新任务</span> </a> </div> <div class="handler-wrap"> <a class="creator-handler post-creator-handler" data-gta="event" data-label="home|create post"> <span class="icon icon-wall"></span><br /> <span class="handler-title">新分享</span> </a> </div> <div class="handler-wrap"> <a class="creator-handler upload-handler" data-gta="event" data-label="home|create file"> <span class="icon icon-library"></span><br /> <span class="handler-title">新文件</span> </a> </div> <div class="handler-wrap"> <a class="creator-handler event-creator-handler" data-gta="event" data-label="home|create event"> <span class="icon icon-calendar"></span><br /> <span class="handler-title">新日程</span> </a> </div> </div> </div> '), b += '</div><div class="card-wrap-right"> <div class="pin-wrap"> <div class="card project-statistics"> <header class="card-header">项目任务统计</header> <section class="card-content"> <ul class="project-statistics-list"></ul> </section> </div> <div class="card tasks-progress-chart"> <header class="card-header">最近任务进展</header> <section class="card-content tasks-chart-wrap"></section> </div> </div> <div class="card today-events"> <header class="card-header">今日日程</header> <section class="card-content today-events-wrap"> </section> </div></div>'
        }
    }), define("views/home/home/templates/placeholder", [], function() {
        return function() {
            var a = '<a class="project-statistic-placeholder"> <span class="placeholder-message">项目整体任务统计信息，实时更新</span></a>';
            return a
        }
    }), define("views/home/home/templates/statistics", [], function() {
        return function(a) {
            var b = '<li class="statistic-wrap"> <a class="statistic-total-tasks" data-gta="event" data-label="home|enter total tasks"> <span class="muted">任务总数</span><br /> <span class="statistic-count total-tasks">' + a.total + '</span> </a></li><li class="statistic-wrap"> <a class="statistic-done-tasks" data-gta="event" data-label="home|enter tasks done"> <span class="muted">已完成任务</span><br /> <span class="statistic-count done-tasks">' + a.done + '</span> </a></li><li class="statistic-wrap"> <a class="statistic-today-tasks" data-gta="event" data-label="home|enter today tasks"> <span class="muted">今天待完成任务</span><br /> <span class="statistic-count today-tasks">' + a.today + "</span> </a></li>";
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/home/home/index", ["require", "exports", "module", "teambition", "lib/guide-point/index", "moment", "util", "view", "collections/events", "collections/posts", "collections/projects", "collections/tasklists", "collections/tasks", "collections/works", "views/home/events-list/index", "views/events/event-creator/index", "views/wall/post-creator/index", "views/home/reviews-card/index", "views/home/tasks-chart/index", "views/home/task-creator/index", "lib/window/index", "views/work/work-uploader/index", "./templates/basic", "./templates/placeholder", "./templates/statistics"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y;
        return y = a("teambition"), g = a("lib/guide-point/index"), i = a("moment"), t = a("util"), u = a("view"), e = a("collections/events"), l = a("collections/posts"), m = a("collections/projects"), q = a("collections/tasklists"), s = a("collections/tasks"), x = a("collections/works"), f = a("views/home/events-list/index"), d = a("views/events/event-creator/index"), k = a("views/wall/post-creator/index"), n = a("views/home/reviews-card/index"), r = a("views/home/tasks-chart/index"), p = a("views/home/task-creator/index"), v = a("lib/window/index"), w = a("views/work/work-uploader/index"), c = a("./templates/basic"), j = a("./templates/placeholder"), o = a("./templates/statistics"), h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "HomeView", h.prototype.className = "home-view body-wrap clearfix fade", h.prototype.events = {"click .task-creator-handler": "openTaskCreator","click .post-creator-handler": "openPostCreator","click .event-creator-handler": "openEventCreator","click .project-statistic-placeholder": "closePlaceholder","click .statistic-today-tasks": "gotoTodayTasks","click .statistic-total-tasks": "gotoTotalTasks","click .statistic-done-tasks": "gotoDoneTasks"}, h.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this._projectId = a._projectId, this.projectModel = m.getOne(0, this._projectId), this._rootCollectionId = this.projectModel.get("_rootCollectionId"), this.renderBasic().renderActivitiesCard().renderEventsCard(), this.fetchStatistics().initUploader().listen(), this.renderStatisticsCard(), this.renderTasksChart(), this.pinAnimation(), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in"), g.initialize(a)
                    }
                }(this), 100), this) : void 0
            }, h.prototype.listen = function() {
                return this.listenTo(this.projectModel, "change:task", this.renderStatisticsCard), this.listenTo(y.user, "change:avatarUrl", function(a) {
                    return function() {
                        return a.$(".home-creator-wrap .avatar").attr("style", "background-image:url(" + y.user.get("avatarUrl") + ")")
                    }
                }(this)), this
            }, h.prototype.pinAnimation = function() {
                var a, b, c;
                return c = !1, b = this.$(".today-events")[0], a = $(document), a.off("scroll.home-auto-pin"), a.on("scroll.home-auto-pin", function(a) {
                    return function() {
                        var d;
                        return d = b.getBoundingClientRect().bottom, !c && 120 > d ? (c = !0, a.$el.addClass("pin")) : c && d >= 120 ? (c = !1, a.$el.removeClass("pin")) : void 0
                    }
                }(this)), this
            }, h.prototype.fetchStatistics = function() {
                return this.projectModel.getStatistic({success: function(a) {
                    return function(b) {
                        return a.projectModel.set(b)
                    }
                }(this)}), this
            }, h.prototype.renderBasic = function() {
                return this.$el.html(c({hasRight: this.projectModel.hasRight(),avatarUrl: y.user.get("avatarUrl")})), this.$statistics = this.$(".project-statistics-list"), this
            }, h.prototype.renderStatisticsCard = function() {
                var a;
                return this.$(".project-statistics").show(), a = this.projectModel.get("task"), this.$statistics.html(o(a)), a.total || a.done || a.today ? this.$(".project-statistic-placeholder").remove() : this.$statistics.append(j()), this
            }, h.prototype.renderActivitiesCard = function() {
                return this.requestSubView(n, {_projectId: this._projectId}).$el.appendTo(this.$(".card-wrap-left")), this
            }, h.prototype.renderEventsCard = function() {
                return this.requestSubView(f, {_projectId: this._projectId}).$el.appendTo(this.$(".today-events-wrap")), this
            }, h.prototype.renderTasksChart = function() {
                return this.$(".tasks-progress-chart").show(), this.requestSubView(r, {projectModel: this.projectModel}).$el.appendTo(this.$(".tasks-chart-wrap")), this
            }, h.prototype.initUploader = function() {
                return this.projectModel.hasRight() >= 0 ? (this.requestSubView(w, {dnd: $("body"),_projectId: this._projectId,_parentId: this._rootCollectionId,isBackground: !0,pick: {id: this.$(".upload-handler"),multiple: !0},success: function(a) {
                    return function(b) {
                        var c;
                        return a.projectModel.set("works", a.projectModel.get("works") + b.length), null != (c = x.find(a._rootCollectionId)) ? c.add(b) : void 0
                    }
                }(this)}), this) : this
            }, h.prototype.updateUrl = function(a, b) {
                var c, d, e;
                return b = b || {}, c = a.type, e = a._modelId, d = y.router.getPrefix() + "/home", c && e && (d += "/" + c + "/" + e, a.params && (d += "/" + a.params)), y.router.navigate(d, b), this
            }, h.prototype.openTaskCreator = function() {
                return this.projectModel.hasRight() >= 0 ? (q.fetch(this._projectId, {success: function(a) {
                    return function(b) {
                        return a.requestSubView(v).open(p, {backdrop: "static",tasklistCollection: b,_projectId: a._projectId,success: function(b) {
                            var c;
                            return a.projectModel.set("tasks", a.projectModel.get("tasks") + 1), null != (c = s.find(b.get("_stageId"))) && c.add(b.toJSON()), t.message({tips: "成功创建任务：",url: "/project/" + b.get("_projectId") + "/tasks/scrum/" + b.get("_tasklistId") + "/task/" + b.id,title: b.get("content")})
                        }})
                    }
                }(this)}), this) : this
            }, h.prototype.openPostCreator = function() {
                return this.projectModel.hasRight() >= 0 ? (this.requestSubView(v).open(k, {backdrop: "static",_projectId: this._projectId,onsave: function(a) {
                    return function(b) {
                        var c;
                        return a.projectModel.set("posts", a.projectModel.get("posts") + 1), null != (c = l.find(b.get("_projectId"))) && c.add(b.toJSON()), t.message({tips: "成功创建分享：",url: "/project/" + b.get("_projectId") + "/posts/post/" + b.id,title: b.get("description")})
                    }
                }(this)}), this) : this
            }, h.prototype.openEventCreator = function() {
                return this.projectModel.hasRight() >= 0 ? (this.requestSubView(v).open(d, {backdrop: "static",eventsCollection: e.get(this._projectId),_projectId: this._projectId,success: function(a) {
                    return function(b) {
                        return a.projectModel.set("events", a.projectModel.get("events") + 1), t.message({tips: "成功创建日程：",url: "/project/" + b.get("_projectId") + "/events/event/" + b.id,title: b.get("title")})
                    }
                }(this)}), this) : this
            }, h.prototype.closePlaceholder = function() {
                return this.$(".project-statistic-placeholder").remove(), this
            }, h.prototype.gotoTasks = function() {
                return y.router.navigate("project/" + this._projectId + "/tasks", {trigger: !0})
            }, h.prototype.gotoTodayTasks = function() {
                return y.router.navigate("project/" + this._projectId + "/tasks/scrum/todaytasks", {trigger: !0})
            }, h.prototype.gotoTotalTasks = function() {
                return y.router.navigate("project/" + this._projectId + "/tasks/scrum/totaltasks", {trigger: !0})
            }, h.prototype.gotoDoneTasks = function() {
                return y.router.navigate("project/" + this._projectId + "/tasks/scrum/donetasks", {trigger: !0})
            }, h.prototype.remove = function() {
                return $(document).off("scroll.home-auto-pin"), h.__super__.remove.apply(this, arguments)
            }, h
        }(u)
    }), define("views/library/collection-creator/templates/basic", [], function() {
        return function() {
            var a = '<div class="check-box pull-left disabled"> <span class="icon icon-tick"></span></div><div class="content-wrap collection-edit clearfix"> <div class="collection-content pull-left"> <span class="icon icon-folder-bold collection-thumbnail inverse pull-left"></span> <div class="collection-title"> <input type="text" placeholder="文件夹名称" class="form-control pull-left"> <button class="btn btn-primary btn-small submit-edit-handler pull-left">创建</button> <button class="btn btn-link btn-small cancel-edit-handler pull-left">取消</button> </div> </div></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/library/collection-creator/index", ["require", "exports", "module", "essage", "./templates/basic", "collections/collections", "util", "view"], function(a) {
        var c, d, e, f, g, h;
        return h = a("essage"), c = a("./templates/basic"), d = a("collections/collections"), f = a("util"), g = a("view"), e = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "CollectionCreatorView", d.prototype.tagName = "li", d.prototype.className = "collection-view collection-creator-view collection clearfix", d.prototype.events = {"keydown .collection-title input": "quickSubmit","click .submit-edit-handler": "submit","click .cancel-edit-handler": "cancel","click *": "stopPropagation"}, d.prototype.initialize = function(a) {
                return this.options = a, this.render(), this
            }, d.prototype.render = function() {
                return this.$el.html(c()), this.$input = this.$(".collection-title input"), this.$createBtn = this.$(".collection-title .submit-edit-handler"), this.$(".collection-edit").handleClickOutside(function(a) {
                    return function() {
                        var b;
                        return (null != (b = a.$input) ? b.val().trim() : void 0) ? void 0 : a.cancel()
                    }
                }(this)), this
            }, d.prototype.quickSubmit = function(a) {
                return 13 === a.keyCode && (a.preventDefault(), this.submit(a)), this
            }, d.prototype.submit = function() {
                var a, b;
                return b = this.$input.val().trim(), a = this.options.collection, b ? a.find(function() {
                    return function(a) {
                        return a.get("title") === b
                    }
                }(this)) ? Essage.show({message: "文件夹名称已存在！",status: "error"}, 2e3) : a.create({title: b,_projectId: this.options._projectId,_parentId: this.options._parentId}, {wait: !0,success: function(a) {
                    return function() {
                        var b;
                        return Essage.show({message: "文件夹创建成功",status: "success"}, 2e3), null != (b = a.parentView) && b.checkSelectedAll(), a.remove()
                    }
                }(this)}) : this.$input.focusAtEnd(), this
            }, d.prototype.cancel = function() {
                var a;
                return null != (a = this.parentView) && a.checkSelectedAll(), this.remove(), this
            }, d.prototype.focus = function() {
                return this.$input.focusAtEnd(), this
            }, d.prototype.stopPropagation = function(a) {
                return a.stopPropagation(), this
            }, d
        }(g)
    }), define("views/library/collection-destroyer/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="modal-content"> <header class="modal-header"> <h4 class="modal-title">' + a.title + '</h4> </header> <div class="modal-body"> ' + a.message + ' </div> <div class="modal-footer"> <button class="confirm-destroy-handler btn btn-primary pull-right">删除</button> <button class="cancel-destroy-handler btn btn-link pull-right">取消</button> </div></div>';
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/library/collection-destroyer/index", ["require", "exports", "module", "./templates/basic", "thenjs", "view"], function(a) {
        var c, d, e, f;
        return d = a("./templates/basic"), e = a("thenjs"), f = a("view"), c = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "CollectionDestroyerView", c.prototype.className = "collection-destroyer modal-dialog modal-padding card", c.prototype.events = {"click .confirm-destroy-handler": "onConfirm","click .cancel-destroy-handler": "onCancel"}, c.prototype.initialize = function(a) {
                return a.works.length || a.collections.length ? (this.options = a, this.works = a.works, this.collections = a.collections, this.render(), this) : void 0
            }, c.prototype.render = function() {
                var a;
                return a = this.options.message, this.$el.html(d({title: "确认删除",message: "确认要将 " + a + " 永久删除？"})), this
            }, c.prototype.onConfirm = function() {
                return this.$(".confirm-destroy-handler").text("正在删除..."), this.$(".cancel-destroy-handler").hide(), e.each(this.collections, function() {
                    return function(a, b) {
                        return b.destroy({success: function() {
                            return a()
                        },error: function(b, c) {
                            return a(c)
                        }})
                    }
                }(this)).each(this.works, function() {
                    return function(a, b) {
                        return b.destroy({success: function() {
                            return a()
                        },error: function(b, c) {
                            return a(c)
                        }})
                    }
                }(this)).then(function(a) {
                    return function() {
                        var b;
                        return Essage.show({message: "删除成功",status: "success"}, 2e3), "function" == typeof (b = a.options).success && b.success(), a.close()
                    }
                }(this)).fail(function(a) {
                    return function(b, c) {
                        return a.$(".confirm-destroy-handler").text("删除失败，点击重试"), a.$(".cancel-destroy-handler").show(), Essage.show({message: c.message || c,status: "error"}, 2e3)
                    }
                }(this)), this
            }, c.prototype.onCancel = function() {
                return this.close(), this
            }, c.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, c
        }(f)
    }), define("views/library/collection-menu/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="list collection-menu-list"> ';
            return "default" != a.collectionType && (b += ' <li> <a class="archive-collection-handler" data-gta="event" data-label="archive collection"> <span class="icon icon-archive"></span>归档文件夹 </a> </li> <li> <a class="delete-collection-handler" data-gta="event" data-label="delete collection"> <span class="icon icon-trash"></span>删除文件夹 </a> </li> '), b += ' <li class="list-divider"></li> <li class="color-choise"> <ul class="clearfix"> <li class="color red ', "red" == a.color && (b += "active"), b += '" data-color="red"><span class="icon icon-tick icon-white"></span></li> <li class="color yellow ', ("yellow" == a.color || "orange" == a.color) && (b += "active"), b += '" data-color="yellow"><span class="icon icon-tick icon-white"></span></li> <li class="color green ', "green" == a.color && (b += "active"), b += '" data-color="green"><span class="icon icon-tick icon-white"></span></li> <li class="color blue ', "blue" == a.color && (b += "active"), b += '" data-color="blue"><span class="icon icon-tick icon-white"></span></li> <li class="color purple ', "purple" == a.color && (b += "active"), b += '" data-color="purple"><span class="icon icon-tick icon-white"></span></li> <li class="color gray ', ("gray" == a.color || "inverse" == a.color) && (b += "active"), b += '" data-color="gray"><span class="icon icon-tick icon-white"></span></li> </ul> </li></ul>'
        }
    }), define("views/library/collection-menu/templates/delete", [], function() {
        return function() {
            var a = '<form class="collection-delete-form"> <p>您确定要永远删除这个文件夹吗?</p> <button class="btn btn-danger" type="submit">删除</button></form>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/library/collection-menu/index", ["require", "exports", "module", "./templates/basic", "./templates/delete", "lib/popover/index"], function(a) {
        var c, d, e, f;
        return c = a("./templates/basic"), e = a("./templates/delete"), f = a("lib/popover/index"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "CollectionMenuView", d.prototype.popoverTitle = "文件夹菜单", d.prototype.events = {"click .color": "changeColor","click .archive-collection-handler": "archiveCollection","click .delete-collection-handler": "enterDeleteSubMenu","submit .collection-delete-form": "submitDeleteForm"}, d.prototype.render = function() {
                return this.collectionModel = this.options.collectionModel, this.$el.html(c(this.collectionModel.toJSON())), this
            }, d.prototype.changeColor = function(a) {
                var b, c;
                return b = $(a.currentTarget), this.$(".active").removeClass("active"), c = b.data("color"), b.addClass("active"), this.collectionModel.save(null, {attrs: {color: c}}), this
            }, d.prototype.archiveCollection = function() {
                return this.collectionModel.archive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功归档了文件夹",status: "success"}, 2e3), a.hide()
                    }
                }(this)}), this
            }, d.prototype.enterDeleteSubMenu = function() {
                return this.enterSubMenu("删除文件夹", function(a) {
                    return function() {
                        return a.$el.html(e())
                    }
                }(this)), this
            }, d.prototype.submitDeleteForm = function(a) {
                return a.preventDefault(), this.collectionModel.destroy({success: function(a) {
                    return function() {
                        return Essage.show({message: "删除成功",status: "success"}, 2e3), a.hide()
                    }
                }(this)}), this
            }, d
        }(f)
    }), define("views/library/collection/templates/edit", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="check-box pull-left disabled"> <span class="icon icon-tick"></span></div><div class="content-wrap collection-edit clearfix"> <div class="collection-content pull-left"> <span class="icon icon-folder-bold collection-thumbnail ' + a.color + ' pull-left"></span> <span class="collection-title"> <input type="text" placeholder="文件夹名称" class="form-control pull-left" value="' + a.title + '" /> <button class="btn btn-primary btn-small submit-edit-handler pull-left">保存</button> <button class="btn btn-link btn-small cancel-edit-handler pull-left">取消</button> </span> </div> <div class="collection-info pull-right"> <span class="collection-count">' + a.subCount + '</span> <span class="collection-author">' + b(a.creator.name || "未知") + '</span> <time class="collection-updated hinted" data-title="' + a.updated + '">' + a.updatedDataString.dateString + "</time> </div></div>";
            return c
        }
    }), define("views/library/collection/templates/list-basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            return "default" != a.collectionType ? (c += '<div class="check-box pull-left ', a.hasRight < 1 && (c += "disabled"), c += '"> <span class="icon icon-tick"></span></div>') : c += '<div class="default-lock pull-left"> <span class="icon icon-lock"></span></div>', c += '<div class="content-wrap clearfix"> <div class="collection-content pull-left"> <span class="icon icon-folder-bold collection-thumbnail ' + a.color + ' pull-left"></span> ', c += "default" != a.collectionType ? ' <span class="collection-title">' + b(a.title) + "</span> " : ' <span class="collection-title">讨论的附件</span> ', c += ' </div> <div class="collection-info pull-right clearfix"> <span class="collection-count">' + a.subCount + '</span> <span class="collection-author">' + b(a.creator.name || "未知") + '</span> <time class="collection-updated hinted" data-title="' + a.updated + '">' + a.updatedDataString.dateString + '</time> <div class="collection-handler-set clearfix"> ', a.hasRight > 0 && "default" != a.collectionType && (c += ' <a class="move-collection-handler icon icon-file-move2 hinted" data-title="移动文件夹" data-gta="event" data-label="move collection"></a> <a class="edit-collection-handler icon icon-pencil hinted" data-title="重命名" data-gta="event" data-label="edit collection"></a> <a class="collection-menu-toggler icon icon-chevron-down hinted" data-title="更多操作"></a> '), c += " </div> </div></div>"
        }
    });
    var e = function(a, b) {
        return function() {
            return a.apply(b, arguments)
        }
    }, a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/library/collection/index", ["require", "exports", "module", "views/library/collection-menu/index", "./templates/edit", "./templates/list-basic", "moment", "util", "view"], function(a) {
        var c, d, f, g, h, i, j;
        return c = a("views/library/collection-menu/index"), f = a("./templates/edit"), g = a("./templates/list-basic"), h = a("moment"), i = a("util"), j = a("view"), d = function(a) {
            function d() {
                return this.stopPropagation = e(this.stopPropagation, this), this.editCancel = e(this.editCancel, this), this.editSubmit = e(this.editSubmit, this), d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "CollectionView", d.prototype.tagName = "li", d.prototype.className = "collection-view collection clearfix", d.prototype.events = {click: "checkCollection","click .collection-menu-toggler": "toggleMenu","click .edit-collection-handler": "renderEditForm","keydown .collection-title input": "quickEditSubmit","click .submit-edit-handler": "editSubmit","click .cancel-edit-handler": "editCancel","click .move-collection-handler": "moveCollection","click .collection-edit *": "stopPropagation"}, d.prototype.initialize = function(a) {
                return (null != a ? a.collectionModel : void 0) && a.membersCollection ? (this.options = a, this.collectionModel = a.collectionModel, this.isEdit = !1, this.membersCollection = a.membersCollection, this.collectionModel.set({_selected_: !1}, {silent: !0}), this.renderBasic().listen(), this.$el.attr("data-id", a.collectionModel.id).addClass(a.viewType), this) : void 0
            }, d.prototype.listen = function() {
                return this.listenTo(this.collectionModel, "change", this.renderBasic), this.listenTo(this.collectionModel, "remove destroy", this.remove), this
            }, d.prototype.renderBasic = function() {
                var a;
                if (!this.isEdit)
                    return a = this.getData(), this.$el.html(g(a)), this.$el[a._selected_ ? "addClass" : "removeClass"]("selected"), this.$thumbnail = this.$(".collection-thumbnail"), this.$title = this.$(".collection-title"), this.count = this.$(".collection-count"), this.author = this.$(".collection-author"), this.updated = this.$(".collection-updated"), this.$el[a._selected_ ? "addClass" : "removeClass"]("selected"), this
            }, d.prototype.renderEditForm = function(a) {
                var b;
                return null != a && a.stopPropagation(), this.isEdit = !0, b = this.getData(), this.$el.html(f(b)), this.$editInput = this.$(".collection-title input"), this.$editInput.focusAtEnd(), this.$(".collection-edit").handleClickOutside(function(a) {
                    return function() {
                        var b;
                        return (null != (b = a.$editInput) ? b.val().trim() : void 0) === a.collectionModel.get("title") ? a.quitEdit() : void 0
                    }
                }(this)), this
            }, d.prototype.getData = function() {
                var a, b;
                return a = this.collectionModel.toJSON(), a.subCount = a.workCount + (a.collectionCount || 0), a.creator = (null != (b = this.membersCollection.get(a._creatorId)) ? b.toJSON() : void 0) || {}, a.updatedDataString = i.formatDate(a.updated), a.updated = h(a.updated).format("YYYY-MM-DD HH:mm"), a.hasRight = this.collectionModel.hasRight(), a
            }, d.prototype.checkCollection = function(a) {
                return "default" === this.collectionModel.get("collectionType") || this.collectionModel.hasRight() < 1 || $(a.target).closest(".collection-thumbnail, .collection-title, .collection-handler-set").length ? void 0 : (this.collectionModel.set("_selected_", !this.collectionModel.get("_selected_")), this)
            }, d.prototype.toggleMenu = function(a) {
                var b;
                return b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(c, {$toggler: b,collectionModel: this.collectionModel,onShown: function(a) {
                    return function() {
                        return a.$el.addClass("active")
                    }
                }(this),onHidden: function(a) {
                    return function() {
                        return a.$el.removeClass("active")
                    }
                }(this)}).show(), this
            }, d.prototype.quickEditSubmit = function(a) {
                return 13 === a.keyCode && (a.preventDefault(), this.editSubmit(a)), this
            }, d.prototype.editSubmit = function(a) {
                var b, c, d;
                return null != a && a.stopPropagation(), d = this.$editInput.val().trim(), b = {}, d && this.collectionModel.get("title") !== d && (b.title = d), _.isEmpty(b) ? d ? this.quitEdit() : this.$editInput.focusAtEnd() : (c = this.collectionModel.collection.find(function(a) {
                    return function(b) {
                        return b.get("title") === d && a.collectionModel.get("_id") !== b.get("_id")
                    }
                }(this)), c ? Essage.show({message: "文件夹名称已存在！",status: "error"}, 2e3) : (this.quitEdit(), this.collectionModel.save(null, {attrs: b}))), this
            }, d.prototype.editCancel = function(a) {
                var b;
                return null != a && a.stopPropagation(), null != (b = this.parentView) && b.checkSelectedAll(), this.quitEdit(), this
            }, d.prototype.quitEdit = function() {
                return this.isEdit = !1, this.renderBasic(), this.$el.removeClass("active"), this
            }, d.prototype.stopPropagation = function(a) {
                return a.stopPropagation(), this
            }, d
        }(j)
    }), define("views/library/work/templates/edit", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="check-box pull-left ';
            return a.hasRight < 1 && (c += "disabled"), c += '"> <span class="icon icon-tick"></span></div><div class="content-wrap work-edit clearfix"> <div class="work-content pull-left"> ', c += a.thumbnail ? ' <div class="work-thumbnail pull-left" style="background-image: url(' + a.thumbnail + ');"> </div> ' : ' <div class="work-thumbnail ' + a.fileType + ' pull-left">' + a.thumbnailText + "</div> ", c += ' <span class="work-title"> <input type="text" placeholder="文件名" class="form-control pull-left" value="' + a.fileName + '"> <button class="btn btn-primary btn-small submit-edit-handler pull-left">保存</button> <button class="btn btn-link btn-small cancel-edit-handler pull-left">取消</button> </span> </div> <div class="work-info pull-right"> <span class="work-size">' + a.fileSizeFix + '</span> <span class="work-author">' + b(a.creator.name || "未知") + '</span> <time class="work-updated hinted" data-title="' + a.updated + '">' + a.updatedDataString.dateString + "</time> </div></div>"
        }
    }), define("views/library/work/templates/list-basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="check-box pull-left"> <span class="icon icon-tick"></span></div><div class="content-wrap clearfix"> <div class="work-content pull-left"> ';
            return c += a.thumbnail ? ' <div class="work-thumbnail pull-left" style="background-image: url(' + a.thumbnail + ');"> </div> ' : ' <div class="work-thumbnail ' + a.fileType + ' pull-left">' + a.thumbnailText + "</div> ", c += ' <span class="work-title">' + b(a.fileName) + '</span> </div> <div class="work-info pull-right clearfix"> <span class="work-size">' + a.fileSizeFix + '</span> <span class="work-author">' + b(a.creator.name || "未知") + '</span> <time class="work-updated hinted" data-title="' + a.updated + '">' + a.updatedDataString.dateString + '</time> <div class="work-handler-set clearfix"> <a class="work-download-handler icon icon-download hinted" data-title="下载"></a> ', a.hasRight > 0 && (c += ' <a class="move-work-handler icon icon-file-move2 hinted" data-title="移动文件" data-gta="event" data-label="move work"></a> <a class="edit-work-handler icon icon-pencil hinted" data-title="重命名" data-gta="event" data-label="edit work"></a> <a class="work-menu-toggler icon icon-chevron-down hinted" data-title="更多操作"></a> '), c += " </div> </div></div>"
        }
    }), define("views/library/work-menu/templates/basic", [], function() {
        return function() {
            var a = '<ul class="list work-menu-list"> <li> <a class="archive-work-handler" data-gta="event" data-label="archive work"> <span class="icon icon-archive"></span>归档文件 </a> </li> <li> <a class="delete-work-handler" data-gta="event" data-label="delete work"> <span class="icon icon-trash"></span>删除文件 </a> </li></ul>';
            return a
        }
    }), define("views/library/work-menu/templates/delete", [], function() {
        return function() {
            var a = '<form class="work-delete-form"> <p>确定要永远删除这个文件吗?</p> <button class="btn btn-danger" type="submit">删除</button></form>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/library/work-menu/index", ["require", "exports", "module", "./templates/basic", "./templates/delete", "lib/popover/index"], function(a) {
        var c, d, e, f;
        return c = a("./templates/basic"), d = a("./templates/delete"), e = a("lib/popover/index"), f = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "WorkMenuView", e.prototype.popoverTitle = "文件菜单", e.prototype.events = {"click .archive-work-handler": "archiveWork","click .delete-work-handler": "enterDeleteSubMenu","submit .work-delete-form": "submitDeleteForm","click .move-work-handler": "moveWork"}, e.prototype.render = function() {
                return this.workModel = this.options.workModel, this.$el.html(c(this.workModel.toJSON())), this
            }, e.prototype.archiveWork = function() {
                return this.workModel.archive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功归档了文件",status: "success"}, 2e3), a.hide()
                    }
                }(this)}), this
            }, e.prototype.enterDeleteSubMenu = function() {
                return this.enterSubMenu("删除文件", function(a) {
                    return function() {
                        return a.$el.html(d())
                    }
                }(this)), this
            }, e.prototype.submitDeleteForm = function(a) {
                return a.preventDefault(), this.workModel.destroy({success: function(a) {
                    return function() {
                        return Essage.show({message: "删除成功",status: "success"}, 2e3), a.hide()
                    }
                }(this)}), this
            }, e
        }(e)
    });
    var e = function(a, b) {
        return function() {
            return a.apply(b, arguments)
        }
    }, a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/library/work/index", ["require", "exports", "module", "./templates/edit", "./templates/list-basic", "moment", "util", "view", "views/library/work-menu/index"], function(a) {
        var c, d, f, g, h, i, j;
        return c = a("./templates/edit"), d = a("./templates/list-basic"), f = a("moment"), g = a("util"), h = a("view"), i = a("views/library/work-menu/index"), j = function(a) {
            function h() {
                return this.stopPropagation = e(this.stopPropagation, this), this.editCancel = e(this.editCancel, this), this.editSubmit = e(this.editSubmit, this), h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "WorkView", h.prototype.tagName = "li", h.prototype.className = "work-view work clearfix", h.prototype.events = {click: "checkCollection","click .work-menu-toggler": "toggerMenu","click .edit-work-handler": "renderEditForm","keydown .work-title input": "quickEditSubmit","click .submit-edit-handler": "editSubmit","click .cancel-edit-handler": "editCancel","click .work-edit *": "stopPropagation"}, h.prototype.initialize = function(a) {
                return (null != a ? a.workModel : void 0) && a.membersCollection ? (this.options = a, this.workModel = a.workModel, this.membersCollection = a.membersCollection, this.workModel.set({_selected_: !1}, {silent: !0}), this.renderBasic().listen(), this.$el.attr("data-id", a.workModel.id).addClass(a.viewType), this) : void 0
            }, h.prototype.listen = function() {
                return this.listenTo(this.workModel, "change", this.renderBasic), this.listenTo(this.workModel, "remove destroy", this.remove), this
            }, h.prototype.renderBasic = function() {
                var a;
                return a = this.getData(), this.$el.html(d(a)), this.$el[a._selected_ ? "addClass" : "removeClass"]("selected"), this
            }, h.prototype.getData = function() {
                var a, b, c;
                return a = this.workModel.toJSON(), a.creator = (null != (c = this.membersCollection.get(a._creatorId)) ? c.toJSON() : void 0) || {}, b = a.updated, f(b).isSame("2014-02-11T06:30:00.000Z", "day") && (b = a.created), a.updatedDataString = g.formatDate(b), a.updated = f(b).format("YYYY-MM-DD HH:mm"), a.fileSizeFix = g.formatFileSize(a.fileSize || 0), a.hasRight = this.workModel.hasRight(), a.thumbnailText = a.fileType, /link/.test(a.fileCategory) && (a.thumbnailText = "link"), a
            }, h.prototype.renderEditForm = function(a) {
                var b;
                return null != a && a.stopPropagation(), this.isEdit = !0, b = this.getData(), this.$el.html(c(b)), this.$editInput = this.$(".work-title input"), this.$editInput.focusAtEnd(), this.$(".work-edit").handleClickOutside(function(a) {
                    return function() {
                        var b;
                        return (null != (b = a.$editInput) ? b.val().trim() : void 0) === a.workModel.get("fileName") ? quitEdit() : void 0
                    }
                }(this)), this
            }, h.prototype.quickEditSubmit = function(a) {
                return 13 === a.keyCode && (a.preventDefault(), this.editSubmit(a)), this
            }, h.prototype.editSubmit = function(a) {
                var b, c;
                return null != a && a.stopPropagation(), c = this.$(".work-title input").val().trim(), b = {}, c && this.workModel.get("fileName") !== c && (b.fileName = c), _.isEmpty(b) ? c ? this.quitEdit() : this.$editInput.focusAtEnd() : (this.quitEdit(), this.workModel.save(null, {attrs: b})), this
            }, h.prototype.editCancel = function(a) {
                var b;
                return null != a && a.stopPropagation(), null != (b = this.parentView) && b.checkSelectedAll(), this.quitEdit(), this
            }, h.prototype.quitEdit = function() {
                return this.isEdit = !1, this.renderBasic(), this.$el.removeClass("active"), this
            }, h.prototype.checkCollection = function(a) {
                return $(a.target).closest(".work-thumbnail, .work-title, .work-handler-set").length ? void 0 : (this.workModel.set("_selected_", !this.workModel.get("_selected_")), this)
            }, h.prototype.toggerMenu = function(a) {
                var b;
                return b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(i, {$toggler: b,workModel: this.workModel,onShown: function(a) {
                    return function() {
                        return a.$el.addClass("active")
                    }
                }(this),onHidden: function(a) {
                    return function() {
                        return a.$el.removeClass("active")
                    }
                }(this)}).show(), this
            }, h.prototype.stopPropagation = function(a) {
                return a.stopPropagation(), this
            }, h
        }(h)
    }), define("views/library/library/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="library-header-wrap body-wrap"> <header class="library-header"> <div class="library-title">文件库</div> ';
            return a.hasRight >= 0 && (b += ' <div class="library-header-handler"> <a class="collection-creator-toggler link-add-handler" data-gta="event" data-label="create collection" data-action="click"> <span class="icon icon-create-folder"></span>创建 </a> <a class="upload-works-handler link-add-handler" data-gta="event" data-label="upload work" data-action="click"> <span class="icon icon-upload-file"></span>上传 </a> </div> '), b += ' </header> <div class="library-handler-set clearfix"> <div class="check-box select-all pull-left"> <span class="icon icon-tick"></span> </div> <div class="library-info"> <span class="library-info-name"> <a class="library-sort" data-orderby="name">名称</a> </span> <span class="library-info-size"> <a class="library-sort" data-orderby="size">大小</a> </span> <span class="library-info-author"> 创建者 </span> <span class="library-info-update"> <a class="library-sort" data-orderby="updated">更新时间</a> </span> </div> <div class="library-handlers"> </div> </div></div><div class="library-content card body-wrap"> <ul class="library-list list clearfix"></ul></div>'
        }
    }), define("views/library/library/templates/breadcrumb-dropdown", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="dropdown breadcrumbs-dropdown"> <a data-toggle="dropdown" href="#">' + b(a.title) + ' <span class="caret"></span></a> <ul class="dropdown-menu" role="menu"> ', d = a.breadcrumbs;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <li><a class="breadcrumb-handler" data-id="' + e._id + '">' + b(e.title) + "</a></li> ";
            return c += " </ul></div>"
        }
    }), define("views/library/library/templates/breadcrumb", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<ol class="breadcrumbs"> ', d = a.breadcrumbs;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += " ", c += e._id ? ' <li><a class="breadcrumb-handler" data-id="' + e._id + '">' + b(e.title) + "</a></li> " : ' <li class="active">' + b(e.title) + "</li> ", c += " ";
            return c += "</ol>"
        }
    }), define("views/library/library/templates/drag", [], function() {
        return function(a) {
            var b = '<div class="';
            return b += a.collection ? "collection" : "work", b += ' library-drag"> ', a.collection ? b += ' <span class="icon icon-folder-bold collection-thumbnail ' + a.collection.color + '"> </span> ' : a.work && (b += " ", b += "image" === a.work.fileCategory ? ' <span class="library-icon library-drag-work work-thumbnail" style="background-image: url(' + a.work.thumbnail + ');"> </span> ' : ' <span class="work-thumbnail ' + a.work.fileType + '"> ' + a.work.fileType + " </span> ", b += " "), b += ' <span class="library-badge">' + a.counts + "</span></div>"
        }
    }), define("views/library/library/templates/library-handlers", [], function() {
        return function(a) {
            var b = "";
            return a.works && (b += '<a class="library-download-handler"><span class="icon icon-download"></span>下载</a>'), a.hasRight > 0 && (b += '<a class="library-move-handler"><span class="icon icon-file-move2"></span>移动</a><a class="library-delete-handler"><span class="icon icon-trash"></span>删除</a>'), b
        }
    }), define("views/library/library/templates/placeholder-nocreate", [], function() {
        return function() {
            var a = '<div class="library-placeholder placeholder muted"> <a class="upload-handler"><span class="icon icon-library"></span></a> <br /> 你可以创建文件夹或上传文件</div>';
            return a
        }
    }), define("views/library/library/templates/placeholder", [], function() {
        return function() {
            var a = '<div class="library-placeholder placeholder muted"> <a class="upload-handler"><span class="icon icon-library"></span></a> <br /> 文件夹中还没有内容哦</div>';
            return a
        }
    });
    var e = function(a, b) {
        return function() {
            return a.apply(b, arguments)
        }
    }, a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/library/library/index", ["require", "exports", "module", "teambition", "lib/scrollable", "thenjs", "util", "view", "models/collection", "collections/collections", "collections/members", "collections/projects", "collections/works", "views/library/collection-creator/index", "views/library/collection-destroyer/index", "views/library/collection-picker/index", "views/library/collection/index", "views/library/previewer/index", "lib/window/index", "views/work/work-uploader/index", "views/library/work/index", "./templates/basic", "./templates/breadcrumb-dropdown", "./templates/breadcrumb", "./templates/drag", "./templates/library-handlers", "./templates/placeholder-nocreate", "./templates/placeholder", "essage"], function(a) {
        var c, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E;
        return D = a("teambition"), v = a("lib/scrollable"), w = a("thenjs"), x = a("util"), y = a("view"), j = a("models/collection"), m = a("collections/collections"), q = a("collections/members"), u = a("collections/projects"), C = a("collections/works"), h = a("views/library/collection-creator/index"), i = a("views/library/collection-destroyer/index"), k = a("views/library/collection-picker/index"), l = a("views/library/collection/index"), t = a("views/library/previewer/index"), z = a("lib/window/index"), A = a("views/work/work-uploader/index"), B = a("views/library/work/index"), c = a("./templates/basic"), f = a("./templates/breadcrumb-dropdown"), g = a("./templates/breadcrumb"), n = a("./templates/drag"), o = a("./templates/library-handlers"), r = a("./templates/placeholder-nocreate"), s = a("./templates/placeholder"), E = a("essage"), p = function(a) {
            function p() {
                return this.moveToCollection = e(this.moveToCollection, this), p.__super__.constructor.apply(this, arguments)
            }
            return b(p, a), p.prototype.viewName = "LibraryView", p.prototype.tagName = "div", p.prototype.className = "library-view fade", p.prototype.order = "asc", p.prototype.orderBy = "name", p.prototype.events = {"click .collection-creator-toggler": "initCollectionCreator","click .collection-title": "enterCollection","click .collection-thumbnail": "enterCollection","click .work-title": "openPreivewer","click .work-thumbnail": "openPreivewer","click .select-all": "togglerSelect","click .breadcrumb-handler": "breadcrumbNav","click .test-handler": "openPicker","click .library-download-handler": "downloadSelected","click .library-move-handler": "moveSelected","click .library-delete-handler": "deleteSelected","click .work-download-handler": "downloadWork","click .move-collection-handler": "moveCollection","click .move-work-handler": "moveWork","click .library-sort": "sortHandler"}, p.prototype.routes = {":_collectionId(/work/:_workId)": "enterCollection","": "enterCollection","*paramString": "home"}, p.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this._projectId = a._projectId, this.projectModel = u.getOne(0, this._projectId), this.membersCollection = q.get(a._projectId), this._defaultCollectionId = this.projectModel.get("_defaultCollectionId"), this._rootCollectionId = this.projectModel.get("_rootCollectionId"), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this) : void 0
            }, p.prototype.home = function() {
                return this.updateUrl({_collectionId: null,_workId: null}, {trigger: !0}), this
            }, p.prototype.resetCollections = function(a) {
                return this.collections && this.stopListening(this.collections), this.collections = a, this.listenTo(a, "add", this.renderCollection), this.listenTo(a, "add remove destroy", this.checkPlaceholder), this.listenTo(a, "add remove destroy change:_selected_", this.checkSelectedAll), this.listenTo(a, "change:_parentId", function() {
                    return function(b, c) {
                        var d;
                        return a.remove(b), null != (d = m.find(c)) ? d.add(b) : void 0
                    }
                }(this)), this
            }, p.prototype.resetWorks = function(a) {
                return this.works && this.stopListening(this.works), this.works = a, this.listenTo(a, "add", this.renderWork), this.listenTo(a, "add remove destroy", this.checkPlaceholder), this.listenTo(a, "add remove destroy change:_selected_", this.checkSelectedAll), this.listenTo(a, "change:_parentId", function() {
                    return function(b, c) {
                        var d;
                        return a.remove(b), null != (d = C.find(c)) ? d.add(b) : void 0
                    }
                }(this)), this
            }, p.prototype.resetView = function() {
                return this.removeSubViews(), this.renderBasic().initUploader(), this
            }, p.prototype.enterCollection = function(a, b) {
                var c;
                return c = !a, a || (a = this._rootCollectionId), a.currentTarget && (a = $(a.currentTarget).closest(".collection").data("id")), this._parentId = a, this.resetView(), this.updateUrl({_collectionId: a,_workId: b}, {trigger: !1,replace: c}), this.showLoadingIndicator(this.$el), w(function(b) {
                    return function(c) {
                        return m.fetch(a, {attrs: {all: !0,_parentId: a,_projectId: b._projectId},success: function(a) {
                            return b.$el ? a._boundToObjectId !== b._parentId ? c() : (b.resetCollections(a), c()) : void 0
                        },error: function(a, b) {
                            return c(b)
                        }})
                    }
                }(this)).then(function(b) {
                    return function(c) {
                        return C.fetch(a, {attrs: {_parentId: a,_projectId: b._projectId},success: function(a) {
                            return b.$el ? a._boundToObjectId !== b._parentId ? c() : (b.resetWorks(a), c()) : void 0
                        },error: function(a, b) {
                            return c(b)
                        }})
                    }
                }(this)).then(function(a) {
                    return function() {
                        return a.hideLoadingIndicator({animated: !0}), a.renderCollectionsAndWorks(), a.genBreadcrumbs(), a.checkPlaceholder(), a.setupScroll(), b ? a.openPreivewer(b) : void 0
                    }
                }(this)).fail(function(a) {
                    return function(b, c) {
                        return a.hideLoadingIndicator({animated: !0}), a.checkPlaceholder(), Essage.show({message: c.message || c,status: "error"}, 2e3)
                    }
                }(this)), this
            }, p.prototype.loadMore = function(a) {
                var b;
                return null != (b = this.works) && b.loadMore({silent: !0,attrs: {_parentId: this._parentId,_projectId: this._projectId},beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$list)
                    }
                }(this),success: function(b) {
                    return function(c, d) {
                        return b.$el ? (b.hideLoadingIndicator({animated: !0}), _.each(d, function(a) {
                            return b.renderWork(b.works.get(a._id), !0)
                        }), b.works.hasMore ? "function" == typeof a ? a() : void 0 : b.showEndPoint(b.$list)) : void 0
                    }
                }(this)}), this
            }, p.prototype.initUploader = function() {
                return this.projectModel.hasRight() >= 0 ? (this.workUploader = this.requestSubView(A, {dnd: $("body"),_projectId: this._projectId,_parentId: this._parentId,isBackground: !0,pick: {id: this.$(".upload-works-handler"),multiple: !0}}), this) : this
            }, p.prototype.addUploaderBtn = function(a) {
                var b;
                return this.projectModel.hasRight() >= 0 ? (null != (b = this.workUploader) && b.uploader.addButton({id: a,multiple: !0}), this) : this
            }, p.prototype.initCollectionCreator = function() {
                var a;
                return this.projectModel.hasRight() >= 0 ? (null != (a = this.collectionCreator) && a.remove(), this.collectionCreator = this.requestSubView(h, {collection: this.collections,_projectId: this._projectId,_parentId: this._parentId}), this.collectionCreator.$el.prependTo(this.$list), this.collectionCreator.focus(), this) : this
            }, p.prototype.renderBasic = function() {
                var a;
                return a = this.projectModel.hasRight(), this.$el.html(c({hasRight: a})), this.$header = this.$(".library-header"), this.$title = this.$(".library-title"), this.$headerHandler = this.$(".library-header-handler"), this.$content = this.$(".library-content"), this.$list = this.$(".library-list"), this.$selectAll = this.$(".select-all"), this.$libraryInfo = this.$(".library-info"), this.$libraryHandlers = this.$(".library-handlers"), this.$placeholder = $(s()), this.$placeholderNocreate = $(r()), this.$el[a >= 0 ? "removeClass" : "addClass"]("no-right"), this
            }, p.prototype.renderCollectionsAndWorks = function() {
                var a, b;
                return this.$list.empty(), a = {name: "title",size: "subCount"}, this.collections.orderBy = this.orderBy in a ? a[this.orderBy] : this.orderBy, this.collections.sort(), "desc" === this.order && this.collections.models.reverse(), b = {name: "fileName",size: "fileSize"}, this.works.orderBy = this.orderBy in b ? b[this.orderBy] : this.orderBy, this.works.sort(), "desc" === this.order && this.works.models.reverse(), this.renderSort(), this.collections.each(function(a) {
                    return function(b) {
                        return a.renderCollection(b, !0)
                    }
                }(this)), this.works.each(function(a) {
                    return function(b) {
                        return a.renderWork(b, !0)
                    }
                }(this))
            }, p.prototype.renderCollection = function(a, b) {
                var c;
                return this._defaultCollectionId !== a.id && (c = this.requestSubView(l, {membersCollection: this.membersCollection,collectionModel: a}).$el, c[b === !0 ? "appendTo" : "prependTo"](this.$list), a.hasRight() > 0 && (this.renderDragHandler(c), this.renderDropHandler(c))), this
            }, p.prototype.renderWork = function(a, b) {
                var c;
                return c = this.requestSubView(B, {membersCollection: this.membersCollection,workModel: a}).$el, c[b === !0 ? "appendTo" : "prependTo"](this.$list), a.hasRight() > 0 && this.renderDragHandler(c), this
            }, p.prototype.renderHandlers = function(a) {
                return a || (a = {}), a.hasRight = this.projectModel.hasRight(), a.works || a.collections && a.hasRight > 0 ? (this.$libraryInfo.hide(), this.$libraryHandlers.html(o(a))) : (this.$libraryInfo.show(), this.$libraryHandlers.empty()), this
            }, p.prototype.renderSort = function() {
                var a, b, c;
                return b = this.order, c = this.orderBy, this.$el.find(".library-info .dropup").removeClass("dropup"), this.$el.find(".library-info .caret").remove(), a = this.$el.find(".library-info [data-orderby='" + c + "']"), a.append("<span class='caret'></span>"), "asc" === b && a.addClass("dropup"), this
            }, p.prototype.genBreadcrumbs = function() {
                var a;
                return this.breadcrumbs = [], a = function(b) {
                    return function(c) {
                        var d;
                        return c === b._rootCollectionId ? (d = {_id: b.breadcrumbs.length ? b._rootCollectionId : null,title: "文件库"}, b.breadcrumbs.unshift(d), b.renderBreadcrumbs()) : c ? j.fetch(c, {success: function(c) {
                            var e;
                            return e = c.toJSON(), d = {_id: e._id !== b._parentId ? e._id : null,title: e.title}, "default" === e.collectionType && b.$headerHandler.remove(), b.breadcrumbs.unshift(d), a(e._parentId || b._rootCollectionId)
                        }}) : void 0
                    }
                }(this), a(this._parentId), this
            }, p.prototype.renderBreadcrumbs = function() {
                var a;
                if (!(this.breadcrumbs.length < 2))
                    return a = $(g({breadcrumbs: this.breadcrumbs})).appendTo(this.$el), a.width() < this.$title.width() ? this.$title.html(a.css("visibility", "visible")) : (this.breadcrumbs.reverse(), this.$title.html(f({title: this.breadcrumbs.shift().title,breadcrumbs: this.breadcrumbs}))), this
            }, p.prototype.renderDragHandler = function(a) {
                var b;
                return this.projectModel.hasRight() >= 0 ? (b = !1, a.draggable({scope: "library-move",zIndex: 1e4,appendTo: this.$el,addClasses: !1,scroll: !1,cursorAt: {top: -10,left: -10},helper: function(c) {
                    return function() {
                        var d, e, f, g, h;
                        return a.hasClass("selected") || (b = !0, c.triggerSelectOne(a)), d = (null != (f = c.collections) ? f.getSelected() : void 0) || [], e = (null != (g = c.works) ? g.getSelected() : void 0) || [], null != (h = c.$drag) && h.remove(), c.$drag = $(n({counts: e.length + d.length,collection: d[0] ? d[0].toJSON() : void 0,work: e[0] ? e[0].toJSON() : void 0})), c.renderHandlers(), c.$drag
                    }
                }(this),start: function() {
                    return function() {
                        return $("body").css("cursor", "not-allowed")
                    }
                }(this),stop: function(c) {
                    return function() {
                        return $("body").css("cursor", "default"), c.$drag.remove(), b && c.triggerSelectOne(a), c.checkSelectedAll()
                    }
                }(this)}), this) : this
            }, p.prototype.renderDropHandler = function(a) {
                return this.projectModel.hasRight() >= 0 ? (a.droppable({scope: "library-move",hoverClass: "dragover",tolerance: "pointer",drop: function(b) {
                    return function() {
                        var c, d, e, f, g;
                        return d = b.collections.get(a.data("id")), c = (null != (f = b.collections) ? f.getSelected() : void 0) || [], e = (null != (g = b.works) ? g.getSelected() : void 0) || [], b.selectAll(!1), d ? b.moveToCollection(d, c, e) : void 0
                    }
                }(this)}), this) : this
            }, p.prototype.checkPlaceholder = function() {
                var a, b, c, d, e;
                return (null != (b = this.collections) ? b.length : void 0) > 1 || (null != (c = this.works) ? c.length : void 0) ? this.$(".library-placeholder").remove() : 1 === (null != (d = this.collections) ? d.length : void 0) && this.collections.at(0).id === this._defaultCollectionId ? (this.$list.html(this.$placeholderNocreate), this.addUploaderBtn(this.$(".library-placeholder .upload-handler"))) : 0 === (null != (e = this.collections) ? e.length : void 0) ? (this.$list.html(this.$placeholder), a = this.$(".library-placeholder .upload-handler"), this._parentId !== this._defaultCollectionId ? this.addUploaderBtn(a) : a.addClass("disabled")) : this.$(".library-placeholder").remove(), this
            }, p.prototype.togglerSelect = function() {
                return this.$selectAll.toggleClass("selected"), this.selectAll(this.$selectAll.hasClass("selected")), this
            }, p.prototype.triggerSelectOne = function(a) {
                return a.find(".check-box").trigger("click"), this.checkSelectedAll(), this
            }, p.prototype.selectAll = function(a) {
                var b, c;
                return this.selecting = !0, null != (b = this.works) && b.each(function() {
                    return function(b) {
                        return b.set({_selected_: a})
                    }
                }(this)), null != (c = this.collections) && c.each(function(b) {
                    return function(c) {
                        return b._defaultCollectionId === c.id || c.hasRight() < 1 ? void 0 : c.set({_selected_: a})
                    }
                }(this)), this.selecting = !1, this.checkSelectedAll(), this
            }, p.prototype.checkSelectedAll = function() {
                var a, b, c, d, e, f;
                if (!this.selecting)
                    return b = !0, a = 0, d = 0, null != (e = this.works) && e.each(function(c) {
                        return c.get("_selected_") && (a += 1, d += 1), b && (b = c.get("_selected_"))
                    }), c = 0, null != (f = this.collections) && f.each(function(d) {
                        return d.get("_selected_") && (c += 1, a += 1), b && (b = "default" === d.get("collectionType") || d.hasRight() < 1 || d.get("_selected_"))
                    }), this.$selectAll[a && b ? "addClass" : "removeClass"]("selected"), this.$selectAll[a && !b ? "addClass" : "removeClass"]("indeterminate"), this.renderHandlers({works: d,collections: c}), this
            }, p.prototype.openPreivewer = function(a) {
                var b;
                return a.currentTarget && (a = $(a.currentTarget).closest(".work").data("id")), b = this.works.get(a), b.getParent(function(c) {
                    return function(d) {
                        return d ? (c.requestSubView(z).open(t, {_projectId: c._projectId,collectionModel: d,workModels: c.works.models,workModel: b}), c.updateUrl({_collectionId: d.id,_workId: a}, {trigger: !1})) : void 0
                    }
                }(this)), this
            }, p.prototype.breadcrumbNav = function(a) {
                return this.enterCollection($(a.currentTarget).data("id")), this
            }, p.prototype.moveCollection = function(a) {
                var b, c, d, e;
                return this.projectModel.hasRight() >= 0 ? (null != (e = this.picker) && e.remove(), b = $(a.currentTarget).closest(".collection"), c = this.collections.get(b.data("id")), this._defaultCollectionId !== c.id ? (d = c.get("title"), this.picker = this.requestSubView(z).open(k, {_projectId: this._projectId,_parentId: c.get("_parentId"),onlyCollections: !0,exclude: [c.id],title: "移动文件夹 " + d + " 至",select: function(a) {
                    return function(b) {
                        var d, e;
                        return e = (null != b ? b.id : void 0) || a._rootCollectionId, e !== c.get("_parentId") && e !== c.id ? (d = m.get(e), c.moveToCollection(d, {success: function() {
                            var a, b;
                            return a = c.get("title"), b = d.get("title"), Essage.show({message: "成功 移动 " + a + " 至 " + b,status: "success"}, 2e3)
                        }})) : void 0
                    }
                }(this)}), this) : void 0) : this
            }, p.prototype.moveWork = function(a) {
                var b, c, d, e;
                return this.projectModel.hasRight() >= 0 ? (null != (e = this.picker) && e.remove(), b = $(a.currentTarget).closest(".work"), (d = this.works.get(b.data("id"))) ? (c = d.get("fileName"), this.picker = this.requestSubView(z).open(k, {_projectId: this._projectId,_parentId: d.get("_parentId"),onlyCollections: !0,title: "移动文件 " + c + " 至",select: function() {
                    return function(a) {
                        var b;
                        if (a.id !== d.get("_parentId"))
                            return b = C.get(a.id), d.moveToCollection(b)
                    }
                }(this)}), this) : void 0) : this
            }, p.prototype.moveToCollection = function(a, b, c) {
                var d, e, f;
                return this.projectModel.hasRight() >= 0 ? (e = (null != a ? a.id : void 0) || this._rootCollectionId, d = m.get(e), f = C.get(e), w.each(b, function(a) {
                    return function(b, c) {
                        return e === c.get("_parentId") || e === c.id || a._defaultCollectionId === c.id ? b() : c.moveToCollection(d, {success: function() {
                            return b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).each(c, function() {
                    return function(a, b) {
                        return e === b.get("_parentId") ? a() : b.moveToCollection(f, {success: function() {
                            return a()
                        },error: function(b, c) {
                            return a(c)
                        }})
                    }
                }(this)).then(function() {
                    return function() {
                        var d, e;
                        return e = a.parse(a.toJSON()).title, c = c.length, b = b.length, d = "", c > 0 && (d += "" + c + " 个文件"), c > 0 && b > 0 && (d += "和 "), b > 0 && (d += "" + b + " 个文件夹"), Essage.show({message: "成功 移动 " + d + " 至 " + e,status: "success"}, 2e3)
                    }
                }(this)).fail(function() {
                    return function(a, b) {
                        return Essage.show({message: b.message || b,status: "error"}, 2e3)
                    }
                }(this)), this) : this
            }, p.prototype.moveSelected = function() {
                var a, b, c, d, e, f;
                return this.projectModel.hasRight() >= 0 ? (null != (d = this.picker) && d.remove(), c = (null != (e = this.works) ? e.getSelected() : void 0) || [], a = (null != (f = this.collections) ? f.getSelected() : void 0) || [], b = this.genMessage(c.length, a.length), this.picker = this.requestSubView(z).open(k, {_projectId: this._projectId,_parentId: this._parentId,onlyCollections: !0,exclude: _.pluck(a, "id"),title: "移动 " + b + " 至",select: function(b) {
                    return function(d) {
                        return b.selectAll(!1), b.moveToCollection(d, a, c)
                    }
                }(this)})) : this
            }, p.prototype.deleteSelected = function() {
                var a, b, c, d, e, f;
                return this.projectModel.hasRight() >= 0 ? (c = (null != (d = this.works) ? d.getSelected() : void 0) || [], a = (null != (e = this.collections) ? e.getSelected() : void 0) || [], b = this.genMessage(c.length, a.length), null != (f = this.collectionDestroyerView) && f.remove(), this.collectionDestroyerView = this.requestSubView(z, {backdrop: "static"}).open(i, {works: c,collections: a,message: b,success: function(a) {
                    return function() {
                        return a.selectAll(!1)
                    }
                }(this)}), this) : this
            }, p.prototype.downloadSelected = function() {
                var a, b;
                return a = (null != (b = this.works) ? b.getSelected() : void 0) || [], w.eachSeries(a, function() {
                    return function(a, b) {
                        var c;
                        return c = b.get("downloadUrl"), c && window.open("" + c), _.delay(a, 1e3)
                    }
                }(this)), this
            }, p.prototype.downloadWork = function(a) {
                var b, c, d;
                return b = $(a.currentTarget).closest(".work"), d = this.works.get(b.data("id")), c = null != d ? d.get("downloadUrl") : void 0, c && window.open("" + c), this
            }, p.prototype.genMessage = function(a, b) {
                var c;
                return c = "", a && (c += "" + a + " 个文件"), a && b && (c += "和 "), b && (c += "" + b + " 个文件夹"), c
            }, p.prototype.updateUrl = function(a, b) {
                var c;
                return c = D.router.getPrefix() + "/files", a._collectionId && (c += "/" + a._collectionId, a._workId && (c += "/work/" + a._workId)), D.router.navigate(c, b), this
            }, p.prototype.sortHandler = function(a) {
                var b, c, e;
                return a.currentTarget ? (b = $(a.currentTarget), e = b.data("orderby")) : e = a, this.orderBy === e ? this.order = "asc" === this.order ? "desc" : "asc" : (this.orderBy = e, c = ["name"], this.order = d.call(c, e) >= 0 ? "asc" : "desc"), this.renderCollectionsAndWorks()
            }, p
        }(y), _.extend(p.prototype, v), p
    }), define("views/member/member-card/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<header class="member-detail-header"> <div class="avatar img-circle pull-left" style="background-image: url(' + a.avatarUrl + ');"> ';
            return a.hasVisited || (c += ' <span class="icon icon-leave-state never-visit"></span> '), c += ' </div> <div class="member-name"> <div class="chinese-name">' + b(a.name) + "</div> ", "team" != a.boundToObjectType && (c += " ", a.hasVisited ? (c += " ", a.title && (c += ' <div class="member-title muted">' + b(a.title) + "</div> "), c += " ", null !== a.latestActived && (c += ' <div class="member-last-active muted">' + b(a.latestActivedString) + "</div> "), c += " ") : c += ' <div class="zero-visit-title muted">该成员从未访问过此项目</div> ', c += " "), c += " </div></header>", a.hasRight >= 0 && (c += '<section class="member-detail-content"> <ul class="member-detail-info"> ', a.birthday && (c += ' <li class="member-info-item"> <div class="member-info-label">生日</div> <div class="member-info-content">' + b(a.birthday) + "</div> </li> "), c += " ", a.location && (c += ' <li class="member-info-item"> <div class="member-info-label">所在地</div> <div class="member-info-content">' + b(a.location) + "</div> </li> "), c += " ", a.phone && (c += ' <li class="member-info-item"> <div class="member-info-label">手机</div> <div class="member-info-content">' + b(a.phone) + "</div> </li> "), c += " ", a.email && (c += ' <li class="member-info-item"> <div class="member-info-label">邮箱</div> <div class="member-info-content"> <a href="mailto:' + a.email + '">' + b(a.email) + "</a> </div> </li> "), c += " ", a.website && (c += ' <li class="member-info-item"> <div class="member-info-label">网站</div> <div class="member-info-content"> <a href="' + a.website + '" target="_blank">' + b(a.website) + "</a> </div> </li> "), c += " </ul></section>"), c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/member/member-card/index", ["require", "exports", "module", "./templates/basic", "moment", "lib/popover/index", "collections/projects"], function(a) {
        var c, d, e, f, g;
        return c = a("./templates/basic"), e = a("moment"), f = a("lib/popover/index"), g = a("collections/projects"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "MemberCardView", d.prototype.className = "member-card-view card", d.prototype.popoverTitle = "Menu", d.prototype.width = 350, d.prototype.render = function() {
                var a, b, d;
                return d = g.getOne(0, this.options._projectId), a = this.options.memberModel.toJSON(), a.hasRight = d ? d.hasRight() : -2, d.get("isPublic") && (a.hasVisited = !0), a.birthday = this.options.memberModel.getBirthdayString(), b = e(a.latestActived).format("YYYY-MM-DD HH:mm"), a.latestActivedString = "最后登录于 " + b, this.$el.html(c(a)), this
            }, d
        }(f)
    }), define("views/member/member-bar/templates/avatar", [], function() {
        return function(a) {
            var b = '<div class="member member-in-drag img-circle img-36" data-id="' + a._id + '" style="background-image:url(' + a.avatarUrl + ');"></div>';
            return b
        }
    }), define("views/member/member-bar/templates/basic", [], function() {
        return function(a) {
            var b = "";
            return a.hasRight >= 0 && (b += '<header class="member-bar-header"></header>'), b += '<section class="member-bar-content scrollable"> <ul class="members-list"></ul></section><footer class="member-bar-footer"> <div class="member-bar-footer-mask"></div> <div class="member-bar-toggler" data-gta="event" data-label="member bar|toggler"> <span class="icon icon-chevron-left"></span> </div></footer>'
        }
    }), define("views/member/member-bar/templates/header", [], function() {
        return function(a) {
            var b = "";
            return b += "full" === a.mode ? ' <div class="member-bar-inviter"> <span class="icon icon-add-user"></span> <input class="member-invite-input input-small form-control" type="email" placeholder="输入邮箱邀请成员" data-gta="event" data-label="member bar|invite by email"></input> </div> <div class="member-bar-link-inviter"> <label class="invite-link-label muted"> 分享链接邀请成员 <a class="invite-link-hint icon icon-info hinted" data-title="新成员访问链接就能加入，最适合分享到微信群或是QQ群"> <!-- <span class="icon icon-info"></span> --> </a> </label> <input class="invite-link-input input-small form-control" value="' + a.inviteLink + '" data-gta="event" gta-label="member bar|invite by link"></input> </div>' : ' <a class="member-settings-opener guide-handler icon icon-plus-sign" data-guide="memberAdd" data-gta="event" data-label="member bar|open member settings"> </a>'
        }
    }), define("views/member/member-bar/templates/member", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li id="member-' + a._id + '" class="member" data-id="' + a._id + '" data-gta="event" data-label="member bar|show card"> <div class="avatar img-circle img-36 pull-left" style="background-image:url(' + a.avatarUrl + ');"> ';
            return "team" == a["in"] || a.hasVisited || (c += ' <span class="icon icon-leave-state never-visit"></span> '), c += ' </div> <div class="member-info"> <p class="member-name"><strong>' + b(a.name) + '</strong></p> <p class="member-title muted"> ' + b(a.title || a.email || a.role) + " </p> </div></li>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/member/member-bar/index", ["require", "exports", "module", "teambition", "lib/guide-point/index", "util", "view", "collections/members", "collections/projects", "views/member/member-card/index", "views/member/member-finder/index", "views/settings/project-settings/index", "lib/window/index", "./templates/avatar", "./templates/basic", "./templates/header", "./templates/member"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q;
        return q = a("teambition"), e = a("lib/guide-point/index"), n = a("util"), o = a("view"), i = a("collections/members"), l = a("collections/projects"), h = a("views/member/member-card/index"), j = a("views/member/member-finder/index"), m = a("views/settings/project-settings/index"), p = a("lib/window/index"), c = a("./templates/avatar"), d = a("./templates/basic"), f = a("./templates/header"), k = a("./templates/member"), g = function(a) {
            function g() {
                return g.__super__.constructor.apply(this, arguments)
            }
            return b(g, a), g.prototype.viewName = "MemberBarView", g.prototype.tagName = "aside", g.prototype.className = "member-bar", g.prototype.events = {"click .member": "showMemberDetail","click .add-member-handler": "addMemberBtn","click .member-settings-opener": "openMemberSettings","click .member-bar-toggler": "toggleMemberBar","mousewheel .scrollable": n.mousewheel}, g.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this.options = a, this._projectId = this.options._projectId, this.projectModel = l.getOne(0, this._projectId), this.membersCollection = i.get(this._projectId), this.renderBasic().renderHeader().renderMembers().switchMode().initDragHandler().listen(), e.initialize(this), this.projectModel.hasRight() >= 0 || this.$el.addClass("no-right"), this) : !1
            }, g.prototype.listen = function() {
                return this.listenTo(this.membersCollection, "change:isQuited change:name change:avatarUrl change:hasVisited", this.refreshMember), this.listenTo(this.membersCollection, "add", this.addMember), this.listenTo(this.membersCollection, "remove", this.removeMember), this
            }, g.prototype.renderBasic = function() {
                return this.$el.html(d(this.projectModel.toJSON())), this.$header = this.$(".member-bar-header"), this.$membersList = this.$(".members-list"), this.$addMemberBtn = this.$(".add-member-handler"), this
            }, g.prototype.renderHeader = function() {
                var a;
                return this.projectModel.hasRight() >= 0 ? (a = this.projectModel.toJSON(), a.mode = q.PREFERENCE.get("memberBarMode"), this.$header.html(f(a)), "full" === q.PREFERENCE.get("memberBarMode") && this.initMemberFinder(), this) : this
            }, g.prototype.renderMembers = function() {
                return this.membersCollection.each(function(a) {
                    return function(b) {
                        var c;
                        return c = b.toJSON(), c.role = b.getRole(), a.projectModel.get("isPublic") && (c.hasVisited = !0), a.$membersList.append(k(c))
                    }
                }(this)), this.toggleMembers(this.$(".member"), !0), this
            }, g.prototype.initMemberFinder = function() {
                return this.requestSubView(j, {collection: this.membersCollection,$searchbox: this.$(".member-invite-input"),select: function(a) {
                    return function(b) {
                        var c;
                        return c = {email: b.item.email}, a.membersCollection.addMember(c, {boundToObjectType: "project"})
                    }
                }(this)}), this
            }, g.prototype.initDragHandler = function(a) {
                return this.projectModel.hasRight() >= 0 ? (a || (a = this.$(".member")), a.draggable({zIndex: "10000",appendTo: "body",addClasses: !1,scroll: !1,cursorAt: {top: 18,left: 18},helper: function(a) {
                    return function(b) {
                        var d, e;
                        return e = $(b.currentTarget).data("id"), d = a.membersCollection.get(e), $(c(d.toJSON()))
                    }
                }(this),start: function() {
                    return q.gta.event(null, "drag", "member bar|drag member")
                }}), this) : this
            }, g.prototype.refreshMember = function(a) {
                var b, c;
                return c = a.changed.isQuited, _.isBoolean(c) && c ? this.removeMember(a) : _.isBoolean(c) && !c ? this.addMember(a) : (b = $(k(a.toJSON())), this.$("#member-" + a.id).replaceWith(b), this.toggleMembers(b, !0), this.initDragHandler(b)), this
            }, g.prototype.addMember = function(a) {
                var b, c;
                return c = a.toJSON(), this.projectModel.get("isPublic") && (c.hasVisited = !0), b = $(k(c)).prependTo(this.$membersList), setTimeout(function(a) {
                    return function() {
                        return a.initDragHandler(b)
                    }
                }(this), 50), this
            }, g.prototype.toggleMembers = function(a, b) {
                var c;
                return c = {}, c = b ? {height: "auto",opacity: 1} : {height: 0,opacity: 0}, a.transition(c), this
            }, g.prototype.removeMember = function(a) {
                return this.$("#member-" + a.id).transition({height: 0,opacity: 0}, function() {
                    return $(this).remove()
                }), this
            }, g.prototype.showMemberDetail = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), c = $(a.currentTarget).data("id"), null != (d = this.memberCardView) && d.remove(), this.memberCardView = this.requestSubView(h, {$toggler: b,placement: "left",_projectId: this._projectId,memberModel: this.membersCollection.get(c)}), this.memberCardView.show(), this
            }, g.prototype.openMemberSettings = function() {
                return this.requestSubView(p).open(m, {projectModel: this.projectModel,tab: "member-settings"}), this
            }, g.prototype.toggleMemberBar = function() {
                return q.PREFERENCE.toggleMemberBarMode(), this.renderHeader().switchMode(), this
            }, g.prototype.switchMode = function(a, b) {
                var c, d;
                return null == a && (a = q.PREFERENCE.get("memberBarMode")), d = _.extend({animated: !0}, b), c = d.animated ? "transition" : "css", q.APP.$el.removeClass("with-mini-member-bar with-full-member-bar"), "full" === a ? (q.APP.$el.addClass("with-full-member-bar"), this.$el[c]({right: 0}, 218, "ease"), this.$el.addClass("member-bar-full-mode")) : (q.APP.$el.addClass("with-mini-member-bar"), this.$el[c]({right: -140}, 218, "ease"), this.$el.removeClass("member-bar-full-mode")), this
            }, g.prototype.remove = function() {
                return q.APP.$el.removeClass("with-mini-member-bar with-full-member-bar"), g.__super__.remove.apply(this, arguments)
            }, g
        }(o)
    }), define("views/core/hotkey-helper/templates/basic", [], function() {
        return function() {
            var a = '<header class="hotkey-header card-header no-bottom"> <p class="card-title pull-left">快捷键</p> <a class="modal-close pull-right icon icon-remove icon-white" data-dismiss="modal"></a></header><div class="hotkey-content"> <h3>全局快捷键</h3> <div class="cheat-sheet-part"> <ul class="cheat-sheet-list"> <li> <span class="key">h</span> <span class="function">回到所有项目</span> </li> <li> <span class="key">i</span> <span class="function">打开收件箱</span> </li> <li> <span class="key">m</span> <span class="function">进入我的控制台</span> </li> <li> <span class="key">s</span> <span class="function">打开搜索</span> </li> <li> <span class="key">shift + m</span> <span class="function">打开Markdown语法帮助</span> </li> </ul> </div> <h3>收件箱的快捷键</h3> <div class="cheat-sheet-part"> <ul class="cheat-sheet-list"> <li> <span class="key">j</span> <span class="function">下一条信息</span> </li> <li> <span class="key">k</span> <span class="function">上一条信息</span> </li> </ul> </div> <h3>分享墙的快捷键</h3> <div class="cheat-sheet-part"> <ul class="cheat-sheet-list"> <li> <span class="key">c</span> <span class="function">创建新分享</span> </li> </ul> </div> <h3>任务板的快捷键</h3> <div class="cheat-sheet-part"> <ul class="cheat-sheet-list"> <li> <span class="key">c</span> <span class="function">创建新任务</span> </li> <li> <span class="key">g</span> <span class="function">打开任务分组面板</span> </li> </ul> </div> <h3>日程表的快捷键</h3> <div class="cheat-sheet-part"> <ul class="cheat-sheet-list"> <li> <span class="key">c</span> <span class="function">创建新日程</span> </li> </ul> </div></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/core/hotkey-helper/index", ["require", "exports", "module", "./templates/basic", "view"], function(a) {
        var c, d, e;
        return c = a("./templates/basic"), e = a("view"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "HotkeyHelperView", d.prototype.className = "hotkey-helper modal-dialog card", d.prototype.initialize = function() {
                return this.renderBasic(), this
            }, d.prototype.renderBasic = function() {
                return this.$el.html(c()), this
            }, d
        }(e)
    }), define("views/organization/organization-creator/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="modal-content"> <header class="modal-header"> <h4 id="organization-creator-header-title" class="modal-title"> 新建组织<sub>・使用企业版</sub> </h4> </header> <form class="form-create-organization form-horizontal"> <div class="modal-body"> <div class="organization-creator-content"> <h5>组织信息</h5> <div class="form-group"> <input class="organization-name form-control" placeholder="组织名称" /> </div> <div class="form-group organization-desc-group"> <textarea class="organization-desc form-control" rows="3" placeholder="组织描述（可选）"></textarea> </div> <div class="form-group hide"> <div class="permission-selector form-control"> <div class="selector-title"> 私有组织（仅组织成员可见） </div> <span class="icon icon-chevron-down"></span> </div> </div> </div> <div class="organization-user-info"> <input class="organization-user-name form-control" placeholder="联系人" /> <input class="organization-user-phone form-control" placeholder="联系电话" /> </div> <div class="form-group"> <input class="organization-address form-control" value="' + a.user.currentCity + '" placeholder="联系地址" /> </div> <div class="checkbox organization-user-help"> <label> <input type="checkbox">我希望 Teambition 部署顾问为我提供产品演示，并指导我们如何针对当前的工作设计最佳使用方案。 </label> </div> </div> <div class="business-tips"> <h5>企业版 499元/月，免费使用 14天！</h5> <p class="muted">提供项目、团队、成员三大管理功能，不限项目和成员数量。若试用期结束不想继续使用，可将项目转移至个人项目中。</p> </div> <footer class="organization-creator-footer modal-footer clearfix"> <button type=\'submit\' class="btn btn-primary btn-create-organization pull-right">创建</button> <button type="button" class="btn btn-link btn-cancel-create-organization pull-right">取消</button> </footer> </form></div>';
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/organization-creator/index", ["require", "exports", "module", "teambition", "./templates/basic", "collections/organizations", "models/organization", "util", "view", "views/core/popover-menu/index"], function(a) {
        var c, d, e, f, g, h, i, j;
        return j = a("teambition"), c = a("./templates/basic"), d = a("collections/organizations"), f = a("models/organization"), h = a("util"), i = a("view"), g = a("views/core/popover-menu/index"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "OrganizationCreatorView", e.prototype.tagName = "div", e.prototype.className = "organization-creator modal-dialog modal-padding", e.prototype.events = {"click .btn-cancel-create-organization": "close","submit .form-create-organization": "onCreateOrganizationFormSubmit","keyup .organization-name, .organization-user-name": "validateString","keyup .organization-user-phone": "validatePhone"}, e.prototype.initialize = function(a) {
                return this.options = null != a ? a : {}, this.reset().renderBasic().initPermission(), this
            }, e.prototype.reset = function() {
                return this
            }, e.prototype.renderBasic = function() {
                var a;
                return a = {user: j.user.toJSON()}, this.$el.html(c(a)), this.$organizationNameInput = this.$(".organization-name"), this.$organizationDescInput = this.$(".organization-desc"), this.$btnCreateOrganization = this.$(".btn-create-organization"), this
            }, e.prototype.initPermission = function() {
                return this.permissionMenuView = this.requestSubView(g, {$toggler: this.$(".permission-selector"),width: 500,dataList: [{title: "公开组织（访客可以查看组织中的公开项目和成员）",_id: "public"}, {title: "私有组织（仅组织成员可见）",_id: "private"}],selected: "private",select: function(a) {
                    return function(b) {
                        return a.isPublic = "public" === b, a.$(".permission-selector .selector-title").text("public" === b ? "公开组织（访客可以查看组织中的公开项目和成员）" : "私有组织（仅组织成员可见）")
                    }
                }(this)}), this
            }, e.prototype.onOpen = function() {
                var a;
                return null != (a = this.$organizationNameInput) && a.focusAtEnd(), this
            }, e.prototype.onCreateOrganizationFormSubmit = function(a) {
                return a.preventDefault(), this.createOrganization()
            }, e.prototype.createOrganization = function() {
                var a;
                return a = {name: this.$organizationNameInput.val().trim(),location: this.$(".organization-address").val().trim(),description: this.$organizationDescInput.val().trim(),logo: "https://dn-st.qbox.me/organizations/org" + _.random(1, 6) + ".jpg",contactName: this.$(".organization-user-name").val().trim(),contactPhone: this.$(".organization-user-phone").val().trim(),provideDemo: this.$(".organization-user-help input").prop("checked"),isPublic: this.isPublic}, a.name ? a.contactName ? h.isPhoneNum(a.contactPhone) ? a.location ? (d.get(0).create(a, {wait: !0,success: function(a) {
                    return function(b) {
                        var c;
                        return c = b.id, a.close(), j.router.navigate("/organization/" + c + "/projects", {trigger: !0})
                    }
                }(this),error: function() {
                    return function() {
                    }
                }(this)}), this) : (this.$(".organization-address").addClass("validate-error").focusAtEnd(), !1) : (this.$(".organization-user-phone").addClass("validate-error").focusAtEnd(), !1) : (this.$(".organization-user-name").addClass("validate-error").focusAtEnd(), !1) : (this.$organizationNameInput.addClass("validate-error").focusAtEnd(), !1)
            }, e.prototype.validateString = function(a) {
                var b;
                return b = $(a.currentTarget), b[b.val().trim() ? "removeClass" : "addClass"]("validate-error"), this
            }, e.prototype.validatePhone = function(a) {
                var b;
                return b = $(a.currentTarget), b[h.isPhoneNum(b.val().trim()) ? "removeClass" : "addClass"]("validate-error"), this
            }, e.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, e
        }(i)
    }), define("views/organization/organization-switcher/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            if (a.organizations.length) {
                c += '<ul class="organization-list list-underscore thin-scroll">';
                var d = a.organizations;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; )
                        e = d[f += 1], c += ' <li class="organization-item" data-id="' + e._id + '" data-gta="event" data-label="switch organization"> <a class="clearfix"> <div class="organization-logo pull-left" style="background-image: url(' + e.logo + ')"></div> <p class="organization-title">' + b(e.name) + '</p> <p class="muted">' + b(e.description) + "</p> </a> </li>";
                c += "</ul>"
            } else
                c += '<div class="placeholder"> <p>您还没有组织<br>创建组织，更便捷的管理项目</p></div>';
            return c += '<div class="organization-create-wrap"> <a class="organization-create-handler" data-gta="event" data-label="create organization"> <span class="icon icon-plus-bold"></span>创建组织</a></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/organization-switcher/index", ["require", "exports", "module", "teambition", "./templates/basic", "views/organization/organization-creator/index", "lib/popover/index", "collections/projects", "lib/scrollable", "util", "lib/window/index"], function(a) {
        var c, d, e, f, g, h, i, j, k;
        return k = a("teambition"), c = a("./templates/basic"), d = a("views/organization/organization-creator/index"), f = a("lib/popover/index"), g = a("collections/projects"), h = a("lib/scrollable"), i = a("util"), j = a("lib/window/index"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "OrganizationSwitcherView", e.prototype.className = "organization-switcher-view", e.prototype.popoverTitle = "Menu", e.prototype.width = 300, e.prototype.hotkeys = {"up|down|enter": "searchOrganizations",esc: function(a) {
                var b;
                return a.preventDefault(), null != (b = this.$popover) && b.parent().trigger("click"), this.hide()
            }}, e.prototype.events = {"click .organization-item": "switchOrganization","click .organization-create-handler": "openOrganizationCreator","mousewheel .organization-list": i.mousewheel}, e.prototype.render = function() {
                var a, b, d;
                if (this.options.organizationsCollection)
                    return this.$el.html(c({organizations: this.options.organizationsCollection.filter(function(a) {
                        return a.hasRight() >= 0
                    }).map(function(a) {
                        return a.toJSON()
                    })})), this.$list = this.$(".organization-list"), a = k.router.getUrl().split("/"), this.selectedId = null, "project" === a[0] ? (b = g.findOne(0, a[1]), this.selectedId = null != b ? b.get("_organizationId") : void 0) : "organization" === a[0] && (this.selectedId = a[1]), this.selectedId && (null != (d = this.options.organizationsCollection.get(this.selectedId)) ? d.hasRight() : void 0) >= 0 || (this.selectedId = null), this.selectedId && this.$list.find(".organization-item[data-id=" + this.selectedId + "]").addClass("selected"), "organization" !== a[0] && (this.selectedId = null), this.layout(), this.setupScroll(this.$list), this
            }, e.prototype.layout = function() {
                return this.$list.css("maxHeight", Math.max(.7 * $(window).height(), 300)), this
            }, e.prototype.switchOrganization = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = this.options.organizationsCollection.get(b.data("id")), c && c.id !== this.selectedId && (this.selectedId = c.id, k.router.navigate("/organization/" + c.id + "/projects", {trigger: !0})), this.hide(), this
            }, e.prototype.searchOrganizations = function(a) {
                var b;
                switch (a.keyCode) {
                    case 38:
                        return this.switchActive("up");
                    case 40:
                        return this.switchActive("down");
                    case 13:
                        return b = this.$list.find(".active"), b.length || (b = this.$list.find("li:first")), b.trigger("click")
                }
                return this
            }, e.prototype.switchActive = function(a) {
                var b, c, d, e, f;
                return b = this.$list.find(".active"), b.length || (b = this.$list.find(".selected")), "up" === a && (f = b.removeClass("active").prevAll(".organization-item:first"), d = this.$list.find("li.organization-item:last"), f.length > 0 ? f.addClass("active") : d.addClass("active")), "down" === a && (e = b.removeClass("active").nextAll(".organization-item:first"), c = this.$list.find("li.organization-item:first"), e.length > 0 ? e.addClass("active") : c.addClass("active")), this.slideTo(this.$list.find(".active"))
            }, e.prototype.openOrganizationCreator = function() {
                return this.requestSubView(j).open(d), this.hide(), this
            }, e
        }(f), _.extend(e.prototype, h), e
    }), define("views/project/project-creator/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="modal-content "> <header class="modal-header"> <h4 id="project-creator-header-title" class="modal-title">创建项目</h4> </header> <form class="form-create-project form-horizontal"> <div class="modal-body"> <section class="project-creator-content"> <h5>项目类型</h5> <div class="form-group"> <div class="project-category-logo"> <div class="logo"> <div class="progress-mask"></div> </div> </div> <div class="project-category-selector"> <ul class="project-category-list"> ', d = a.categories;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <li class="project-category-option ' + e.value + '-logo" data-category="' + e.value + '"> <a> <div class="logo"></div> </a> <span class="icon icon-tick"></span> <span class="category-name">' + b(e.name) + "</span> </li> ";
            return c += ' <li class="project-category-option custom"> <a class="custom-logo"> <span class="icon icon-plus"></span> </a> 自定义图片 </li> </ul> </div> </div> <h5>项目信息</h5> <div class="form-group"> <input class="project-name form-control" placeholder="项目名称" /> </div> <div class="form-group project-desc-group"> <textarea class="project-desc form-control" rows="3" placeholder="项目简介（可选）"></textarea> </div> <div class="project-owner"> <h5>拥有者</h5> <div class="form-group"> <div class="open-selector-handler form-control"> <div class="selector-title"> <strong>' + b(a.organizationName) + " </strong> <span>(已使用" + a.plan.total + "个项目中的" + a.plan.created + '个)</span> </div> <span class="icon icon-chevron-down"></span> </div> <p class="feild-tips project-owner-selector-tips"> 个人的免费项目已经用完，你可以通过购买企业版获得无限的项目和成员数量，并且拥有项目，团队，成员三大管理功能 </p> </div> </div> <div class="project-permission"> <h5>项目公开性</h5> <div class="form-group"> <div class="open-selector-handler form-control"> <div class="selector-title"> 私有项目（仅项目成员可见） </div> <span class="icon icon-chevron-down"></span> </div> </div> </div> <div class="project-section"> <h5>项目分组</h5> <div class="form-group"> <div class="open-selector-handler form-control is-placeholder"> <div class="selector-title"> 选择或添加项目分组（可选） </div> <span class="icon icon-chevron-down"></span> </div> </div> </div> </section> </div> <div class="project-creator-footer modal-footer clearfix"> <button type=\'submit\' class="btn btn-primary btn-create-project pull-right">创建</button> <button type="button" class="btn btn-link btn-cancel-create-project pull-right">取消</button> </div> </form></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/project/project-creator/index", ["require", "exports", "module", "teambition", "lib/uploader/index", "util", "view", "models/project", "collections/organizations", "collections/projects", "views/core/popover-menu/index", "./templates/basic", "essage"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n;
        return m = a("teambition"), j = a("lib/uploader/index"), k = a("util"), l = a("view"), i = a("models/project"), d = a("collections/organizations"), g = a("collections/projects"), f = a("views/core/popover-menu/index"), c = a("./templates/basic"), n = a("essage"), e = [{value: "media",name: "媒体项目"}, {value: "design",name: "设计项目"}, {value: "education",name: "教育项目"}, {value: "internet",name: "互联网项目"}, {value: "app",name: "移动应用项目"}], h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "ProjectCreatorView", h.prototype.tagName = "div", h.prototype.className = "project-creator modal-dialog modal-padding", h.prototype.events = {"click .btn-cancel-create-project": "close","submit .form-create-project": "onCreateProjectFormSubmit","click .project-category-option": "onSelectProjectCategory"}, h.prototype.initialize = function(a) {
                var b, c;
                return this.options = null != a ? a : {}, this._organizationId = this.options._organizationId || (null != (c = this.options.selectedOrganizationModel) ? c.id : void 0), this._organizationId || (b = m.router.getPrefix().split("/"), "organization" === b[0] && (this._organizationId = b[1])), d.fetch(0, {success: function(a) {
                    return function(b) {
                        var c;
                        return a.organizationsCollection = b, (c = a.options).selectedOrganizationModel || (c.selectedOrganizationModel = b.get(a._organizationId)), a.reset().renderBasic().initOwnerSelector(a.options.selectedOrganizationModel).initPermission().initSectionSelector().initUploader().refreshSelectedOrg().listen(), a.projectModel.set("category", "media"), a.checkSections()
                    }
                }(this)}), this
            }, h.prototype.reset = function() {
                return this.projectModel = new i({_organizationId: this._organizationId || null,category: null}), this.listenTo(this.projectModel, "change:category", this.renderProjectCover), this.listenTo(this.projectModel, "change:logo", this.refreshLogo), this.listenTo(this.organizationsCollection, "add remove", function(a) {
                    return function() {
                        var b;
                        return null != (b = a.ownerMenuView) ? b.update(a.getOwners()) : void 0
                    }
                }(this)), this
            }, h.prototype.renderBasic = function() {
                var a, b, d;
                return a = {categories: e,plan: (null != (b = this.options.selectedOrganizationModel) ? b.get("plan") : void 0) || m.user.get("plan"),organizationName: (null != (d = this.options.selectedOrganizationModel) ? d.get("name") : void 0) || "我"}, this.$el.html(c(a)), this.$projectNameInput = this.$(".project-name"), this.$projectDescInput = this.$(".project-desc"), this.$btnCreateProject = this.$(".btn-create-project"), this.$categorySelector = this.$(".project-category-selector"), this.$projectLogo = this.$(".project-category-logo"), this.$projectCover = this.$(".project-cover"), this.$projectOwnerSelectorTitle = this.$(".project-owner .selector-title"), this.$projectOwnerSelectorTips = this.$(".project-owner-selector-tips"), this.$projectSection = this.$(".project-section"), this.$projectSectionSelectorTitle = this.$(".project-section .selector-title"), this
            }, h.prototype.onOpen = function() {
                var a;
                return null != (a = this.$projectNameInput) && a.focusAtEnd(), this
            }, h.prototype.listen = function() {
                return this.listenTo(this.projectModel, "change:_organizationId", this.refreshSelectedOrg), this.listenTo(this.projectModel, "change:logo", this.refreshLogo), this.listenTo(this.projectModel, "change:category", this.renderProjectCover)
            }, h.prototype.onCreateProjectFormSubmit = function(a) {
                return a.preventDefault(), this.createProject()
            }, h.prototype.createProject = function() {
                var a, b;
                return this.projectModel.set({name: this.$projectNameInput.val().trim(),description: this.$projectDescInput.val().trim()}), a = this.projectModel.toJSON(), a.name ? (b = a._organizationId ? d.getOne(0, a._organizationId).toJSON() : m.user.toJSON(), g.get(0).create(a, {wait: !0,beforeSend: function(a) {
                    return function() {
                        return a.$btnCreateProject.text("创建中...")
                    }
                }(this),success: function(a) {
                    return function(b) {
                        return a.close(), m.router.navigate("project/" + b.id + "/home", {trigger: !0})
                    }
                }(this),error: function(a) {
                    return function() {
                        return a.$btnCreateProject.text("完成")
                    }
                }(this)}), this) : this.$projectNameInput.focusAtEnd()
            }, h.prototype.initOwnerSelector = function(a) {
                return this.ownerMenuView = this.requestSubView(f, {$toggler: this.$(".project-owner .open-selector-handler"),width: 500,dataList: this.getOwners(),selected: (a || m.user).id,select: function(a) {
                    return function(b) {
                        var c;
                        return b === m.user.id && (b = null), a.projectModel.set("_organizationId", b), b && (c = a.organizationsCollection.get(b).toJSON()), a.projectModel.set("organization", c), a.checkSections()
                    }
                }(this)}), this
            }, h.prototype.initPermission = function() {
                return this.permissionMenuView = this.requestSubView(f, {$toggler: this.$(".project-permission .open-selector-handler"),width: 500,dataList: [{title: "公开项目（所有访客可见）",_id: "public"}, {title: "私有项目（仅项目成员可见）",_id: "private"}],selected: "private",select: function(a) {
                    return function(b) {
                        return a.projectModel.set("isPublic", "public" === b), a.$(".project-permission .selector-title").text("public" === b ? "公开项目（所有访客可见）" : "私有项目（仅项目成员可见）")
                    }
                }(this)}), this
            }, h.prototype.initSectionSelector = function() {
                return this.sectionMenuView = this.requestSubView(f, {$toggler: this.$(".project-section .open-selector-handler"),width: 500,addPlaceholder: "添加项目分组",dataList: [],selected: "",select: function(a) {
                    return function(b) {
                        return a.refreshSelectedSection(b)
                    }
                }(this),unselect: function(a) {
                    return function() {
                        return a.refreshSelectedSection(-1)
                    }
                }(this),add: function(a) {
                    return function(b) {
                        var c, d, e;
                        return d = a.organizationsCollection.get(a.projectModel.get("_organizationId")), (c = null != d ? d.get("dividers") : void 0) ? (e = null != d ? d.get("projectIds") : void 0, c = c.slice(), c.push({pos: e.length,name: b}), d.saveSection("dividers", c, {success: function() {
                            return d.set("dividers", c), a.checkSections(c.length - 1)
                        }})) : void 0
                    }
                }(this)}), this
            }, h.prototype.getOwners = function() {
                var a, b, c, d, e, f;
                if (c = [], c.push({title: "我",plan: m.user.get("plan"),_id: m.user.id}), c._userMeId = m.user.id, b = "function" == typeof (d = this.organizationsCollection).toJSON ? d.toJSON() : void 0, (null != b ? b.length : void 0) > 0)
                    for (e = 0, f = b.length; f > e; e++)
                        a = b[e], a.hasRight > 0 && c.push({title: a.name,plan: a.plan,_id: a._id});
                return c
            }, h.prototype.checkSections = function(a) {
                var b;
                return b = this.organizationsCollection.get(this.projectModel.get("_organizationId")), 2 !== (null != b ? b.hasRight() : void 0) ? this.$projectSection.hide() : (null == a && (a = -1), this.sectionMenuView.update(b.get("dividers").map(function(a, b) {
                    return {_id: b,title: a.name}
                }), a), this.refreshSelectedSection(a), this.$projectSection.show(), this)
            }, h.prototype.refreshSelectedSection = function(a) {
                var b, c, d, e;
                return b = this.organizationsCollection.get(this.projectModel.get("_organizationId")), c = null != b && null != (d = b.get("dividers")) && null != (e = d[null != a ? a : -1]) ? e.name : void 0, c ? (this.projectModel.set("dividerIndex", a), this.$projectSectionSelectorTitle.parent().removeClass("is-placeholder")) : (this.projectModel.unset("dividerIndex"), this.$projectSectionSelectorTitle.parent().addClass("is-placeholder")), this.$projectSectionSelectorTitle.text(c || "选择或添加项目分组（可选）"), this
            }, h.prototype.refreshSelectedOrg = function() {
                var a, b, c, e, f;
                return f = this.projectModel.get("_organizationId"), f ? (c = d.get(0).get(f), b = c.get("name"), a = "<strong>" + b + " </strong>", this.$projectOwnerSelectorTips.hide(), this.$btnCreateProject.attr("disabled", !1)) : (b = "我", e = m.user.get("plan"), a = "<strong>" + b + " </strong><span>(已使用" + e.total + "个项目中的" + e.created + "个)</span>", e.total <= e.created ? (this.$projectOwnerSelectorTips.show(), this.$btnCreateProject.removeClass("btn-primary").addClass("btn-default").attr("disabled", !0)) : (this.$projectOwnerSelectorTips.hide(), this.$btnCreateProject.addClass("btn-primary").removeClass("btn-default").attr("disabled", !1))), this.$projectOwnerSelectorTitle.html(a), this
            }, h.prototype.refreshLogo = function() {
                var a, b;
                return b = this.projectModel.get("logo"), a = this.$projectLogo.find(".logo"), b ? a.css("background-image", "url(" + this.projectModel.get("logo") + ")") : a.css("background-image", "")
            }, h.prototype.initUploader = function() {
                var a;
                return a = this.$(".progress-mask"), this.uploader = new j({model: this.projectModel,pick: {id: this.$(".custom-logo"),multiple: !1},dnd: this.$(".project-category-logo .logo"),type: "logo",duplicate: !0,onCreate: function(a) {
                    return function(b) {
                        return a.projectModel.set("logo", b.thumbnail)
                    }
                }(this),onStart: function() {
                    return function() {
                        return a.css("clip", "rect(0, 300px, 150px, 0)").html("")
                    }
                }(this),onProgress: function() {
                    return function(b) {
                        var c;
                        return c = 150 * b / 100, a.css("clip", "rect(" + c + "px, 500px, 150px, 0)")
                    }
                }(this),onComplete: function(b) {
                    return function(c) {
                        return a.css("clip", "rect(150px, 500px, 150px, 0)"), b.projectModel.set({logo: c.thumbnailUrl.replace("w/200/h/200", "w/600/h/300")}), b.projectModel.set({category: null})
                    }
                }(this)}), this
            }, h.prototype.onSelectProjectCategory = function(a) {
                var b;
                return b = $(a.currentTarget), this.projectModel.set({category: b.data("category")}), this.projectModel.set({logo: null}), this
            }, h.prototype.renderProjectCover = function() {
                var a, b, c, d, f;
                if (this.$(".project-category-option").removeClass("selected-project-category-option"), c = this.projectModel.get("category"), !c)
                    return this;
                for (b = "", d = 0, f = e.length; f > d; d++)
                    a = e[d], b += "project-cover-" + a.value + " ";
                return this.$(".project-category-option." + c + "-logo").addClass("selected-project-category-option"), this.$projectCover.removeClass(b).addClass("project-cover-" + c), this.$projectLogo.removeClass(_.pluck(e, "value").join("-logo ") + "-logo ").addClass("" + c + "-logo"), this
            }, h.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, h.prototype.remove = function() {
                var a;
                return null != (a = this.uploader) && a.destroy(), h.__super__.remove.apply(this, arguments)
            }, h
        }(l)
    }), define("views/settings/user-settings/templates/basic", [], function() {
        return function() {
            var a = '<header class="user-settings-header card-header user-cover"> <p class="card-title pull-left">个人设置</p> <a class="modal-close pull-right icon icon-remove icon-white" data-dismiss="modal"></a> <div class="avatar-uploader"> <div class="avatar logo"> <a class="edit-handler icon icon-pencil"></a> <div class="progress-mask"></div> </div> </div></header><nav class="user-settings-navigation"> <ul class="section-switcher nav nav-tabs"> <li> <a class="user-switcher-toggler" data-toggle="user-info" data-gta="event" data-label="user info"> 个人设置</a> </li> <li> <a class="user-switcher-toggler" data-toggle="security" data-gta="event" data-label="security settings"> 安全设置</a> </li> <li> <a class="user-switcher-toggler" data-toggle="notification" data-gta="event" data-label="notification settings"> 提醒设置</a> </li> </ul></nav><div class="user-settings-content card-content"></div>';
            return a
        }
    }), define("views/settings/user-settings/templates/birthday", [], function() {
        return function(a) {
            var b = '<label class="form-control-select"> <select class="birthday birthday-year form-control pull-left"> <option value="0">年</option> ', c = a.years;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], b += ' <option value="' + d + '" ', a.year == d && (b += "selected"), b += ">" + d + "</option> ";
            b += ' </select></label><label class="form-control-select"> <select class="birthday birthday-month form-control pull-left"> <option value="0">月</option> ';
            var g = a.months;
            if (g)
                for (var h, i = -1, j = g.length - 1; j > i; )
                    h = g[i += 1], b += ' <option value="' + h + '" ', a.month == h && (b += "selected"), b += ">" + h + "</option> ";
            b += ' </select></label><label class="form-control-select"> <select class="birthday birthday-day form-control pull-left"> <option value="0">日</option> ';
            var k = a.days;
            if (k)
                for (var l, m = -1, n = k.length - 1; n > m; )
                    l = k[m += 1], b += ' <option value="' + l + '" ', a.day == l && (b += "selected"), b += ">" + l + "</option> ";
            return b += " </select></label>"
        }
    }), define("views/settings/user-settings/templates/email", [], function() {
        return function(a) {
            var b = '<li class="mail-item clearfix primary" data-id="' + a._emailId + '"> ' + a.email + ' <span class="label">主邮箱</span> ';
            a.isActive || (b += ' <a class="btn btn-mini email-setting-handler" data-action="resend">发送验证邮件</a> '), b += "</li>";
            var c = a.emails;
            if (c)
                for (var d, e = -1, f = c.length - 1; f > e; )
                    d = c[e += 1], d.email != a.email && (b += '<li class="mail-item clearfix option"> ' + d.email + ' <div class="mail-handler pull-right" data-id="' + d._id + '"> ', b += 1 == d.state ? ' <a class="btn btn-mini email-setting-handler" data-action="setMain">设为主邮箱</a> ' : ' <a class="btn btn-mini email-setting-handler" data-action="resend">发送验证邮件</a> ', b += ' <a class="btn btn-mini btn-danger email-setting-handler" data-action="delete">移除</a> </div></li>');
            return b
        }
    }), define("views/settings/user-settings/templates/notification-tab", [], function() {
        return function(a) {
            var b = '<form class="notification-form"> <div class="form-group clearfix"> <p class="notification-type-label pull-right">手机</p> <p class="notification-type-label pull-right">邮箱</p> </div> <div class="form-group clearfix"> <label>收到『新分享』提醒</label> <div class="toggle blue pull-right"> <input class="check';
            return a.newpost.mobile && (b += " checked"), b += '" type="button" data-type="newpost.mobile"> <div class="switch"></div> <div class="track"></div> </div> <div class="toggle blue pull-right"> <input class="check', a.newpost.email && (b += " checked"), b += '" type="button" data-type="newpost.email"> <div class="switch"></div> <div class="track"></div> </div> </div> <div class="form-group clearfix"> <label>收到『新任务』提醒</label> <div class="toggle blue pull-right"> <input class="check', a.newtask.mobile && (b += " checked"), b += '" type="button" data-type="newtask.mobile"> <div class="switch"></div> <div class="track"></div> </div> <div class="toggle blue pull-right"> <input class="check', a.newtask.email && (b += " checked"), b += '" type="button" data-type="newtask.email"> <div class="switch"></div> <div class="track"></div> </div> </div> <div class="form-group clearfix"> <label>收到『新文件』提醒</label> <div class="toggle blue pull-right"> <input class="check', a.newwork.mobile && (b += " checked"), b += '" type="button" data-type="newwork.mobile"> <div class="switch"></div> <div class="track"></div> </div> <div class="toggle blue pull-right"> <input class="check', a.newwork.email && (b += " checked"), b += '" type="button" data-type="newwork.email"> <div class="switch"></div> <div class="track"></div> </div> </div> <div class="form-group clearfix"> <label>收到『新日程』提醒</label> <div class="toggle blue pull-right"> <input class="check', a.newevent.mobile && (b += " checked"), b += '" type="button" data-type="newevent.mobile"> <div class="switch"></div> <div class="track"></div> </div> <div class="toggle blue pull-right"> <input class="check', a.newevent.email && (b += " checked"), b += '" type="button" data-type="newevent.email"> <div class="switch"></div> <div class="track"></div> </div> </div> <div class="form-group clearfix"> <label>评论提醒</label> <div class="toggle blue pull-right"> <input class="check', a.comment.mobile && (b += " checked"), b += '" type="button" data-type="comment.mobile"> <div class="switch"></div> <div class="track"></div> </div> <div class="toggle blue pull-right"> <input class="check', a.comment.email && (b += " checked"), b += '" type="button" data-type="comment.email"> <div class="switch"></div> <div class="track"></div> </div> </div> <div class="form-group clearfix"> <label>被添加参与者提醒</label> <div class="toggle blue pull-right"> <input class="check', a.involve.mobile && (b += " checked"), b += '" type="button" data-type="involve.mobile" > <div class="switch"></div> <div class="track"></div> </div> <div class="toggle blue pull-right"> <input class="check', a.involve.email && (b += " checked"), b += '" type="button" data-type="involve.email"> <div class="switch"></div> <div class="track"></div> </div> </div> <div class="form-group clearfix"> <label>任务，文件内容更新时提醒</label> <div class="toggle blue pull-right"> <input class="check', a.update.mobile && (b += " checked"), b += '" type="button" data-type="update.mobile"> <div class="switch"></div> <div class="track"></div> </div> <div class="toggle blue pull-right"> <input class="check', a.update.email && (b += " checked"), b += '" type="button" data-type="update.email"> <div class="switch"></div> <div class="track"></div> </div> </div> <div class="form-group clearfix"> <label>每日工作事项邮件提醒</label> <div class="toggle toggle-placeholder pull-right"> </div> <div class="toggle blue pull-right"> <input class="check', a.daily.email && (b += " checked"), b += '" type="button" data-type="daily.email"> <div class="switch"></div> <div class="track"></div> </div> </div> <div class="form-group clearfix"> <label>月刊订阅</label> <div class="toggle toggle-placeholder pull-right"> </div> <div class="toggle blue pull-right"> <input class="check', a.monthly.email && (b += " checked"), b += '" type="button" data-type="monthly.email"> <div class="switch"></div> <div class="track"></div> </div> </div></form>', a.desktopNotification && (b += '<hr /><div class="clearfix"> <a class="btn btn-default desktop-notification-handler">桌面通知</a></div>'), b
        }
    }), define("views/settings/user-settings/templates/profile-tab", [], function() {
        return function(a) {
            var b = '<form class="user-info-form"> <div class="form-group"> <label>姓名</label> <input class="name-input form-control" name="name" value="' + a.name + '"/> </div> <div class="form-group"> <label>职位</label> <input class="setting-info-content member-info-content title-input form-control" name="title" value="' + a.title + '"/> </div> <div class="form-group clearfix"> <label>生日</label> <div class="clearfix birthday-wrap"> </div> </div> <div class="form-group"> <label>所在地</label> <input class="setting-info-content member-info-content location-input form-control" name="location" type="text" value="' + a.location + '"/> </div> <div class="form-group"> <label>手机</label> <input class="setting-info-content member-info-content phone-input form-control" name="phone" type="text" value="' + a.phone + '"/> </div> <div class="form-group"> <label>网站</label> <input class="setting-info-content member-info-content website-input form-control" name="website" type="text" value="' + a.website + '"/> </div> <div class="form-group"> <label>语言</label> <div class="clearfix"> <a class="btn ';
            return b += "zh" == a.lang ? "btn-primary" : "btn-default", b += ' language-handler" data-lang="zh">简体中文</a> <a class="btn ', b += "en" == a.lang ? "btn-primary" : "btn-default", b += ' language-handler" data-lang="en">English</a> <a class="btn ', b += "ja" == a.lang ? "btn-primary" : "btn-default", b += ' language-handler" data-lang="ja">日本語</a> </div> </div> <button class="btn btn-save btn-primary pull-left disabled" type="submit" data-gta="event" data-label="submit user settings"> 保存 </button></form>'
        }
    }), define("views/settings/user-settings/templates/security-tab", [], function() {
        return function(a) {
            var b = '<div class="security-settings"> <h4>登录帐号管理</h4> <div class="mail-setting settings-part"> <p class="muted mail-desc">主邮箱帐号用于接收系统提醒，进行密码重置等操作；你可以添加多个备用邮箱用于登录teambition。</p> <ul class="mail-list"></ul> <div class="form-group clearfix"> <input class="new-mail-input form-control" placeholder="添加备用邮箱" /> <button class="btn btn-primary new-email-btn">添加</button> </div> </div> <h4>两步验证管理</h4> <div class="two-factor-setting settings-part"> ';
            return b += a.enabledGoogleTwoFactor ? ' <a class="btn hinted" data-title="点击进行解绑" href="' + a.unbindGoogleTwoFactor + '" target="_blank"> <span class="icon icon-tick"></span> 谷歌身份验证器 </a> ' : ' <a class="btn" href="' + a.bindGoogleTwoFactor + '" target="_blank"> 谷歌身份验证器 </a> ', b += ' </div> <h4>密码管理</h4> <div class="password-form settings-part"> <a class="btn" href="' + a.resetPasswordURL + '" target="_blank"> 修改登录密码 </a> </div></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/settings/user-settings/index", ["require", "exports", "module", "hotkey", "teambition", "moment", "lib/notification/index", "lib/uploader/index", "util", "view", "./templates/basic", "./templates/birthday", "./templates/email", "./templates/notification-tab", "./templates/profile-tab", "./templates/security-tab", "essage"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q;
        return o = a("hotkey"), p = a("teambition"), f = a("moment"), g = a("lib/notification/index"), k = a("lib/uploader/index"), m = a("util"), n = a("view"), c = a("./templates/basic"), d = a("./templates/birthday"), e = a("./templates/email"), h = a("./templates/notification-tab"), i = a("./templates/profile-tab"), j = a("./templates/security-tab"), q = a("essage"), l = function(a) {
            function l() {
                return l.__super__.constructor.apply(this, arguments)
            }
            return b(l, a), l.prototype.viewName = "UserSettingsView", l.prototype.className = "user-settings-view modal-dialog card", l.prototype.events = {"click .user-switcher-toggler": "switch","keyup .user-info-form input": "collectInfoChanges","click .notification-form .check": "toggleNotificationSetting","submit .user-info-form": "submitUserInfo","change .birthday": "changeBirthday","click .email-setting-handler": "emailSettingHandler","click .new-email-btn": "addNewEmail","click .desktop-notification-handler": "setupDesktopNotification","click .language-handler": "changeLanguage"}, l.prototype.initialize = function() {
                return this.userModel = p.user, this.changes = {}, this.renderBasic().renderAvatar().toggle("user-info"), this.listen(), this
            }, l.prototype["switch"] = function(a) {
                return this.toggle($(a.currentTarget).data("toggle")), this
            }, l.prototype.toggle = function(a) {
                if (a === this.tab)
                    return this;
                switch (this.tab = a, this.changes = {}, this.$switcher.find(".active").removeClass("active"), this.$switcher.find("[data-toggle=" + a + "]").parent().addClass("active"), a) {
                    case "user-info":
                        this.renderProfileTab();
                        break;
                    case "security":
                        this.renderSecurityTab();
                        break;
                    case "notification":
                        this.renderNotificationTab()
                }
                return this
            }, l.prototype.listen = function() {
                return this.listenTo(this.userModel, "change:avatarUrl", this.renderAvatar), this.listenTo(this.userModel, "change:email change:emails", this.renderEmail), this.listenTo(this.userModel, "change:name change:title change:location change:website", this.renderProfileTab), this
            }, l.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$content = this.$(".user-settings-content"), this.$mask = this.$(".progress-mask"), this.$switcher = this.$(".section-switcher"), this
            }, l.prototype.renderAvatar = function() {
                return this.$(".avatar").css({"background-image": "url(" + this.userModel.get("avatarUrl") + ")"}), this
            }, l.prototype.renderProfileTab = function() {
                var a;
                return a = this.userModel.toJSON(), a.lang = p.PREFERENCE.getLang(), this.$content.html(i(a)), this.$nameInput = this.$content.find(".name-input"), this.$titleInput = this.$content.find(".title-input"), this.$locationInput = this.$content.find(".location-input"), this.$websiteInput = this.$content.find(".website-input"), this.$phoneInput = this.$content.find(".phone-input"), this.renderBirthday(), this.renderAvatar(), this.initAvatarUploader(), this
            }, l.prototype.renderSecurityTab = function() {
                var a;
                return a = this.userModel.toJSON(), a.bindGoogleTwoFactor = "" + p.accountHost + "/user/google-two-factor", a.unbindGoogleTwoFactor = "" + p.accountHost + "/user/google-two-factor/disable", a.resetPasswordURL = "" + p.accountHost + "/forgot", this.$content.html(j(a)), this.renderEmail(this.userModel), this
            }, l.prototype.renderEmail = function(a) {
                return this.$content.find(".mail-list").html(e(a.toJSON())), this
            }, l.prototype.renderNotificationTab = function() {
                var a;
                return a = p.PREFERENCE.structureNotification(), a.desktopNotification = g.support(), this.$content.html(h(a)), this
            }, l.prototype.renderBirthday = function(a) {
                var b, c, e, g, h;
                return a || (a = f(this.userModel.get("birthday"))), b = {day: a.date(),month: a.month() + 1,year: a.year()}, e = f().year() - 10, b.years = function() {
                    g = [];
                    for (var a = e, b = e - 80; b >= e ? b >= a : a >= b; b >= e ? a++ : a--)
                        g.push(a);
                    return g
                }.apply(this), b.months = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], c = f("" + b.year + "-" + b.month, "YYYY-MM").daysInMonth(), b.days = function() {
                    h = [];
                    for (var a = 1; c >= 1 ? c >= a : a >= c; c >= 1 ? a++ : a--)
                        h.push(a);
                    return h
                }.apply(this), this.$content.find(".birthday-wrap").html($(d(b))), this
            }, l.prototype.initAvatarUploader = function() {
                var a;
                return a = this.$(".progress-mask"), this.uploader = new k({model: this.userModel,pick: {id: this.$(".edit-handler"),label: " ",multiple: !1},dnd: this.$(".avatar-uploader"),type: "avatar",duplicate: !0,onCreate: function(a) {
                    return function(b) {
                        return a.userModel.set("avatarUrl", b.thumbnailUrl)
                    }
                }(this),onStart: function() {
                    return function() {
                        return a.css("clip", "rect(0, 132px, 132px, 0)").html("")
                    }
                }(this),onProgress: function() {
                    return function(b) {
                        var c;
                        return c = 132 * b / 100, a.css("clip", "rect(" + c + "px, 132px, 132px, 0)")
                    }
                }(this),onComplete: function(b) {
                    return function(c) {
                        var d;
                        return a.css("clip", "rect(132px, 132px, 132px, 0)"), d = {avatarUrl: c.thumbnailUrl}, b.userModel.save(d, {attrs: d})
                    }
                }(this)}), this
            }, l.prototype.collectInfoChanges = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), d = b.val(), c = b.attr("name"), this.checkInfoChange(c, d), this
            }, l.prototype.checkInfoChange = function(a, b) {
                var c;
                return c = this.userModel.get(a), "birthday" === a && (c = f(c).toISOString()), c !== b ? this.changes[a] = b : delete this.changes[a], _.isEmpty(this.changes) ? this.$content.find(".btn-save").addClass("disabled") : this.$content.find(".btn-save").removeClass("disabled"), this
            }, l.prototype.submitUserInfo = function(a) {
                return a.preventDefault(), this.validUserInfo() && this.userModel.save(null, {attrs: this.changes,success: function(a) {
                    return function() {
                        return a.$content.find(".btn-save").addClass("disabled"), Essage.show({message: "个人信息更新成功",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, l.prototype.toggleNotificationSetting = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = b.data("type"), b.hasClass("checked") ? (this.changes[c] = !1, b.removeClass("checked")) : (this.changes[c] = !0, b.addClass("checked")), p.PREFERENCE.updateNotification(this.changes), this
            }, l.prototype.changeBirthday = function() {
                var a, b, c, d, e;
                return e = +this.$content.find(".birthday-year").val() || f().year() - 10, d = +this.$content.find(".birthday-month").val() || 1, b = +this.$content.find(".birthday-day").val() || 1, a = f(this.userModel.get("birthday") || new Date), c = f("" + e + "-" + d, "YYYY-MM").daysInMonth(), a.set("year", e).set("month", d - 1).set("date", Math.min(b, c)), this.renderBirthday(a), this.checkInfoChange("birthday", a.toISOString()), this
            }, l.prototype.validUserInfo = function() {
                var a, b, c, d, e;
                b = !0, e = this.changes;
                for (a in e)
                    switch (d = e[a], a) {
                        case "name":
                            "" === d.replace(/\s/g, "") && (this.$nameInput.addClass("red").attr("placeholder", "请填写姓名").val(""), setTimeout(function(a) {
                                return function() {
                                    return a.$nameInput.removeClass("red").attr("placeholder", "")
                                }
                            }(this), 3e3), b = !1);
                            break;
                        case "phone":
                            if ("" === d.replace(/\s/g, ""))
                                continue;
                            c = /\d{11}$/, c.exec(d) || (this.$phoneInput.addClass("red").attr("placeholder", "请填写有效的电话号码").val(""), setTimeout(function(a) {
                                return function() {
                                    return a.$phoneInput.removeClass("red").attr("placeholder", "")
                                }
                            }(this), 3e3), b = !1)
                    }
                return b
            }, l.prototype.emailSettingHandler = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), d = b.parent().data("id"), c = b.data("action"), "resend" === c && /\d/.test(b.html()) ? void 0 : this.userModel.emailSetting(c, d, function(a) {
                    return function(d, e) {
                        var f, g;
                        if (a.emailSettingMessage(d, e), "resend" === c && !d) {
                            for (b.html("邮件已发送(30秒后可以重新发送)"), f = 30, g = 30; --f; )
                                setTimeout(function() {
                                    return --g, b.html("邮件已发送(" + g + "秒后可以重新发送)")
                                }, 1e3 * (30 - f));
                            return setTimeout(function() {
                                return b.html("发送验证邮件")
                            }, 3e4)
                        }
                    }
                }(this))
            }, l.prototype.addNewEmail = function(a) {
                var b;
                return b = $(a.currentTarget).prev("input").val(), m.isEmail(b) ? (this.userModel.addEmail(b, function(a) {
                    return function(b, c) {
                        return a.emailSettingMessage(b, c)
                    }
                }(this)), $(a.currentTarget).prev("input").val("")) : void 0
            }, l.prototype.emailSettingMessage = function(a, b) {
                var c;
                return c = {209: "您输入的邮箱已被使用",211: "邮箱未验证，无法设置为主邮箱!",212: "邮箱已验证"}, a ? (b = c[a.code] || a.message, Essage.show({message: b,status: "error"}, 2e3)) : Essage.show({message: b,status: "success"}, 2e3), this
            }, l.prototype.changeLanguage = function(a) {
                var b, c;
                if (!this.changingLang && (b = $(a.currentTarget), c = b.data("lang"), c !== p.PREFERENCE.getLang() && p.PREFERENCE.updateLang(c)))
                    return this.changingLang = !0, b.siblings().addClass("btn-default").removeClass("btn-primary"), b.addClass("btn-primary").removeClass("btn-default")
            }, l.prototype.setupDesktopNotification = function() {
                return g.setup(), this
            }, l.prototype.remove = function() {
                var a;
                return null != (a = this.uploader) && a.destroy(), l.__super__.remove.apply(this, arguments)
            }, l
        }(n)
    }), define("views/core/navigation/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="navbar-inner"> <div class="nav-handler"> <a class="logo" data-gta="event" data-label="enter portal by logo"></a> </div> ';
            return a.isGhost ? c += ' <div class="pull-right clearfix nav-ghost-btns"> <button class="btn btn-default login-handler">登录</button> <button class="btn btn-primary register-handler">注册</button> </div> ' : (c += ' <div class="pull-left clearfix nav-handler-set"> <div class="nav-handler"> <a class="projects-handler" data-gta="event" data-label="return project or portal"> 项目 </a> </div> <div class="nav-handler"> <a class="organization-switcher-handler" data-gta="event" data-label="open organization switch menu"> 组织 </a> </div> <div class="nav-handler"> <a class="my-handler" data-gta="event" data-label="enter my"> 我的 <span class="tasks-badge"></span> </a> </div> <div class="nav-handler"> <a class="inbox-handler" data-gta="event" data-label="enter inbox"> 收件箱 <span class="message-badge"></span> </a> </div> </div> <div class="pull-right clearfix"> <a class="new-ribbon" data-gta="event" data-label="enter new feature introduction" href="/new" target="_blank">新功能</a> <div class="nav-handler nav-separate"> <a class="create-handler guide-handler" data-guide="navCreate" data-toggle="dropdown" data-gta="event" data-label="create project or organization"> <span class="icon icon-plus-bold"></span>创建 </a> <div class="creator-selector dropdown-menu card"> <ul class="list-underscore"> <li class="create-project" data-gta="event" data-label="create project"> <h3>创建项目</h3> <p>每个项目都有任务板、文件库和日程表等功能。</p> </li> <li class="create-organization underscore" data-gta="event" data-label="create organization"> <span class="business-mark">企业版</span> <h3>创建组织</h3> <p>组织是项目和人的集合，可以用来管理你的公司、团队。</p> </li> </ul> </div> </div> <div class="nav-handler nav-separate my-set"> <a data-toggle="dropdown" data-gta="event" data-label="user bar|show user menu"> <div class="avatar img-circle img-24" style="background-image:url(' + a.avatarUrl + ');"></div> <span class="user-name">' + b(a.name) + '</span> </a> <ul class="dropdown-menu card list-underscore"> <li> <a class="my-settings-handler" data-gta="event" data-label="my settings">个人设置</a> </li> ', a.isPublicService && (c += ' <li> <a href="https://pay.teambition.com/plans" target="_blank" data-gta="event" data-label="payment center">支付中心</a> </li> '), c += ' <li class="underscore"> <a class="hotkey-handler" data-gta="event" data-label="hotkey helper">快捷键</a> </li> <li> <a href="/apps" target="_blank">下载应用</a> </li> <li> <a href="/support" target="_blank">帮助中心</a> </li> <li class="underscore"> <a href="' + a.logoutURL + '" data-gta="event" data-label="log out">退出登录</a> </li> </ul> </div> <div class="nav-handler search"> <a class="search-handler" data-gta="event" data-label="enter search"> <span class="icon icon-search"></span> </a> </div> </div> '), c += "</div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/core/navigation/index", ["require", "exports", "module", "teambition", "lib/guide-point/index", "moment", "store", "util", "view", "collections/organizations", "views/core/hotkey-helper/index", "views/organization/organization-creator/index", "views/organization/organization-switcher/index", "views/project/project-creator/index", "views/settings/user-settings/index", "lib/window/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s;
        return s = a("teambition"), d = a("lib/guide-point/index"), f = a("moment"), l = a("store"), n = a("util"), o = a("view"), j = a("collections/organizations"), e = a("views/core/hotkey-helper/index"), h = a("views/organization/organization-creator/index"), i = a("views/organization/organization-switcher/index"), k = a("views/project/project-creator/index"), m = a("views/settings/user-settings/index"), p = a("lib/window/index"), c = a("./templates/basic"), r = l.namespace("temp").namespace("navigation_task_badge"), q = /^https?:\/\/(www.teambition.com|project.ci)/, g = function(a) {
            function g() {
                return g.__super__.constructor.apply(this, arguments)
            }
            return b(g, a), g.prototype.viewName = "NavigationView", g.prototype.el = $("#navigator"), g.prototype.className = "navbar-central navbar", g.prototype.events = {"click .logo": "enterProjects","click .brand": "goHomePage","click .create-project": "openProjectCreator","click .create-organization": "openOrganizationCreator","click .projects-handler": "returnProjects","click .organization-switcher-handler": "toggleOrganizationSwitcher","click .my-handler": "enterMy","click .inbox-handler": "enterInbox","click .search-handler": "enterSearch","click .new-ribbon": "updateUserPreference","click .create-project-handler": "openProjectCreator","click .my-settings-handler": "showUserSettings","click .hotkey-handler": "showHotkeys","click .login-handler": "loginHanlder","click .register-handler": "registerHandler"}, g.prototype.initialize = function() {
                var a;
                return this.renderBasic().listen(), a = s.user.toJSON(), a.isGhost ? this : (s.user.fetchTodayTasks(), _.delay(function(a) {
                    return function() {
                        return a.refreshNew().refreshMessage().refreshTasksBadge(), d.initialize(a)
                    }
                }(this), 100), this)
            }, g.prototype.renderBasic = function() {
                var a;
                return a = s.user.toJSON(), a.logoutURL = "" + s.accountHost + "/logout", a.isPublicService = q.test(location.href), this.$el.html(c(a)), this.$badge = this.$(".message-badge"), this.$tasksBadge = this.$(".tasks-badge"), this.$creatorSelector = this.$(".creator-selector"), this.$myHandler = this.$(".my-handler"), this.$inboxHandler = this.$(".inbox-handler"), this.$projectsHandler = this.$(".projects-handler"), this.$searchHandler = this.$(".search-handler"), this
            }, g.prototype.listen = function() {
                return this.listenTo(s.user, "change:name change:avatarUrl", this.renderBasic), this.listenTo(s.user, "change:badge", this.refreshMessage), this.listenTo(s.user, "change:todayTasks", this.refreshTasksBadge), this.listenTo(s.PREFERENCE, "change:hasNew", this.refreshNew), this
            }, g.prototype.refreshMessage = function() {
                var a, b, c;
                return a = s.user.get("badge"), this.$badge.text(a || ""), null != (b = s.favico) && b.badge(a || 0), (null != (c = s.favico) ? c.browser.supported : void 0) || s.APP.dynamicTitle(), a && -1 !== _.indexOf(d.validList(), "navInbox") && (this.$inboxHandler.addClass("guide-handler").data("guide", "navInbox"), d.initialize(this)), this
            }, g.prototype.refreshTasksBadge = function() {
                var a, b, c;
                return c = r(s.user.id), b = f(), s.user.get("isNew") || c && b.isSame(c, "day") ? this.$tasksBadge.text("") : (a = s.user.get("todayTasks"), this.$tasksBadge.text(a || ""), a && -1 !== _.indexOf(d.validList(), "navMy") && (this.$myHandler.addClass("guide-handler").data("guide", "navMy"), d.initialize(this))), this
            }, g.prototype.refreshNew = function() {
                return s.PREFERENCE.get("hasNew") !== !0 || s.user.get("isNew") || this.$(".new-ribbon").css({display: "block"}), this
            }, g.prototype.updateUserPreference = function() {
                return this.$(".new-ribbon").hide(), s.PREFERENCE.save(null, {attrs: {hasNew: !1}}), this
            }, g.prototype.enterProjects = function() {
                return s.user.get("isGhost") ? s.router.gotoTeambition() : (s.APP.Float.close(), s.router.navigate("projects", {trigger: !0}), this)
            }, g.prototype.returnProjects = function() {
                return s.APP.Float.currentView ? s.APP.Float.close() : this.enterProjects(), this
            }, g.prototype.activeProjects = function() {
                return this.$projectsHandler[/^project\//.test(s.router.getUrl()) ? "addClass" : "removeClass"]("active"), this
            }, g.prototype.toggleOrganizationSwitcher = function(a) {
                return this.organizationSwitcherView || (this.organizationSwitcherView = this.requestSubView(i, {$toggler: $(a.currentTarget),organizationsCollection: j.get(0)}).show()), this
            }, g.prototype.enterMy = function(a) {
                var b;
                return s.user.get("todayTasks") && (r(s.user.id, f().toISOString()), this.$tasksBadge.text("")), b = s.APP.Float.toggleMy(), b || a.stopPropagation(), this
            }, g.prototype.enterInbox = function(a) {
                var b;
                return b = s.APP.Float.toggleInbox(), b || a.stopPropagation(), this
            }, g.prototype.enterSearch = function(a) {
                var b;
                return b = s.APP.Float.toggleSearch(), b || a.stopPropagation(), this
            }, g.prototype.openProjectCreator = function() {
                return this.requestSubView(p).open(k), this
            }, g.prototype.openOrganizationCreator = function() {
                return this.requestSubView(p).open(h), this
            }, g.prototype.showHotkeys = function() {
                return this.requestSubView(p).open(e), this
            }, g.prototype.showUserSettings = function() {
                return this.requestSubView(p).open(m), this
            }, g.prototype.loginHanlder = function() {
                return s.router.gotoLogin(), this
            }, g.prototype.registerHandler = function() {
                return s.router.gotoRegister(), this
            }, g
        }(o)
    }), define("views/organization/member-menu/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="list"> ';
            return a.isOrgnizationMemberMenu ? (b += " ", 2 == a.hasOrganizationRight ? (b += " ", b += 2 == a.hasRight ? ' <li> <a class="unset-owner-handler"> <span class="icon icon-user"></span>取消拥有者 </a> </li> ' : 1 == a.hasRight ? ' <li> <a class="unset-manager-handler"> <span class="icon icon-user"></span>取消管理员 </a> </li> ' : ' <li> <a class="set-owner-handler"> <span class="icon icon-user"></span>设为拥有者 </a> </li> <li> <a class="set-manager-handler"> <span class="icon icon-user"></span>设为管理员 </a> </li> <li> <a class="remove-member-handler"> <span class="icon icon-trash"></span>从组织中移除 </a> </li> ', b += " ") : b += ' <li> <a class="remove-member-handler"> <span class="icon icon-trash"></span>从组织中移除 </a> </li> ', b += " ") : b += ' <li> <a class="remove-member-handler"> <span class="icon icon-trash"></span>从团队中移除 </a> </li> ', b += "</ul>"
        }
    }), define("views/organization/member-menu/templates/remove", [], function() {
        return function() {
            var a = '<form class="member-remove-form"> <p>确认移除该成员？</p> <button class="btn btn-danger" type="submit" data-gta="event" data-label="remove member">确认移除</button></form>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/member-menu/index", ["require", "exports", "module", "./templates/basic", "lib/popover/index", "./templates/remove"], function(a) {
        var c, d, e, f;
        return c = a("./templates/basic"), e = a("lib/popover/index"), f = a("./templates/remove"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "MemberMenuView", d.prototype.popoverTitle = "成员菜单", d.prototype.events = {"click .remove-member-handler": "enterRemoveSubMenu","click .set-manager-handler": "setAdmin","click .unset-manager-handler": "unsetAdmin","click .set-owner-handler": "setOwner","click .unset-owner-handler": "unsetOwner","submit .member-remove-form": "submitRemoveForm"}, d.prototype.render = function() {
                var a;
                if (this.options.memberModel)
                    return a = this.options.memberModel.toJSON(), a.isOrgnizationMemberMenu = this.options.isOrgnizationMemberMenu, a.hasOrganizationRight = this.options.hasOrganizationRight, this.$el.html(c(a)), this
            }, d.prototype.enterRemoveSubMenu = function() {
                return this.enterSubMenu("移除成员", function(a) {
                    return function() {
                        return a.$el.html(f(a.options.memberModel.toJSON())), a.$("input").focusAtEnd()
                    }
                }(this)), this
            }, d.prototype.setAdmin = function(a) {
                return a.preventDefault(), this.options.memberModel.saveAttr("admin"), this.hide(), this
            }, d.prototype.unsetAdmin = function(a) {
                return a.preventDefault(), this.options.memberModel.saveAttr("member"), this.hide(), this
            }, d.prototype.setOwner = function(a) {
                return a.preventDefault(), this.options.memberModel.saveAttr("owner"), this.hide(), this
            }, d.prototype.unsetOwner = function(a) {
                return a.preventDefault(), this.options.memberModel.saveAttr("admin"), this.hide(), this
            }, d.prototype.submitRemoveForm = function(a) {
                return a.preventDefault(), this.options.membersCollection.removeMember(this.options.memberModel.id, {success: function(a) {
                    return function() {
                        return a.hide()
                    }
                }(this)}), this
            }, d
        }(e)
    }), define("views/organization/members-manager/templates/basic", [], function() {
        return function(a) {
            var b = "";
            return a.hasRight >= 0 && (b += '<div class="members-nanger-header"> <ol class="breadcrumbs"> <li> 所有成员 </li> </ol></div>'), b += '<div class="members-manager-content"> ', a.hasRight > 0 && (b += ' <div class="add-member-card card"> <h4 class="nav">添加成员</h4> <p>通过邮箱添加新成员</p> <div class="member-finder"> <input class="member-info-input form-control" type="text" placeholder="输入邮箱 回车确认"/> </div> </div> '), b += ' <div class="members-card"> <ul class="members-list"></ul> </div></div>'
        }
    }), define("views/organization/members-manager/templates/member", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="' + a._id + " ";
            return c += a.hasOrganizationRight > 0 ? "member-witch-add-card" : "member", c += ' card" data-id="' + a._id + '"> <div class="avatar img-circle img-60" style="background-image:url(' + a.avatarUrl + ');"></div> <p class="abstract"> ', c += a._id === a._userMeId ? ' <strong class="name">我(' + b(a.name) + ")</strong> " : ' <strong class="name">' + b(a.name) + "</strong> ", c += ' </p> <p class="muted" title="' + a.title + '">' + b(a.title) + "</p> ", a.hasOrganizationRight >= 0 && (c += ' <div class="member-strip member-strip-' + a._id + '"> <div class="strip-part done-part hinted"> <div class="strip-part-bar"></div> </div> <div class="strip-part undone-part hinted"> <div class="strip-part-bar"></div> </div> <div class="strip-part expire-part hinted"> <div class="strip-part-bar"></div> </div> </div> ', 2 == a.hasRight ? c += ' <a class="owner-mark"> <span class="icon icon-crown hinted" data-title="拥有者"></span> </a> ' : 1 == a.hasRight && (c += ' <a class="manager-mark"> <span class="icon icon-user-bold hinted" data-title="管理员"></span> </a> '), c += " ", a._id !== a._userMeId && (2 == a.hasOrganizationRight || a.hasOrganizationRight > a.hasRight) && (c += ' <a class="member-menu-toggler icon icon-chevron-down" data-member-id="' + a._id + '"></a> '), c += " "), c += "</li>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/members-manager/index", ["require", "exports", "module", "teambition", "lib/guide-point/index", "util", "view", "collections/members", "views/member/member-finder/index", "views/organization/member-menu/index", "./templates/basic", "./templates/member"], function(a) {
        var c, d, e, f, g, h, i, j, k, l;
        return l = a("teambition"), d = a("lib/guide-point/index"), j = a("util"), k = a("view"), h = a("collections/members"), e = a("views/member/member-finder/index"), f = a("views/organization/member-menu/index"), c = a("./templates/basic"), g = a("./templates/member"), i = function(a) {
            function i() {
                return i.__super__.constructor.apply(this, arguments)
            }
            return b(i, a), i.prototype.viewName = "MembersManagerView", i.prototype.className = "members-manager-view", i.prototype.events = {"click .member-menu-toggler": "toggleMemberMenu","click .member-strip": "onMemberStripClick","click .member": "onMemberClick","click .member-witch-add-card": "onMemberClick"}, i.prototype.initialize = function(a) {
                return this.options = null != a ? a : {}, this.organizationModel = this.options.organizationModel, this.hasRight = this.organizationModel.hasRight(), this.loadOrganizationMembers({success: function(a) {
                    return function() {
                        return a.renderBasic().renderMembers(), d.initialize(a), a.hasRight && a.initMemberFinder(), a.listen()
                    }
                }(this)})
            }, i.prototype.listen = function() {
                return this.listenTo(this.organizationMembersCollection, "add remove", this.renderMembers), this.listenTo(this.organizationMembersCollection, "change:hasRight change:isQuited change:name change:avatarUrl", this.renderMember)
            }, i.prototype.loadOrganizationMembers = function(a) {
                var b;
                return b = _.extend({boundToObjectType: "organization"}, a), b.success = function(b) {
                    return function(c) {
                        return b.organizationMembersCollection = c, a.success()
                    }
                }(this), h.fetch(this.organizationModel.id, b), this
            }, i.prototype.renderMembersStatus = function() {
                return this.organizationModel.hasRight() >= 0 ? (this.organizationModel.getStatistic({attrs: {all: !0},success: function(a) {
                    return function(b) {
                        return b.forEach(function(b) {
                            return a.renderMemberStatus(_.clone(b))
                        })
                    }
                }(this)}), this) : this
            }, i.prototype.renderBasic = function() {
                return this.$el.html(c({hasRight: this.hasRight})), this.$membersList = this.$(".members-list"), this
            }, i.prototype.renderMembers = function() {
                return this.$membersList.empty(), this.organizationMembersCollection.each(function(a) {
                    return function(b) {
                        return a.renderMember(b, !1)
                    }
                }(this)), this.buildGuidePointDom(), _.delay(function(a) {
                    return function() {
                        return a.renderMembersStatus()
                    }
                }(this)), this
            }, i.prototype.renderMember = function(a, b) {
                return this.assembleData(a, function(a) {
                    return function(c) {
                        var d, e, f;
                        return c._userMeId = l.user.id, f = a.$membersList.find("li[data-id=" + c._id + "]"), c.isQuited ? f.remove() : (d = $(g(c)), f.length ? f.replaceWith(d) : (e = _.isBoolean(b) && b ? "prepend" : "append", a.$membersList[e](d)))
                    }
                }(this)), this
            }, i.prototype.renderMemberStatus = function(a) {
                var b, c, d, e, f;
                return a.undoCount = a.undoCount - a.expiredCount, e = a.undoCount + a.doneCount + a.expiredCount, 0 === e ? (c = 1, f = 0, d = 0) : (c = a.doneCount / e, f = a.undoCount / e, d = a.expiredCount / e), b = $(".member-strip-" + a._id), b.find(".done-part").css({width: "" + 100 * c + "%",opacity: 1}).attr("data-title", "已完成 " + a.doneCount), b.find(".undone-part").css({width: "" + 100 * f + "%",opacity: 1}).attr("data-title", "近期任务 " + a.undoCount), b.find(".expire-part").css({width: "" + 100 * d + "%",opacity: 1}).attr("data-title", "已逾期 " + a.expiredCount)
            }, i.prototype.assembleData = function(a, b) {
                var c;
                return c = a.toJSON(), c.hasOrganizationRight = this.organizationModel.hasRight(), c.dateString = j.formatDate(a.get("joined")).dateString, b(c)
            }, i.prototype.addMember = function(a) {
                var b;
                return b = a.attributes ? {email: a.get("email")} : {email: a.item.email}, this.organizationMembersCollection.addMember(b), this
            }, i.prototype.initMemberFinder = function() {
                return this.$(".member-info-input").length ? (this.requestSubView(e, {collection: this.organizationMembersCollection,$searchbox: this.$(".member-info-input"),select: function(a) {
                    return function(b) {
                        return a.addMember(b)
                    }
                }(this)}), this) : this
            }, i.prototype.toggleMemberMenu = function(a) {
                var b, c;
                return a.preventDefault(), a.stopPropagation(), c = $(a.currentTarget).data("memberId"), b = $(a.currentTarget), b.data("bs.popover") ? this : (this.requestSubView(f, {$toggler: b,membersCollection: this.organizationMembersCollection,memberModel: this.organizationMembersCollection.get(c),hasOrganizationRight: this.organizationModel.hasRight(),isOrgnizationMemberMenu: !0}).show(), this)
            }, i.prototype.onMemberClick = function(a) {
                var b;
                return b = this.$(a.currentTarget).data("id"), this.options.onMemberClick(this.organizationMembersCollection.get(b))
            }, i.prototype.onMemberStripClick = function(a) {
                return a.stopPropagation()
            }, i.prototype.buildGuidePointDom = function() {
                return this.$membersList.find("li:eq(1) .member-strip").addClass("guide-handler").data("guide", "orgBar"), this.$membersList.find("li:eq(2) .member-menu-toggler").addClass("guide-handler").data("guide", "orgRight")
            }, i
        }(k)
    }), define("views/organization/member-manager/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="member-manger-header"> <ol class="breadcrumbs"> <li> <a class="breadcrumb-handler back-to-members">所有成员</a> </li> <li class="active">' + b(a.name) + '</li> </ol></div><div class="member-manager-content"> <div class="member-manager-content-side card"> <div class="member-header"> <div class="avatar img-circle img-60" style="background-image:url(' + a.avatarUrl + ');"></div> <p class="member-name">' + b(a.name) + '</p> <p class="muted" title="' + a.title + '">' + b(a.title) + '</p> </div> <div class="member-info"> <div class="email"> <span class="icon icon-envelope-bold"></span> <span class="email-address">' + b(a.email) + "</span> </div> ";
            return a.phone && a.phone.trim() && (c += ' <div class="phone"> <span class="icon icon-phone"></span> <span class="phone-number">' + b(a.phone) + "</span> </div> "), c += ' </div> <ul class="member-status"> <li class="expired"> <p class="number">' + a.expiredCount + '</p> <p>已逾期</p> </li> <li class="undo"> <p class="number">' + a.undoCount + '</p> <p>未完成</p> </li> <li class="done"> <p class="number">' + a.doneCount + '</p> <p>已完成</p> </li> </ul> </div> <div class="member-manager-main-content card"> </div></div>'
        }
    }), define("views/organization/member-tasks/templates/basic", [], function() {
        return function() {
            var a = '<div class="today-tasks" data-gta="event" data-label="member today tasks" data-value="member today tasks"> <h3>今天的任务 ・ <span class="today-task-count">0</span></h3></div><div class="recent-tasks" data-gta="event" data-label="member recent tasks" data-value="member recent tasks"> <h3>近期的任务 ・ <span class="recent-task-count">0</span></h3></div><div class="future-tasks" data-gta="event" data-label="member future tasks" data-value="member future tasks"> <h3>未来的任务 ・ <span class="future-task-count">0</span></h3></div><div class="recently-done-tasks" data-gta="event" data-label="member recently done tasks" data-value="member recently done tasks"> <h3>最近完成的任务 ・ <span class="recently-done-task-count">0</span></h3></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/member-tasks/index", ["require", "exports", "module", "underscore", "teambition", "lib/http", "moment", "thenjs", "view", "models/task", "collections/tasks", "views/board/task/task-list/index", "./templates/basic"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m;
        return m = a("underscore"), l = a("teambition"), d = a("lib/http"), f = a("moment"), j = a("thenjs"), k = a("view"), h = a("models/task"), i = a("collections/tasks"), g = a("views/board/task/task-list/index"), c = a("./templates/basic"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "MemberTasksView", e.prototype.tagName = "section", e.prototype.className = "member-tasks-view", e.prototype.initialize = function(a) {
                return this.options = null != a ? a : {}, this.memberModel = this.options.memberModel, this.todayTasksCollection = i.get("" + this.memberModel.id + "_today_tasks"), this.recentTasksCollection = i.get("" + this.memberModel.id + "_recent_tasks"), this.futureTasksCollection = i.get("" + this.memberModel.id + "_future_tasks"), this.recentlyDoneTasksCollection = i.get("" + this.memberModel.id + "_recently_tasks"), this.load({success: function(a) {
                    return function() {
                        return a.renderBasic(), a.renderTaskLists(), a.refreshTodayTaskCount().refreshRecentTaskCount().refreshFutureTaskCount().refreshRecentlyDoneTasksCount().listen()
                    }
                }(this)}), this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$recentTasks = this.$(".recent-tasks"), this
            }, e.prototype.renderTaskLists = function() {
                return this.requestSubView(g, {isPrepend: !0,groupBy: !0,noExecutor: !0,rightOffset: 0,tasksCollection: this.todayTasksCollection}).$el.appendTo(this.$(".today-tasks")), this.requestSubView(g, {isPrepend: !0,groupBy: !0,noExecutor: !0,rightOffset: 0,tasksCollection: this.recentTasksCollection}).$el.appendTo(this.$(".recent-tasks")), this.requestSubView(g, {isPrepend: !0,groupBy: !0,noExecutor: !0,rightOffset: 0,tasksCollection: this.futureTasksCollection}).$el.appendTo(this.$(".future-tasks")), this.requestSubView(g, {isPrepend: !0,groupBy: !0,noExecutor: !0,rightOffset: 0,tasksCollection: this.recentlyDoneTasksCollection}).$el.appendTo(this.$(".recently-done-tasks"))
            }, e.prototype.listen = function() {
                return this.listenTo(this.todayTasksCollection, "add remove", this.refreshTodayTaskCount), this.listenTo(this.recentTasksCollection, "add remove", this.refreshRecentTaskCount), this.listenTo(this.futureTasksCollection, "add remove", this.refreshFutureTaskCount), this.listenTo(this.recentlyDoneTasksCollection, "add remove", this.refreshRecentlyDoneTasksCount), this.listenTo(this.todayTasksCollection, "change:_executorId", function(a) {
                    return function(b, c) {
                        return b.get("isDone") || c !== l.user.id ? a.todayTasksCollection.remove(b) : void 0
                    }
                }(this)), this.listenTo(this.recentTasksCollection, "change:_executorId", function(a) {
                    return function(b, c) {
                        return b.get("isDone") || c !== l.user.id ? a.recentTasksCollection.remove(b) : void 0
                    }
                }(this)), this.listenTo(this.futureTasksCollection, "change:_executorId", function(a) {
                    return function(b, c) {
                        return b.get("isDone") || c !== l.user.id ? a.futureTasksCollection.remove(b) : void 0
                    }
                }(this)), this.listenTo(this.recentlyDoneTasksCollection, "change:_executorId", function(a) {
                    return function(b, c) {
                        return c !== l.user.id ? a.recentlyDoneTasksCollection.remove(b) : void 0
                    }
                }(this)), this
            }, e.prototype.load = function(a) {
                return this.showLoadingIndicator(this.$el), j.parallel([function(a) {
                    return function(b) {
                        return d.ajax("tasks", {data: {_memberId: a.memberModel.get("_memberId"),withProject: !0,withTags: !0,all: !0},expireCache: {namespace: "member_tasks",expire: 120},success: function(a) {
                            return b(null, a)
                        },error: function(a, c, d) {
                            return b(d, null)
                        }})
                    }
                }(this), function(a) {
                    return function(b) {
                        return d.ajax("tasks", {data: {_memberId: a.memberModel.get("_memberId"),isDone: !0,withTags: !0,withProject: !0},expireCache: {namespace: "member_tasks",expire: 120},success: function(a) {
                            return b(null, a)
                        },error: function(a, c, d) {
                            return b(d, null)
                        }})
                    }
                }(this)]).fin(function(b) {
                    return function(c, d, e) {
                        return d ? b.renderError() : (m.each(e[0], function(a, c) {
                            var d;
                            return a = new h(m.extend(a, {hasRight: 1})), e[0][c] = a.attributes, d = a.getScope(), "today" === d ? b.todayTasksCollection.add(a) : "recent" === d ? b.recentTasksCollection.add(a) : "future" === d ? b.futureTasksCollection.add(a) : void 0
                        }), m.each(e[1], function(a, c) {
                            var d;
                            return a = new h(m.extend(a, {hasRight: 1})), e[1][c] = a.attributes, d = a.getScope(), b.recentlyDoneTasksCollection.add(a)
                        }), b.hideLoadingIndicator(), a.success())
                    }
                }(this)), this
            }, e.prototype.refreshTodayTaskCount = function() {
                return this.$(".today-task-count").text(this.todayTasksCollection.length), this
            }, e.prototype.refreshRecentTaskCount = function() {
                return this.$(".recent-task-count").text(this.recentTasksCollection.length), this.$recentTasks[this.recentTasksCollection.length ? "show" : "hide"](), this
            }, e.prototype.refreshFutureTaskCount = function() {
                return this.$(".future-task-count").text(this.futureTasksCollection.length), this
            }, e.prototype.refreshRecentlyDoneTasksCount = function() {
                return this.$(".recently-done-task-count").text(this.recentlyDoneTasksCollection.length), this
            }, e
        }(k)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/member-manager/index", ["require", "exports", "module", "./templates/basic", "collections/members", "../member-tasks/index", "collections/projects", "thenjs", "util", "view"], function(a) {
        var c, d, e, f, g, h, i, j;
        return c = a("./templates/basic"), f = a("collections/members"), e = a("../member-tasks/index"), g = a("collections/projects"), h = a("thenjs"), i = a("util"), j = a("view"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "MemberManagerView", d.prototype.className = "member-manager-view", d.prototype.events = {"click .back-to-members": "onBackToMembersClick"}, d.prototype.initialize = function(a) {
                return this.options = null != a ? a : {}, this.organizationModel = this.options.organizationModel, this.load({success: function(a) {
                    return function() {
                        return a.renderBasic().renderMemmberTasks()
                    }
                }(this)})
            }, d.prototype.load = function(a) {
                return h.parallel([function(a) {
                    return function(b) {
                        return f.fetch(a.organizationModel.id, {boundToObjectType: "organization",success: function(c) {
                            var d;
                            return d = c.get(a.options._memberId), b(null, d)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this), function(a) {
                    return function(b) {
                        return a.organizationModel.getStatistic({attrs: {all: !0},success: function(c) {
                            var d, e, f;
                            for (e = 0, f = c.length; f > e; e++)
                                if (d = c[e], d._id === a.options._memberId)
                                    return void b(null, d);
                            return b("can't read member status", null)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this)]).fin(function(b) {
                    return function(c, d, e) {
                        return d ? b.renderError() : (b.memberModel = e[0], b.status = e[1], a.success())
                    }
                }(this))
            }, d.prototype.listen = function() {
            }, d.prototype.renderBasic = function() {
                var a;
                return a = this.memberModel.toJSON(), a = _.extend(a, this.status), this.$el.html(c(a)), this.$mainContent = this.$(".member-manager-main-content"), this
            }, d.prototype.renderMemmberTasks = function() {
                return this.requestSubView(e, {memberModel: this.memberModel}).$el.appendTo(this.$mainContent), this
            }, d.prototype.onBackToMembersClick = function() {
                var a;
                return "function" == typeof (a = this.options).onBackToMembersClick ? a.onBackToMembersClick() : void 0
            }, d
        }(j)
    }), define("views/organization/team-creator/templates/basic", [], function() {
        return function() {
            var a = '<div class="modal-content"> <header class="modal-header"> <h4 id="team-creator-header-title" class="modal-title">新建团队</h4> </header> <form class="form-create-team form-horizontal"> <div class="modal-body"> <section class="team-creator-content"> <div class="form-group"> <input class="team-name form-control" placeholder="团队名称" /> </div> </section> </div> <footer class="team-creator-footer modal-footer clearfix"> <button type=\'submit\' class="btn btn-primary btn-create-team pull-right">创建</button> <button type="button" class="btn btn-link btn-cancel-create-team pull-right">取消</button> </footer> </form></div>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/team-creator/index", ["require", "exports", "module", "teambition", "./templates/basic", "collections/teams", "models/team", "view"], function(a) {
        var c, d, e, f, g, h, i, j, k;
        return j = a("teambition"), d = a("./templates/basic"), e = a("collections/teams"), g = a("models/team"), h = a("view"), c = j.APP, k = j.user, i = j.router, f = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "TeamCreatorView", c.prototype.className = "team-creator modal-dialog modal-padding", c.prototype.events = {"click .btn-cancel-create-team": "close","submit .form-create-team": "onCreateTeamFormSubmit"}, c.prototype.initialize = function(a) {
                return this.options = null != a ? a : {}, this._organizationId = this.options._organizationId, this.reset().renderBasic(), this
            }, c.prototype.reset = function() {
                return this.teamModel = new g({_organizationId: this._organizationId}), this
            }, c.prototype.renderBasic = function() {
                return this.$el.html(d()), this.$teamNameInput = this.$(".team-name"), this.$btnCreateTeam = this.$(".btn-create-team"), _.delay(function(a) {
                    return function() {
                        return a.$teamNameInput.focusAtEnd()
                    }
                }(this), 200), this
            }, c.prototype.onCreateTeamFormSubmit = function(a) {
                return a.preventDefault(), this.createTeam()
            }, c.prototype.createTeam = function() {
                var a;
                return this.teamModel.set({name: this.$teamNameInput.val().trim()}), a = this.teamModel.toJSON(), a.name ? (e.get(this._organizationId).create(a, {wait: !0,beforeSend: function(a) {
                    return function() {
                        return a.$btnCreateTeam.text("创建中...")
                    }
                }(this),success: function(a) {
                    return function(b) {
                        var c;
                        return "function" == typeof (c = a.options).success && c.success(b), a.close()
                    }
                }(this),error: function(a) {
                    return function() {
                        return a.$btnCreateTeam.text("完成")
                    }
                }(this)}), this) : this.$teamNameInput.focusAtEnd()
            }, c.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, c
        }(h)
    }), define("views/organization/organization-guide/templates/basic", [], function() {
        return function() {
            var a = '<div class="tab-content"> <div role="tabpanel" class="tab-pane fade in active" data-tab="members" id="guide-member"> <header class="modal-header text-center"> <h1 class="success-icon"><span class="icon icon-circle-check"></span></h1> <p class="success-desc">组织创建成功 现在邀请伙伴一起加入吧</p> </header> <div class="modal-body"> <div class="invite-member"> <h4>通过邮箱添加新成员</h4> <div class="member-finder"> <input class="member-info-input form-control" type="text" placeholder="输入邮箱 回车确认"/> </div> </div> <div class="member-nav"> <h4 class="member-tabs" data-subtab="organization"> 成员列表 </h4> <span class="member-tabs-span">|</span> <h4 class="member-tabs active" data-subtab="recommendation"> 推荐成员 </h4> </div> <div class="members-wrap active"> <ul class="members-list"></ul> </div> </div> <div class="modal-footer"> <div class="guide-step"> <a class="cancel-guide pull-left">跳过</a> <button class="btn btn-primary pull-right switch-handler" data-target="#guide-team">下一步</button> </div> </div> </div> <div role="tabpanel" class="tab-pane fade" data-tab="teams" id="guide-team"> <header class="modal-header"> <h4 class="modal-title">分团队进行工作，这样有利于提高效率、控制权限</h4> </header> <div class="modal-body"> <h5>选择或创建您的团队</h5> <div class="teams-wrap clearfix"> <div class="team select-handler"> <div class="box-wrap"> <div class="selected-label"><span class="icon icon-tick"></span></div> <h4 class="name">管理团队</h4> <div class="team-member-list clearfix"></div> <a class="add-member"> <span class="icon icon-plus-sign"></span>添加成员 </a> </div> </div> <div class="team select-handler"> <div class="box-wrap"> <div class="selected-label"></div> <h4 class="name">产品研发</h4> <div class="team-member-list clearfix"></div> <a class="add-member"> <span class="icon icon-plus-sign"></span>添加成员 </a> </div> </div> <div class="team select-handler"> <div class="box-wrap"> <div class="selected-label"></div> <h4 class="name">人力资源</h4> <div class="team-member-list clearfix"></div> <a class="add-member"> <span class="icon icon-plus-sign"></span>添加成员 </a> </div> </div> <div class="team create-team"> <div class="box-wrap"> <div class="create-team-handler text-center"> <span class="icon icon-plus"></span> <p>新建团队</p> </div> </div> </div> </div> </div> <div class="modal-footer"> <div class="guide-step"> <a class="switch-handler pull-left" data-target="#guide-member">上一步</a> <button class="btn btn-primary pull-right switch-handler" data-target="#guide-transfer">下一步</button> </div> </div> </div> <div role="tabpanel" class="tab-pane fade" data-tab="transfer" id="guide-transfer"> <header class="modal-header"> <h4 class="modal-title">迁入项目到组织</h4> </header> <div class="modal-body none-toppadding"> </div> <div class="modal-footer"> <div class="guide-step"> <a class="switch-handler pull-left" data-target="#guide-team">上一步</a> <button class="btn btn-primary pull-right enter-guide">进入组织</button> </div> </div> </div></div>';
            return a
        }
    }), define("views/organization/organization-guide/templates/member", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="member" data-id="' + a._id + '"> <div class="avatar img-circle img-36" style="background-image:url(' + a.avatarUrl + ');"></div> <p class="abstract"> ';
            return c += a._id === a._userMeId ? ' <strong class="name">我(' + b(a.name) + ")</strong> " : ' <strong class="name">' + b(a.name) + "</strong> ", c += ' </p> <p class="muted">' + a.role + b(a.title && "・" + a.title) + "</p> ", a._id !== a._userMeId && (c += ' <div class="handlerset', ("organization" == a.listType || a.inOrg) && (c += " no-btn"), c += '"> ', "recommendation" == a.listType ? (c += " ", c += a.inOrg ? ' <span class="muted">已加入组织</span> ' : ' <a class="btn btn-primary btn-small add-recommendation-handler" data-id="' + a._id + '">加入组织</a> ', c += " ") : c += ' <a class="member-menu-toggler icon icon-chevron-down" data-member-id="' + a._id + '"></a> ', c += " </div> "), c += "</li>"
        }
    }), define("views/organization/organization-guide/templates/team", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="team select-handler selected" data-team-id="' + a._id + '"> <div class="box-wrap"> <div class="selected-label destroy-team-handler"><span class="icon icon-tick"></span></div> <h4 class="name">' + b(a.name) + '</h4> <div class="team-member-list clearfix"> ', d = a.hasMembers;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += " ", 7 > f && (c += ' <div class="avatar img-circle img-24 hinted" style="background-image:url(' + e.avatarUrl + ');" data-title="' + e.name + '"></div> '), c += " ";
            return c += " ", a.hasMembers.length >= 7 && (c += ' <div class="pull-left "><a class="view-all-team-members hinted" data-title="查看团队所有成员" data-team-id="' + a._id + '" >...</a></div> '), c += ' </div> <a class="add-member" data-team-id="' + a._id + '" > <span class="icon icon-plus-sign"></span>添加成员 </a> </div></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/organization-guide/index", ["require", "exports", "module", "teambition", "thenjs", "util", "view", "models/team", "collections/members", "collections/teams", "lib/confirm/index", "views/member/member-finder/index", "views/member/member-menu/index", "views/organization/member-menu/index", "views/organization/projects-transfer/index", "views/organization/team-creator/index", "lib/window/index", "./templates/basic", "./templates/member", "./templates/team", "essage"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u;
        return t = a("teambition"), p = a("thenjs"), q = a("util"), r = a("view"), n = a("models/team"), h = a("collections/members"), l = a("collections/teams"), d = a("lib/confirm/index"), e = a("views/member/member-finder/index"), f = a("views/member/member-menu/index"), i = a("views/organization/member-menu/index"), k = a("views/organization/projects-transfer/index"), m = a("views/organization/team-creator/index"), s = a("lib/window/index"), c = a("./templates/basic"), g = a("./templates/member"), o = a("./templates/team"), u = a("essage"), j = function(a) {
            function j() {
                return j.__super__.constructor.apply(this, arguments)
            }
            return b(j, a), j.prototype.viewName = "OrganizationGuideView", j.prototype.className = "organization-guide-view modal-dialog modal-padding", j.prototype.events = {"click .switch-handler": "switchTabPanel","click .member-tabs": "switchMemberTab","click .add-recommendation-handler": "addRecommendationMember","click .member-menu-toggler": "toggleMemberMenu","click .select-handler": "quicklyCreateTeam","click .destroy-team-handler": "destroyTeam","click .add-member": "manageTeamMembers","click .view-all-team-members": "viewAllTeamMembers","click .create-team-handler": "openTeamCreator","click .enter-guide": "enterOrganization","click .cancel-guide": "close"}, j.prototype.initialize = function(a) {
                return this.options = null != a ? a : {}, this.organizationModel = this.options.organizationModel, this.organizationId = this.organizationModel.get("id"), this.hasRight = this.organizationModel.hasRight(), this.renderBasic(), this.loadOrganizationMembers({success: function(a) {
                    return function() {
                        return a.renderMembers(), a.hasRight ? a.initMemberFinder() : void 0
                    }
                }(this)}), this.loadOrganizationTeams({success: function(a) {
                    return function() {
                        return a.renderTeams(), a.renderTransfer()
                    }
                }(this)}), this
            }, j.prototype.listen = function(a, b) {
                switch (this.stopListening(), a) {
                    case "teams":
                        return this.listenTo(this.organizationTeamsCollection, "change", this.refreshTeam);
                    case "members":
                        if ("organization" === b)
                            return this.listenTo(this.organizationMembersCollection, "add remove", function(a) {
                                return function() {
                                    return a.renderMembers("organization")
                                }
                            }(this)), this.listenTo(this.organizationMembersCollection, "change:hasRight change:isQuited", function(a) {
                                return function() {
                                    return a.renderMembers("organization")
                                }
                            }(this))
                }
            }, j.prototype.loadOrganizationMembers = function(a) {
                var b;
                return b = _.extend({boundToObjectType: "organization"}, a), b.success = function(b) {
                    return function(c) {
                        return b.organizationMembersCollection = c, a.success()
                    }
                }(this), h.fetch(this.organizationModel.id, b), this
            }, j.prototype.loadOrganizationTeams = function(a) {
                var b;
                return b = _.extend({boundToObjectType: "organization"}, a), b.success = function(b) {
                    return function(c) {
                        return b.organizationTeamsCollection = c, a.success()
                    }
                }(this), l.fetch(this.organizationModel.id, b), this
            }, j.prototype.renderBasic = function() {
                return this.$el.html(c({hasRight: this.hasRight})), this.$membersList = this.$(".members-list"), this.$createTeamCard = this.$(".teams-wrap .create-team"), this.$tabContent = this.$(".tab-content"), this
            }, j.prototype.initMemberFinder = function() {
                return this.$memberInput = this.$(".member-info-input"), this.requestSubView(e, {collection: this.organizationMembersCollection,$searchbox: this.$memberInput,select: function(a) {
                    return function(b) {
                        return a.addMember(b)
                    }
                }(this)}), this
            }, j.prototype.addMember = function(a, b) {
                var c, d;
                return d = _.extend({boundToObjectType: "organization"}, b), c = a.email ? {email: a.email} : {email: a.item.email}, this.organizationMembersCollection.addMember(c, d), this
            }, j.prototype.addRecommendationMember = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), d = b.data("id"), c = this.recommendationMembersCollection.get(d), this.addMember(c.toJSON(), {wait: !0,beforeSend: function() {
                    return function() {
                        return b.html("正在添加")
                    }
                }(this),success: function(a) {
                    return function() {
                        return a.renderMember(c, "recommendation", !0)
                    }
                }(this)})
            }, j.prototype.renderMembers = function(a) {
                switch (null == a && (a = "recommendation"), this.$membersList.empty(), a) {
                    case "organization":
                        this.organizationMembersCollection.each(function(b) {
                            return function(c) {
                                return b.renderMember(c, a, !1)
                            }
                        }(this));
                        break;
                    default:
                        this.organizationModel.getRecommendMembers({success: function(b) {
                            return function(c) {
                                return b.recommendationMembersCollection = new h(c), b.recommendationMembersCollection.each(function(c) {
                                    return b.renderMember(c, a, !1)
                                })
                            }
                        }(this),error: function(a) {
                            return function() {
                                return a.renderError()
                            }
                        }(this)})
                }
                return this
            }, j.prototype.assembleData = function(a, b) {
                var c;
                return c = a.toJSON(), c.hasOrganizationRight = this.organizationModel.hasRight(), c.dateString = q.formatDate(a.get("joined")).dateString, b(c)
            }, j.prototype.renderMember = function(a, b, c) {
                return this.assembleData(a, function(d) {
                    return function(e) {
                        var f, h, i;
                        return e._userMeId = t.user.id, e.listType = b, e.role = "recommendation" !== e.listType ? a.getRole() : "推荐成员", e.inOrg = !!d.organizationMembersCollection.get(a.id), i = d.$membersList.find("li[data-id=" + e._id + "]"), e.isQuited ? i.remove() : (f = $(g(e)), i.length ? i.replaceWith(f) : c ? (h = d.$membersList.find(".li[data-id=" + a.id + "]"), h.replaceWith(f)) : d.$membersList.append(f))
                    }
                }(this)), this
            }, j.prototype.switchTabPanel = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = $(b.data("target")), b.tab("show"), this.listen(c.data("tab"))
            }, j.prototype.switchMemberTab = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = b.data("subtab"), b.addClass("active").siblings().removeClass("active"), this.$tabContent.css("min-height", b.height()), this.renderMembers(c), this.listen("members", c), this
            }, j.prototype.toggleMemberMenu = function(a) {
                var b, c;
                return a.preventDefault(), a.stopPropagation(), c = $(a.currentTarget).data("memberId"), b = $(a.currentTarget), b.data("bs.popover") ? this : (this.requestSubView(i, {$toggler: b,membersCollection: this.organizationMembersCollection,memberModel: this.organizationMembersCollection.get(c),hasOrganizationRight: this.organizationModel.hasRight(),isOrgnizationMemberMenu: !0}).show(), this)
            }, j.prototype.quicklyCreateTeam = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), d = b.data("team-id"), $(".member-menu-view").length || d ? this : (this.teamModel = new n({_organizationId: this.organizationModel.id}), this.teamModel.set({name: b.find(".name").text()}), c = this.teamModel.toJSON(), l.get(this.organizationModel.id).create(c, {success: function(a) {
                    return function(c) {
                        var d;
                        return d = c.toJSON(), a.renderTeam(d, b), Essage.show({message: "成功新建团队：" + d.name,status: "success"}, 2e3)
                    }
                }(this)}))
            }, j.prototype.destroyTeam = function(a) {
                var b, c;
                return a.stopPropagation(), b = $(a.currentTarget).closest(".team"), c = b.data("team-id"), this.requestSubView(d, {title: "删除团队",description: "您确定要永远删除这个团队吗",onConfirm: function(a) {
                    return function() {
                        return a.organizationTeamsCollection.get(c).destroy({success: function() {
                            var a;
                            return b.removeClass("selected").data("team-id", ""), b.find(".add-member").removeAttr("data-team-id"), b.find(".team-member-list").empty(), a = b.find(".name").text(), Essage.show({message: "成功删除团队：" + a,status: "success"}, 2e3)
                        }})
                    }
                }(this)})
            }, j.prototype.renderTeams = function() {
                var a, b, c, d;
                if (this.organizationTeamsCollection.length)
                    for (d = this.organizationTeamsCollection.toJSON(), b = 0, c = d.length; c > b; b++)
                        a = d[b], this.renderTeam(a);
                return this
            }, j.prototype.renderTeam = function(a, b) {
                return (null != b ? b.length : void 0) ? b.replaceWith(o(a)) : $(o(a)).insertBefore(this.$createTeamCard), this
            }, j.prototype.refreshTeam = function(a) {
                var b;
                return b = a.toJSON(), this.$(".team[data-team-id='" + b._id + "']").replaceWith(o(b)), this
            }, j.prototype.manageTeamMembers = function(a) {
                var b, c, d;
                return a.stopPropagation(), b = $(a.currentTarget), d = b.data("team-id"), d ? (null != (c = this.memberMenuView) && c.remove(), this.genTeamMembersCollection(d, function(a) {
                    return function() {
                        return a.memberMenuView = a.requestSubView(f, {fixed: !1,$toggler: b,multi: !0,selected: a.inTeamList,select: function(b) {
                            return a.addTeamMember(b, d)
                        },unselect: function(b) {
                            return a.removeTeamMember(b, d)
                        },selectAll: function(b) {
                            return a.addTeamMembers(b, d)
                        },membersCollection: a.organizationMembersCollection}), a.memberMenuView.show()
                    }
                }(this))) : b.closest(".team").trigger("click"), this
            }, j.prototype.genTeamMembersCollection = function(a, b) {
                return h.fetch(a, {boundToObjectType: "team",success: function(a) {
                    return function(c) {
                        return a.inTeamList = [], a.teamMembersCollection = c, a.organizationMembersCollection.each(function(b) {
                            var c;
                            return (null != (c = a.teamMembersCollection.get(b.id)) ? c.toJSON() : void 0) ? a.inTeamList.push(b.id) : void 0
                        }), b()
                    }
                }(this)}), this
            }, j.prototype.addTeamMembers = function(a, b) {
                var c;
                return c = _.filter(a, function(a) {
                    return function(b) {
                        return !a.teamMembersCollection.get(b)
                    }
                }(this)), c.length ? p.eachSeries(c, function(a) {
                    return function(c, d) {
                        return a.addTeamMember(d, b, c)
                    }
                }(this)) : void 0
            }, j.prototype.addTeamMember = function(a, b, c) {
                var d;
                return d = this.organizationMembersCollection.get(a), this.teamMembersCollection.addMember({email: d.get("email")}, {boundToObjectType: "team",success: function(a) {
                    return function(d) {
                        var e, f;
                        return f = a.organizationTeamsCollection.get(b), e = f.get("hasMembers").slice(), e.push(d[0]), f.set("hasMembers", e), a.refreshTeam(f), "function" == typeof c ? c() : void 0
                    }
                }(this),error: function() {
                    return "function" == typeof c ? c() : void 0
                }})
            }, j.prototype.removeTeamMember = function(a, b) {
                return this.teamMembersCollection.removeMember(a, {success: function(a) {
                    return function(c) {
                        var d, e, f;
                        return f = a.organizationTeamsCollection.get(b), e = f.get("hasMembers"), d = _.filter(e, function(a) {
                            return a._id !== c.id
                        }), f.set("hasMembers", d), a.refreshTeam(f)
                    }
                }(this)})
            }, j.prototype.viewAllTeamMembers = function(a) {
                var b, c, d;
                return a.stopPropagation(), c = this.organizationModel.id, d = $(a.currentTarget).data("team-id"), b = "/organization/" + c + "/teams/" + d, t.router.navigate(b, {trigger: !0}), this
            }, j.prototype.openTeamCreator = function() {
                return this.requestSubView(s).open(m, {_organizationId: this.organizationModel.id,success: function(a) {
                    return function(b) {
                        var c;
                        return c = b.toJSON(), a.renderTeam(c), Essage.show({message: "成功新建团队：" + c.name,status: "success"}, 2e3)
                    }
                }(this)}), this
            }, j.prototype.renderTransfer = function() {
                return this.transferView = this.requestSubView(k, {sourceId: 0,targetIds: [this.organizationModel.id],success: function(a) {
                    return function() {
                        return a.close()
                    }
                }(this)}), this.transferView.$el.removeClass("modal-dialog modal-padding").appendTo(this.$tabContent.find("#guide-transfer .modal-body")).find(".modal-header, .modal-footer").addClass("hidden"), this
            }, j.prototype.enterOrganization = function() {
                return this.transferView.$el.find(".transfer-to .transfer-list li").length ? this.transferView.submit(!0) : this.close()
            }, j.prototype.close = function() {
                var a, b;
                return null != (a = l.get(this.organizationId)) && (a.synced = !1), l.fetch(this.organizationId), null != (b = this.parentView) && b.remove(), this
            }, j
        }(r)
    }), define("views/settings/organization-settings/templates/advanced-tab", [], function() {
        return function(a) {
            var b = '<div class="settings-part advanced-settings"> ';
            return a.hasRight < 2 ? b += ' <h4>退出组织</h4> <p class="muted">一旦你退出了该组织，你将不能查看任何关于该组织的信息。退出组织后，如果想重新加入，请联系组织的拥有者或者管理员。</p> <br> <a class="btn btn-danger btn-quit-organizaiton form-control" data-id="' + a._userMeId + '">退出组织</a> ' : 2 == a.hasRight && (b += ' <div class="organization-delete-form form-horizontal"> <h4>删除组织</h4> <p class="muted">一旦你删除了组织，组织内所有项目、团队、成员，项目中所有内容等都将会被永久删除。这是一个不可恢复的操作，请谨慎对待！</p> <p> <a class="btn btn-danger btn-delete-organization form-control">删除组织</a> <input class="delete-input form-control" type="text" placeholder="请输入“DELETE”以确认"/> </p> </div> '), b += "</div>"
        }
    }), define("views/settings/organization-settings/templates/basic", [], function() {
        return function(a) {
            var b = '<header class="organization-settings-header card-header no-bottom organization-cover"> <p class="card-title pull-left">组织设置</p> <a class="modal-close icon icon-remove icon-white pull-right " data-dismiss="modal"></a> <div class="logo-uploader"> <div class="logo" style="background-image: url(' + a.logo + ');"> <div class="progress-mask"></div> </div> </div></header><nav class="organization-settings-navigation"> <ul class="section-switcher nav nav-tabs"> <li class="organization-info"> <a class="section-switcher-toggler" data-toggle="organization-info">组织信息</a> </li> <li class="advanced-settings"> <a class="section-switcher-toggler" data-toggle="advanced-settings">高级设置</a> </li> </ul></nav><div class="organization-settings-content card-content"></div>';
            return b
        }
    }), define("views/settings/organization-settings/templates/profile-tab", [], function() {
        return function(a) {
            var b = '<div class="settings-part organization-info-settings"> <div class="organization-info-content"> <form class="form-horizontal organization-info-form"> <div class="form-group"> <label>组织名称</label> <input class="organization-name setting-part form-control" type="text" data-type="name" value="' + a.name + '"';
            return a.hasRight < 2 && (b += "disabled"), b += ' /> </div> <div class="form-group"> <label>组织类别</label> <label class="form-control-select"> <select class="setting-info-content category-select setting-part form-control" data-type="category" ', a.hasRight < 2 && (b += "disabled"), b += '> <option value="design" ', "design" === a.category && (b += "selected"), b += '> 设计组织 </option> <option value="internet" ', "internet" === a.category && (b += "selected"), b += '> 互联网组织 </option> <option value="education" ', "education" === a.category && (b += "selected"), b += '> 教育组织 </option> <option value="media" ', "media" === a.category && (b += "selected"), b += '> 媒体组织 </option> <option value="app" ', "app" === a.category && (b += "selected"), b += '> 移动应用组织 <option value="other" ', "other" === a.category && (b += "selected"), b += '> 其他组织 </option> </select> </label> </div> <div class="form-group"> <label>组织简介</label> <textarea class="setting-info-content organization-description  setting-part form-control" data-type="description" ', a.hasRight < 2 && (b += "disabled"), b += ">" + (a.description || "") + '</textarea> </div> <div class="form-group"> <label>组织公开性</label> <label class="form-control-select"> <select class="setting-part form-control" data-type="isPublic" ', 2 != a.hasRight && (b += "disabled"), b += '> <option value="public" ', a.isPublic && (b += "selected"), b += '> 公开组织（访客可以查看组织中的公开项目和成员） </option> <option value="private" ', a.isPublic || (b += "selected"), b += "> 私有组织（仅组织成员可见） </option> </select> </label> </div> ", 2 == a.hasRight && (b += ' <button class="btn btn-save btn-primary disabled" type="submit">保存</button> '), b += " </form> </div></div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/settings/organization-settings/index", ["require", "exports", "module", "teambition", "thenjs", "lib/uploader/index", "util", "view", "collections/members", "collections/organizations", "views/member/member-finder/index", "./templates/advanced-tab", "./templates/basic", "./templates/profile-tab", "essage"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o;
        return n = a("teambition"), j = a("thenjs"), k = a("lib/uploader/index"), l = a("util"), m = a("view"), e = a("collections/members"), h = a("collections/organizations"), f = a("views/member/member-finder/index"), c = a("./templates/advanced-tab"), d = a("./templates/basic"), i = a("./templates/profile-tab"), o = a("essage"), g = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "OrganizationSettingsView", e.prototype.className = "organization-settings-view modal-dialog card", e.prototype.events = {"change .setting-part": "collectChange","input .setting-part": "collectChange","click .section-switcher-toggler": "switch","click .btn-quit-organizaiton": "quitOrganizaiton","click .btn-delete-organization": "deleteConfirm","click .member-add-btn": "addMemberFromList","submit .organization-info-form": "submitOrganizationInfo"}, e.prototype.initialize = function(a) {
                return a.organizationModel ? (this.changes = {}, this.options = a, this.organizationModel = this.options.organizationModel, this.renderBasic().toggle(a.tab || "organization-info"), this) : !1
            }, e.prototype.toggle = function(a) {
                switch (this.tab = a, this.$navigation.find(".active").removeClass("active"), this.$navigation.find("." + a).addClass("active"), a) {
                    case "organization-info":
                        this.renderProfileTab().listen(a);
                        break;
                    case "advanced-settings":
                        this.renderAdvancedTab().listen(a)
                }
                return this
            }, e.prototype.listen = function(a) {
                switch (this.stopListening(), this.listenTo(this.organizationModel, "remove", this.close), a) {
                    case "organization-info":
                        this.listenTo(this.organizationModel, "change", this.renderProfileTab), this.listenTo(this.organizationModel, "change:logo", this.renderLogo);
                        break;
                    case "advanced-settings":
                        this.listenTo(this.organizationModel, "change", this.renderAdvancedTab)
                }
                return this
            }, e.prototype.renderBasic = function() {
                return this.$el.html(d(this.organizationModel.toJSON())), this.$header = this.$(".organization-settings-header"), this.$navigation = this.$(".organization-settings-navigation"), this.$content = this.$(".organization-settings-content"), this.renderLogo(), this.organizationModel.hasRight() && this.initUploader(), this
            }, e.prototype.renderLogo = function() {
                return this.$header.find(".logo").css({"background-image": "url(" + this.organizationModel.get("logo") + ")"}), this
            }, e.prototype.renderProfileTab = function() {
                var a;
                return a = this.organizationModel.toJSON(), this.$content.html(i(a)), this
            }, e.prototype.renderAdvancedTab = function() {
                var a;
                return a = this.organizationModel.toJSON(), a._userMeId = n.user.id, this.$content.html(c(a)), this
            }, e.prototype.deleteConfirm = function(a) {
                var b, c, d;
                return d = this.$(".delete-input:visible"), d.val() ? "DELETE" === d.val().toUpperCase() ? this.deleteOrganization() : d.val("") : (b = $(a.currentTarget), c = b.next(), b.transition({width: 200}, function() {
                    return function() {
                        return c.show()
                    }
                }(this))), this
            }, e.prototype.deleteOrganization = function() {
                return this.organizationModel.destroy({wait: !0,success: function(a) {
                    return function() {
                        return a.close(), n.router.navigate("projects", {trigger: !0})
                    }
                }(this),error: function() {
                    return function() {
                    }
                }(this)}), this
            }, e.prototype.quitOrganizaiton = function(a) {
                var b;
                return b = $(a.currentTarget), this.organizationModel.quit({wait: !0,beforeSend: function() {
                    return function() {
                        return b.toggleClass("btn-link btn-danger").html("正在退出组织")
                    }
                }(this),success: function(a) {
                    return function() {
                        return b.html("已成功退出组织, 即将返回首页"), setTimeout(function() {
                            var b;
                            return null != (b = a.organizationModel.collection) && b.remove(a.organizationModel), n.router.navigate("/projects", {trigger: !0})
                        }, 1e3)
                    }
                }(this)})
            }, e.prototype.initUploader = function() {
                var a, b, c;
                if (!(this.organizationModel.hasRight() < 2))
                    return b = this.$header.find(".logo"), a = $('<a class="icon icon-pencil edit-handler"></a>').appendTo(b), c = this.$header.find(".progress-mask"), this.uploader = new k({model: this.organizationModel,pick: {id: a,label: " ",multiple: !1},dnd: b,type: "logo",duplicate: !0,onCreate: function(a) {
                        return function(b) {
                            return a.organizationModel.set("logo", b.thumbnailUrl)
                        }
                    }(this),onStart: function() {
                        return function() {
                            return c.css("clip", "rect(0, 132px, 132px, 0)").html("")
                        }
                    }(this),onProgress: function() {
                        return function(a) {
                            var b;
                            return b = 132 * a / 100, c.css("clip", "rect(" + b + "px, 132px, 132px, 0)")
                        }
                    }(this),onComplete: function(a) {
                        return function(b) {
                            return c.css("clip", "rect(132px, 132px, 132px, 0)"), a.organizationModel.save(null, {attrs: {logo: b.thumbnailUrl}})
                        }
                    }(this)}), this
            }, e.prototype["switch"] = function(a) {
                var b;
                return b = $(a.currentTarget).data("toggle"), this.tab !== b ? _.isEmpty(this.changes) ? this.toggle(b) : this.autoSubmit(b) : void 0
            }, e.prototype.submitOrganizationInfo = function(a) {
                return a.preventDefault(), _.isEmpty(this.changes) ? (null != a ? a.success : void 0) instanceof Function ? null != a && a.success() : this.close() : this.organizationModel.save(null, {attrs: this.changes,success: function(b) {
                    return function() {
                        return b.changes = {}, null != a && "function" == typeof a.success && a.success(), a instanceof $.Event ? b.close() : void 0
                    }
                }(this)}), this
            }, e.prototype.collectChange = function(a) {
                var b, c, d, e, f;
                return b = $(".btn-save"), c = $(a.currentTarget), f = c.val(), e = c.data("type"), "isPublic" === e && (f = "public" === f), d = this.organizationModel.get(e), d === f ? delete this.changes[e] : this.changes[e] = f, _.isEmpty(this.changes) ? b.addClass("disabled") : b.removeClass("disabled")
            }, e.prototype.close = function() {
                var a;
                return null != (a = this.parentView) && a.remove(), this
            }, e.prototype.remove = function() {
                var a;
                return null != (a = this.uploader) && a.destroy(), e.__super__.remove.apply(this, arguments)
            }, e
        }(m)
    }), define("views/organization/projects-manager/templates/basic", [], function() {
        return function(a) {
            var b = "";
            return a.hasOrgRight >= 0 && (b += '<div class="projects-manager-header"> <ol class="breadcrumbs"> <li> 所有项目 </li> </ol> ', a.hasOrgRight > 0 && a.myOwnProjectCount > 0 && (b += ' <a class="pull-right import-projects link-add-handler guide-handler" data-guide="orgImport"><span class="icon icon-import-project"></span>迁入项目</a> '), b += "</div>"), b += '<div class="projects-manager-content clearfix"></div>', a.hasOrgRight > 0 && (b += ' <header class="projects-archived-header"> <div class="project-category-title"> 已归档的项目・ <a class="archived-projects-toggler">显示</a> </div> <hr> </header> <div class="projects-archived-content clearfix"></div>'), b
        }
    }), define("views/organization/projects-manager/templates/divider", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="divider"> <div class="divider-title divider-name">' + b(a.name) + "</div> ";
            return 2 == a.hasRight && (c += ' <div class="divider-title divider-title-editor"> <input type="text" class="form-control divider-input" placeholder="新分组名称"/> </div> <div class="divider-tools"> <a class="hinted icon icon-chevron-up divider-move" data-direction="up" data-title="上移分组"></a> <a class="hinted icon icon-chevron-down divider-move" data-direction="down" data-title="下移分组"></a> <a class="hinted icon icon-remove divider-remove" data-title="取消分组"></a> </div> '), c += "</div>"
        }
    }), define("views/organization/projects-manager/templates/placeholder", [], function() {
        return function(a) {
            var b = '<div class="placeholder muted"> ';
            return a.hasOrgRight > 0 ? (b += ' <span class="icon icon-project"></span><br/> ', b += a.isOverdue ? ' 该组织已经到期，请尽快续费 <a href="http://pay.teambition.com/confirm_order?_organizationId=' + a._organizaitonId + '" class="organization-pay-link" target="_blank">立即付款</a> ' : ' <a class="btn-open-project-creator" data-id="' + a._organizaitonId + '">添加新项目，</a> 开始你全新的项目管理 ', b += " ") : b += " 还没有项目 ", b += "</div>"
        }
    }), define("views/organization/projects-manager/templates/project", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            return a.isArchived ? (c += " ", (a.hasRight > 0 || a.hasOrgRight > 0) && (c += ' <div class="project archived-project card pull-left" data-id="' + a._id + '" style="background-image:url(' + a.logo + ')"> <div class="project-info"> <h3 class="project-name">' + b(a.name) + '</h3> <p class="project-desc">' + b(a.description) + '</p> </div> <a class="unarchive-project-handler"> <span class="icon icon-repeat"></span> </a> </div> ')) : (c += ' <div class="project ', a.hasRight > -2 && (c += "enter-project"), c += ' card" style="background-image:url(' + a.logo + ')" data-id="' + a._id + '"> <div class="project-info"> <!--       项目中有权限 或者 组织中有权限（注意组织中的管理员，只能看到自己参与的项目） --> ', (a.hasRight > 0 || a.hasOrgRight > 0) && (c += ' <a class="icon icon-pencil edit-handler" data-id="' + a._id + '" data-gta="event" data-label="organizaion projects||to edit project"></a> '), c += ' <div> <h3 class="project-name">' + b(a.name) + '</h3> </div> <p class="project-desc">' + b(a.description) + "</p> ", a.hasRight <= -2 && (c += ' <div class="no-right-overlay"> <p> <span>你不是这个项目的成员</span> <br /> <br /> <a class=\'btn btn-primary btn-join-project\' data-id="' + a._id + '">马上加入</a> </p> </div> '), c += " </div> ", a.isPublic && (c += ' <span class="label public-label">公开</span> '), c += " ", a.isOverdue && (c += ' <div class="is-overdue"> <hr /> <div class="lock-wrap"> <span class="icon icon-lock2"></span> </div> </div> '), c += " </div>"), c
        }
    });
    var e = function(a, b) {
        return function() {
            return a.apply(b, arguments)
        }
    }, a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/projects-manager/index", ["require", "exports", "module", "teambition", "lib/guide-point/index", "view", "collections/members", "collections/projects", "lib/confirm/index", "views/organization/organization-overdue/index", "views/organization/projects-transfer/index", "views/project/project-creator/index", "views/settings/project-settings/index", "lib/window/index", "./templates/basic", "./templates/divider", "./templates/placeholder", "./templates/project"], function(a) {
        var c, d, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t;
        return t = a("teambition"), h = a("lib/guide-point/index"), r = a("view"), i = a("collections/members"), o = a("collections/projects"), f = a("lib/confirm/index"), j = a("views/organization/organization-overdue/index"), q = a("views/organization/projects-transfer/index"), l = a("views/project/project-creator/index"), m = a("views/settings/project-settings/index"), s = a("lib/window/index"), d = a("./templates/basic"), g = a("./templates/divider"), k = a("./templates/placeholder"), n = a("./templates/project"), c = $(window), p = function(a) {
            function p() {
                return this.renderDividerTip = e(this.renderDividerTip, this), this.toggleArchivedOrganizationProjects = e(this.toggleArchivedOrganizationProjects, this), p.__super__.constructor.apply(this, arguments)
            }
            return b(p, a), p.prototype.viewName = "ProjectsManagerView", p.prototype.className = "projects-manager-view", p.prototype.projectArchivedContentShown = !1, p.prototype.events = {"click .archived-project": "unarchiveOrganizationProject","click .archived-projects-toggler": "toggleArchivedOrganizationProjects","click .enter-project": "enterProject","click .btn-join-project": "joinProject","click .edit-handler": "editProject","click .btn-open-project-creator": "openProjectCreator","click .import-projects": "openProjectsImportTransfer","click .divider-move": "moveDivider","click .divider-remove": "removeDivider","click .divider-name": "editDividerTitle","keydown .divider-input": "quickSubmit","blur .divider-input": "submitDividerTitle"}, p.prototype.initialize = function(a) {
                return this.options = null != a ? a : {}, this.organization = this.options.organization, this._organizationId = this.organization.id, this.hasRight = this.organization.hasRight(), this.showLoadingIndicator(), this.projectsArchivedCollection = o.get("archived_" + this._organizationId), this.loadOrganizationProjects({success: function(a) {
                    return function() {
                        return a.hideLoadingIndicator(), a.renderBasic(), a.renderProjects(), a.listen(), h.initialize(a), 2 === a.hasRight ? a.registerAsResponsive() : void 0
                    }
                }(this)})
            }, p.prototype.layout = function() {
                var a;
                return a = c.width() < 1200 ? 3 : 4, a !== this.ranks ? (this.ranks = a, this.renderDividerTip(), this) : void 0
            }, p.prototype.listen = function() {
                return this.listenTo(this.projectsCollection, "add remove", this.renderProjects), this.listenTo(this.projectsArchivedCollection, "add remove", this.renderArchiveProjects), this.listenTo(this.projectsCollection, "change:isArchived", function(a) {
                    return function(b, c) {
                        return c ? (a.projectsCollection.remove(b), a.projectsArchivedCollection.add(b)) : void 0
                    }
                }(this)), this.listenTo(this.projectsArchivedCollection, "change:isArchived", function(a) {
                    return function(b, c) {
                        return c ? void 0 : (a.projectsArchivedCollection.remove(b), a.projectsCollection.add(b))
                    }
                }(this)), this
            }, p.prototype.renderBasic = function() {
                var a;
                return a = {}, a.hasOrgRight = this.options.hasOrgRight, a.isOverdue = this.organization.isOverdue(), a._organizaitonId = this._organizationId, a.myOwnProjectCount = o.get(0).getSelfOwnProjectCount(), this.$el.html(d(a)), this.$projectMangerContent = this.$(".projects-manager-content"), this.$projectArchivedContent = this.$(".projects-archived-content"), this
            }, p.prototype.renderProjects = function() {
                var a, b, c;
                if (this.$projectMangerContent.empty(), this.projectsCollection.length) {
                    if (c = this.projectsCollection.models.slice(), (b = this.organization.get("projectIds")) && c.sort(function(a, c) {
                        return (b.indexOf(a.id) + 1 || 999) - (b.indexOf(c.id) + 1 || 999)
                    }), _.each(c, function(a) {
                        return function(b) {
                            return a.renderProject(b)
                        }
                    }(this)), this.renderDivider(), 2 !== this.hasRight)
                        return this;
                    this.$el.addClass("divider-editable"), this.ranks = 0, this.layout(), this.setupSortable()
                } else
                    a = {}, a.hasOrgRight = this.options.hasOrgRight, a.isOverdue = this.organization.isOverdue(), a._organizaitonId = this._organizationId, a.myOwnProjectCount = o.get(0).getSelfOwnProjectCount(), this.$projectMangerContent.html(k(a));
                return this
            }, p.prototype.renderArchiveProjects = function() {
                return this.$projectArchivedContent.empty(), this.projectsArchivedCollection.each(function(a) {
                    return function(b) {
                        return a.$projectArchivedContent.append(n(b.toJSON()))
                    }
                }(this)), this
            }, p.prototype.renderProject = function(a) {
                var b, c, d;
                return b = this.$projectMangerContent.find(".project[data-id=" + a.id + "]"), d = a.toJSON(), d.hasOrgRight = this.options.hasOrgRight, d.isOverdue = this.organization.isOverdue(), c = $(n(d)), b.length ? b.replaceWith(c) : d.isArchived !== !0 && c.appendTo(this.$projectMangerContent), this
            }, p.prototype.loadOrganizationProjects = function(a) {
                return o.fetch(this._organizationId, {boundToObjectType: "organization",success: function(b) {
                    return function(c) {
                        return b.projectsCollection = c, b.projectsCollection.each(function(a) {
                            return a.set("isOverdue", a.isOverdue())
                        }), a.success()
                    }
                }(this)}), this
            }, p.prototype.loadArchivedOrganizationProjects = function(a) {
                var b;
                return b = _.extend({success: function() {
                    return function() {
                    }
                }(this),beforeSend: function() {
                    return function() {
                    }
                }(this),error: function() {
                    return function() {
                    }
                }(this),attrs: {isArchived: !0,_organizationId: this._organizationId}}, a), o.fetch("archived_" + this._organizationId, b)
            }, p.prototype.toggleArchivedOrganizationProjects = function(a) {
                return this.projectArchivedContentShown ? (this.$projectArchivedContent.empty(), $(a.currentTarget).text("显示"), this.projectArchivedContentShown = !1) : ($(a.currentTarget).text("隐藏"), this.loadArchivedOrganizationProjects({success: function(a) {
                    return function() {
                        return a.renderArchiveProjects(), a.projectArchivedContentShown = !0
                    }
                }(this)}))
            }, p.prototype.unarchiveOrganizationProject = function(a) {
                var b;
                return (b = this.projectsArchivedCollection.get($(a.currentTarget).data("id"))) ? this.requestSubView(f, {title: "重新激活项目",description: "重新激活项目后，您就可以正常使用该项目了",onConfirm: function() {
                    return function() {
                        return b.save(null, {attrs: {isArchived: !1},success: function() {
                            return Essage.show({message: "项目已经成功重新激活.",status: "success"}, 2e3)
                        },error: function() {
                            return Essage.show({message: "抱歉，我们未能重新激活该项目，请稍后重试.",status: "error"})
                        }})
                    }
                }(this)}) : void 0
            }, p.prototype.setupSortable = function() {
                var a, b;
                return a = document.body, b = function(b) {
                    var d, e;
                    if (d = b[0].getBoundingClientRect(), d.top < 130) {
                        if (a.scrollTop < 5)
                            return;
                        return a.scrollTop -= 15
                    }
                    if (d.bottom + 30 > (e = c.height())) {
                        if (a.scrollTop > a.scrollHeight - e - 5)
                            return;
                        return a.scrollTop += 15
                    }
                }, this.$projectMangerContent.sortable({items: ".project, .divider",helper: "clone",cancel: ".divider",placeholder: "project sortable-placeholder",tolerance: "pointer",zIndex: 2001,scroll: !1,start: function(a) {
                    return function() {
                        return a.$projectMangerContent.find(".divider-tip").hide()
                    }
                }(this),stop: function(a) {
                    return function() {
                        return a.$projectMangerContent.find(".divider-tip").show()
                    }
                }(this),sort: function() {
                    return function(a, c) {
                        return b(c.helper)
                    }
                }(this),update: function(a) {
                    return function() {
                        var b;
                        return a.renderDividerTip(), b = a.updatePosition(), a.saveSection("projectIds", b), a.saveSection("dividers", b)
                    }
                }(this)}), this
            }, p.prototype.openProjectsImportTransfer = function() {
                return this.requestSubView(s).open(q, {sourceId: 0,targetIds: [this.organization.id]}), this
            }, p.prototype.enterProject = function(a) {
                var b;
                return b = $(a.currentTarget).data("id"), this._enterProject(b)
            }, p.prototype._enterProject = function(a) {
                var b;
                return b = this.projectsCollection.get(a), b.isOverdue() ? this.requestSubView(s).open(j, {_organizationId: b.get("_organizationId")}) : t.router.navigate("project/" + a + "/" + b.getFirstApp(), {trigger: !0})
            }, p.prototype.joinProject = function(a) {
                var b, c;
                return b = $(a.target), c = $(a.currentTarget).data("id"), b.html("加入中...").addClass("hover"), this.loadProjectMembers({_projectId: c,success: function(a) {
                    return function(d) {
                        var e;
                        return e = {email: t.user.get("email")}, d.addMember(e, {boundToObjectType: "project",success: function() {
                            var d;
                            return b.html("成功加入"), d = a.projectsCollection.get(c), d.set("hasRight", 0), o.get(0).add(d), setTimeout(function() {
                                return a._enterProject(c)
                            }, 1e3)
                        }})
                    }
                }(this)})
            }, p.prototype.loadProjectMembers = function(a) {
                return a = _.extend(a, {boundToObjectType: "project"}), i.fetch(a._projectId, a), this
            }, p.prototype.editProject = function(a) {
                var b, c;
                return b = $(a.currentTarget).closest(".project").data("id"), c = this.projectsCollection.get(b), this.requestSubView(s).open(m, {projectModel: c}), !1
            }, p.prototype.openProjectCreator = function(a) {
                var b, c;
                return b = this.$(a.target), c = b.data("id"), this.requestSubView(s).open(l, {_organizationId: c}), this
            }, p.prototype.renderDivider = function() {
                var a, b;
                return this.projectsCollection.length ? (a = this.organization.get("dividers") || [], b = this.organization.get("projectIds") || [], _.each(a, function(c) {
                    return function(d, e) {
                        var f, h, i, j, k, l;
                        for (i = function(a) {
                            var d;
                            return d = b[a], c.$projectMangerContent.find(".project[data-id=" + d + "]")
                        }, k = d.pos, j = (null != (l = a[e + 1]) ? l.pos : void 0) || b.length - 1, h = i(k); !h.length && ++k < j; )
                            h = i(k);
                        return f = $(g({name: d.name,hasRight: c.hasRight})), f.addClass("divider-section"), h.length ? f.insertBefore(h) : 2 === c.hasRight ? f.appendTo(c.$projectMangerContent) : void 0
                    }
                }(this)), this) : this
            }, p.prototype.renderDividerTip = function() {
                var a, b, c;
                return (null != (c = this.projectsCollection) ? c.length : void 0) ? (this.$projectMangerContent.children(".divider-tip").remove(), b = 0, this.$projectMangerContent.children(".project").each(function(a) {
                    return function(c, d) {
                        var e, f;
                        return f = $(d), f.prev(".divider").length ? b = 1 : b++ % a.ranks ? void 0 : (e = $(g({name: "点击添加一个分组",hasRight: a.hasRight})), e.addClass("divider-tip"), f.before(e))
                    }
                }(this)), this.$projectMangerContent.children().last().hasClass("divider") || (a = $(g({name: "点击添加一个分组",hasRight: this.hasRight})), a.addClass("divider-tip"), a.addClass("guide-handler").data("guide", "orgGroup"), a.appendTo(this.$projectMangerContent)), this) : this
            }, p.prototype.moveDivider = function(a) {
                var b, c, d, e, f;
                if (d = $(a.target), b = d.closest(".divider"), "up" === d.data("direction")) {
                    if (e = b.prevAll(".divider-section").first(), !e.length)
                        return;
                    c = b.nextUntil(".divider-section"), b.insertBefore(e), c.insertBefore(e)
                } else {
                    if (e = b.nextAll(".divider-section").first(), !e.length)
                        return;
                    c = e.nextUntil(".divider-section"), e.insertBefore(b), c.insertBefore(b)
                }
                return f = this.updatePosition(), this.saveSection("projectIds", f), this.saveSection("dividers", f)
            }, p.prototype.updatePosition = function() {
                var a, b, c;
                return c = [], b = [], a = 0, this.$projectMangerContent.children().each(function(d, e) {
                    var f;
                    return f = $(e), f.hasClass("divider-tip") ? void 0 : f.hasClass("project") ? (c.push(f.data("id")), a++) : f.hasClass("divider") ? b.push({pos: a,name: f.find(".divider-name").text()}) : void 0
                }), {dividers: b,projectIds: c}
            }, p.prototype.saveSection = function(a, b) {
                return b = b[a], _.isEqual(b, this.organization.get(a)) ? void 0 : (this.organization.saveSection(a, b, {success: function(c) {
                    return function() {
                        return c.organization.set(a, b)
                    }
                }(this)}), this)
            }, p.prototype.removeDivider = function(a) {
                var b, c, d;
                return c = $(a.target), b = c.closest(".divider"), b.remove(), this.renderDividerTip(), d = this.updatePosition(), this.saveSection("projectIds", d), this.saveSection("dividers", d)
            }, p.prototype.quickSubmit = function(a) {
                return 13 === a.keyCode ? this.submitDividerTitle(a) : void 0
            }, p.prototype.submitDividerTitle = function(a) {
                var b, c, d;
                return c = $(a.target), b = c.closest(".divider"), b.removeClass("editing"), d = c.val().trim(), d && d !== b.find(".divider-name").text() ? (b.removeClass("divider-tip").addClass("divider-section"), b.find(".divider-name").text(d), this.saveSection("dividers", this.updatePosition())) : void 0
            }, p.prototype.editDividerTitle = function(a) {
                var b, c, d;
                if (2 === this.hasRight)
                    return c = $(a.target), b = c.closest(".divider"), b.addClass("editing"), d = c.text(), "点击添加一个分组" === d && (d = ""), b.find(".divider-input").val(d).focusAtEnd()
            }, p
        }(r)
    }), define("views/organization/statistics/templates/basic", [], function() {
        return function() {
            var a = '<div class="statistics-header"> <ul class="list-unstyled clearfix"> <li> <a class="statistics-handler" data-type="members" data-gta="event" data-label="statistics | members"> 成员统计</a> </li> <li> <a class="statistics-handler" data-type="teams" data-gta="event" data-label="statistics | teams"> 团队统计</a> </li> <li> <a class="statistics-handler" data-type="projects" data-gta="event" data-label="statistics | projects"> 项目统计</a> </li> </ul></div><div class="statistics-content clearfix"> <div class="left-charts pull-left"> <div class="card"> <div class="card-header"></div> <div class="card-content"> <div class="chart"></div> <div class="placeholder-image"></div> </div> </div> </div> <div class="right-charts pull-right"> <div class="card"> <div class="card-header"></div> <div class="card-content"> <div class="chart"></div> <div class="placeholder-image"></div> </div> </div> </div></div>';
            return a
        }
    }), define("views/organization/statistics/templates/filter", [], function() {
        return function(a) {
            var b = '<div class="data-filter"> <a data-toggle="dropdown"> <span class="filter-type">' + a.name + '</span> <span class="caret"></span> </a> <ul class="dropdown-menu"> <li> <a class="filter-item ';
            return "week" == a.type && (b += "active"), b += '" data-type="week" data-gta="event" data-label="show this week data">最近一周</a> </li> <li> <a class="filter-item ', "month" == a.type && (b += "active"), b += '" data-type="month" data-gta="event" data-label="show this month data">最近一月</a> </li> <li> <a class="filter-item ', "all" == a.type && (b += "active"), b += '" data-type="all" data-gta="event" data-label="show all time data">所有时间</a> </li> </ul></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/statistics/index", ["require", "exports", "module", "./templates/basic", "charts", "./templates/filter", "moment", "view"], function(a) {
        var c, d, e, f, g, h, i, j, k;
        return c = a("./templates/basic"), d = a("charts"), e = a("./templates/filter"), f = a("moment"), i = a("view"), k = "ZH".toLowerCase(), g = {week: "最近一周",month: "最近一月",all: "所有时间"}, j = {type: "month",name: g.month}, h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "StatisticsView", h.prototype.className = "statistics-view", h.prototype.events = {"click .statistics-handler": "switchStatistics","click .left-charts .filter-item": function(a) {
                var b;
                return null != (b = this.chartsCache.leftChart) && "function" == typeof b.onClick ? b.onClick($(a.currentTarget).data("type")) : void 0
            },"click .right-charts .filter-item": function(a) {
                var b;
                return null != (b = this.chartsCache.rightChart) && "function" == typeof b.onClick ? b.onClick($(a.currentTarget).data("type")) : void 0
            }}, h.prototype.initialize = function(a) {
                return this.organization = a.organization, this.chartsCache = {}, this.renderBasic(), _.delay(function(a) {
                    return function() {
                        return a.switchStatistics("members"), a.registerAsResponsive()
                    }
                }(this))
            }, h.prototype.layout = function() {
                return _.each(this.chartsCache, function(a) {
                    return function(b) {
                        return b.resize(a.$leftChart.width())
                    }
                }(this)), this
            }, h.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$leftChart = this.$(".left-charts .chart"), this.$rigthChart = this.$(".right-charts .chart"), this.$header = this.$(".statistics-header"), this.$leftHeader = this.$(".left-charts .card-header"), this.$rightHeader = this.$(".right-charts .card-header"), this
            }, h.prototype.switchStatistics = function(a) {
                var b;
                if (b = a.currentTarget ? $(a.currentTarget).data("type") : a, this.currentType !== b) {
                    switch (this.currentType = b, this.disposeCharts(), b) {
                        case "members":
                            this.$leftHeader.html("成员工作完成率" + e(j)), this.$rightHeader.html("成员任务数量" + e(j)), this.organization.getStatistic({beforeSend: function(a) {
                                return function() {
                                    return a.showLoadingIndicator(a.$leftChart), a.showLoadingIndicator(a.$rigthChart)
                                }
                            }(this),success: function(a) {
                                return function(b) {
                                    return a.renderMemberEfficiency(b, "month", function() {
                                        return a.hideLoadingIndicator({animated: !1}), a.renderMemberTasks(b, "month")
                                    })
                                }
                            }(this)});
                            break;
                        case "teams":
                            this.$leftHeader.text("团队成员数量"), this.$rightHeader.text("团队参与项目数量"), this.organization.getTeamsStatistic({beforeSend: function(a) {
                                return function() {
                                    return a.showLoadingIndicator(a.$leftChart), a.showLoadingIndicator(a.$rigthChart)
                                }
                            }(this),success: function(a) {
                                return function(b) {
                                    return a.renderTeamMembers(b, "month", function() {
                                        return a.hideLoadingIndicator({animated: !1}), a.renderTeamProjects(b, "month")
                                    })
                                }
                            }(this)});
                            break;
                        case "projects":
                            this.$leftHeader.text("项目成员数量"), this.$rightHeader.html("项目任务数量" + e(j)), this.organization.getProjectsStatistic({beforeSend: function(a) {
                                return function() {
                                    return a.showLoadingIndicator(a.$leftChart), a.showLoadingIndicator(a.$rigthChart)
                                }
                            }(this),success: function(a) {
                                return function(b) {
                                    return a.renderProjectMembers(b, "month", function() {
                                        return a.hideLoadingIndicator({animated: !1}), a.renderProjectTasks(b, "month")
                                    })
                                }
                            }(this)})
                    }
                    return this.activeTab(b)
                }
            }, h.prototype.activeTab = function(a) {
                return this.$header.find(".active").removeClass("active"), this.$header.find(".statistics-handler[data-type=" + a + "]").addClass("active")
            }, h.prototype.disposeCharts = function() {
                var a, b;
                return null != (a = this.chartsCache.leftChart) && a.dispose(), null != (b = this.chartsCache.rightChart) && b.dispose(), this.$leftChart.empty().attr("style", ""), this.$rigthChart.empty().attr("style", "")
            }, h.prototype.checkPlaceholder = function(a, b) {
                return a[b ? "removeClass" : "addClass"]("no-data"), b
            }, h.prototype.genAttrs = function(a) {
                var b;
                switch (b = {}, a) {
                    case "all":
                        b.all = !0;
                        break;
                    case "week":
                        b.endDate = (new Date).toISOString(), b.startDate = f().subtract(7, "days").toISOString()
                }
                return b
            }, h.prototype.renderMemberEfficiency = function(a, b, c) {
                return null == c && (c = function() {
                }), this.checkPlaceholder(this.$(".left-charts"), a.length) ? d({lang: k,dom: this.$leftChart[0]}, function(d) {
                    return function(f) {
                        return d.chartsCache.leftChart = f, f.orgMembersEfficiency(a), f.onClick = function(a) {
                            return a !== b ? (b = a, d.$leftHeader.html("成员工作完成率" + e({type: a,name: g[a]})), d.organization.getStatistic({attrs: d.genAttrs(b),success: function(a) {
                                return f.orgMembersEfficiency(a)
                            }})) : void 0
                        }, c()
                    }
                }(this)) : c(), this
            }, h.prototype.renderMemberTasks = function(a, b, c) {
                return null == c && (c = function() {
                }), this.checkPlaceholder(this.$(".right-charts"), a.length) ? d({lang: k,dom: this.$rigthChart[0]}, function(d) {
                    return function(f) {
                        return d.chartsCache.rightChart = f, f.orgMembersTasks(a), f.onClick = function(a) {
                            return a !== b ? (b = a, d.$rightHeader.html("成员任务数量" + e({type: a,name: g[a]})), d.organization.getStatistic({attrs: d.genAttrs(b),success: function(a) {
                                return f.orgMembersTasks(a)
                            }})) : void 0
                        }, c()
                    }
                }(this)) : c(), this
            }, h.prototype.renderTeamMembers = function(a, b, c) {
                return null == c && (c = function() {
                }), this.checkPlaceholder(this.$(".left-charts"), a.length) ? d({lang: k,dom: this.$leftChart[0]}, function(b) {
                    return function(d) {
                        return b.chartsCache.leftChart = d, d.orgTeamMembers(a), c()
                    }
                }(this)) : c(), this
            }, h.prototype.renderTeamProjects = function(a, b, c) {
                return null == c && (c = function() {
                }), this.checkPlaceholder(this.$(".right-charts"), a.length) ? d({lang: k,dom: this.$rigthChart[0]}, function(b) {
                    return function(d) {
                        return b.chartsCache.rightChart = d, d.orgTeamProjects(a), c()
                    }
                }(this)) : c(), this
            }, h.prototype.renderProjectMembers = function(a, b, c) {
                return null == c && (c = function() {
                }), this.checkPlaceholder(this.$(".left-charts"), a.length) ? d({lang: k,dom: this.$leftChart[0]}, function(b) {
                    return function(d) {
                        return b.chartsCache.leftChart = d, d.orgProjectsMembers(a), c()
                    }
                }(this)) : c(), this
            }, h.prototype.renderProjectTasks = function(a, b, c) {
                return null == c && (c = function() {
                }), this.checkPlaceholder(this.$(".right-charts"), a.length) ? d({lang: k,dom: this.$rigthChart[0]}, function(d) {
                    return function(f) {
                        return d.chartsCache.rightChart = f, f.orgProjectsTasks(a), f.onClick = function(a) {
                            return a !== b ? (b = a, d.$rightHeader.html("项目任务数量" + e({type: a,name: g[a]})), d.organization.getProjectsStatistic({attrs: d.genAttrs(b),success: function(a) {
                                return f.orgProjectsTasks(a)
                            }})) : void 0
                        }, c()
                    }
                }(this)) : c(), this
            }, h.prototype.remove = function() {
                return d.clear(), h.__super__.remove.apply(this, arguments)
            }, h
        }(i)
    }), define("views/organization/teams-manager/templates/basic", [], function() {
        return function(a) {
            var b = '<div class="teams-manager-header clearfix"> <ol class="breadcrumbs"> <li> 所有团队 </li> </ol>';
            return a.hasRight > 0 && (b += ' <a class="pull-right btn-open-team-creator link-add-handler guide-handler" data-guide="orgTeamCreate"> <span class="icon icon-plus-bold"></span>新建团队 </a> '), b += '</div><div class="teams-manager-content"> <div class="placeholder muted"> <p>团队是组织中若干个人员的集合，可以将团队成员批量添加到项目中，联系管理员创建团队</p> </div></div>'
        }
    }), define("views/organization/team-menu/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="list"> ';
            return a.hasRight > 0 ? (b += ' <li> <a class="edit-team-handler"> <span class="icon icon-pencil"></span>编辑团队名称 </a> </li> ', a.isMember && (b += ' <li> <a class="quit-team-handler"> <span class="icon icon-user"></span>退出团队 </a> </li> '), b += ' <li> <a class="delete-team-handler"> <span class="icon icon-trash"></span>删除团队 </a> </li> ') : b += ' <li> <a class="quit-team-handler"> <span class="icon icon-user"></span>退出团队 </a> </li> ', b += "</ul>"
        }
    }), define("views/organization/team-menu/templates/delete", [], function() {
        return function() {
            var a = '<form class="team-delete-form"> <p>您确定要永远删除这个团队吗?</p> <button class="btn btn-danger" type="submit" data-gta="event" data-label="delete team">删除</button></form>';
            return a
        }
    }), define("views/organization/team-menu/templates/edit", [], function() {
        return function(a) {
            var b = '<form class="team-edit-form"> <input class="form-control" placeholder="teamMenuStageName" type="text" value="' + a.name + '"></input> <button class="btn btn-primary" type="submit" data-gta="event" data-label="edit team">保存</button></form>';
            return b
        }
    }), define("views/organization/team-menu/templates/quit", [], function() {
        return function() {
            var a = '<form class="team-quit-form"> <p>您确定退出这个团队吗?</p> <button class="btn btn-danger" type="submit" data-gta="event" data-label="quit team">退出</button></form>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/team-menu/index", ["require", "exports", "module", "teambition", "./templates/basic", "./templates/delete", "./templates/edit", "lib/popover/index", "./templates/quit"], function(a) {
        var c, d, e, f, g, h, i;
        return i = a("teambition"), c = a("./templates/basic"), d = a("./templates/delete"), e = a("./templates/edit"), f = a("lib/popover/index"), g = a("./templates/quit"), h = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "TeamMenuView", f.prototype.popoverTitle = "团队菜单", f.prototype.events = {"click .edit-team-handler": "enterEditSubMenu","click .delete-team-handler": "enterDeleteSubMenu","click .quit-team-handler": "enterQuitSubMenu","submit .team-edit-form": "submitEditForm","submit .team-delete-form": "submitDeleteForm","submit .team-quit-form": "submitQuitForm"}, f.prototype.render = function() {
                var a;
                if (this.options.teamModel)
                    return a = this.options.teamModel.toJSON(), a.hasRight = this.options.teamModel.hasRight(), a.isMember = this.options.teamModel.isMember(i.user.id), this.$el.html(c(a)), this
            }, f.prototype.enterEditSubMenu = function() {
                return this.enterSubMenu("编辑团队名称", function(a) {
                    return function() {
                        return a.$el.html(e(a.options.teamModel.toJSON())), a.$("input").focusAtEnd()
                    }
                }(this)), this
            }, f.prototype.enterDeleteSubMenu = function() {
                return this.enterSubMenu("删除团队", function(a) {
                    return function() {
                        return a.$el.html(d({}))
                    }
                }(this)), this
            }, f.prototype.enterQuitSubMenu = function() {
                return this.enterSubMenu("退出团队", function(a) {
                    return function() {
                        return a.$el.html(g({}))
                    }
                }(this)), this
            }, f.prototype.submitEditForm = function(a) {
                var b, c;
                return a.preventDefault(), b = $(a.currentTarget), c = b.find("input").val().trim(), c ? this.options.teamModel.save({name: c}, {success: function(a) {
                    return function() {
                        return a.hide()
                    }
                }(this)}) : b.find("input").focusAtEnd(), this
            }, f.prototype.submitDeleteForm = function(a) {
                return a.preventDefault(), this.options.teamModel.destroy({success: function(a) {
                    return function() {
                        return a.hide(), Essage.show({message: "删除成功",status: "success"}, 2e3)
                    }
                }(this)}), this
            }, f.prototype.submitQuitForm = function(a) {
                var b;
                return a.preventDefault(), b = this.options.teamModel, b.quit({success: function(a) {
                    return function() {
                        var c, d;
                        return a.hide(), 2 !== (null != (c = a.options) ? c.teamModel.hasRight() : void 0) && null != (d = b.collection) ? d.remove(b) : void 0
                    }
                }(this)}), this
            }, f
        }(f)
    }), define("views/organization/teams-manager/templates/team", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="team card" data-team-id="' + a._id + '"> <a> <h3>' + b(a.name) + '</h3> <p class="member-team-acount"> 成员&nbsp;·&nbsp;' + a.membersCount + "&nbsp;&nbsp;&nbsp;&nbsp;项目&nbsp;·&nbsp;" + a.projectsCount + ' </p> </a> <hr /> <ul class="members-list"> ', d = a.hasMembers;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += " ", 7 > f && (c += ' <li> <div class="member-avatar img-circle img-24 pull-left hinted" style="background-image:url(' + e.avatarUrl + ');" data-title="' + e.name + '"></div> </li> '), c += " ";
            return c += " ", a.hasMembers.length >= 7 && (c += ' <li> <div class="pull-left">...</div> </li> '), c += " </ul> ", "default" != a.type && (c += ' <a class="team-menu-toggler icon icon-chevron-down" data-team-id="' + a._id + '"></a> '), c += "</div>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/teams-manager/index", ["require", "exports", "module", "./templates/basic", "lib/guide-point/index", "collections/teams", "views/organization/team-creator/index", "views/organization/team-menu/index", "./templates/team", "view", "lib/window/index"], function(a) {
        var c, d, e, f, g, h, i, j, k;
        return c = a("./templates/basic"), d = a("lib/guide-point/index"), e = a("collections/teams"), f = a("views/organization/team-creator/index"), g = a("views/organization/team-menu/index"), h = a("./templates/team"), j = a("view"), k = a("lib/window/index"), i = function(a) {
            function i() {
                return i.__super__.constructor.apply(this, arguments)
            }
            return b(i, a), i.prototype.viewName = "TeamsManagerView", i.prototype.className = "teams-manager-view", i.prototype.events = {"click .team": "onTeamClick","click .btn-open-team-creator": "openTeamCreator","click .team-menu-toggler": "toggleTeamMenu"}, i.prototype.initialize = function(a) {
                return this.options = null != a ? a : {}, this.organizationModel = this.options.organizationModel, this.loadOrganizationTeams({success: function(a) {
                    return function() {
                        return a.renderBasic().renderTeams().listen(), d.initialize(a)
                    }
                }(this)})
            }, i.prototype.listen = function() {
                return this.listenTo(this.organizationTeamsCollection, "add remove", function(a) {
                    return function() {
                        return a.organizationTeamsCollection.length ? a.renderTeams() : a.renderBasic()
                    }
                }(this)), this.listenTo(this.organizationTeamsCollection, "change", this.refreshTeam)
            }, i.prototype.renderBasic = function() {
                return this.$el.html(c({hasRight: this.organizationModel.hasRight()})), this
            }, i.prototype.loadOrganizationTeams = function(a) {
                var b;
                return b = _.extend({boundToObjectType: "organization"}, a), b.success = function(b) {
                    return function(c) {
                        return b.organizationTeamsCollection = c, a.success()
                    }
                }(this), e.fetch(this.organizationModel.id, b), this
            }, i.prototype.renderTeams = function() {
                var a, b, c, d;
                if (this.organizationTeamsCollection.length) {
                    for (this.$(".teams-manager-content").html(""), d = this.organizationTeamsCollection.toJSON(), b = 0, c = d.length; c > b; b++)
                        a = d[b], this.renderTeam(a, "default" === a.type);
                    this.buildGuidePointDom()
                }
                return this
            }, i.prototype.renderTeam = function(a, b) {
                var c;
                return c = _.isBoolean(b) && b ? "prepend" : "append", this.$(".teams-manager-content")[c](h(a)), this
            }, i.prototype.refreshTeam = function(a) {
                var b;
                return b = a.toJSON(), this.$(".team[data-team-id='" + a.id + "']").replaceWith(h(b)), this
            }, i.prototype.onTeamClick = function(a) {
                var b, c;
                return a.preventDefault(), c = $(a.currentTarget).attr("data-team-id"), "function" == typeof (b = this.options).onTeamClick ? b.onTeamClick(this.organizationTeamsCollection.get(c)) : void 0
            }, i.prototype.openTeamCreator = function() {
                return this.requestSubView(k).open(f, {_organizationId: this.organizationModel.id}), this
            }, i.prototype.toggleTeamMenu = function(a) {
                var b, c;
                return a.preventDefault(), a.stopPropagation(), c = $(a.currentTarget).attr("data-team-id"), b = $(a.currentTarget), b.data("bs.popover") ? this : (this.requestSubView(g, {$toggler: b,teamModel: this.organizationTeamsCollection.get(c)}).show(), this)
            }, i.prototype.buildGuidePointDom = function() {
                return this.$el.find(".team:eq(1) .team-menu-toggler").addClass("guide-handler").data("guide", "orgTeamSet")
            }, i
        }(j)
    }), define("views/organization/team-manager/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="team-manager-header"> <ol class="breadcrumbs"> <li> <a class="breadcrumb-handler back-to-teams">所有团队</a> </li> <li class="active">' + b(a.name) + '</li> </ol></div><div class="team-manager-content"><div class="team-members-panel card">';
            return a.hasOrganizaitonRight && (c += '<div class="panel-nav"><a class="team-member-trigger active">现有团队成员・<span class="team-members-count">' + a.membersCount + "</span></a> ", "default" != a.type && (c += ' <span class="split-line"></span> <a class="import-member-from-org-trigger">从组织中导入成员</a> '), c += "</div> "), c += '<ul class="member-list"></ul></div><div class="team-projects-panel card"><p class="panel-nav"> 团队参与的项目・<span class="team-projects-count">' + a.projectsCount + '</span> </p> <p class="muted add-project-tips"> 团队成员将直接加入项目，往团队中添加成员，自动添加到参与的项目 </p> ', a.hasOrganizaitonRight > 0 && (c += ' <label class="team-projects-finder-wrapper guide-handler" data-guide="orgTeamProject"> <input class="team-projects-finder form-control"  placeholder="搜索来添加项目" /> <span class="icon icon-search"></span> </label> '), c += '<ul class="team-project-list"> <li> <div class="placeholder muted">还没有参与任何项目</div> </li></ul></div></div>'
        }
    }), define("views/organization/team-manager/templates/member", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="' + a._id + ' member card"> <div class="avatar img-circle img-36" style="background-image:url(' + a.avatarUrl + ');"></div> <p class="abstract"> ';
            return c += a._id === a._userMeId ? ' <strong class="name">我(' + b(a.name) + ")</strong> " : ' <strong class="name">' + b(a.name) + "</strong> ", c += " </p> ", a._id !== a._userMeId && a.hasOrganizationRight > 0 && 2 !== a.hasRight && !a.isTeamDefault && (c += ' <a class="member-menu-toggler icon icon-chevron-down" data-member-id="' + a._id + '"></a> '), c += "</li>"
        }
    }), define("views/organization/team-manager/templates/organization-member", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li data-id="' + a._id + '" class="' + a._id + " member organization-member ";
            return a.isInTeam && (c += "in-team"), c += ' card"> <div class="avatar img-circle img-48" style="background-image:url(' + a.avatarUrl + ');"></div> <p class="abstract"> ', c += a._id === a._userMeId ? ' <strong class="name">我(' + b(a.name) + ")</strong> " : ' <strong class="name">' + b(a.name) + "</strong> ", c += ' </p> <span class="icon icon-tick"></span></li>'
        }
    }), define("views/organization/team-manager/templates/project", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="' + a._id + ' project"> <div class="project-logo" style="background-image:url(' + a.logo + ');"></div> <h3 class="project-title" title="' + a.name + '">' + b(a.name) + "</h3> ";
            return a.hasOrganizationRight > 0 && (c += ' <botton class="remove-project-btn btn" data-id=\'' + a._id + "'>移除</botton> "), c += "</li>"
        }
    }), define("views/organization/team-manager/templates/result", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="ui-menu-item ' + a._id + ' project auto-complete-project"> <div class="project-logo" style="background-image:url(' + a.logo + ');"></div> <h3 class="project-title">' + b(a.name) + "</h3> <a></a></li>";
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/team-manager/index", ["require", "exports", "module", "teambition", "lib/guide-point/index", "thenjs", "util", "view", "collections/members", "collections/projects", "collections/teams", "../member-menu/index", "./templates/basic", "./templates/member", "./templates/organization-member", "./templates/project", "./templates/result"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q;
        return q = a("teambition"), d = a("lib/guide-point/index"), n = a("thenjs"), o = a("util"), p = a("view"), g = a("collections/members"), j = a("collections/projects"), m = a("collections/teams"), e = a("../member-menu/index"), c = a("./templates/basic"), f = a("./templates/member"), h = a("./templates/organization-member"), i = a("./templates/project"), k = a("./templates/result"), l = function(a) {
            function l() {
                return l.__super__.constructor.apply(this, arguments)
            }
            return b(l, a), l.prototype.viewName = "TeamManagerView", l.prototype.className = "team-manager-view", l.prototype.events = {"click .back-to-teams": "onBackToTeamsClick","click .member-menu-toggler": "toggleMemberMenu","click .import-member-from-org-trigger": "importMemberFromOrg","click .team-member-trigger": "renderMembers","click .organization-member": "addOrRemoveMemberFromTeam","click .remove-project-btn": "removeProject"}, l.prototype.initialize = function(a) {
                return this.options = null != a ? a : {}, this.teamModel = this.options.teamModel, this.organizationModel = this.options.organizationModel, this.organizationProjectsCollection = this.options.organizationProjectsCollection, this.hasOrganizaitonRight = this.organizationModel.hasRight(), this.load({beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$el)
                    }
                }(this),success: function(a) {
                    return function() {
                        return a.hideLoadingIndicator(a.$el), a.renderBasic().renderMembers().renderProjects(), d.initialize(a), a.hasOrganizaitonRight > 0 && a.initProjectFinder(), a.listen()
                    }
                }(this)})
            }, l.prototype.load = function(a) {
                return "function" == typeof a.beforeSend && a.beforeSend(), n.parallel([function(a) {
                    return function(b) {
                        return g.fetch(a.options._teamId, {boundToObjectType: "team",success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this), function(a) {
                    return function(b) {
                        return j.fetch(a.options._teamId, {boundToObjectType: "team",success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this), function(a) {
                    return function(b) {
                        return m.fetchOne(a.organizationModel.id, a.options._teamId, {boundToObjectType: "organization",success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this)]).fin(function(b) {
                    return function(c, d, e) {
                        return d ? b.renderError() : (b.teamMembersCollection = e[0], b.teamProjectsCollection = e[1], b.teamModel = e[2], a.success())
                    }
                }(this)), this
            }, l.prototype.loadOrganizationMembersCollection = function(a) {
                return g.fetch(this.organizationModel.id, {boundToObjectType: "organization",success: function(b) {
                    return function(c) {
                        return b.organizationMembersCollection = c, a.success()
                    }
                }(this)})
            }, l.prototype.listen = function() {
                return this.listenTo(this.teamMembersCollection, "add remove", function(a) {
                    return function() {
                        return a.teamModel.set("membersCount", a.teamMembersCollection.length), a.teamModel.set("hasMembers", a.teamMembersCollection.toJSON()), a.refreshTeamMembersCount(), a.$importMemberFromOrgTrigger.hasClass("active") ? void 0 : a.renderMembers()
                    }
                }(this)), this.listenTo(this.teamMembersCollection, "change:hasRight change:isQuited change:avatarUrl", function(a) {
                    return function() {
                        return a.renderMembers()
                    }
                }(this)), this.listenTo(this.teamProjectsCollection, "add remove", function(a) {
                    return function() {
                        return a.teamModel.set("projectsCount", a.teamProjectsCollection.length), a.renderProjects(), a.refreshTeamProjectsCount()
                    }
                }(this))
            }, l.prototype.renderBasic = function() {
                var a;
                return a = this.teamModel.toJSON(), a.hasOrganizaitonRight = this.hasOrganizaitonRight, this.$el.html(c(a)), this.$teamMemberTrigger = this.$(".team-member-trigger"), this.$importMemberFromOrgTrigger = this.$(".import-member-from-org-trigger"), this.$memberList = this.$(".member-list"), this.$teamProjectFinder = this.$(".team-projects-finder"), this
            }, l.prototype.renderMembers = function() {
                return this.$importMemberFromOrgTrigger.removeClass("active"), this.$teamMemberTrigger.addClass("active"), this.$memberList.html(""), this.teamMembersCollection.each(function(a) {
                    return function(b) {
                        return a.renderMember(b, !1)
                    }
                }(this)), this
            }, l.prototype.renderMember = function(a, b) {
                return this.assembleData(a, function(a) {
                    return function(c) {
                        var d;
                        return c._userMeId = q.user.id, c.isTeamDefault = "default" === a.teamModel.get("type"), d = _.isBoolean(b) && b ? "prepend" : "append", a.$memberList[d](f(c))
                    }
                }(this)), this
            }, l.prototype.importMemberFromOrg = function() {
                return this.$importMemberFromOrgTrigger.addClass("active"), this.$teamMemberTrigger.removeClass("active"), this.showLoadingIndicator(this.$memberList), this.loadOrganizationMembersCollection({success: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$memberList), a.renderOrganizaitonMembers()
                    }
                }(this)})
            }, l.prototype.renderOrganizaitonMembers = function() {
                return this.$memberList.html(""), this.organizationMembersCollection.each(function(a) {
                    return function(b) {
                        return a.renderOrganizationMember(b, !1)
                    }
                }(this)), this
            }, l.prototype.renderOrganizationMember = function(a, b) {
                return this.assembleData(a, function(a) {
                    return function(c) {
                        var d;
                        return c._userMeId = q.user.id, d = _.isBoolean(b) && b ? "prepend" : "append", c.isInTeam = !!a.teamMembersCollection.get(c._id), a.$memberList[d](h(c))
                    }
                }(this)), this
            }, l.prototype.renderProjects = function() {
                var a, b, c, d;
                if (this.$(".team-project-list").html(""), 0 === this.teamProjectsCollection.length)
                    return this.$(".team-project-list").html('<li><div class="placeholder muted">还没有参与任何项目</div></li>'), this;
                for (d = this.teamProjectsCollection.toJSON(), b = 0, c = d.length; c > b; b++)
                    a = d[b], this.renderProject(a, !1);
                return this
            }, l.prototype.renderProject = function(a, b) {
                var c;
                return a.hasOrganizationRight = this.organizationModel.hasRight(), c = _.isBoolean(b) && b ? "prepend" : "append", this.$(".team-project-list")[c](i(a)), this
            }, l.prototype.assembleData = function(a, b) {
                var c;
                return c = a.toJSON(), c.hasOrganizationRight = this.organizationModel.hasRight(), c.dateString = o.formatDate(a.get("joined")).dateString, b(c)
            }, l.prototype.addMember = function(a) {
                var b;
                return b = a.attributes ? {email: a.get("email")} : {email: a.item.email}, this.teamMembersCollection.addMember(b), this
            }, l.prototype.onBackToTeamsClick = function() {
                var a;
                return "function" == typeof (a = this.options).onBackToTeamsClick ? a.onBackToTeamsClick() : void 0
            }, l.prototype.toggleMemberMenu = function(a) {
                var b, c;
                return a.preventDefault(), c = $(a.currentTarget).data("memberId"), b = $(a.currentTarget), b.data("bs.popover") ? this : (this.requestSubView(e, {$toggler: b,membersCollection: this.teamMembersCollection,memberModel: this.teamMembersCollection.get(c),hasOrganizationRight: this.organizationModel.hasRight()}).show(), this)
            }, l.prototype.initProjectFinder = function() {
                return this.$teamProjectFinder.autocomplete({appendTo: "body",minLength: 0,autoFocus: !0,create: function() {
                    return function() {
                        return $("body > .ui-autocomplete.ui-menu").addClass("dropdown-menu").addClass("team-manager-projects-autocomplete").css({zIndex: 1e4,visibility: "visible",opacity: 1,"overflow-y": "auto"})
                    }
                }(this),select: function(a) {
                    return function(b, c) {
                        return a.addProject(c.item.value), a.$teamProjectFinder.val(""), !1
                    }
                }(this),focus: function(a, b) {
                    return a.preventDefault(), $(".team-manager-projects-autocomplete .ui-menu-item").removeClass("hover"), $(".team-manager-projects-autocomplete ." + b.item.value.id).addClass("hover")
                },source: function(a) {
                    return function(b, c) {
                        return j.fetch(a.organizationModel.id, {boundToObjectType: "organization",success: function(d) {
                            var e;
                            return e = "" === b.term ? d.map(function(a) {
                                return {label: a.get("name"),value: a}
                            }) : d.filter(function(c) {
                                var d, e, f, g, h, i, j, k;
                                return g = null != (h = b.term) ? h.toLowerCase() : void 0, d = null != (i = c.get("name")) ? i.toLowerCase() : void 0, f = null != (j = c.get("py")) ? j.toLowerCase() : void 0, e = null != (k = c.get("pingyin")) ? k.toLowerCase() : void 0, !a.teamProjectsCollection.get(c.id) && (d.indexOf(g) > -1 || f && f.indexOf(g) > -1 || e && e.indexOf(g) > -1)
                            }).map(function(a) {
                                return {label: a.get("name"),value: a}
                            }), c(e)
                        }})
                    }
                }(this)}), this.$teamProjectFinder.bind("focus", function() {
                    return $(this).autocomplete("search")
                }), this.autocomplete = this.$teamProjectFinder.data("ui-autocomplete"), this.autocomplete._renderItem = function() {
                    return function(a, b) {
                        var c;
                        return c = b.value.toJSON(), $(k(c)).appendTo(a)
                    }
                }(this), this.autocomplete.liveRegion = $("<span>"), this
            }, l.prototype.addOrRemoveMemberFromTeam = function(a) {
                var b, c, d, e, f;
                return b = this.$(a.currentTarget), e = b.data("id"), c = null != (f = this.teamMembersCollection.get(e)) ? f.toJSON() : void 0, c ? c.isOwner ? void 0 : this.teamMembersCollection.removeMember(e, {beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(b)
                    }
                }(this),success: function(a) {
                    return function() {
                        return a.hideLoadingIndicator(b), b.removeClass("in-team")
                    }
                }(this)}) : (d = this.organizationMembersCollection.get(e), this.teamMembersCollection.addMember({email: d.get("email")}, {boundToObjectType: "team",beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(b)
                    }
                }(this),success: function(a) {
                    return function() {
                        return a.hideLoadingIndicator(b), b.addClass("in-team")
                    }
                }(this)}))
            }, l.prototype.addProject = function(a) {
                return this.teamModel.addProject(a.id, {success: function(b) {
                    return function() {
                        return b.teamProjectsCollection.add(a)
                    }
                }(this)})
            }, l.prototype.removeProject = function(a) {
                var b, c;
                return b = this.$(a.currentTarget), c = b.data("id"), this.teamModel.removeProject(c, {success: function(a) {
                    return function() {
                        return a.teamProjectsCollection.remove(a.teamProjectsCollection.get(c))
                    }
                }(this)})
            }, l.prototype.refreshTeamMembersCount = function() {
                return this.$(".team-members-count").html(this.teamMembersCollection.length)
            }, l.prototype.refreshTeamProjectsCount = function() {
                return this.$(".team-projects-count").html(this.teamProjectsCollection.length)
            }, l
        }(p)
    }), define("views/organization/organization/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="organization-header"><div class="organization-info organization-wrap"><div class="plan-tips-wrap"></div><div class="organization-logo" style="background-image: url(' + a.logo + ');"> </div> <h2 class="organization-name"> <span class="organization-name-span">' + b(a.name) + '</span> <span class="label public-label ';
            return a.isPublic || (c += "hide"), c += '">公开</span> </h2> <p class="organization-description"> ' + b(a.description) + ' </p></div><div class="organization-nav sub-nav organization-wrap"> <ul class="nav nav-underscore"> <li class="organization-title-wrap"> <h3 class="organization-title"> <span class="organization-name">' + b(a.name) + '</span> </h3> </li> <li class="organization-nav-projects"> <a data-tab-name="projects"> 项目 · <span class="projects-count">' + a.projectsCount + '</span> </a> </li> <li class="organization-nav-members"> <a data-tab-name="members"> 成员 · <span class="members-count">' + a.membersCount + "</span> </a> </li> ", a.hasRight >= 0 && (c += ' <li class="organization-nav-teams"> <a data-tab-name="teams"> 团队 · <span class="teams-count">' + a.teamsCount + '</span> </a> </li> <li class="organization-nav-statistics"> <a data-tab-name="statistics"> 统计 </a> </li> <li class="organization-nav-setting"> <a data-tab-name="setting"> 设置 </a> </li> '), c += ' </ul></div></div><div class="organization-content organization-wrap clearfix"><div class="organization-tab-content"></div></div>'
        }
    }), define("views/organization/organization/templates/plan", [], function() {
        return function(a) {
            var b = '<div class="plan-tips">企业版<br />';
            return b += a.days > 0 ? "还有" + a.days + "天到期" : "已过期", b += '</div><div class="plan-tips-detail ', a.days <= 0 && (b += "is-overdue"), b += '"><div class="go-payment"><a href="http://pay.teambition.com/confirm_order?_organizationId=' + a._organizaitonId + '" target="_blank">立即付款</a></div>', a.projectsCount > 0 && 2 == a.hasRight && (b += '<div class="export-projects">迁出项目</div>'), b += '<div class="contact-us">咨询电话 <br /> <span>400-060-5576</span></div></div>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/organization/organization/index", ["require", "exports", "module", "teambition", "thenjs", "view", "collections/members", "collections/organizations", "collections/projects", "collections/teams", "views/organization/members-manager/index", "views/organization/member-manager/index", "views/organization/organization-expiring/index", "views/organization/organization-guide/index", "views/organization/organization-overdue/index", "views/settings/organization-settings/index", "views/organization/projects-manager/index", "views/organization/projects-transfer/index", "views/organization/statistics/index", "views/organization/teams-manager/index", "views/organization/team-manager/index", "lib/window/index", "./templates/basic", "./templates/plan"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x;
        return x = a("teambition"), u = a("thenjs"), v = a("view"), e = a("collections/members"), l = a("collections/organizations"), n = a("collections/projects"), s = a("collections/teams"), f = a("views/organization/members-manager/index"), d = a("views/organization/member-manager/index"), g = a("views/organization/organization-expiring/index"), h = a("views/organization/organization-guide/index"), i = a("views/organization/organization-overdue/index"), j = a("views/settings/organization-settings/index"), o = a("views/organization/projects-manager/index"), p = a("views/organization/projects-transfer/index"), q = a("views/organization/statistics/index"), t = a("views/organization/teams-manager/index"), r = a("views/organization/team-manager/index"), w = a("lib/window/index"), c = a("./templates/basic"), m = a("./templates/plan"), k = function(a) {
            function k() {
                return k.__super__.constructor.apply(this, arguments)
            }
            return b(k, a), k.prototype.viewName = "OrganizationView", k.prototype.className = "organization-view", k.prototype.routes = {projects: "enterProjects","teams(/:_teamId)": "enterTeams","members(/:_memberId)": "enterMembers",statistics: "enterStatistics","*paramString": "enterProjects"}, k.prototype.events = {"click .organization-nav a": "onTabClick","click .export-projects": "openProjectsExportTransfer"}, k.prototype.initialize = function(a) {
                return this.options = null != a ? a : {}, window.scrollTo(0, 0), this.isInTeamView = !1, this.organization = this.options.organizationModel, this.renderBasic().renderGuide(), this.loadOrganizationProjectsMembersTeams({success: function(a) {
                    return function() {
                        return a.renderPlan().refreshProjectsCount().refreshMembersCount().refreshTeamsCount().refreshPlanTip().listen().navAnimation()
                    }
                }(this)})
            }, k.prototype.listen = function() {
                return this.listenTo(this.organization, "change:name", function(a) {
                    return function() {
                        return a.$orgName.text(a.organization.get("name"))
                    }
                }(this)), this.listenTo(this.organization, "change:isPublic", function(a) {
                    return function() {
                        var b;
                        return b = a.organization.get("isPublic") ? "removeClass" : "addClass", a.$publcLabel[b]("hide")
                    }
                }(this)), this.listenTo(this.organization, "change:description", function(a) {
                    return function() {
                        return a.$orgDes.text(a.organization.get("description"))
                    }
                }(this)), this.listenTo(this.organization, "change:logo", function(a) {
                    return function() {
                        return a.$orgLogo.attr("style", "background-image: url(" + a.organization.get("logo") + ")")
                    }
                }(this)), this.listenTo(this.organization, "change:plan", this.renderPlan), this.listenTo(this.organizationProjects, "add remove", function(a) {
                    return function() {
                        return a.renderPlan(), a.refreshProjectsCount()
                    }
                }(this)), this.listenTo(this.organizationMembers, "add remove", function(a) {
                    return function() {
                        return a.refreshMembersCount()
                    }
                }(this)), this.listenTo(this.organizationTeams, "add remove", function(a) {
                    return function() {
                        return a.refreshTeamsCount()
                    }
                }(this)), this
            }, k.prototype.navAnimation = function() {
                var a, b, c;
                return b = !1, a = this.$organizationHeader[0], c = a.getBoundingClientRect().bottom, $(document).off("scroll.organization-auto-nav"), $(document).on("scroll.organization-auto-nav", function(c) {
                    return function() {
                        var d;
                        return d = a.getBoundingClientRect().bottom, !b && 100 >= d ? (b = !0, c.$el.addClass("pin")) : b && d > 50 ? (b = !1, c.$el.removeClass("pin")) : void 0
                    }
                }(this)), this
            }, k.prototype.loadOrganizationProjectsMembersTeams = function(a) {
                return "function" == typeof a.beforeSend && a.beforeSend(), u.parallel([function(a) {
                    return function(b) {
                        return n.fetch(a.organization.id, {boundToObjectType: "organization",success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this), function(a) {
                    return function(b) {
                        return e.fetch(a.organization.id, {boundToObjectType: "organization",success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }})
                    }
                }(this), function(a) {
                    return function(b) {
                        return a.organization.hasRight() >= 0 ? s.fetch(a.organization.id, {boundToObjectType: "organization",success: function(a) {
                            return b(null, a)
                        },error: function(a) {
                            return b(a, null)
                        }}) : b(null, new s)
                    }
                }(this)]).fin(function(b) {
                    return function(c, d, e) {
                        return d ? b.renderError() : (b.organizationProjects = e[0], b.organizationMembers = e[1], b.organizationTeams = e[2], a.success())
                    }
                }(this)), this
            }, k.prototype.renderBasic = function() {
                var a, b;
                try {
                    mixpanel.track("organization manager")
                } catch (d) {
                    a = d
                }
                return b = this.organization.toJSON(), this.$el.html(c(b)), this.$orgName = this.$(".organization-name-span"), this.$publcLabel = this.$(".organization-name .public-label"), this.$orgDes = this.$(".organization-description"), this.$orgLogo = this.$(".organization-logo"), this.$organizationTabContent = this.$(".organization-tab-content"), this.$organizationHeader = this.$(".organization-header"), this.organization.isExpiring() ? _.delay(function(a) {
                    return function() {
                        return a.renderExpiring()
                    }
                }(this)) : this.organization.isOverdue() && _.delay(function(a) {
                    return function() {
                        return a.renderOverdue()
                    }
                }(this)), this
            }, k.prototype.renderPlan = function() {
                var a, b;
                return a = this.organization.get("plan"), this.$(".plan-tips-wrap").html(a.days <= 31 ? m({_organizaitonId: this.organization.id,days: a.days,hasRight: this.organization.hasRight(),projectsCount: null != (b = this.organizationProjects) ? b.length : void 0}) : ""), this
            }, k.prototype.renderOverdue = function() {
                return this.requestSubView(w).open(i, {_organizationId: this.organization.id}), this
            }, k.prototype.renderExpiring = function() {
                return this.requestSubView(g, {_organizationId: this.organization.id}), this
            }, k.prototype.switchTo = function(a) {
                return this.$(".organization-nav li").removeClass("active"), this.$(".organization-nav-" + a).addClass("active"), this
            }, k.prototype.enterProjects = function() {
                var a;
                try {
                    mixpanel.track("projects manager")
                } catch (b) {
                    a = b
                }
                return this.switchTo("projects"), this.navigateTo("/projects", {trigger: !1}), this.renderProjects(), this
            }, k.prototype.enterMembers = function(a) {
                var b;
                try {
                    mixpanel.track("members manager")
                } catch (c) {
                    b = c
                }
                return this.switchTo("members"), this.navigateTo("/members", {trigger: !1}), a && this.organization.hasRight() >= 0 ? this.renderMember(a) : this.renderMembers(), this
            }, k.prototype.enterTeams = function(a) {
                var b;
                if (!(this.organization.hasRight() >= 0))
                    return this.enterProjects();
                try {
                    mixpanel.track("teams manager")
                } catch (c) {
                    b = c
                }
                return this.switchTo("teams"), this.navigateTo("/teams", {trigger: !1}), a ? this.renderTeam(a) : this.renderTeams(), this
            }, k.prototype.enterStatistics = function() {
                var a;
                if (!(this.organization.hasRight() >= 0))
                    return this.enterProjects();
                try {
                    mixpanel.track("organization statistics")
                } catch (b) {
                    a = b
                }
                return this.switchTo("statistics"), this.navigateTo("/statistics", {trigger: !1}), this.renderStatistics(), this
            }, k.prototype.onTabClick = function(a) {
                var b;
                if (a.preventDefault(), b = this.$(a.target).attr("data-tab-name"), b === this.currentTabName && ("teams" !== b || !this.isInTeamView))
                    return this;
                switch (b) {
                    case "projects":
                        return this.enterProjects();
                    case "teams":
                        return this.enterTeams();
                    case "members":
                        return this.enterMembers();
                    case "statistics":
                        return this.enterStatistics();
                    case "setting":
                        return this.openOrganizationSettings()
                }
            }, k.prototype.renderProjects = function() {
                var a;
                return this.isInTeamView = !1, null != (a = this.projectsManagerView) && a.remove(), this.projectsManagerView = this.requestSubView(o, {organization: this.organization,hasOrgRight: this.organization.hasRight()}), this.projectsManagerView.$el.appendTo(this.$organizationTabContent.empty())
            }, k.prototype.renderTeams = function() {
                var a;
                return this.isInTeamView = !1, null != (a = this.teamsManagerView) && a.remove(), this.teamsManagerView = this.requestSubView(t, {organizationModel: this.organization,onTeamClick: function(a) {
                    return function(b) {
                        return a.renderTeam(b.id)
                    }
                }(this)}), this.teamsManagerView.$el.appendTo(this.$organizationTabContent.empty())
            }, k.prototype.renderTeam = function(a) {
                var b;
                try {
                    mixpanel.track("team manager")
                } catch (c) {
                    b = c
                }
                return this.isInTeamView = !0, this.requestSubView(r, {_teamId: a,organizationModel: this.organization,onBackToTeamsClick: function(a) {
                    return function() {
                        return a.navigateTo("/teams", {trigger: !0})
                    }
                }(this)}).$el.appendTo(this.$organizationTabContent.empty()), this.navigateTo("/teams/" + a, {trigger: !1})
            }, k.prototype.renderMembers = function() {
                var a;
                return this.isInTeamView = !1, null != (a = this.membersManagerView) && a.remove(), this.membersManagerView = this.requestSubView(f, {organizationModel: this.organization,onMemberClick: function(a) {
                    return function(b) {
                        return a.organization.hasRight() >= 0 ? a.renderMember(b.id) : void 0
                    }
                }(this)}), this.membersManagerView.$el.appendTo(this.$organizationTabContent.empty())
            }, k.prototype.renderMember = function(a) {
                var b;
                try {
                    mixpanel.track("member manager")
                } catch (c) {
                    b = c
                }
                return this.isInMemberView = !0, this.requestSubView(d, {_memberId: a,organizationModel: this.organization,onBackToMembersClick: function(a) {
                    return function() {
                        return a.navigateTo("/members", {trigger: !0})
                    }
                }(this)}).$el.appendTo(this.$organizationTabContent.empty()), this.navigateTo("/members/" + a, {trigger: !1})
            }, k.prototype.renderStatistics = function() {
                var a;
                return this.isInTeamView = !1, null != (a = this.statisticsView) && a.remove(), this.statisticsView = this.requestSubView(q, {organization: this.organization,hasOrgRight: this.organization.hasRight()}), this.statisticsView.$el.appendTo(this.$organizationTabContent.empty())
            }, k.prototype.renderGuide = function() {
                return (this.organization.get("isNew") || x.router.getUrl().match(/form=business/i)) && (this.organization.unset("isNew", {silent: !0}), this.requestSubView(w).open(h, {organizationModel: this.organization})), this
            }, k.prototype.openOrganizationSettings = function() {
                return this.requestSubView(w).open(j, {organizationModel: this.organization}), this
            }, k.prototype.openProjectsExportTransfer = function() {
                var a, b;
                return a = l.get(0).getOrganizationsByRight(2), b = _.pluck(a, "id"), b.push(0), this.requestSubView(w).open(p, {sourceId: this.organization.id,targetIds: b}), this
            }, k.prototype.refreshProjectsCount = function() {
                return this.$(".projects-count").html(this.organizationProjects.length), this
            }, k.prototype.refreshMembersCount = function() {
                return this.$(".members-count").html(this.organizationMembers.length), this
            }, k.prototype.refreshTeamsCount = function() {
                return this.$(".teams-count").html(this.organizationTeams.length), this
            }, k.prototype.refreshPlanTip = function() {
                return this.organizationProjects.length || this.$(".export-projects").hide(), this
            }, k.prototype.navigateTo = function(a, b) {
                var c;
                return c = "/organization/" + this.organization.get("_id"), a && (c += a), x.router.navigate(c, b), this
            }, k.prototype.remove = function() {
                return $(document).off("scroll.organization-auto-nav"), k.__super__.remove.apply(this, arguments)
            }, k
        }(v)
    }), define("views/portal/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<ul class="project-category"> <li class="project-category-item no-project"> <header class="project-category-header"> <div class="project-category-title">星标项目</div> <hr> </header> <ul class="projects clearfix flagged-projects"></ul> </li> ', d = a;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += " ", "null" == e._id ? c += ' <li class="project-category-item personal"> <header class="project-category-header"> <div class="project-category-title">个人项目</div> <hr> </header> <ul class="projects clearfix organization-null"></ul> </li> ' : (c += ' <li class="project-category-item organization"> <header class="project-category-header"> <div class="project-category-title"> ' + b(e.name) + " ", e.hasRight > -1 && (c += '· <a class="navigate-to-organization-handler" data-id="' + e._id + '"> 组织首页 <span class="icon icon-chevron-right"></span> </a> '), c += ' </div> <hr> </header> <ul class="projects clearfix organization-' + e._id + '"></ul> <div class="placeholder muted"> ', c += e.isOverdue ? ' 该组织已经到期，请尽快续费 <a href="http://pay.teambition.com/confirm_order?_organizationId=' + e._id + '" class="organization-pay-link" target="_blank">立即付款</a> ' : ' <a class="create-project-handler" data-id="' + e._id + '"> <span class="icon icon-plus"></span> 新建项目 </a> ', c += " </div> </li> "), c += " ";
            return c += ' <li class="project-category-item"> <header class="project-category-header"> <div class="project-category-title"> 已归档的项目・ <a class="archived-projects-toggler">显示</a> </div> <hr> </header> <ul class="projects clearfix archived-projects"></ul> </li></ul>'
        }
    }), define("views/portal/templates/divider", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="divider"> <div class="divider-title">' + b(a.name) + "</div></li>";
            return c
        }
    }), define("views/portal/templates/project", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = "";
            return a.isArchived ? c += ' <li class="project archived-project card pull-left" data-id="' + a._id + '" style="background-image:url(' + a.logo + ')"> <div class="project-info"> <h3 class="project-name">' + b(a.name) + '</h3> <p class="project-desc">' + b(a.description) + '</p> </div> <a class="unarchive-project-handler"> <span class="icon icon-repeat"></span> </a> </li>' : (c += ' <li class="project active-project card pull-left ', a.isStar && (c += "flagged"), c += '" data-id="' + a._id + '" style="background-image:url(' + a.logo + ')"> <div class="project-info"> <div> <div class="edit-set pull-right"> ', a.hasRight >= 0 && (c += ' <a class="icon icon-pencil edit-handler" data-gta="event" data-label="portal||to edit project"></a> '), c += ' <a class="icon icon-star flag-handler" data-gta="event" data-label="star project"></a> </div> <h3 class="project-name">' + b(a.name) + '</h3> </div> <p class="project-desc">' + b(a.description) + "</p> </div> ", a.isPublic && (c += ' <span class="label public-label">公开</span> '), c += " ", a.isOverdue && (c += ' <div class="is-overdue"> <hr /> <div class="lock-wrap"> <span class="icon icon-lock2"></span> </div> </div> '), c += " </li>"), c
        }
    });
    var e = function(a, b) {
        return function() {
            return a.apply(b, arguments)
        }
    }, a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/portal/index", ["require", "exports", "module", "teambition", "util", "view", "collections/organizations", "collections/projects", "lib/confirm/index", "views/organization/organization-overdue/index", "views/project/project-creator/index", "views/settings/project-settings/index", "lib/window/index", "./templates/basic", "./templates/divider", "./templates/project", "jquery.cookie"], function(a) {
        var c, d, f, g, h, i, j, k, l, m, n, o, p, q, r;
        return q = a("teambition"), n = a("util"), o = a("view"), h = a("collections/organizations"), m = a("collections/projects"), d = a("lib/confirm/index"), g = a("views/organization/organization-overdue/index"), j = a("views/project/project-creator/index"), k = a("views/settings/project-settings/index"), p = a("lib/window/index"), c = a("./templates/basic"), f = a("./templates/divider"), l = a("./templates/project"), r = a("jquery.cookie"), i = function(a) {
            function i() {
                return this.toggleArchivedProjects = e(this.toggleArchivedProjects, this), i.__super__.constructor.apply(this, arguments)
            }
            return b(i, a), i.prototype.viewName = "PortalView", i.prototype.className = "portal-view fade", i.prototype.title = "myProject", i.prototype.archivedProjectsShown = !1, i.prototype.events = {"click .active-project": "enterProject","click .archived-project": "unarchiveProject","click .edit-handler": "editProject","click .flag-handler": "flagProject","click .navigate-to-organization-handler": "navigateToOrganization","click .archived-projects-toggler": "toggleArchivedProjects","click .create-project-handler": "openProjectCreator"}, i.prototype.initialize = function() {
                return this.projectsCollection = m.get(0), this.projectsArchivedCollection = m.get("archived_0"), this.organizationsCollection = h.get(0), this.renderBasic(), this.renderContent(), this.listen(), this.setupPlaceholder(this.projectsCollection, "project"), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this
            }, i.prototype.listen = function() {
                return this.listenTo(this.projectsCollection, "add remove", this.renderContent), this.listenTo(this.projectsArchivedCollection, "add remove", function(a) {
                    return function() {
                        return a.archivedProjectsShown ? a.renderArchiveProjects() : void 0
                    }
                }(this)), this.listenTo(this.projectsCollection, "change", this.refreshProject), this.listenTo(this.projectsCollection, "change:isArchived", function(a) {
                    return function(b, c) {
                        return c ? (a.projectsCollection.remove(b), a.projectsArchivedCollection.add(b)) : void 0
                    }
                }(this)), this.listenTo(this.projectsArchivedCollection, "change:isArchived", function(a) {
                    return function(b, c) {
                        return c ? void 0 : (a.projectsArchivedCollection.remove(b), a.projectsCollection.add(b))
                    }
                }(this)), this.listenTo(this.projectsCollection, "change:_organizationId", function() {
                    return this.renderBasic(), this.renderContent()
                }), this
            }, i.prototype.renderBasic = function() {
                var a;
                return a = this.assembleData(), this.$el.html(c(a)), this.$projects = this.$(".projects:not(.archived-projects)"), this.$projectArchivedContent = this.$(".archived-projects"), this.$flaggedProjects = this.$(".flagged-projects"), this
            }, i.prototype.renderContent = function() {
                var a;
                return a = this.assembleData(), this.projectsCollection.length && this.renderProjects(a), this.checkFlagged(), this.checkOrganizationProjects(), this
            }, i.prototype.assembleData = function() {
                var a, b;
                return a = [], b = this.projectsCollection.groupBy(function(a) {
                    return function(b) {
                        var c;
                        return c = b.get("_organizationId"), c && !a.organizationsCollection.get(c) && b.get("organization") && a.organizationsCollection.add(b.get("organization")), c || null
                    }
                }(this)), this.organizationsCollection.each(function() {
                    return function(c) {
                        var d, e;
                        return d = c.toJSON(), d.isOverdue = c.isOverdue(), d.projects = b[c.id] || [], (e = c.get("projectIds")) && d.projects.sort(function(a, b) {
                            return (e.indexOf(a.id) + 1 || 999) - (e.indexOf(b.id) + 1 || 999)
                        }), a.push(d)
                    }
                }(this)), a = _.sortBy(a, function() {
                    return function(a) {
                        return a.name
                    }
                }(this)), a.unshift({_id: "null",projects: b["null"]}), a
            }, i.prototype.renderProjects = function(a) {
                var b;
                return this.$projects.empty(), _.each(this.projectsCollection.getStarProjects(), function(a) {
                    return function(b) {
                        var c;
                        return c = b.toJSON(), c.isOverdue = b.isOverdue(), $(l(c)).addClass("flagged").appendTo(a.$flaggedProjects)
                    }
                }(this)), b = this.projectsCollection.getSelfProjectCount(), _.each(a, function(a) {
                    return function(b) {
                        return _.each(b.projects, function(b) {
                            return b.hasRight() >= 0 ? a.renderProject(b) : void 0
                        }), "null" !== b._id ? _.delay(function() {
                            return a.renderDivider(b)
                        }) : void 0
                    }
                }(this)), this
            }, i.prototype.renderDivider = function(a) {
                var b, c, d;
                return b = this.$(".organization-" + a._id), c = a.dividers || [], d = a.projectIds || [], _.each(c, function() {
                    return function(a, e) {
                        var g, h, i, j, k, l;
                        for (i = function(a) {
                            return b.find(".project[data-id=" + d[a] + "]")
                        }, k = a.pos, j = (null != (l = c[e + 1]) ? l.pos : void 0) || d.length - 1, h = i(k); !h.length && ++k < j; )
                            h = i(k);
                        return h.length ? (g = $(f({name: a.name})), g.insertBefore(h)) : void 0
                    }
                }(this)), b.children().first().hasClass("divider") && b.closest(".organization").addClass("first-divider"), this
            }, i.prototype.renderArchiveProjects = function() {
                return this.$projectArchivedContent.empty(), this.projectsArchivedCollection.each(function(a) {
                    return function(b) {
                        return a.$projectArchivedContent.append(l(b.toJSON()))
                    }
                }(this)), this
            }, i.prototype.renderProject = function(a) {
                var b, c, d, e;
                return e = a.get("_organizationId"), b = this.$(".organization-" + e), d = a.toJSON(), d.isOverdue = a.isOverdue(), c = $(l(d)), b.append(c), this
            }, i.prototype.removeProject = function(a) {
                return this.$("[data-id=" + a.id + "]").remove(), this
            }, i.prototype.refreshProject = function(a) {
                var b;
                return "isStar" in a.changed ? this.renderFlag(a) : (b = a.toJSON(), b.isOverdue = a.isOverdue(), this.$("[data-id=" + a.id + "]").replaceWith(l(b))), this
            }, i.prototype.enterProject = function(a) {
                var b, c;
                return b = $(a.currentTarget).data("id"), c = this.projectsCollection.get(b), c.isOverdue() ? this.requestSubView(p).open(g, {_organizationId: c.get("_organizationId")}) : q.router.navigate("project/" + b + "/" + c.getFirstApp(), {trigger: !0}), this
            }, i.prototype.editProject = function(a) {
                var b, c;
                return b = $(a.currentTarget).closest(".project").data("id"), c = this.projectsCollection.get(b), this.requestSubView(p).open(k, {projectModel: c}), !1
            }, i.prototype.flagProject = function(a) {
                var b, c;
                return b = $(a.currentTarget).closest(".project").data("id"), c = this.projectsCollection.get(b), c.toggleStar({success: function() {
                    return function(a) {
                        return Essage.show({message: a.isStar ? "星标成功，该项目会在您的星标项目中" : "取消星标成功",status: "success"}, 2e3)
                    }
                }(this)}), !1
            }, i.prototype.renderFlag = function(a) {
                var b, c, d;
                return c = a.get("isStar"), d = ".project[data-id=" + a.id + "]", c ? (b = this.$projects.find(d), this.$flaggedProjects.append(b.clone().addClass("animation")), this.checkFlagged()) : (b = this.$flaggedProjects.find(d), b.transition({scale: .5,opacity: 0}, 300, function(a) {
                    return function() {
                        return b.remove(), a.checkFlagged()
                    }
                }(this))), this.$(d)[c ? "addClass" : "removeClass"]("flagged"), this
            }, i.prototype.openOrganizationSettings = function(a) {
                return this.requestSubView(p).open(OrganizationSettingsView, {_organizationId: $(a.currentTarget).data("id")}), this
            }, i.prototype.navigateToOrganization = function(a) {
                var b;
                return b = $(a.currentTarget).data("id"), q.router.navigate("/organization/" + b + "/projects", {trigger: !0}), this
            }, i.prototype.checkFlagged = function() {
                return this.$flaggedProjects.parent()[this.$flaggedProjects.children().length ? "removeClass" : "addClass"]("no-project"), this
            }, i.prototype.checkOrganizationProjects = function() {
                return this.$(".organization").each(function() {
                    var a;
                    return a = $(this), 0 === a.find(".project").length ? a.addClass("no-organization-project") : a.removeClass("no-organization-project")
                })
            }, i.prototype.loadArchivedProjects = function(a) {
                var b;
                return b = _.extend({success: function() {
                    return function() {
                    }
                }(this),beforeSend: function() {
                    return function() {
                    }
                }(this),error: function() {
                    return function() {
                    }
                }(this),attrs: {isArchived: !0}}, a), m.fetch("archived_0", b), this
            }, i.prototype.toggleArchivedProjects = function(a) {
                return this.archivedProjectsShown ? (this.$projectArchivedContent.empty(), $(a.currentTarget).text("显示"), this.archivedProjectsShown = !1) : ($(a.currentTarget).text("隐藏"), this.loadArchivedProjects({success: function(a) {
                    return function() {
                        return a.archivedProjectsShown = !0, a.renderArchiveProjects()
                    }
                }(this)}))
            }, i.prototype.unarchiveProject = function(a) {
                var b;
                return (b = this.projectsArchivedCollection.get($(a.currentTarget).data("id"))) ? this.requestSubView(d, {title: "重新激活项目",description: "重新激活项目后，您就可以正常使用该项目了",onConfirm: function() {
                    return function() {
                        return b.save(null, {attrs: {isArchived: !1},success: function() {
                            return Essage.show({message: "项目已经成功重新激活.",status: "success"}, 2e3)
                        },error: function() {
                            return Essage.show({message: "抱歉，我们未能重新激活该项目，请稍后重试.",status: "error"})
                        }})
                    }
                }(this)}) : void 0
            }, i.prototype.openProjectCreator = function(a) {
                var b, c;
                return b = this.$(a.target), c = b.data("id"), this.requestSubView(p).open(j, {_organizationId: c}), this
            }, i
        }(o)
    }), define("views/review/review/templates/review", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="review-member-wrap" data-id="' + a.executor._id + '"> <div class="review-member clearfix"> <span class="avatar img-circle img-36" style="background-image:url(' + a.executor.avatarUrl + ')"></span> <span class="member-name">' + b(a.executor.name) + '</span> </div> <ul class="review-activities"> ', d = a.reviews;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <li class="activity ' + e.boundToObjectType + '" data-id="' + e._id + '"> <div class="activity-timeline"> <time class="time-stamp">' + e.createdTime + '</time> </div> <div class="activity-body', "project" == e.boundToObjectType && (c += "-system"), c += ' clearfix" data-object-id="' + e._boundToObjectId + '" data-type="' + e.boundToObjectType + '"> <p class="activity-title">' + b(e.title) + "</p> ", "work" == e.boundToObjectType ? (c += ' <div class="work"> ', c += e.boundToObject.thumbnail ? ' <div class="work-thumbnail image" style="background-image: url(' + e.boundToObject.thumbnail + ');"> </div> ' : ' <div class="work-thumbnail ' + e.boundToObject.fileType + '"> ' + e.boundToObject.thumbnailText + " </div> ", c += ' <div class="attachment-content clearfix"> <p class="attachment-title hinted" data-title="' + e.boundToObject.fileName + '"> ' + b(e.boundToObject.fileName) + ' <span class="attachment-size">(' + e.boundToObject.fileSizeFix + ")</span> </p> </div> </div> ") : c += ' <p class="activity-content">' + b(e.content) + "</p> ", c += ' </div> <div class="activity-arrow-hint"><i class="icon icon-chevron-right"></i></div> </li> ';
            return c += " </ul></div>"
        }
    }), define("views/review/review/templates/basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<header class="review-header body-wrap clearfix"> <a class="dropdown-toggle week-picker-handler pull-left"></a> <div class="content-filter"> ', d = a.shownType;
            if (d)
                for (var e, f = -1, g = d.length - 1; g > f; )
                    e = d[f += 1], c += ' <label class="checkbox-inline checkbox-' + e.attr + " ", e.isHide && (c += "hide"), c += '"> <div class="check-box ', e.isChecked && (c += "active"), c += '" data-type="' + e.attr + '" data-gta="event" data-label="review filte ' + e.attr + '"><span class="icon icon-tick"></span></div> <span>' + e.title + "</span> </label> ";
            c += ' </div></header><div class="review-members scrollable thin-scroll"> <ul class="member-filter"> <li class="member-item active all-members" data-gta="event" data-label="review select all member"> <a> <span class="icon icon-users-bold"></span> <span class="member-name">所有成员</span> </a> </li> ';
            var h = a.members;
            if (h)
                for (var i, j = -1, k = h.length - 1; k > j; )
                    i = h[j += 1], c += ' <li class="member-item member" data-id="' + i._id + '" data-gta="event" data-label="review select member"> <a> <span class="avatar img-circle img-36" style="background-image:url(' + i.avatarUrl + ');"></span> <span class="member-name">' + b(i.name) + "</span> </a> </li> ";
            return c += ' </ul></div><div class="review-content-wrap"> <div class="review-placeholder muted"> <span class="icon icon-review"></span> <br /> 目前还没有动态 </div> <div class="review-content"></div></div>'
        }
    }), define("views/review/review/templates/date", [], function() {
        return function(a) {
            var b = '<div class="review-date-wrap" data-date="' + a.date + '"> <div class="review-date">' + a.dateString + "</div></div>";
            return b
        }
    }), define("views/review/review/templates/week", [], function() {
        return function(a) {
            var b = '<span class="start-date">' + a.startDateString + '</span><span> - </span><span class="end-date">' + a.endDateString + '</span><span class="week"> (' + a.week + ')</span><span class="caret"></span>';
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    }, d = [].indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
            if (b in this && this[b] === a)
                return b;
        return -1
    };
    define("views/review/review/index", ["require", "exports", "module", "teambition", "moment", "lib/scrollable", "util", "view", "models/review", "collections/apps", "collections/members", "collections/projects", "collections/reviews", "collections/works", "views/bookkeeping/entry-detail-panel/index", "views/events/event-detail-panel/index", "views/wall/post-panel/index", "views/library/previewer/index", "./templates/review", "views/board/task/task-detail-panel/index", "views/review/week-picker/index", "lib/window/index", "./templates/basic", "./templates/date", "./templates/week"], function(a) {
        var c, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A;
        return A = a("teambition"), j = a("moment"), r = a("lib/scrollable"), t = a("util"), u = a("view"), o = a("models/review"), c = a("collections/apps"), i = a("collections/members"), m = a("collections/projects"), n = a("collections/reviews"), y = a("collections/works"), g = a("views/bookkeeping/entry-detail-panel/index"), h = a("views/events/event-detail-panel/index"), k = a("views/wall/post-panel/index"), l = a("views/library/previewer/index"), p = a("./templates/review"), s = a("views/board/task/task-detail-panel/index"), v = a("views/review/week-picker/index"), x = a("lib/window/index"), e = a("./templates/basic"), f = a("./templates/date"), w = a("./templates/week"), z = {entry: {attr: "entry",title: "账目",isChecked: !0,isHide: !0},post: {attr: "post",title: "分享",isChecked: !0},work: {attr: "work",title: "文件",isChecked: !0},event: {attr: "event",title: "日程",isChecked: !0},task: {attr: "task",title: "任务",isChecked: !0},project: {attr: "project",title: "系统消息",isChecked: !0}}, q = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.viewName = "ReviewView", c.prototype.tagName = "div", c.prototype.className = "review-view body-wrap fade", c.prototype.events = {"click label.checkbox-inline": "changeFilter","click .member-item": "selectMembers","click .activity-body": "enterDetail","mousewheel .scrollable": t.mousewheel}, c.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this.options = a, this._projectId = a._projectId, this.projectModel = m.getOne(0, this._projectId), this.membersCollection = i.get(this._projectId), this.reviewCollection = n.get(this._projectId), this.allMembers = this.membersCollection.getMemberIds(), this.selectedMembers = [], this.shownType = z, this.renderedDates = [], this.listen().renderBasic().initWeekPicker().renderWeek(), this.load({beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$reviewContent)
                    }
                }(this),success: function(a) {
                    return function() {
                        return a.hideLoadingIndicator({animated: !0}), a.groupActivitiesByDate()
                    }
                }(this)}), this.setupScroll(), this.setupLoadMore(10, !0), this.registerAsResponsive(), _.delay(function(a) {
                    return function() {
                        return a.layout()
                    }
                }(this)), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in")
                    }
                }(this)), this) : void 0
            }, c.prototype.layout = function() {
                return this.$reviewContent.css("min-height", this.$reviewMembers.height() + 5), this
            }, c.prototype.load = function(a) {
                var b, c;
                if (null != (c = this.week) ? c.startDate : void 0)
                    return a || (a = {}), "function" == typeof a.beforeSend && a.beforeSend(), b = "" + this._projectId + "_" + this.week.startDate + "_" + this.week.endDate, n.fetch(b, {boundToObjectType: "",attrs: {_projectId: this._projectId,startDate: this.week.startDate,endDate: this.week.endDate},success: function(b) {
                        return function(c) {
                            return b.$el ? (b.reviewCollection.reset(c.models), "function" == typeof a.success ? a.success() : void 0) : void 0
                        }
                    }(this)}), this
            }, c.prototype.loadMore = function(a, b) {
                var c;
                if (b) {
                    if (c = this.weekPickerView.weeks.indexOf(this.week) - 1, 0 > c)
                        return a()
                } else if (c = this.weekPickerView.weeks.indexOf(this.week) + 1, c >= this.weekPickerView.weeks.length)
                    return a();
                return this.week = this.weekPickerView.weeks[c], this.load({beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$reviewContent, {isPrepend: b})
                    }
                }(this),success: function(c) {
                    return function(d) {
                        return c.$el ? (c.hideLoadingIndicator({animated: !0}), c.groupActivitiesByDate(d, b), a()) : void 0
                    }
                }(this)}), this.weekPickerView.renderSelected(this.week), this.renderWeek(), this
            }, c.prototype.listen = function() {
                return this.listenTo(this.projectModel, "change:navigation", function(a) {
                    return function() {
                        return a.$reviewContent.html(""), a.renderedDates = [], a.groupActivitiesByDate()
                    }
                }(this)), this
            }, c.prototype.renderBasic = function() {
                return this.$el.html(e({members: this.membersCollection.toJSON(),shownType: _.map(this.shownType)})), this.$weekFilter = this.$(".week-picker-handler"), this.$contentFilter = this.$(".content-filter"), this.$reviewMembers = this.$(".review-members"), this.$memberFilter = this.$(".member-filter"), this.$allMembers = this.$(".member-item.all-members"), this.$reviewContent = this.$(".review-content"), this.$reviewPlaceholder = this.$(".review-placeholder"), this
            }, c.prototype.refreshEntryFilter = function() {
                var a;
                return a = this.$(".checkbox-entry"), this.projectModel.get("navigation").bookkeeping >= 0 || this.hasEntry ? a.removeClass("hide") : a.addClass("hide"), this
            }, c.prototype.initWeekPicker = function() {
                return this.weekPickerView = this.requestSubView(v, {projectCreated: this.projectModel.get("created"),onSelectedChange: function(a) {
                    return function(b) {
                        return a.week = b, a.renderWeek(), a.load({beforeSend: function() {
                            return a.showLoadingIndicator(a.$reviewContent, {isPrepend: !0})
                        },success: function() {
                            return a.hideLoadingIndicator(), a.$reviewContent.html(""), a.renderedDates = [], a.groupActivitiesByDate()
                        }})
                    }
                }(this)}), this.weekPickerView.setup(this.$weekFilter), this.week = this.weekPickerView.weeks[0], this
            }, c.prototype.renderWeek = function() {
                return this.$weekFilter.html(w(this.week)), this
            }, c.prototype.groupActivitiesByDate = function(a, b) {
                var c, e;
                return c = {}, a || (a = this.reviewCollection), a.each(function(a) {
                    return function(b) {
                        var e, f, g;
                        return g = a.shownType[b.get("boundToObjectType")], "entry" === g.attr && (a.hasEntry = !0), (null != g ? !g.isChecked : !0) || (f = j(b.get("created")).format("YYYYMMDD"), d.call(a.renderedDates, f) >= 0) ? void 0 : (c[f] || (c[f] = []), b = b.toJSON(), b.createdTime = j(b.created).format("HH:mm"), e = b.boundToObject, "work" === b.boundToObjectType && (e.fileSizeFix = t.formatFileSize(e.fileSize || 0), e.thumbnail || (e.thumbnail = e.thumbnailUrl), e.thumbnailText = e.fileType, /link/.test(e.fileCategory) && (e.thumbnailText = "link"), e.fileName = t.escape(e.fileName)), c[f].push(b))
                    }
                }(this)), e = _.keys(c), e = _.sortBy(e, function(a) {
                    return b ? +a : -a
                }), _.each(e, function(a) {
                    return function(d) {
                        return a.renderedDates.push(d), a.renderActivitiesByMember(d, c[d], b)
                    }
                }(this)), this.refreshEntryFilter(), this.checkPlaceholder(), this
            }, c.prototype.renderActivitiesByMember = function(a, b, c) {
                var d, e;
                return b = _.groupBy(b, function() {
                    return function(a) {
                        return a._creatorId
                    }
                }(this)), e = this.selectedMembers.length ? this.selectedMembers : this.allMembers, d = $("<div></div>"), _.each(e, function(c) {
                    return function(e) {
                        var g, h;
                        return h = c.membersCollection.get(e), b[e] && h ? (g = d.find(".review-date-wrap[data-date=" + a + "]"), g.length || (g = $(f({date: a,dateString: j(a, "YYYYMMDD").format("MMM Do dddd")})).appendTo(d)), $(p({executor: h.toJSON(),reviews: b[e]})).appendTo(g)) : void 0
                    }
                }(this)), d.children()[c ? "prependTo" : "appendTo"](this.$reviewContent), d = null, this
            }, c.prototype.checkPlaceholder = function() {
                return this.$reviewContent.children().length ? this.$reviewPlaceholder.hide() : this.$reviewPlaceholder.show(), this
            }, c.prototype.selectMembers = function(a) {
                var b, c, d;
                return b = $(a.currentTarget), c = b.data("id"), c ? (b.toggleClass("active"), b.hasClass("active") ? this.selectedMembers.push(c) : t.removeItem(this.selectedMembers, c), d = this.selectedMembers.length && this.selectedMembers.length !== this.allMembers.length ? "removeClass" : "addClass", this.$allMembers[d]("active")) : (this.selectedMembers.length || !b.hasClass("active")) && (b.addClass("active"), this.selectedMembers = [], this.$memberFilter.children(".member").removeClass("active")), this.$reviewContent.html(""), this.renderedDates = [], this.groupActivitiesByDate(), this
            }, c.prototype.changeFilter = function(a) {
                var b, c, d;
                return b = $(a.currentTarget).children(".check-box"), b.toggleClass("active"), c = b.data("type"), null != (d = this.shownType[c]) && (d.isChecked = b.hasClass("active")), this.$reviewContent.html(""), this.renderedDates = [], this.groupActivitiesByDate(), this
            }, c.prototype.updateUrl = function(a, b) {
                var c, d, e;
                return b = b || {}, c = a.type, e = a._modelId, d = A.router.getPrefix() + "/review", c && e && (d += "/" + c + "/" + e, a.params && (d += "/" + a.params)), A.router.navigate(d, b), this
            }, c.prototype.enterDetail = function(a) {
                var b, c, d;
                switch (b = $(a.currentTarget), d = b.data("type"), c = b.data("object-id"), d) {
                    case "task":
                        A.APP.showPanel(s, {_projectId: this._projectId,_taskId: c});
                        break;
                    case "event":
                        A.APP.showPanel(h, {_projectId: this._projectId,_eventId: c});
                        break;
                    case "post":
                        A.APP.showPanel(k, {_projectId: this._projectId,_postId: c,membersCollection: this.membersCollection});
                        break;
                    case "work":
                        y.fetchOne(this._projectId, c, {success: function(a) {
                            return function(b) {
                                var c;
                                return c = {_projectId: a._projectId,workModel: b,workModels: [b]}, a.requestSubView(x).open(l, c)
                            }
                        }(this)});
                        break;
                    case "entry":
                        A.APP.showPanel(g, {_entryId: c})
                }
                return this.updateUrl({type: d,_modelId: c}, {trigger: !1}), this
            }, c
        }(u), _.extend(q.prototype, r), q
    }), define("views/tag/entries/templates/basic", [], function() {
        return function() {
            var a = '<h3>账目 ・ <span class="entries-count">0</span></h3><ul class="tag-entries-list"></ul>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/tag/entries/index", ["require", "exports", "module", "teambition", "./templates/basic", "models/bookkeeping", "collections/entries", "views/bookkeeping/entry-detail-panel/index", "views/bookkeeping/entry/index", "thenjs", "view"], function(a) {
        var c, d, e, f, g, h, i, j, k;
        return k = a("teambition"), c = a("./templates/basic"), d = a("models/bookkeeping"), e = a("collections/entries"), f = a("views/bookkeeping/entry-detail-panel/index"), g = a("views/bookkeeping/entry/index"), i = a("thenjs"), j = a("view"), h = function(a) {
            function h() {
                return h.__super__.constructor.apply(this, arguments)
            }
            return b(h, a), h.prototype.viewName = "TagEntriesView", h.prototype.className = "tag-entries-view fade", h.prototype.events = {"click .open-detail": "openDetail"}, h.prototype.initialize = function(a) {
                return this.tagModel = a.tagModel, this.entriesCollection = e.get("tag_" + this.tagModel.id), this.bookkeepingModel = new d, this.load({success: function(b) {
                    return function() {
                        return b.listen().renderBasic().renderItems().refreshCount(), "function" == typeof a.onFinish ? a.onFinish() : void 0
                    }
                }(this),error: function() {
                    return "function" == typeof a.onFinish ? a.onFinish() : void 0
                }}), this
            }, h.prototype.load = function(a) {
                return i(function(a) {
                    return function(b) {
                        return a.tagModel.fetchRelation("entries", {success: function(c) {
                            return a.entriesCollection.reset(c), b()
                        },error: function(a, c) {
                            return b(c)
                        }})
                    }
                }(this)).then(function() {
                    return function() {
                        return null != a && "function" == typeof a.success ? a.success() : void 0
                    }
                }(this)).fail(function() {
                    return function() {
                        return null != a && "function" == typeof a.error ? a.error() : void 0
                    }
                }(this))
            }, h.prototype.listen = function() {
                return this.listenTo(this.entriesCollection, "add", this.renderItems), this.listenTo(this.entriesCollection, "remove", this.removeItem), this.listenTo(this.entriesCollection, "change:tagIds", function(a) {
                    return function(b, c) {
                        return (null != c ? c.indexOf(a.tagModel.id) : void 0) >= 0 ? void 0 : a.entriesCollection.remove(b)
                    }
                }(this)), this
            }, h.prototype.renderBasic = function() {
                return this.$el.html(c()).hide(), this.$list = this.$(".tag-entries-list"), this
            }, h.prototype.renderItems = function(a) {
                var b;
                return a ? (_.isArray(a) || (a = [a]), b = !0) : (this.$list.empty(), a = this.entriesCollection.toJSON()), _.each(a, function(a) {
                    return function(c) {
                        return a.renderItem(c, b)
                    }
                }(this)), this.refreshCount(), this
            }, h.prototype.renderItem = function(a, b) {
                var c, d, e;
                return e = a.id || a._id || a, c = this.requestSubView(g, {_entryId: e,displayFields: this.bookkeepingModel.getFields(["category", "content"]),viewType: "open-detail"}).$el, d = this.$(".entry-view[data-id=" + e + "]"), d.length ? d.replaceWith(c) : this.$list[b ? "prepend" : "append"](c), this
            }, h.prototype.removeItem = function(a) {
                var b, c;
                return c = a.id || a._id || a, b = this.$(".entry-view[data-id=" + c), b.remove(), this.refreshCount(), this
            }, h.prototype.refreshCount = function() {
                var a;
                return a = this.entriesCollection.length, this.tagModel.set("entriesCount", a), this.$(".entries-count").text(a), a ? this.$el.show().addClass("in") : this.$el.hide(), this
            }, h.prototype.openDetail = function(a) {
                var b, c;
                return (null != a ? a.currentTarget : void 0) ? (b = $(a.currentTarget), c = b.data("id")) : c = a, c ? (k.APP.showPanel(f, {_entryId: c}), this) : void 0
            }, h
        }(j)
    }), define("views/tag/events/templates/basic", [], function() {
        return function() {
            var a = '<h3>日程 ・ <span class="events-count">0</span></h3>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/tag/events/index", ["require", "exports", "module", "teambition", "./templates/basic", "collections/events", "views/events/events-list/index", "view"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("./templates/basic"), e = a("collections/events"), d = a("views/events/events-list/index"), g = a("view"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "TagEventsView", f.prototype.className = "tag-events-view fade", f.prototype.initialize = function(a) {
                return this.tagModel = a.tagModel, this.eventsCollection = e.get("tag_" + this.tagModel.id), this.renderBasic(), this.tagModel.fetchRelation("events", {success: function(b) {
                    return function(c) {
                        return b.$el ? (b.eventsCollection.reset(c), b.requestSubView(d, {groupBy: !1,eventsCollection: b.eventsCollection}).$el.appendTo(b.$el), b.refreshCount(), b.eventsCollection.length && b.$el.show().addClass("in"), b.listen(), "function" == typeof a.onFinish ? a.onFinish() : void 0) : void 0
                    }
                }(this),error: function() {
                    return "function" == typeof a.onFinish ? a.onFinish() : void 0
                }}), this
            }, f.prototype.renderBasic = function() {
                return this.$el.html(c()).hide(), this
            }, f.prototype.listen = function() {
                return this.listenTo(this.eventsCollection, "add remove", this.refreshCount), this.listenTo(this.eventsCollection, "change:tagIds", function(a) {
                    return function(b, c) {
                        return (null != c ? c.indexOf(a.tagModel.id) : void 0) >= 0 ? void 0 : a.eventsCollection.remove(b)
                    }
                }(this)), this
            }, f.prototype.refreshCount = function() {
                return this.tagModel.set("eventsCount", this.eventsCollection.length), this.$(".events-count").text(this.eventsCollection.length), this
            }, f
        }(g)
    }), define("views/tag/works/templates/basic", [], function() {
        return function() {
            var a = '<h3>文件 ・ <span class="works-count">0</span></h3>';
            return a
        }
    }), define("views/work/work-list/templates/list-basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="work" data-id="' + a._id + '"> ';
            return c += a.thumbnail ? ' <div class="work-thumbnail pull-left" style="background-image: url(' + a.thumbnail + ');"> </div> ' : ' <div class="work-thumbnail ' + a.fileType + ' pull-left">' + a.thumbnailText + "</div> ", c += ' <span class="work-title">' + b(a.fileName) + '</span> <div class="work-info muted"> ' + a.creator.name + '上传于 <time datetime="' + a.created + '"></time> </div></li>'
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/work/work-list/index", ["require", "exports", "module", "./templates/list-basic", "collections/members", "moment", "views/library/previewer/index", "util", "view", "lib/window/index"], function(a) {
        var c, d, e, f, g, h, i, j;
        return c = a("./templates/list-basic"), d = a("collections/members"), e = a("moment"), f = a("views/library/previewer/index"), g = a("util"), h = a("view"), i = a("lib/window/index"), j = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "WorkListView", e.prototype.tagName = "ul", e.prototype.className = "work-list-view", e.prototype.events = {"click .work": "openDetail"}, e.prototype.initialize = function(a) {
                return (null != a ? a.worksCollection : void 0) && a._projectId ? (this.options = a, this._projectId = a._projectId, this.worksCollection = a.worksCollection, d.fetch(this._projectId, {success: function(a) {
                    return function(b) {
                        return a.membersCollection = b, a.renderBasic().listen()
                    }
                }(this)}), this) : void 0
            }, e.prototype.listen = function() {
                return this.listenTo(this.worksCollection, "add change", function(a) {
                    return function(b) {
                        return a.renderWork(b, !0)
                    }
                }(this)), this.listenTo(this.worksCollection, "remove destroy", this.removeWork), this
            }, e.prototype.renderBasic = function() {
                return this.worksCollection.each(function(a) {
                    return function(b) {
                        return a.renderWork(b)
                    }
                }(this)), this
            }, e.prototype.renderWork = function(a, b) {
                var d, e;
                return d = this.$(".work[data-id=" + a.id + "]"), e = $(c(this.getData(a))), d.length ? d.replaceWith(e) : this.$el[b ? "prepend" : "append"](e), e.find("time").timesince(), this
            }, e.prototype.removeWork = function(a) {
                return this.$(".work[data-id=" + a.id + "]").remove(), this
            }, e.prototype.getData = function(a) {
                var b, c, d;
                return b = a.toJSON(), b.creator = (null != (d = this.membersCollection.get(b._creatorId)) ? d.toJSON() : void 0) || {}, (c = b.creator).name || (c.name = "未知"), b.fileSizeFix = g.formatFileSize(b.fileSize || 0), b.thumbnailText = b.fileType, /link/.test(b.fileCategory) && (b.thumbnailText = "link"), b
            }, e.prototype.openDetail = function(a) {
                var b;
                return b = this.worksCollection.get($(a.currentTarget).data("id")), this.requestSubView(i).open(f, {_projectId: this._projectId,workModel: b,workModels: this.worksCollection.models}), this
            }, e
        }(h)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/tag/works/index", ["require", "exports", "module", "teambition", "./templates/basic", "view", "collections/works", "views/work/work-list/index"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("./templates/basic"), e = a("view"), g = a("collections/works"), f = a("views/work/work-list/index"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "TagWorksView", d.prototype.className = "tag-works-view fade", d.prototype.initialize = function(a) {
                return this.tagModel = a.tagModel, this.worksCollection = g.get("tag_" + this.tagModel.id), this.renderBasic(), this.tagModel.fetchRelation("works", {success: function(b) {
                    return function(c) {
                        return b.$el ? (b.worksCollection.reset(c), b.requestSubView(f, {_projectId: b.tagModel.get("_projectId"),worksCollection: b.worksCollection}).$el.appendTo(b.$el), b.refreshCount(), b.worksCollection.length && b.$el.show().addClass("in"), b.listen(), "function" == typeof a.onFinish ? a.onFinish() : void 0) : void 0
                    }
                }(this),error: function() {
                    return "function" == typeof a.onFinish ? a.onFinish() : void 0
                }}), this
            }, d.prototype.renderBasic = function() {
                return this.$el.html(c()).hide(), this
            }, d.prototype.listen = function() {
                return this.listenTo(this.worksCollection, "add remove", this.refreshCount), this.listenTo(this.worksCollection, "change:tagIds", function(a) {
                    return function(b, c) {
                        return (null != c ? c.indexOf(a.tagModel.id) : void 0) >= 0 ? void 0 : a.worksCollection.remove(b)
                    }
                }(this)), this
            }, d.prototype.refreshCount = function() {
                return this.tagModel.set("worksCount", this.worksCollection.length), this.$(".works-count").text(this.worksCollection.length), this
            }, d
        }(e)
    }), define("views/tag/posts/templates/basic", [], function() {
        return function() {
            var a = '<h3>分享 ・ <span class="posts-count">0</span></h3>';
            return a
        }
    }), define("views/wall/post-list/templates/list-basic", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="post" data-id="' + a._id + '"> <span class="post-title" >' + b(a.description) + '</span> <div class="post-info muted"> ' + a.creator.name + '发布于 <time datetime="' + a.created + '"></time> </div></li>';
            return c
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/wall/post-list/index", ["require", "exports", "module", "teambition", "./templates/list-basic", "collections/members", "views/wall/post-panel/index", "view"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("./templates/list-basic"), d = a("collections/members"), f = a("views/wall/post-panel/index"), g = a("view"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "PostListView", e.prototype.tagName = "ul", e.prototype.className = "post-list-view", e.prototype.events = {"click .post": "openDetail"}, e.prototype.initialize = function(a) {
                return (null != a ? a.postsCollection : void 0) && a._projectId ? (this.options = a, this._projectId = a._projectId, this.postsCollection = a.postsCollection, d.fetch(this._projectId, {success: function(a) {
                    return function(b) {
                        return a.membersCollection = b, a.renderBasic().listen()
                    }
                }(this)}), this) : void 0
            }, e.prototype.listen = function() {
                return this.listenTo(this.postsCollection, "add change", function(a) {
                    return function(b) {
                        return a.renderPost(b, !0)
                    }
                }(this)), this.listenTo(this.postsCollection, "remove destroy", this.removePost), this
            }, e.prototype.renderBasic = function() {
                return this.postsCollection.each(function(a) {
                    return function(b) {
                        return a.renderPost(b)
                    }
                }(this)), this
            }, e.prototype.renderPost = function(a, b) {
                var d, e, f, g;
                return e = this.$(".post[data-id=" + a.id + "]"), f = a.toJSON(), f.creator = null != (g = this.membersCollection.get(f._creatorId)) ? g.toJSON() : void 0, f.creator || (f.creator = {_id: "",avatarUrl: "",name: "未知"}), d = $(c(f)), e.length ? e.replaceWith(d) : this.$el[b ? "prepend" : "append"](d), d.find("time").timesince(), this
            }, e.prototype.removePost = function(a) {
                return this.$(".post[data-id=" + a.id + "]").remove(), this
            }, e.prototype.openDetail = function(a) {
                var b;
                return b = this.postsCollection.get($(a.currentTarget).data("id")), h.APP.showPanel(f, {_projectId: this._projectId,postModel: b,rightOffset: this.options.rightOffset}), this
            }, e
        }(g)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/tag/posts/index", ["require", "exports", "module", "teambition", "./templates/basic", "collections/posts", "views/wall/post-list/index", "view"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("./templates/basic"), e = a("collections/posts"), d = a("views/wall/post-list/index"), g = a("view"), f = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "TagPostsView", f.prototype.className = "tag-posts-view fade", f.prototype.initialize = function(a) {
                return this.tagModel = a.tagModel, this.postsCollection = e.get("tag_" + this.tagModel.id), this.renderBasic(), this.tagModel.fetchRelation("posts", {success: function(b) {
                    return function(c) {
                        return b.$el ? (b.postsCollection.reset(c), b.requestSubView(d, {_projectId: b.tagModel.get("_projectId"),postsCollection: b.postsCollection}).$el.appendTo(b.$el), b.refreshCount(), b.postsCollection.length && b.$el.show().addClass("in"), b.listen(), "function" == typeof a.onFinish ? a.onFinish() : void 0) : void 0
                    }
                }(this),error: function() {
                    return "function" == typeof a.onFinish ? a.onFinish() : void 0
                }}), this
            }, f.prototype.renderBasic = function() {
                return this.$el.html(c()).hide(), this
            }, f.prototype.listen = function() {
                return this.listenTo(this.postsCollection, "add remove", this.refreshCount), this.listenTo(this.postsCollection, "change:tagIds", function(a) {
                    return function(b, c) {
                        return (null != c ? c.indexOf(a.tagModel.id) : void 0) >= 0 ? void 0 : a.postsCollection.remove(b)
                    }
                }(this)), this
            }, f.prototype.refreshCount = function() {
                return this.tagModel.set("postsCount", this.postsCollection.length), this.$(".posts-count").text(this.postsCollection.length), this
            }, f
        }(g)
    }), define("views/tag/tag-creator/templates/basic", [], function() {
        return function() {
            var a = '<input class="add-input form-control" placeholder="标签名称"/><ul class="clearfix"> <li class="tag-label tag-label-red" data-color="red"> <span class="icon icon-tick icon-white"></span></li> <li class="tag-label tag-label-yellow" data-color="yellow"> <span class="icon icon-tick icon-white"></span></li> <li class="tag-label tag-label-green" data-color="green"> <span class="icon icon-tick icon-white"></span></li> <li class="tag-label tag-label-blue" data-color="blue"> <span class="icon icon-tick icon-white"></span></li> <li class="tag-label tag-label-purple" data-color="purple"> <span class="icon icon-tick icon-white"></span></li> <li class="tag-label tag-label-gray" data-color="gray"> <span class="icon icon-tick icon-white"></span></li></ul><button class="btn btn-primary submit-handler">创建</button>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/tag/tag-creator/index", ["require", "exports", "module", "./templates/basic", "lib/popover/index"], function(a) {
        var c, d, e;
        return c = a("./templates/basic"), d = a("lib/popover/index"), e = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "TagCreatorView", d.prototype.className = "tag-creator-view", d.prototype.popoverTitle = "新建标签", d.prototype.events = {"click .tag-label": "changeLabel","click .submit-handler": "submit"}, d.prototype.render = function() {
                return this.$el.html(c()), this.color && this.$(".tag-label-" + this.color).addClass("active"), this.$input = this.$("input"), this
            }, d.prototype.changeLabel = function(a) {
                var b;
                return b = $(a.currentTarget), b.addClass("active").siblings().removeClass("active"), this.color = b.data("color"), this
            }, d.prototype.submit = function() {
                var a;
                return (a = this.$input.val().trim()) ? (this.options.tagsCollection.create({_projectId: this.options._projectId,name: a,color: this.color || "gray"}, {wait: !0,success: function(a) {
                    return function() {
                        return a.$input.val(""), a.remove()
                    }
                }(this)}), this) : void 0
            }, d
        }(d)
    }), define("views/tag/tag-menu/templates/basic", [], function() {
        return function(a) {
            var b = '<ul class="list"> <li> <a class="edit-handler" data-gta="event" data-label="edit tag"> <span class="icon icon-pencil"></span>编辑标签 </a> </li> <li> ';
            return b += a.isArchived ? ' <a class="unarchive-handler" data-gta="event" data-label="unarchive tag"> <span class="icon icon-archive"></span>取消归档 </a> ' : ' <a class="archive-handler" data-gta="event" data-label="archive tag"> <span class="icon icon-archive"></span>归档标签 </a> ', b += ' </li> <li> <a class="delete-handler" data-gta="event" data-label="delete tag"> <span class="icon icon-trash"></span>删除标签 </a> </li></ul>'
        }
    }), define("views/tag/tag-menu/templates/delete", [], function() {
        return function() {
            var a = '<div class="delete-wrap"> <p>确认删除标签？</p> <button class="btn btn-danger delete-submit">删除</button></div>';
            return a
        }
    }), define("views/tag/tag-menu/templates/edit", [], function() {
        return function(a) {
            var b = '<div class="edit-wrap"> <input class="add-input form-control" placeholder="标签名称" value="' + a.name + '"> <ul class="clearfix"> <li class="tag-label tag-label-red" data-color="red"> <span class="icon icon-tick icon-white"></span></li> <li class="tag-label tag-label-yellow" data-color="yellow"> <span class="icon icon-tick icon-white"></span></li> <li class="tag-label tag-label-green" data-color="green"> <span class="icon icon-tick icon-white"></span></li> <li class="tag-label tag-label-blue" data-color="blue"> <span class="icon icon-tick icon-white"></span></li> <li class="tag-label tag-label-purple" data-color="purple"> <span class="icon icon-tick icon-white"></span></li> <li class="tag-label tag-label-gray" data-color="gray"> <span class="icon icon-tick icon-white"></span></li> </ul> <button class="btn btn-primary edit-submit">保存</button></div>';
            return b
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/tag/tag-menu/index", ["require", "exports", "module", "./templates/basic", "./templates/delete", "./templates/edit", "lib/popover/index"], function(a) {
        var c, d, e, f, g;
        return c = a("./templates/basic"), d = a("./templates/delete"), e = a("./templates/edit"), f = a("lib/popover/index"), g = function(a) {
            function f() {
                return f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "TagMenuView", f.prototype.className = "tag-menu-view", f.prototype.popoverTitle = "标签菜单", f.prototype.events = {"click .archive-handler": "archiveTag","click .unarchive-handler": "unarchiveTag","click .edit-handler": "enterEditSubMenu","click .delete-handler": "enterDeleteSubMenu","click .delete-submit": "submitDelete","click .edit-submit": "submitEdit","click .tag-label": "changeLabel"}, f.prototype.render = function() {
                return this.$el.html(c(this.options.tagModel.toJSON())), this
            }, f.prototype.archiveTag = function() {
                return this.options.tagModel.archive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功归档了标签",status: "success"}, 2e3), a.hide()
                    }
                }(this)}), this
            }, f.prototype.unarchiveTag = function() {
                return this.options.tagModel.unarchive({success: function(a) {
                    return function() {
                        return Essage.show({message: "已成功解档了标签",status: "success"}, 2e3), a.hide()
                    }
                }(this)}), this
            }, f.prototype.changeLabel = function(a) {
                var b;
                return b = $(a.currentTarget), b.addClass("active").siblings().removeClass("active"), this.color = b.data("color"), this
            }, f.prototype.enterEditSubMenu = function() {
                return this.enterSubMenu("编辑标签", function(a) {
                    return function() {
                        var b;
                        return b = a.options.tagModel.toJSON(), a.$el.html(e(b)), a.color = b.color, a.$(".tag-label-" + a.color).addClass("active"), a.$editInput = a.$(".add-input")
                    }
                }(this)), this
            }, f.prototype.enterDeleteSubMenu = function() {
                return this.enterSubMenu("删除标签", function(a) {
                    return function() {
                        return a.$el.html(d())
                    }
                }(this)), this
            }, f.prototype.submitEdit = function() {
                var a, b, c;
                return (b = null != (c = this.$editInput) ? c.val().trim() : void 0) ? (a = {name: b,color: this.color}, this.options.tagModel.save(a, {attrs: a,wait: !0,success: function(a) {
                    return function() {
                        return a.hide()
                    }
                }(this)}), this) : void 0
            }, f.prototype.submitDelete = function() {
                return this.options.tagModel.destroy({success: function(a) {
                    return function() {
                        return a.hide()
                    }
                }(this)}), this
            }, f
        }(f)
    }), define("views/tag/tasks/templates/basic", [], function() {
        return function() {
            var a = '<h3>任务 ・ <span class="tasks-count">0</span></h3>';
            return a
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/tag/tasks/index", ["require", "exports", "module", "teambition", "./templates/basic", "collections/tasks", "views/board/task/task-list/index", "view"], function(a) {
        var c, d, e, f, g, h;
        return h = a("teambition"), c = a("./templates/basic"), f = a("collections/tasks"), e = a("views/board/task/task-list/index"), g = a("view"), d = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.viewName = "TagTasksView", d.prototype.className = "tag-tasks-view fade", d.prototype.initialize = function(a) {
                return this.tagModel = a.tagModel, this.tasksCollection = f.get("tag_" + this.tagModel.id), this.renderBasic(), this.tagModel.fetchRelation("tasks", {success: function(b) {
                    return function(c) {
                        return b.$el ? (b.tasksCollection.reset(c), b.requestSubView(e, {tasksCollection: b.tasksCollection}).$el.appendTo(b.$el), b.refreshCount(), b.tasksCollection.length && b.$el.show().addClass("in"), b.listen(), "function" == typeof a.onFinish ? a.onFinish() : void 0) : void 0
                    }
                }(this),error: function() {
                    return "function" == typeof a.onFinish ? a.onFinish() : void 0
                }}), this
            }, d.prototype.renderBasic = function() {
                return this.$el.html(c()).hide(), this
            }, d.prototype.listen = function() {
                return this.listenTo(this.tasksCollection, "add remove", this.refreshCount), this.listenTo(this.tasksCollection, "change:tagIds", function(a) {
                    return function(b, c) {
                        return (null != c ? c.indexOf(a.tagModel.id) : void 0) >= 0 ? void 0 : a.tasksCollection.remove(b)
                    }
                }(this)), this
            }, d.prototype.refreshCount = function() {
                return this.tagModel.set("tasksCount", this.tasksCollection.length), this.$(".tasks-count").text(this.tasksCollection.length), this
            }, d
        }(g)
    }), define("views/tag/tags/templates/basic", [], function() {
        return function(a) {
            var b = '<header class="tag-header body-wrap clearfix"> <div class="left-header pull-left"> <span class="tag-section">所有标签</span> ';
            return a.hasRight >= 0 && (b += ' <a class="tag-creator-handler link-add-handler pull-right"> <span class="icon icon-create-tag"></span>新标签 </a> '), b += ' </div> <div class="right-header"></div></header><div class="tag-navigator scrollable thin-scroll"> <ul class="tag-list hack-render-bug"></ul></div><div class="tag-content-wrap"></div>'
        }
    }), define("views/tag/tags/templates/header", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<div class="tag-detail" data-id="' + a._id + '"> <span class="tag"> <span class="tag-label tag-label-' + a.color + '"></span> <span class="tag-name">' + b(a.name) + '</span> </span> <a class="tag-info ';
            return a.tasksCount || (c += "disabled"), c += '" data-target=".tag-tasks-view">' + a.tasksCount + ' 项任务</a>， <a class="tag-info ', a.eventsCount || (c += "disabled"), c += '" data-target=".tag-events-view">' + a.eventsCount + ' 个日程</a>， <a class="tag-info ', a.postsCount || (c += "disabled"), c += '" data-target=".tag-posts-view">' + a.postsCount + ' 篇分享</a>， <a class="tag-info ', a.worksCount || (c += "disabled"), c += '" data-target=".tag-works-view">' + a.worksCount + " 个文件</a> ", (a.hasEntry || a.entriesCount > 0) && (c += ' ， <a class="tag-info ', a.entriesCount || (c += "disabled"), c += '" data-target=".tag-entries-view">' + a.entriesCount + " 个账目</a> "), c += "</div>"
        }
    }), define("views/tag/tags/templates/placeholder", [], function() {
        return function() {
            var a = '<div class="placeholder"> <h3>项目中还没有标签</h3> <p>你可以通过“新标签”按钮来创建标签。此后，就可以在在这里按照标签来查看项目内容了。我们准备了一些实用的标签用法，<a href="https://www.teambition.com/blog/201410090403" class="link-add-handler" target="_blank">立即查看</a>。</p></div>';
            return a
        }
    }), define("views/tag/tags/templates/tag", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="tag-item" data-id="' + a._id + "\"> <a class=\"tag tag-handler\" data-gta='event' data-label='tags |open tag detail'> <span class=\"tag-label tag-label-" + a.color + '"></span> <span class="tag-name">' + b(a.name) + "</span> </a> ";
            return a.hasRight > 0 && (c += ' <a class="tag-menu-toggler icon icon-chevron-down hinted" data-title="更多操作"></a> '), c += "</li>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/tag/tags/index", ["require", "exports", "module", "teambition", "lib/scrollable", "thenjs", "util", "view", "collections/projects", "collections/tags", "views/tag/entries/index", "views/tag/events/index", "views/tag/works/index", "views/tag/posts/index", "views/tag/tag-creator/index", "views/tag/tag-menu/index", "views/tag/tasks/index", "./templates/basic", "./templates/header", "./templates/placeholder", "./templates/tag"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u;
        return u = a("teambition"), k = a("lib/scrollable"), r = a("thenjs"), s = a("util"), t = a("view"), j = a("collections/projects"), p = a("collections/tags"), d = a("views/tag/entries/index"), e = a("views/tag/events/index"), f = a("views/tag/works/index"), i = a("views/tag/posts/index"), l = a("views/tag/tag-creator/index"), m = a("views/tag/tag-menu/index"), q = a("views/tag/tasks/index"), c = a("./templates/basic"), g = a("./templates/header"), h = a("./templates/placeholder"), n = a("./templates/tag"), o = function(a) {
            function k() {
                return k.__super__.constructor.apply(this, arguments)
            }
            return b(k, a), k.prototype.viewName = "TagView", k.prototype.className = "tags-view body-wrap card fade", k.prototype.routes = {"tag/:_tagId": "enter","*paramString": "home"}, k.prototype.events = {"click .tag-handler": "showContent","click .tag-creator-handler": "toggleCreator","click .tag-menu-toggler": "toggleMenu","click .tag-info": "scrollToSection","mousewheel .scrollable": s.mousewheel}, k.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this.options = a, this._projectId = a._projectId, this.projectModel = j.getOne(0, this._projectId), this.currentTagId = null, this.prevTagId = null, this.renderBasic(), this.tagsCollection = p.get(this._projectId, {boundToObjectType: "project"}), this.registerAsResponsive(), this.setupScroll(), _.delay(function(a) {
                    return function() {
                        return a.layout(), a.$el.addClass("in")
                    }
                }(this)), this) : void 0
            }, k.prototype.home = function() {
                return this.enter(), this
            }, k.prototype.enter = function(a) {
                return p.fetch(this._projectId, {beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$tags, {isPrepend: !0})
                    }
                }(this),success: function(b) {
                    return function() {
                        return b.$el ? (b.hideLoadingIndicator(), b.renderTags(), b.showContent(a, !0), b.listen()) : void 0
                    }
                }(this)}), this
            }, k.prototype.layout = function() {
                return this.$contentWrap.css("min-height", this.$navigator.height()), this
            }, k.prototype.renderBasic = function() {
                return this.$el.html(c({hasRight: this.projectModel.hasRight()})), this.$header = this.$(".right-header"), this.$content = this.$(".tag-content-list"), this.$tags = this.$(".tag-list"), this.$placeholder = this.$(".tag-placeholder"), this.$navigator = this.$(".tag-navigator"), this.$contentWrap = this.$(".tag-content-wrap"), this
            }, k.prototype.listen = function() {
                return this.listenTo(this.projectModel, "change:navigation", function(a) {
                    return function() {
                        return a.renderHeader()
                    }
                }(this)), this.listenTo(this.tagsCollection, "add", function(a) {
                    return function(b) {
                        return a.renderTag(b, !0), a.currentTagId ? void 0 : a.showContent(b.id)
                    }
                }(this)), this.listenTo(this.tagsCollection, "change", this.updateTag), this.listenTo(this.tagsCollection, "remove destroy", this.removeTag), this
            }, k.prototype.renderHeader = function(a) {
                var b;
                return a || (a = this.tagsCollection.get(this.currentTagId)), b = a.toJSON(), b.hasEntry = this.projectModel.get("navigation").bookkeeping >= 0, this.$header.html(g(b)), this
            }, k.prototype.renderTags = function() {
                return this.$tags.empty(), this.tagsCollection.each(function(a) {
                    return function(b) {
                        return a.renderTag(b)
                    }
                }(this)), this
            }, k.prototype.renderTag = function(a, b) {
                var c, d;
                if ("my" !== this.section || a.get("_creatorId") === u.user.id)
                    return d = b === !0 ? "prependTo" : "appendTo", c = a.toJSON(), c.hasRight = a.hasRight(), $(n(c))[d](this.$tags), this
            }, k.prototype.updateTag = function(a) {
                var b, c, d;
                return c = a.toJSON(), c.hasRight = a.hasRight(), d = this.$tags.find(".tag-item[data-id=" + a.id + "]"), b = $(n(c)), d.replaceWith(b), a.id === this.currentTagId && (b.addClass("active"), this.renderHeader(a)), this
            }, k.prototype.removeTag = function(a) {
                return this.$tags.find(".tag-item[data-id=" + a.id + "]").remove(), a.id !== this.currentTagId ? this : (this.currentTagId = null, this.showContent(this.prevTagId), this)
            }, k.prototype.renderPlaceholder = function() {
                return this.$contentWrap.html(h()), this
            }, k.prototype.showContent = function(a, b) {
                var c, g, h, j, k, l, m;
                return (null != a ? a.currentTarget : void 0) ? (c = $(a.currentTarget).parent(), g = this.tagsCollection.get(c.data("id"))) : g = this.tagsCollection.get(a), g || (g = this.tagsCollection.at(0)), g ? this.currentTagId !== g.id ? (c = this.$(".tag-item[data-id=" + g.id + "]"), this.prevTagId = this.currentTagId, this.currentTagId = g.id, c.addClass("active").siblings().removeClass("active"), this.renderHeader(g), null != (h = this.tasksView) && h.remove(), null != (j = this.eventsView) && j.remove(), null != (k = this.postsView) && k.remove(), null != (l = this.filesView) && l.remove(), null != (m = this.entriesView) && m.remove(), this.$contentWrap.empty(), r(function(a) {
                    return function(b) {
                        return a.tasksView = a.requestSubView(q, {tagModel: g,onFinish: function() {
                            return _.delay(b)
                        }}), a.tasksView.$el.appendTo(a.$contentWrap)
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return a.currentTagId !== g.id ? b() : (a.eventsView = a.requestSubView(e, {tagModel: g,onFinish: function() {
                            return _.delay(b)
                        }}), a.eventsView.$el.appendTo(a.$contentWrap))
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return a.currentTagId !== g.id ? b() : (a.postsView = a.requestSubView(i, {tagModel: g,onFinish: function() {
                            return _.delay(b)
                        }}), a.postsView.$el.appendTo(a.$contentWrap))
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return a.currentTagId !== g.id ? b() : (a.filesView = a.requestSubView(f, {tagModel: g,onFinish: function() {
                            return _.delay(b)
                        }}), a.filesView.$el.appendTo(a.$contentWrap))
                    }
                }(this)).then(function(a) {
                    return function(b) {
                        return a.currentTagId !== g.id ? b() : (a.entriesView = a.requestSubView(d, {tagModel: g,onFinish: function() {
                            return _.delay(b)
                        }}), a.entriesView.$el.appendTo(a.$contentWrap))
                    }
                }(this)), this.updateUrl({type: "tag",_modelId: g.id}, {trigger: !1,replace: b}), this) : void 0 : this.renderPlaceholder()
            }, k.prototype.toggleCreator = function(a) {
                var b;
                return b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(l, {$toggler: b,_projectId: this._projectId,tagsCollection: this.tagsCollection,onShown: function() {
                    return function() {
                        return b.addClass("active")
                    }
                }(this),onHidden: function() {
                    return function() {
                        return b.removeClass("active")
                    }
                }(this)}).show(), this
            }, k.prototype.toggleMenu = function(a) {
                var b;
                return b = $(a.currentTarget), b.data("bs.popover") || this.requestSubView(m, {$toggler: b,_projectId: this._projectId,tagModel: this.tagsCollection.get(b.closest(".tag-item").data("id")),onShown: function() {
                    return function() {
                        return b.addClass("active")
                    }
                }(this),onHidden: function() {
                    return function() {
                        return b.removeClass("active")
                    }
                }(this)}).show(), this
            }, k.prototype.scrollToSection = function(a) {
                var b;
                return b = $(a.currentTarget), b.hasClass("disabled") ? void 0 : (this.slideTo(this.$(b.data("target")), !0), this)
            }, k.prototype.updateUrl = function(a, b) {
                var c;
                return b = b || {}, c = u.router.getPrefix() + "/tags", a.type && (c += "/" + a.type), a._modelId && (c += "/" + a._modelId), a.params && (c += "/" + a.params), u.router.navigate(c, b), this
            }, k
        }(t), _.extend(o.prototype, k), o
    }), define("views/wall/wall/templates/basic", [], function() {
        return function() {
            var a = '<div class="wall-left-column"> <header class="wall-left-column-header clearfix"></header> <nav class="posts-navigator thin-scroll"> <ul class="posts-list"></ul> <div class="posts-placeholder placeholder muted"> <a class="icon icon-wall"></a> <br /> 目前还没有分享 </div> </nav></div><div class="wall-right-column"> <div class="post-detail-wrapper"></div></div>';
            return a
        }
    }), define("views/wall/wall/templates/header", [], function() {
        return function(a) {
            var b = '<div class="btn-group wall-switcher pull-left"> <a class="btn btn-link dropdown-toggle" data-toggle="dropdown" data-gta="event" data-label="expand post list menu"> ';
            return b += "my" === a.section ? "我的分享" : "所有分享", b += ' <span class="icon icon-chevron-down"></span> </a> <ul class="dropdown-menu"> <li> <a class="wall-switcher-btn" data-section="all" data-gta="event" data-label="show all posts">所有分享</a> </li> <li> <a class="wall-switcher-btn" data-section="my" data-gta="event" data-label="show my posts">我的分享</a> </li> <li class="divider"></li> <li> <a class="wall-order-btn sort-handler" data-type="created" data-gta="event" data-label="post order by issue date">按发布时间排序</a> </li> <li> <a class="wall-order-btn sort-handler" data-type="lastCommentedAt" data-gta="event" data-label="post order by reply date">按回复时间排序</a> </li> </ul></div>', a.hasRight >= 0 && (b += '<div class="btn-group post-create-wrap pull-right"> <a class="btn btn-link open-post-creator-handler link-add-handler" data-gta="event" data-label="create default post"> <span class="icon icon-create-post"></span>添加分享 </a> <a class="btn btn-link dropdown-toggle post-mode-handler" data-toggle="dropdown" data-gta="event" data-label="expand create post menu"> <span class="icon icon-chevron-down"></span> </a> <ul class="dropdown-menu"> <li> <a class="post-creator-btn" data-type="html" data-gta="event" data-label="create html post">普通文档</a> </li> <li> <a class="post-creator-btn" data-type="md" data-gta="event" data-label="create markdown post">Markdown 文档</a> </li> </ul></div>'), b
        }
    }), define("views/wall/wall/templates/post", [], function() {
        return function(a) {
            var b = "undefined" != typeof _encodeHTML ? _encodeHTML : function(a) {
                var b = {"&": "&#38;","<": "&#60;",">": "&#62;",'"': "&#34;","'": "&#39;","/": "&#47;"}, c = a ? /[&<>"'\/]/g : /&(?!#?\w+;)|<|>|"|'|\//g;
                return function(a) {
                    return a ? a.toString().replace(c, function(a) {
                        return b[a] || a
                    }) : ""
                }
            }(), c = '<li class="post ';
            if (a.pin && (c += "pin"), c += '" data-id="' + a._id + "\" data-type=\"post\" data-gta='event' data-label='wall |open post detail'> <section> <div class=\"avatar img-36 img-circle pull-left ", a.creator.avatarUrl || (c += "no-avatar"), c += '" style="background-image: url(' + a.creator.avatarUrl + ');"></div> <div class="post-content"> <p class="post-title"> <span class="post-title hinted" data-title="' + a.description + '">' + b(a.description) + '</span> </p> <p class="post-info muted"> ' + a.creator.name + '发布于 <time datetime="' + a.created + '"></time> </p> </div> </section> ', a.commentsCount || a.attachmentsCount || a.objectlinksCount || a.likesCount || a.tags && a.tags.length) {
                c += ' <footer class="clearfix"> ', a.commentsCount && (c += ' <span class="label"> <span class="icon ', c += a.commentsCount > 10 ? "icon-comments" : "icon-comment", c += '"></span> </span> '), c += " ", a.attachmentsCount && (c += ' <span class="label"> <span class="icon icon-paperclip"></span> </span> '), c += " ", a.objectlinksCount && (c += ' <span class="label"> <span class="icon icon-link2"></span> </span> '), c += " ", a.likesCount && (c += ' <span class="label"> <span class="icon icon-heart"></span> ' + a.likesCount + " </span> "), c += " ";
                var d = a.tags;
                if (d)
                    for (var e, f = -1, g = d.length - 1; g > f; )
                        e = d[f += 1], c += ' <span class="label tag"> <span class="tag-label tag-label-' + e.color + '"></span> <span class="tag-name">' + b(e.name) + "</span> </span> ";
                c += " </footer> "
            }
            return c += " ", "involves" == a.visiable && (c += ' <span class="icon icon-lock2 hinted" data-title="仅参与者可见"></span> '), c += "</li>"
        }
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/wall/wall/index", ["require", "exports", "module", "teambition", "lib/guide-point/index", "lib/scrollable", "lib/selectable", "thenjs", "util", "view", "models/work", "collections/members", "collections/posts", "collections/projects", "collections/tags", "views/wall/post-creator/index", "views/wall/post-detail/index", "lib/window/index", "./templates/basic", "./templates/header", "./templates/post"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u;
        return u = a("teambition"), d = a("lib/guide-point/index"), l = a("lib/scrollable"), m = a("lib/selectable"), o = a("thenjs"), p = a("util"), q = a("view"), t = a("models/work"), f = a("collections/members"), j = a("collections/posts"), k = a("collections/projects"), n = a("collections/tags"), g = a("views/wall/post-creator/index"), h = a("views/wall/post-detail/index"), s = a("lib/window/index"), c = a("./templates/basic"), e = a("./templates/header"), i = a("./templates/post"), r = function(a) {
            function l() {
                return l.__super__.constructor.apply(this, arguments)
            }
            return b(l, a), l.prototype.viewName = "WallView", l.prototype.className = "wall-view card fade", l.prototype.orderBy = "created", l.prototype.hotkeys = {c: "openPostCreator"}, l.prototype.routes = {":section(/:type)(/:_modelId)": "enterSection","*paramString": "home"}, l.prototype.events = {"click .post": "onClickPost","click .open-post-creator-handler, .post-creator-btn": "openPostCreator","click .wall-switcher-btn": "nav","click .sort-handler": "switchSort"}, l.prototype.initialize = function(a) {
                return (null != a ? a._projectId : void 0) ? (this.options = a, this._projectId = a._projectId, this.projectModel = k.getOne(0, this._projectId), this.postsCollection = j.get(this._projectId, {boundToObjectType: "project"}), this.membersCollection = f.get(this._projectId), this.tagsCollection = n.get(this._projectId), this.renderBasic().listen().setupScroll(this.$(".posts-navigator")), _.delay(function(a) {
                    return function() {
                        return a.$el.addClass("in"), d.initialize(a)
                    }
                }(this)), this) : void 0
            }, l.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$header = this.$(".wall-left-column-header"), this.$postsWrapper = this.$(".posts-wrapper"), this.$posts = this.$(".posts-list"), this.$nav = this.$(".wall-switcher-nav"), this.$detail = this.$(".post-detail-wrapper"), this.$postsPlaceholder = this.$(".posts-placeholder"), this
            }, l.prototype.listen = function() {
                return this.listenTo(this.postsCollection, "add", function(a) {
                    return function(b) {
                        return a.checkPlaceholder(), a.renderPost(b, !0)
                    }
                }(this)), this.listenTo(this.postsCollection, "change", this.renderPost), this.listenTo(this.postsCollection, "change:pin change:lastCommentedAt", function(a) {
                    return function() {
                        return a.renderPosts()
                    }
                }(this)), this.listenTo(this.postsCollection, "remove", function(a) {
                    return function(b) {
                        return a.removePost(b), a.checkPlaceholder()
                    }
                }(this)), this
            }, l.prototype.home = function() {
                return this.enterSection("all"), this
            }, l.prototype.enterSection = function(a, b, c) {
                var d;
                return d = this.postsCollection.getType(a), a !== d && (c = b, b = a, a = d), a !== this.section && (this.section = a, this.postsCollection.section !== a && (this.postsCollection.section = a, this.postsCollection.reset()), this.renderHeader({section: a}), this.load({type: b,_modelId: c})), this
            }, l.prototype.load = function(a) {
                return j.fetch(this._projectId, {remove: !1,silent: !0,section: this.section,beforeSend: function(a) {
                    return function() {
                        return a.showLoadingIndicator(a.$posts, {isPrepend: !0})
                    }
                }(this),success: function(b) {
                    return function() {
                        var c;
                        if (b.$el)
                            return b.hideLoadingIndicator(), b.renderPosts(), b.checkPlaceholder(), b.postsCollection.length ? (c = a._modelId, b.postsCollection.get(c) || (c = b.postsCollection.at(0).id), b.openDetail(c, null, !0)) : void 0
                    }
                }(this)}), this
            }, l.prototype.loadMore = function(a) {
                var b, c, d;
                return d = b = 0, c = this.postsCollection.getType(this.section), this.postsCollection.loadMore({silent: !0,section: c,beforeSend: function(a) {
                    return function() {
                        return d = (new Date).getTime(), a.showLoadingIndicator(a.$posts)
                    }
                }(this),success: function(c) {
                    return function(e, f) {
                        var g, h;
                        if (c.$el)
                            return b = (new Date).getTime(), h = b - d, g = 1e3 > h ? 1e3 - h : 0, _.delay(function() {
                                return c.hideLoadingIndicator({animated: !0}), c.renderPosts(f), c.postsCollection.hasMore ? "function" == typeof a ? a() : void 0 : c.showEndPoint(c.$posts)
                            }, g)
                    }
                }(this)}), this
            }, l.prototype.renderHeader = function(a) {
                return a.hasRight = this.projectModel.hasRight(), this.$header.html(e(a)), this
            }, l.prototype.renderPosts = function(a) {
                var b;
                return a ? b = _.isArray(a) ? a : [a] : (this.$posts.empty(), this.postsCollection.orderBy = this.orderBy, this.postsCollection.sort(), this.renderSort(), b = this.postsCollection.toJSON()), _.each(b, function(a) {
                    return function(b) {
                        return a.renderPost(b)
                    }
                }(this)), this.checkPlaceholder(), this
            }, l.prototype.renderPost = function(a, b) {
                var c, d, e, f, g, h, j;
                return c = this.$posts, (g = "function" == typeof a.toJSON ? a.toJSON() : void 0) || (g = p.parsePost(a)), g.orderBy = this.orderBy, g.creator = null != (h = this.membersCollection.get(g._creatorId)) ? h.toJSON() : void 0, g.creator || (g.creator = {_id: "",avatarUrl: "",name: ""}), g.latestActivity && (g.latestActivity.creator = (null != (j = this.membersCollection.get(g.latestActivity._creatorId)) ? j.toJSON() : void 0) || {_id: "",avatarUrl: "",name: ""}), g.tags = this.tagsCollection.getTagsbyIds(g.tagIds), e = $(i(g)), b === !0 ? (d = this.$(".pin").last(), d.length ? d.after(e) : c.prepend(e)) : (f = c.find("[data-id=" + g._id + "]"), f.length ? f.replaceWith(e) : c.append(e)), e.find("time").timesince(), this.currentPostId === a.id && e.addClass("active"), e
            }, l.prototype.renderSort = function() {
                var a, b, c;
                return c = this.orderBy, b = ".sort-handler", this.$el.find("" + b + " .icon").remove(), a = this.$el.find("" + b + "[data-type=" + c + "]"), a.append("<span class='icon icon-tick'></span>"), this
            }, l.prototype.removePost = function(a) {
                var b, c;
                return this.$posts.find("[data-id=" + a.id + "]").remove(), this.currentPostId = null, b = this.prevPostId || (null != (c = this.postsCollection.at(0)) ? c.id : void 0), b ? this.openDetail(b) : this.openPostCreator(), this
            }, l.prototype.checkPlaceholder = function() {
                return this.$postsPlaceholder[this.postsCollection.length ? "hide" : "show"](), this
            }, l.prototype.onClickPost = function(a) {
                var b;
                return b = $(a.currentTarget), this.openDetail(b.data("id"), b), this
            }, l.prototype.openDetail = function(a, b, c) {
                return !a || a === this.currentPostId && this.currentView instanceof h ? void 0 : (this.prevPostId = this.currentPostId, this.currentPostId = a, this.open(h, this.$detail, {_projectId: this._projectId,postModel: this.postsCollection.get(a)}), this.$posts.find(".post.active").removeClass("active"), b || (b = this.$posts.find("[data-id=" + a + "]")), b.addClass("active"), this.updateUrl({type: "post",_modelId: a}, {trigger: !1,replace: c}), this)
            }, l.prototype.openPostCreator = function(a) {
                var b, c;
                return b = $(a.currentTarget).data("type"), "md" !== b && (b = "html"), null != (c = this.postCreatorView) && c.remove(), this.postCreatorView = this.requestSubView(s).open(g, {backdrop: "static",_projectId: this._projectId,postMode: b,onsave: function(a) {
                    return function(b) {
                        return a.postsCollection.add(b), a.openDetail(b.id)
                    }
                }(this)}), this
            }, l.prototype.switchSort = function(a) {
                var b, c;
                return b = $(a.currentTarget), (c = b.data("type")) ? (c !== this.orderBy && (this.orderBy = c, this.renderPosts()), this) : this
            }, l.prototype.open = function(a, b, c) {
                var d;
                return null != (d = this.currentView) && d.remove(), this.currentView = this.requestSubView(a, c), b.html(this.currentView.$el), this
            }, l.prototype.nav = function(a) {
                var b, c;
                return b = $(a.currentTarget), c = b.data("section"), c !== this.section ? (this.updateUrl({section: c}, {trigger: !0}), this) : void 0
            }, l.prototype.updateUrl = function(a, b) {
                var c, d;
                return b = b || {}, d = u.router.getPrefix() + "/posts", c = a.section ? this.postsCollection.getType(a.section) : this.section, "all" !== c && (d += "/" + c), a.type && (d += "/" + a.type), a._modelId && (d += "/" + a._modelId), a.params && (d += "/" + a.params), u.router.navigate(d, b), this
            }, l
        }(q), _.extend(r.prototype, l), r
    }), define("views/work/works-background-uploader/templates/basic", [], function() {
        return function() {
            var a = '<div class="card"> <div class="card-header"> <p class="card-title"> <span class="card-title-doing"></span> </p> <a class="maximize-creator icon icon-window-max"></a> <a class="minimize-creator icon icon-window-min"></a> <a class="close-creator icon icon-remove"></a> </div> <ul class="work-set clearfix thin-scroll"></ul></div>';
            return a
        }
    });
    var e = function(a, b) {
        return function() {
            return a.apply(b, arguments)
        }
    }, a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("views/work/works-background-uploader/index", ["require", "exports", "module", "essage", "./templates/basic", "lib/confirm/index", "util", "view", "collections/works", "views/work/work/index"], function(a) {
        var c, d, f, g, h, i, j, k;
        return k = a("essage"), c = a("./templates/basic"), d = a("lib/confirm/index"), f = a("util"), g = a("view"), j = a("collections/works"), h = a("views/work/work/index"), i = function(a) {
            function f() {
                return this.close = e(this.close, this), this.removeWork = e(this.removeWork, this), f.__super__.constructor.apply(this, arguments)
            }
            return b(f, a), f.prototype.viewName = "WorksBackgroundUploaderView", f.prototype.tagName = "section", f.prototype.className = "works-background-uploader", f.prototype.events = {"click .maximize-creator": "maximize","click .minimize-creator": "minimize","click .close-creator": "closeCreator"}, f.prototype.initialize = function() {
                return this.total = 0, this.uploadedCount = 0, this.renderBasic(), this
            }, f.prototype.listen = function(a) {
                return this.listenTo(a, "add", this.renderWork), this.listenTo(a, "remove", function(b) {
                    return function() {
                        return b.removeWork(), b.checkUpload(a)
                    }
                }(this)), this.listenTo(a, "change:completed", function(b) {
                    return function() {
                        return b.uploadedCount++, b.checkUpload(a)
                    }
                }(this)), this
            }, f.prototype.renderBasic = function() {
                return this.$el.html(c()), this.$workSet = this.$(".work-set"), this.$title = this.$(".card-title-doing"), this.$maxHandle = this.$(".maximize-creator"), this.$minHandle = this.$(".minimize-creator"), this
            }, f.prototype.renderWorks = function(a) {
                return a.each(function(a) {
                    return function() {
                        return a.renderWork
                    }
                }(this)), this
            }, f.prototype.renderWork = function(a) {
                return this.requestSubView(h, {workModel: a,isBackground: !0}).$el.addClass("card").prependTo(this.$workSet), this.total++, this.refreshTitle(), this.maximize(), this
            }, f.prototype.addWorks = function(a, b) {
                return a.inWorksBgUploader = !0, a._projectId = b._projectId, a.success = b.success || function() {
                }, this.uploadedCount += a.length - a.getUploadingCount(), this.listen(a), this
            }, f.prototype.removeWork = function() {
                return this.total--, this.total > 0 ? this.refreshTitle() : (this.total = 0, this.uploadedCount = 0, this.$el.hide(), this.$workSet.empty()), this
            }, f.prototype.checkUpload = function(a) {
                return this.refreshTitle(), a.getUploadingCount() || this.submit(a), this
            }, f.prototype.submit = function(a) {
                return a.addWorks(a.toJSON(), {_projectId: a._projectId,success: function(b) {
                    return function(c) {
                        var d;
                        return null != (d = j.find(a._boundToObjectId)) && d.add(c), a.reset(null, {silent: !0}), a.inWorksBgUploader = !1, a.success(c), b.stopListening(a), b.refreshTitle(), _.delay(function() {
                            return b.uploadedCount === b.total ? b.minimize() : void 0
                        }, 2e3)
                    }
                }(this),error: function(a) {
                    return function() {
                        return Essage.show({message: "文件上传失败",status: "error"}, 2e3), a.minimize()
                    }
                }(this)}), this
            }, f.prototype.refreshTitle = function() {
                var a, b;
                return a = this.uploadedCount, b = this.total, this.$title.text(a === b ? "上传完成" : "正在上传 " + a + "/" + b), this
            }, f.prototype.closeCreator = function() {
                return this.uploadedCount === this.total ? this.close() : this.requestSubView(d, {title: "确认关闭",description: "您有文件正在上传,确认关闭么?",onConfirm: function(a) {
                    return function() {
                        return _.each(a.subViews, function(a) {
                            var b;
                            return null != (b = a.workModel) ? b.removeFile() : void 0
                        }), a.close()
                    }
                }(this)})
            }, f.prototype.close = function() {
                return this.total = 0, this.uploadedCount = 0, this.$el.hide(), this.$workSet.empty(), this
            }, f.prototype.maximize = function() {
                return this.$el.removeClass("minimize").show(), this
            }, f.prototype.minimize = function() {
                return this.$el.addClass("minimize").show(), this
            }, f
        }(g)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("app", ["require", "exports", "module", "teambition", "hotkey", "lib/notification/index", "lib/socket", "thenjs", "view", "collections/members", "collections/messages", "collections/projects", "collections/tags", "views/core/app-switcher/index", "views/board/board/index", "views/bookkeeping/bookkeeping/index", "views/events/events/index", "views/core/float/index", "views/home/home/index", "views/inbox/inbox/index", "views/library/library/index", "views/core/markdown-helper/index", "views/member/member-bar/index", "views/core/navigation/index", "views/organization/organization/index", "views/portal/index", "views/review/review/index", "views/tag/tags/index", "views/wall/wall/index", "lib/window/index", "views/work/works-background-uploader/index", "essage"], function(a) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I;
        return H = a("teambition"), k = a("hotkey"), s = a("lib/notification/index"), x = a("lib/socket"), A = a("thenjs"), B = a("view"), p = a("collections/members"), q = a("collections/messages"), v = a("collections/projects"), z = a("collections/tags"), d = a("views/core/app-switcher/index"), f = a("views/board/board/index"), g = a("views/bookkeeping/bookkeeping/index"), h = a("views/events/events/index"), i = a("views/core/float/index"), j = a("views/home/home/index"), l = a("views/inbox/inbox/index"), m = a("views/library/library/index"), n = a("views/core/markdown-helper/index"), o = a("views/member/member-bar/index"), r = a("views/core/navigation/index"), t = a("views/organization/organization/index"), u = a("views/portal/index"), w = a("views/review/review/index"), y = a("views/tag/tags/index"), C = a("views/wall/wall/index"), D = a("lib/window/index"), E = a("views/work/works-background-uploader/index"), I = a("essage"), F = {home: j,posts: C,tasks: f,files: m,events: h,review: w,tags: y,bookkeeping: g}, c = $(window), G = RegExp("" + window.location.host + "/(projects|project/|organizations|organization/)"), e = function(a) {
            function e() {
                return e.__super__.constructor.apply(this, arguments)
            }
            return b(e, a), e.prototype.viewName = "AppView", e.prototype.el = $("body"), e.prototype.responsiveViews = {}, e.prototype.hotkeys = {h: function() {
                return H.user.get("isGhost") ? void 0 : this.backToPortal()
            },"shift+m": "openMdHelper",backspace: function(a) {
                return a.preventDefault()
            }}, e.prototype.events = {"click .readable a, a.url-handler": "routeLink"}, e.prototype.initialize = function() {
                var a;
                return this.defaultTitle = document.title, this.$content = $("#content"), this.navigation = this.requestSubView(r), this.renderWorksBgUploader(), this.projectsCollection = v.get(0), this.messagesCollection = q.get(H.user.id), this.messagesCollection.listen(), this.listen(), a = _.throttle(function(a) {
                    return function() {
                        return a.layout()
                    }
                }(this), 500), $(window).resize(a), a(), k.add(this), this
            }, e.prototype.layout = function() {
                var a, b, d;
                if (this.$el.css("min-height", c.height() - 50), !_.isEmpty(this.responsiveViews)) {
                    d = this.responsiveViews;
                    for (a in d)
                        b = d[a], "function" == typeof b.layout && b.layout();
                    return this
                }
            }, e.prototype.listen = function() {
                var a;
                return a = function() {
                    return function(a) {
                        var b;
                        if (!a.get("isArchived") && !a.get("isRead") && ("system" === a.get("type") || a.get("unreadActivitiesCount")))
                            return b = a.genNotification(), b.creator && b.creator._id !== H.user.id ? s.show(b, function() {
                                var b;
                                return window.focus(), a.markRead(), null != (b = H.APP.Float) ? b.open(l, {_messageId: a.id}) : void 0
                            }) : void 0
                    }
                }(this), this.listenTo(H.PREFERENCE, "change:memberBarMode", function(a) {
                    return function() {
                        return _.delay(function() {
                            return a.layout()
                        }, 300)
                    }
                }(this)), this.listenTo(this.messagesCollection, "add change", function(b) {
                    return function(c) {
                        var d;
                        return d = b.messagesCollection.getUnreadCount(), d > H.user.get("badge") && H.user.set("badge", d), a(c)
                    }
                }(this)), this.listenTo(this.projectsCollection, "remove", function(a) {
                    return function(b) {
                        return a._projectId === b.id ? a.backToPortal() : void 0
                    }
                }(this)), this
            }, e.prototype.backToPortal = function() {
                return H.router.navigate("projects", {trigger: !0}), !1
            }, e.prototype.enter = function(a, b) {
                var c, d, e, f;
                if (this.removeSubViews(this.navigation, this.memberBar, this.worksBgUploader), this.Float = this.requestSubView(i), this.currentAppName = a, this._organizationId = b._organizationId, c = this._projectId === b._projectId, this._projectId = b._projectId, null != (d = this.currentView) && d.remove(), this.projectModel = null, this.organizationModel = null, this.$content.empty(), this.setDataCategory(a), F[a]) {
                    if (!b._projectId)
                        return;
                    this.projectModel = b.projectModel, this.projectModel.hasRight() >= 0 && !this.projectModel.subscribed && (x.join("projects", this.projectModel.id), this.projectModel.subscribed = !0), this.renderAppSwitcher(a), A(function(a) {
                        return function(d) {
                            return p.fetch(a._projectId, {attrs: {users: 1},boundToObjectType: "project",success: function() {
                                var e;
                                return c && (null != (e = a.memberBar) ? e.$el : void 0) ? a.memberBar.switchMode() : a.renderMemberBar(b), d()
                            }})
                        }
                    }(this)).then(function(c) {
                        return function() {
                            return z.fetch(c._projectId, {success: function() {
                                return c.enterApp(F[a], b), $("body").scrollTop(0)
                            }})
                        }
                    }(this))
                } else
                    "portal" === a ? (null != (e = this.memberBar) && e.remove(), this.enterApp(u, b), "inbox" === b.routeString && this.Float.toggleInbox(), this.navigation.activeProjects()) : "organization" === a && (null != (f = this.memberBar) && f.remove(), this.organizationModel = b.organizationModel, this.organizationModel.hasRight() >= 0 && !this.organizationModel.subscribed && (x.join("organizations", this.organizationModel.id), this.organizationModel.subscribed = !0), this.enterApp(t, b), "inbox" === b.routeString && this.Float.toggleInbox());
                return this
            }, e.prototype.enterApp = function(a, b) {
                var c;
                return b.onError = function() {
                    return H.router.home()
                }, null != (c = this.currentView) && c.remove(), this.$content.find(">div").remove(), this.currentView = this.requestSubView(a, b), this.currentView.$el.appendTo(this.$content), H.router.checkRoute(b.routeString, this.currentView), this
            }, e.prototype.loadMembers = function(a, b, c) {
                var d;
                return d = {boundToObjectType: a,success: c}, p.fetch(b, d), this
            }, e.prototype.renderAppSwitcher = function(a) {
                return this.requestSubView(d, {projectModel: this.projectModel,appName: a}).$el.appendTo(this.$content), this
            }, e.prototype.renderMemberBar = function(a) {
                var b;
                return null != (b = this.memberBar) && b.remove(), this.memberBar = this.requestSubView(o, a), this.memberBar.$el.appendTo(this.$el), this
            }, e.prototype.renderWorksBgUploader = function(a) {
                var b;
                return null != (b = this.worksBgUploader) && b.remove(), this.worksBgUploader = this.requestSubView(E, a), this.worksBgUploader.$el.appendTo(this.$el), this
            }, e.prototype.openMdHelper = function() {
                var a;
                return null != (a = this.markdownHelperView) && a.remove(), this.markdownHelperView = this.requestSubView(D).open(n), this
            }, e.prototype.showPanel = function(a, b) {
                var c;
                return (null != (c = this.panelView) ? c.isIn : void 0) ? this.panelView.isSame(b) ? this.panelView.hide() : this.panelView.hide(function(c) {
                    return function() {
                        return c.panelView.remove(), delete c.panelView, c.panelView = c.requestSubView(a, b), c.panelView.show()
                    }
                }(this)) : (this.panelView && (this.panelView.remove(), delete this.panelView), this.panelView = this.requestSubView(a, b), this.panelView.show()), this
            }, e.prototype.hidePanel = function() {
                var a;
                return (null != (a = this.panelView) ? a.isIn : void 0) && this.panelView.hide(function(a) {
                    return function() {
                        return delete a.panelView
                    }
                }(this)), this
            }, e.prototype.routeLink = function(a) {
                var b, c;
                return c = a.currentTarget, c.href && !$(c).closest(".post-editor-textarea").length ? (a.preventDefault(), G.test(c.href) ? (b = c.pathname.split("/").slice(1), "project" === b[0] ? v.fetchOne(0, b[1], {success: function(a) {
                    return function() {
                        return a.Float.close(), H.router.navigate(c.pathname, {trigger: !0})
                    }
                }(this),error: function() {
                    return function() {
                        return Essage.show({message: "您没有权限查看链接的对象",status: "error"}, 3e3)
                    }
                }(this)}) : (this.Float.close(), H.router.navigate(c.pathname, {trigger: !0}))) : window.open(c.href)) : void 0
            }, e.prototype.dynamicTitle = function() {
                var a, b, c, d, e, f;
                return b = H.router.getUrl().split("/"), "project" === b[0] && (c = null != (d = this.projectsCollection.get(b[1])) ? d.get("name") : void 0), c = c ? "" + c + " · Teambition" : this.defaultTitle, (null != (e = H.favico) ? e.browser.supported : void 0) || (a = null != (f = H.user) ? f.get("badge") : void 0), document.title = a ? "(" + a + ")" + c : c, this
            }, e.prototype.setDataCategory = function(a) {
                return a = a || this.currentAppName, _.delay(function(b) {
                    return function() {
                        var c, d;
                        return null != (c = b.$el) && c.data("category", a), null != (d = b.$el) ? d.attr("data-category", a) : void 0
                    }
                }(this), 500)
            }, e
        }(B)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/user", ["require", "exports", "module", "lib/http", "model", "moment", "lib/socket"], function(a) {
        var c, d, e, f, g;
        return c = a("lib/http"), d = a("model"), e = a("moment"), f = a("lib/socket"), g = function(a) {
            function d() {
                return d.__super__.constructor.apply(this, arguments)
            }
            return b(d, a), d.prototype.name = "user", d.prototype.urlRoot = "users", d.prototype.defaults = {name: "",title: "",phone: "",location: "",website: "",birthday: "",email: "",avatar: "",emails: [],badge: 0,todayTasks: 0,isGhost: !0}, d.prototype.parse = function(a) {
                var b;
                return a = _.extend(this.toJSON(), a), b = _.findWhere(a.emails, {email: a.email}), b && (a._emailId = b._id), a.isGhost = !a._id, a
            }, d.prototype.initialize = function() {
                return this.formatBirthday(), this.on("change:birthday", this.formatBirthday), this.on("change", function(a) {
                    return function() {
                        var b;
                        return b = a.pick("name", "title", "phone", "location", "website", "birthday", "email", "avatar", "avatarUrl"), _.isEmpty(b) ? void 0 : f.trigger(":change:member/" + a.id, b)
                    }
                }(this)), d.__super__.initialize.apply(this, arguments)
            }, d.prototype.formatBirthday = function() {
                var a;
                return a = this.get("birthday"), !a || a instanceof Date ? void 0 : (a = new Date(a), this.set("birthday", a, {silent: !0}))
            }, d.prototype.fetchBadge = function() {
                return this.fetch({silentError: !0,url: "users/badge"})
            }, d.prototype.fetchTodayTasks = function() {
                return c.ajax("tasks/me", {data: {dueDate: e().endOf("day").toISOString()},success: function(a) {
                    return function(b) {
                        return a.set("todayTasks", b.count || 0)
                    }
                }(this)})
            }, d.prototype.getSetting = function(a, b) {
                var c;
                return ~a.indexOf(".") ? (c = a.split("."), this.attributes[b][c[0]][c[1]]) : this.attributes[b][a]
            }, d.prototype.sendResetPasswordMail = function() {
                return this.sync("create", this, {url: "users/resetpassword"})
            }, d.prototype.emailSetting = function(a, b, c) {
                switch (a) {
                    case "setMain":
                        return this.sync("update", this, {silentError: !0,url: "users/email/" + b,attrs: {},success: function(a) {
                            return function(b) {
                                return a.set(a.parse(b)), c(null, "设置成功")
                            }
                        }(this),error: c});
                    case "resend":
                        return this.sync("create", this, {silentError: !0,url: "users/email/" + b + "/send",attrs: {},success: function() {
                            return c(null, "发送成功")
                        },error: c});
                    case "delete":
                        return this.sync("delete", this, {silentError: !0,url: "users/email/" + b,success: function(a) {
                            return function(b) {
                                return a.set(a.parse(b)), c(null, "删除成功")
                            }
                        }(this),error: c})
                }
            }, d.prototype.addEmail = function(a, b) {
                return this.sync("create", this, {silentError: !0,url: "users/email",attrs: {email: a},success: function(a) {
                    return function(c) {
                        return a.set(a.parse(c)), b(null, "添加成功")
                    }
                }(this),error: b})
            }, d
        }(d)
    });
    var a = {}.hasOwnProperty, b = function(b, c) {
        function d() {
            this.constructor = b
        }
        for (var e in c)
            a.call(c, e) && (b[e] = c[e]);
        return d.prototype = c.prototype, b.prototype = new d, b.__super__ = c.prototype, b
    };
    define("models/preference", ["require", "exports", "module", "jquery.cookie", "teambition", "model", "store"], function(a) {
        var c, d, e, f, g, h;
        return h = a("jquery.cookie"), g = a("teambition"), c = a("model"), e = a("store"), f = e.namespace("preference"), d = function(a) {
            function c() {
                return c.__super__.constructor.apply(this, arguments)
            }
            return b(c, a), c.prototype.name = "preference", c.prototype.urlRoot = "preferences", c.prototype.defaults = {memberBarMode: "mini",hideDoneTasks: 0,postMode: "html",quickCreateTask: !1,quickReply: !1}, c.prototype.initialize = function() {
                var a;
                return this.localCacheId = this.get("_userId"), a = f(this.localCacheId), a && this.set(a), this.on("change", function(a) {
                    return function() {
                        return f(a.localCacheId, a.toJSON())
                    }
                }(this)), c.__super__.initialize.apply(this, arguments)
            }, c.prototype.toggleMemberBarMode = function(a) {
                var b;
                return null == a && (a = "full" === this.get("memberBarMode") ? "mini" : "full"), g.user.get("isGhost") ? this.set("memberBarMode", a) : (b = {memberBarMode: a}, this.save(b, {attrs: b})), a
            }, c.prototype.quickReply = function(a) {
                var b;
                return b = {quickReply: !!a}, null != a && this.save(b, {attrs: b}), this.get("quickReply")
            }, c.prototype.quickCreateTask = function(a) {
                var b;
                return b = {quickCreateTask: !!a}, null != a && this.save(b, {attrs: b}), this.get("quickCreateTask")
            }, c.prototype.togglePostMode = function(a) {
                var b;
                return b = {postMode: a}, a && this.save(b, {attrs: b}), this.get("postMode")
            }, c.prototype.toggleTasklistBar = function(a) {
                return null != a && this.set("pinTasklistBar", !!a), this.get("pinTasklistBar")
            }, c.prototype.tempMark = function(a, b) {
                return null != b && f("temp_" + a, b), f("temp_" + a)
            }, c.prototype.tasksSortInStage = function(a, b) {
                var c, d;
                return d = this.get("taskSort") || {}, this.get("taskSort") || this.set("taskSort", d), _.isArray(b) && !_.isEqual(b, d[a]) && (d[a] = b, c = {taskSort: {}}, c.taskSort[a] = b, this.save(null, {attrs: c})), d[a] || []
            }, c.prototype.tasklistSortInProject = function(a, b) {
                var c, d;
                return d = this.get("tasklist") || {}, this.get("tasklist") || this.set("tasklist", d), _.isArray(b) && !_.isEqual(b, d[a]) && (d[a] = b, c = {}, c[a] = b, this.saveAttr("tasklist", c)), d[a] || []
            }, c.prototype.structureNotification = function(a) {
                var b, c, d, e, f, g, h, i, j;
                b = this.attributes.notification, e = {comment: {mobile: b.comment.mobile,email: b.comment.email},involve: {mobile: b.involve.mobile,email: b.involve.email},newpost: {mobile: b.newpost.mobile,email: b.newpost.email},newtask: {mobile: b.newtask.mobile,email: b.newtask.email},newwork: {mobile: b.newwork.mobile,email: b.newwork.email},newevent: {mobile: null != (g = b.newevent) ? g.mobile : void 0,email: null != (h = b.newevent) ? h.email : void 0},update: {mobile: b.update.mobile,email: b.update.email},daily: {email: null != (i = b.daily) ? i.email : void 0},monthly: {email: null != (j = b.monthly) ? j.email : void 0}};
                for (c in a)
                    f = a[c], d = c.split("."), e[d[0]][d[1]] = f;
                return e
            }, c.prototype.updateNotification = function(a, b) {
                var c;
                return b || (b = {}), c = {notification: this.structureNotification(a)}, b.attrs = c, this.save(c, b), this
            }, c.prototype.structureGuide = function(a, b) {
                var c, d, e, f, g, h, i, j, k, l;
                if (g = ["navCreate", "navMy", "navInbox", "navThree", "memberAdd", "homeToday", "tasksGroup", "tasksStage", "postsMore", "eventAcano", "orgImport", "orgGroup", "orgRight", "orgBar", "orgTeamCreate", "orgTeamSet", "orgTeamProject"], c = this.attributes.tips || {}, d = {}, !b && _.isEmpty(c)) {
                    for (i = 0, k = g.length; k > i; i++)
                        e = g[i], c[e] = !1;
                    c.eventAcano = !0
                }
                for (j = 0, l = g.length; l > j; j++)
                    e = g[j], d[e] = c.hasOwnProperty(e) ? c[e] : !0;
                if (!a)
                    return d;
                for (f in a)
                    h = a[f], d[f] = h;
                return d
            }, c.prototype.updateGuide = function(a, b, c) {
                var d;
                return null == b && (b = !1), c || (c = {}), d = {tips: this.structureGuide(a, b)}, c.attrs = d, c.url = "" + this.url() + "/tips", this.save(d, c), this
            }, c.prototype.getLang = function() {
                return this.get("language") || $.cookie("lang")
            }, c.prototype.updateLang = function(a) {
                var b, c, d, e;
                if (d = function() {
                    return function() {
                        return _.delay(function() {
                            return window.location.reload()
                        }, 100)
                    }
                }(this), e = $.cookie("lang"), a && a !== this.get("language")) {
                    if ("en" !== a && "zh" !== a && "ja" !== a)
                        return !1;
                    this.save({language: a}, {attrs: {language: a},success: function() {
                        return d()
                    }})
                } else
                    (a = this.get("language")) || (a = e);
                return c = location.host.split(".").slice(-2), c[1] >= 0 || (b = c.join(".")), $.removeCookie("lang"), $.cookie("lang", a, {expires: 7,path: "/",domain: b || location.host})
            }, c
        }(c)
    }), define("lib/moment", ["require", "exports", "module", "moment"], function(a) {
        var b, c;
        return c = a("moment"), b = "ZH", "ZH" === b ? c.locale("zh", {months: "一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort: "1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays: "周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysShort: "周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin: "日_一_二_三_四_五_六".split("_"),longDateFormat: {LT: "Ah:mm",L: "YYYY年MMMD日",LL: "YYYY年MMMD日",LLL: "YYYY年MMMD日LT",LLLL: "YYYY年MMMD日ddddLT",l: "YYYY年MMMD日",ll: "YYYY年MMMD日",lll: "YYYY年MMMD日 LT",llll: "YYYY年MMMD日ddddLT"},relativeTime: {future: "%s内",past: "%s前",s: "几秒",m: "1分钟",mm: "%d分钟",h: "1小时",hh: "%d小时",d: "1天",dd: "%d天",M: "1个月",MM: "%d个月",y: "1年",yy: "%d年"},week: {dow: 1},calendar: {sameDay: "[今天]",nextDay: "[明天]",lastDay: "[昨天]",lastWeek: function() {
            var a, b;
            return b = c().startOf("week"), a = this.unix() < b.unix() ? "[上]" : "", a + "dddd"
        },nextWeek: function() {
            var a, b;
            return b = c().startOf("week"), a = this.unix() - b.unix() >= 604800 ? "[下]" : "", a + "dddd"
        },sameElse: function() {
            return this.year() === c().year() ? "MMMD日" : "LL"
        }},meridiem: function(a, b) {
            var c;
            return c = 100 * a + b, 500 > c ? "凌晨" : 900 > c ? "早上" : 1130 > c ? "上午" : 1230 > c ? "中午" : 1800 > c ? "下午" : "晚上"
        },ordinal: function(a, b) {
            switch (b) {
                case "d":
                case "D":
                case "DDD":
                    return a + "日";
                case "M":
                    return a + "月";
                case "w":
                case "W":
                    return a + "周";
                default:
                    return a
            }
        }}) : "JA" === b ? c.locale("ja", {months: "1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),monthsShort: "1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays: "日曜日_月曜日_火曜日_水曜日_木曜日_金曜日_土曜日".split("_"),weekdaysShort: "日_月_火_水_木_金_土".split("_"),weekdaysMin: "日_月_火_水_木_金_土".split("_"),longDateFormat: {LT: "Ah:mm",L: "YYYY/MM/DD",LL: "YYYY年M月D日",LLL: "YYYY年M月D日LT",LLLL: "YYYY年M月D日LT dddd"},meridiem: function(a) {
            return 12 > a ? "午前" : "午後"
        },ordinal: function(a, b) {
            switch (b) {
                case "d":
                case "D":
                case "DDD":
                    return a + "日";
                case "M":
                    return a + "月";
                case "w":
                case "W":
                    return a + "週";
                default:
                    return a
            }
        },calendar: {sameDay: "[今日]",nextDay: "[明日]",nextWeek: "[来週]dddd",lastDay: "[昨日]",lastWeek: "[前週]dddd",sameElse: "L"},relativeTime: {future: "%s後",past: "%s前",s: "数秒",m: "1分",mm: "%d分",h: "1時間",hh: "%d時間",d: "1日",dd: "%d日",M: "1ヶ月",MM: "%dヶ月",y: "1年",yy: "%d年"}}) : c.locale("en", {calendar: {lastDay: "[Yesterday]",sameDay: "[Today]",nextDay: "[Tomorrow]",lastWeek: function() {
            var a, b;
            return b = c().startOf("week"), a = this.unix() < b.unix() ? "[Last] " : "", a + "dddd"
        },nextWeek: function() {
            var a, b;
            return b = c().startOf("week"), a = this.unix() - b.unix() >= 604800 ? "[Next] " : "", a + "dddd"
        },sameElse: function() {
            return this.year() === c().year() ? "MMM D" : "LL"
        }}})
    }), define("jqueryFn", ["require", "exports", "module", "jquery", "underscore", "moment"], function(a) {
        var b, c, d, e, f, g, h;
        return b = a("jquery"), f = a("underscore"), e = a("moment"), d = b(document), c = b("body"), h = null, g = function(a) {
            var d;
            return h || (h = setInterval(function() {
                return g()
            }, 6e4)), a || (a = c.find(".time-stamp"), a.length || (clearInterval(h), h = null)), d = e(), a.each(function() {
                var a, c, f, g;
                return a = b(this), c = e(a.attr("datetime") || a.data("timestamp")), c.valueOf() ? (f = "", c.year() !== d.year() ? f = c.format("L") : (g = d.diff(c, "hour", !0), f = 1 > g ? c.fromNow() : c.calendar() + " " + c.format("LT")), a.text(f)) : void 0
            })
        }, b.fn.isVisible = function() {
            var a;
            return a = this.get(0).getBoundingClientRect(), !!(a.bottom - a.top)
        }, b.fn.selectRange = function(a, b) {
            return this.each(function() {
                var c;
                return this.setSelectionRange ? (this.focus(), this.setSelectionRange(a, b)) : this.createTextRange ? (c = this.createTextRange(), c.collapse(!0), c.moveEnd("character", b), c.moveStart("character", a), c.select()) : void 0
            })
        }, b.fn.focusAtEnd = function() {
            return this.each(function() {
                var a, c, d;
                a = b(this), d = a.val().length;
                try {
                    return a.selectRange(d, d), this.scrollTop = 999999
                } catch (e) {
                    return c = e, this.focus()
                }
            })
        }, b.fn.timesince = function() {
            return g(b(this)), this
        }, b.fn.handleClickOutside = function(a, e, g) {
            var h, i;
            return null == e && (e = "click"), h = this, i = ".datepicker", g && (i += "," + g), f.delay(function(f) {
                return function() {
                    return d.one(e, function(d) {
                        var j;
                        if (f.closest(c).length)
                            return j = b(d.target), j.closest(h).length || j.closest(i).length || !j.closest(c).length ? f.handleClickOutside(a, e, g) : a(d)
                    })
                }
            }(this))
        }
    }), require.config({paths: {jquery: "../../bower_components/jquery/dist/jquery","jquery-ui": "../../bower_components/jquery-ui/ui","jquery.cookie": "../../bower_components/jquery.cookie/jquery.cookie","jquery.transit": "../../bower_components/jquery.transit/jquery.transit","bootstrap-js": "../../bower_components/UI/dist/js/teambition-ui",underscore: "../../bower_components/underscore/underscore",backbone: "../../bower_components/backbone/backbone","jquery.mousewheel": "../../bower_components/jquery-mousewheel/jquery.mousewheel","jquery.ui.touch": "../../bower_components/jquery.ui.touch/jquery.ui.touch-punch",flexText: "../../bower_components/tb.flexText/tb.flexText",mousetrap: "../../bower_components/mousetrap/mousetrap",markdown: "../../bower_components/tb.marked/lib/tb.marked",essage: "../../bower_components/tb.essage/src/essage",thenjs: "../../bower_components/thenjs/then",pdf: "../../bower_components/PDFObject/pdfobject",gta: "../../bower_components/gta/lib/index",moment: "../../bower_components/momentjs/moment",webuploader: "../../bower_components/webuploader/dist/webuploader.html5only",pen: "../../bower_components/pen/src/pen",store: "../../bower_components/store2/dist/store2",md5: "../../bower_components/blueimp-md5/js/md5",favico: "../../bower_components/favico.js/favico",highlight: "../../bower_components/highlightjs/highlight.tb","bootstrap-datepicker": "../../bower_components/bootstrap-datepicker/js/bootstrap-datepicker",sockjs: "../../bower_components/sockjs/sockjs",rrule: "../../bower_components/rrule/lib/rrule",ichart: "../../bower_components/ichart/ichart.1.2.1.src",dropins: "../../bower_components/dropins/dropins",spider: "../../bower_components/spider/index",charts: "../../bower_components/charts/dist/app",caretjs: "../../bower_components/tb.caret.js/src/jquery.caret",uaParser: "../../bower_components/ua-parser-js/src/ua-parser",warehouse: "../../bower_components/warehouse/lib/index",expireCache: "../../bower_components/expire-cache/index",teambition: "global",model: "../../lib/model",collection: "../../lib/collection",hotkey: "../../lib/hotkey",util: "../../lib/util",jqueryFn: "../../lib/jquery-fn",view: "../../lib/view",views: "../../components/views",models: "../../components/models",collections: "../../components/collections",lib: "../../lib"},shim: {pen: {exports: "Pen"},"bootstrap-js": ["jquery"],"jquery.cookie": ["jquery"],"jquery.transit": ["jquery"],"jquery.mousewheel": ["jquery"],flexText: ["jquery"],"bootstrap-datepicker": ["jquery", "bootstrap-js"],warehouse: ["backbone"],ichart: {exports: "iChart"},caretjs: {deps: ["jquery"]}}}), require(["jquery", "underscore", "backbone", "favico", "spider", "gta", "uaParser", "util", "lib/http", "thenjs", "markdown", "store", "moment", "teambition", "router", "lib/hint/index", "lib/socket", "app", "model", "models/user", "models/project", "models/preference", "collections/projects", "collections/organizations", "collections/apps", "lib/moment", "bootstrap-js", "pdf", "jquery.transit", "jquery.mousewheel", "essage", "bootstrap-datepicker", "ichart", "dropins", "jquery-ui/droppable", "jquery-ui/autocomplete", "jquery-ui/sortable", "jquery.ui.touch", "jqueryFn"], function(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y) {
        var z, A, B, C, D, E, F, G, H, I, J;
        z = "ZH", p.initialize(), i.initialize(), k.setOptions({breaks: !0,keepBreaks: !1,sanitize: !0,smartLists: !0}), H = new g, a("body").addClass("" + H.getOS().name.toLowerCase() + " " + H.getBrowser().name.toLowerCase()), a("body").on("dragover dragenter drop", function() {
            return !1
        }), "function" == typeof window.initNwPlugin && window.initNwPlugin(z), window._encodeHTML = function(a, c) {
            return "md" === (null != c ? c.toLowerCase() : void 0) ? k(b.unescape(a)) : h.escape(a)
        }, n.gta = f, j.onerror = function(a) {
            return console.error(a)
        }, J = function(a) {
            return a >= -2 && 2 >= a ? Math.floor(a) : -2
        }, s.prototype.getRight = function() {
            var a, b, c, d, e, f;
            return "organization" === this.get("objectType") ? this.get("hasRight") : ("project" === this.get("objectType") ? d = this : (f = this.get("_projectId")) ? d = w.getOne(0, f) : (e = this.get("_organizationId")) && (c = x.getOne(0, e)), d || c ? (a = c ? c.get("hasRight") : d.get("hasOrgRight"), b = null != d ? d.get("hasRight") : void 0, Math.max(J(b), J(a))) : -2)
        }, s.prototype.hasRight = function() {
            return this._hasRight >= -2 || (this._hasRight = "project" !== this.get("objectType") && this.get("_creatorId") === n.user.id ? 2 : this.getRight()), this._hasRight
        }, s.prototype.isAdmin = function() {
            return this.getRight() > 0
        }, u.prototype.isOverdue = function() {
            var a, b;
            return a = x.get(0), null != (b = a.get(this.get("_organizationId"))) ? b.isOverdue() : void 0
        }, u.prototype.isExpiring = function() {
            var a, b;
            return a = x.get(0), null != (b = a.get(this.get("_organizationId"))) ? b.isExpiring() : void 0
        };
        try {
            n.favico = new d({animation: "popFade"})
        } catch (K) {
            B = K
        }
        return E = function() {
            var a;
            try {
                if (n.gta.event("teambition", "view", "teambition|enter teambition"), a = n.user.toJSON(), a.isGhost)
                    return n.gta.event("teambition", "view", "teambition|guest enter teambition")
            } catch (b) {
                B = b
            }
        }, D = function(a) {
            var b;
            return console.error(a), b = encodeURIComponent(window.location.href), window.location = "" + n.accountHost + "/login?next_url=" + b
        }, C = function() {
            return y.fetch(), n.APP = new r, n.router = new o, n.router.start(), a("#bodyloadinglayer").addClass("fading"), setTimeout(function() {
                return a("#bodyloadinglayer").remove()
            }, 218), E(), q.connect(n.pushHost)
        }, F = function(a) {
            var b, c;
            if (n.spiderHost)
                try {
                    b = {_userId: a.id,client: "6b83ecde2891d635908c7990123e1128"}, b.host = n.spiderHost, n.spider = new e(b), c = a.toJSON(), mixpanel.identify(c._id)
                } catch (d) {
                    B = d
                }
            return n.PREFERENCE = new v({_userId: a.id}), a.isGhost ? C() : j.parallel([function(a) {
                return w.fetch(0, {success: function() {
                    return a()
                },error: function(b, c) {
                    return a(c)
                }})
            }, function(a) {
                return x.fetch(0, {success: function() {
                    return a()
                },error: function(b, c) {
                    return a(c)
                }})
            }, function(a) {
                return n.PREFERENCE.id ? a() : n.PREFERENCE.fetch({success: function() {
                    return a()
                },error: function(b, c) {
                    return a(c)
                }})
            }]).then(function() {
                return C(), A(), n.PREFERENCE.fetch({success: function() {
                    return function() {
                        return n.PREFERENCE.updateLang()
                    }
                }(this)})
            }).fail(function(a, b) {
                return D(b)
            })
        }, I = function() {
            return n.user.fetch({url: "users/me",silentError: !0,success: F,error: function() {
                return F(n.user.toJSON())
            }})
        }, A = function() {
            var b, c;
            return b = 0, c = function() {
                return n.user.fetchBadge(), b += 1, 10 > b ? window.setTimeout(c, 18e4) : void 0
            }, a(document).on("click", function() {
                return b >= 10 ? (b = 0, c()) : b = 0
            }), c()
        }, n.user = new t({_id: 0}), n.socket = q, I(), G = l("teambition"), !G || Date.now() - new Date(G) > 1296e6 ? (l.namespace("temp").clearAll(), l("teambition", new Date)) : void 0
    }), define("main", function() {
    })
}();
